<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BW Calculator - Ï†ïÍ∑úÌôî Í∞ÄÍ≤© ÎπÑÍµê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000000;
            color: #ffffff;
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-x: auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #4caf50;
        }
        
        .header p {
            font-size: 14px;
            color: #888;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .section {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
        }
        
        .section-title {
            font-size: 18px;
            color: #4caf50;
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        
        .price-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .coin-data {
            background: #151515;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        
        .coin-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .btc-color { color: #f7931a; }
        .eth-color { color: #9a8ff8; }
        .sol-color { color: #00FFA3; }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .price-value {
            font-family: 'Monaco', 'Consolas', monospace;
            font-weight: bold;
        }
        
        .calculation-section {
            background: #0f0f0f;
            border: 2px solid #4caf50;
        }
        
        .ratio-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .ratio-card {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .baseline-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #888;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .baseline-btn:hover {
            background: #2a2a2a;
            color: #fff;
            border-color: #555;
        }
        
        .baseline-btn.active {
            background: #4caf50;
            color: #000;
            border-color: #4caf50;
            font-weight: bold;
        }
        
        /* ÎπÑÍµê ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: #0a0a0a;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #333;
        }
        
        .comparison-table th {
            background: #1a1a1a;
            color: #4caf50;
            font-weight: bold;
            font-size: 14px;
        }
        
        .comparison-table td {
            color: #e0e0e0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .coin-cell {
            font-weight: bold;
        }
        
        .btc-cell { color: #f7931a; }
        .eth-cell { color: #9a8ff8; }
        .sol-cell { color: #00FFA3; }
        
        .eth-ratio { border-left-color: #9a8ff8; }
        .sol-ratio { border-left-color: #00FFA3; }
        
        .normalized-prices {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #666;
        }
        
        .normalized-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            text-align: center;
        }
        
        .normalized-item {
            padding: 10px;
            background: #1a1a1a;
            border-radius: 6px;
        }
        
        .change-display {
            margin-top: 15px;
            padding: 15px;
            background: #0a0a0a;
            border-radius: 8px;
        }
        
        .change-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .positive { color: #4caf50; }
        .negative { color: #f44336; }
        .neutral { color: #888; }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .control-btn {
            background: transparent;
            border: 1px solid #333;
            color: #666;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .arbitrage-opportunity {
            background: #1a0a0a;
            border: 2px solid #ff9800;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
        }
        
        .opportunity-title {
            color: #ff9800;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button class="control-btn" onclick="toggleCalculation()">üîÑ</button>
        <button class="control-btn" onclick="resetBaseline()">‚ö°</button>
    </div>

    <div class="header">
        <h1>BW Calculator - Ï†ïÍ∑úÌôî Í∞ÄÍ≤© ÎπÑÍµê ÏãúÏä§ÌÖú</h1>
        <p>ÎπÑÌä∏ÏΩîÏù∏ Í∏∞Ï§Ä Ï†ïÍ∑úÌôîÎ•º ÌÜµÌïú ÏÉÅÎåÄÏ†Å Í∞ÄÍ≤© ÎπÑÍµê Î∞è Ï∞®ÏùµÍ±∞Îûò Í∏∞Ìöå ÌÉêÏßÄ</p>
    </div>

    <div class="container">
        <!-- ÌòÑÏû¨ Í∞ÄÍ≤© ÌëúÏãú -->
        <div class="section">
            <div class="section-title">üìà ÌòÑÏû¨ Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞</div>
            <div class="price-display">
                <div class="coin-data">
                    <div class="coin-name btc-color">BTC (Í∏∞Ï§Ä)</div>
                    <div class="price-row">
                        <span>ÌòÑÏû¨Í∞Ä:</span>
                        <span class="price-value" id="btc-price">------</span>
                    </div>
                    <div class="price-row">
                        <span>24h Î≥ÄÌôî:</span>
                        <span class="price-value" id="btc-change">------</span>
                    </div>
                </div>
                
                <div class="coin-data">
                    <div class="coin-name eth-color">ETH</div>
                    <div class="price-row">
                        <span>ÌòÑÏû¨Í∞Ä:</span>
                        <span class="price-value" id="eth-price">------</span>
                    </div>
                    <div class="price-row">
                        <span>24h Î≥ÄÌôî:</span>
                        <span class="price-value" id="eth-change">------</span>
                    </div>
                </div>
                
                <div class="coin-data">
                    <div class="coin-name sol-color">SOL</div>
                    <div class="price-row">
                        <span>ÌòÑÏû¨Í∞Ä:</span>
                        <span class="price-value" id="sol-price">------</span>
                    </div>
                    <div class="price-row">
                        <span>24h Î≥ÄÌôî:</span>
                        <span class="price-value" id="sol-change">------</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ï†ïÍ∑úÌôî Í≥ÑÏÇ∞ -->
        <div class="section calculation-section">
            <div class="section-title">üßÆ Ï†ïÍ∑úÌôî ÎπÑÏú® Í≥ÑÏÇ∞</div>
            
            <!-- Í∏∞Ï§ÄÏ†ê ÏÑ†ÌÉù -->
            <div style="margin-bottom: 20px; padding: 15px; background: #1a1a1a; border-radius: 8px;">
                <div style="margin-bottom: 10px; color: #888; font-size: 14px;">Ï†ïÍ∑úÌôî Í∏∞Ï§ÄÏ†ê ÏÑ†ÌÉù:</div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="baseline-btn active" onclick="setBaselineMode('current')" id="current-btn">ÌòÑÏû¨Í∞Ä</button>
                    <button class="baseline-btn" onclick="setBaselineMode('24h-avg')" id="avg-btn">24h ÌèâÍ∑†</button>
                    <button class="baseline-btn" onclick="setBaselineMode('24h-open')" id="open-btn">24h ÏãúÍ∞Ä</button>
                    <button class="baseline-btn" onclick="setBaselineMode('24h-vwap')" id="vwap-btn">24h VWAP</button>
                    <button class="baseline-btn" onclick="setBaselineMode('manual')" id="manual-btn">ÏàòÎèô ÏÑ§Ï†ï</button>
                </div>
                <div style="margin-top: 10px; color: #666; font-size: 12px;" id="baseline-desc">
                    ÌòÑÏû¨Í∞Ä: Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤©ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÍ∑úÌôî (Î≥ÄÎèôÏÑ± ÎÜíÏùå, Ïã§ÏãúÍ∞Ñ Î∞òÏòÅ)
                </div>
            </div>
            
            <div class="ratio-display">
                <div class="ratio-card eth-ratio">
                    <div style="font-size: 14px; margin-bottom: 10px; color: #9a8ff8;">ETH ‚Üí BTC Ï†ïÍ∑úÌôî</div>
                    <div class="price-row">
                        <span>Í∏∞Ï§Ä ÎπÑÏú®:</span>
                        <span id="eth-ratio">------</span>
                    </div>
                    <div class="price-row">
                        <span>Ï†ïÍ∑úÌôî Î∞∞Ïàò:</span>
                        <span id="eth-multiplier">------</span>
                    </div>
                </div>
                
                <div class="ratio-card sol-ratio">
                    <div style="font-size: 14px; margin-bottom: 10px; color: #00FFA3;">SOL ‚Üí BTC Ï†ïÍ∑úÌôî</div>
                    <div class="price-row">
                        <span>Í∏∞Ï§Ä ÎπÑÏú®:</span>
                        <span id="sol-ratio">------</span>
                    </div>
                    <div class="price-row">
                        <span>Ï†ïÍ∑úÌôî Î∞∞Ïàò:</span>
                        <span id="sol-multiplier">------</span>
                    </div>
                </div>
            </div>

            <div class="normalized-prices">
                <div style="text-align: center; margin-bottom: 15px; font-size: 16px; color: #4caf50;">
                    Ï†ïÍ∑úÌôîÎêú Í∞ÄÍ≤© (BTC Î≤îÏ£ºÎ°ú Ï°∞Ï†ï)
                </div>
                <div class="normalized-grid">
                    <div class="normalized-item">
                        <div style="color: #f7931a; margin-bottom: 5px;">BTC</div>
                        <div class="price-value" id="normalized-btc">------</div>
                    </div>
                    <div class="normalized-item">
                        <div style="color: #9a8ff8; margin-bottom: 5px;">ETH (√ó<span id="eth-mult-display">--</span>)</div>
                        <div class="price-value" id="normalized-eth">------</div>
                    </div>
                    <div class="normalized-item">
                        <div style="color: #00FFA3; margin-bottom: 5px;">SOL (√ó<span id="sol-mult-display">--</span>)</div>
                        <div class="price-value" id="normalized-sol">------</div>
                    </div>
                </div>
            </div>

            <div class="change-display">
                <div style="text-align: center; margin-bottom: 10px; font-size: 14px; color: #888;">
                    Ï†ïÍ∑úÌôîÎêú Í∞ÄÍ≤© Î≥ÄÌôîÏú® ÎπÑÍµê
                </div>
                <div class="change-row">
                    <span>BTC Î≥ÄÌôî:</span>
                    <span id="btc-norm-change" class="neutral">------</span>
                </div>
                <div class="change-row">
                    <span>ETH Î≥ÄÌôî (Ï†ïÍ∑úÌôî):</span>
                    <span id="eth-norm-change" class="neutral">------</span>
                </div>
                <div class="change-row">
                    <span>SOL Î≥ÄÌôî (Ï†ïÍ∑úÌôî):</span>
                    <span id="sol-norm-change" class="neutral">------</span>
                </div>
            </div>

            <!-- Ï†ÑÏùº ÏµúÍ≥†Í∞Ä ÎåÄÎπÑ ÌòÑÏû¨Í∞Ä ÎπÑÏú® -->
            <div class="change-display">
                <div style="text-align: center; margin-bottom: 10px; font-size: 14px; color: #888;">
                    24h ÏµúÍ≥†Í∞Ä ÎåÄÎπÑ ÌòÑÏû¨Í∞Ä ÎπÑÏú® (ÏµúÍ≥†Í∞Ä=100%)
                </div>
                <div class="change-row">
                    <span>BTC ÌòÑÏû¨ ÏúÑÏπò:</span>
                    <span id="btc-high-ratio" class="neutral">------</span>
                </div>
                <div class="change-row">
                    <span>ETH ÌòÑÏû¨ ÏúÑÏπò:</span>
                    <span id="eth-high-ratio" class="neutral">------</span>
                </div>
                <div class="change-row">
                    <span>SOL ÌòÑÏû¨ ÏúÑÏπò:</span>
                    <span id="sol-high-ratio" class="neutral">------</span>
                </div>
            </div>
            
            <!-- ÎπÑÍµê ÌÖåÏù¥Î∏î -->
            <div style="margin-top: 20px;">
                <div style="text-align: center; margin-bottom: 15px; font-size: 16px; color: #4caf50;">
                    Ï†ïÍ∑úÌôîÎêú Í∞ÄÍ≤© ÎπÑÍµê ÌÖåÏù¥Î∏î
                </div>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ÏΩîÏù∏Î™Ö</th>
                            <th>BTCÍ∞ÄÍ≤© (A)</th>
                            <th>Ï†ïÍ∑úÌôîÍ∞ÄÍ≤© (B)</th>
                            <th>Ï∞®Ïï° (A-B)</th>
                            <th>ÎåÄÏÉÅÏΩîÏù∏ÏúºÎ°ú Î≥ÄÌôò</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="coin-cell btc-cell">BTC</td>
                            <td id="table-btc-btc-price">------</td>
                            <td id="table-btc-normalized">------</td>
                            <td id="table-btc-diff-usd">Í∏∞Ï§Ä</td>
                            <td id="table-btc-diff-coin">Í∏∞Ï§Ä</td>
                        </tr>
                        <tr>
                            <td class="coin-cell eth-cell">ETH</td>
                            <td id="table-eth-btc-price">------</td>
                            <td id="table-eth-normalized">------</td>
                            <td id="table-eth-diff-usd">------</td>
                            <td id="table-eth-diff-coin">------</td>
                        </tr>
                        <tr>
                            <td class="coin-cell sol-cell">SOL</td>
                            <td id="table-sol-btc-price">------</td>
                            <td id="table-sol-normalized">------</td>
                            <td id="table-sol-diff-usd">------</td>
                            <td id="table-sol-diff-coin">------</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ï∞®ÏùµÍ±∞Îûò Í∏∞Ìöå -->
        <div class="arbitrage-opportunity">
            <div class="opportunity-title">‚ö° Ï∞®ÏùµÍ±∞Îûò Í∏∞Ìöå Î∂ÑÏÑù</div>
            <div id="arbitrage-analysis">
                Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï§ë...
            </div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let baselinePrices = {};
        let currentPrices = {};
        let normalizationRatios = {};
        let isCalculating = true;
        let dailyHighPrices = {}; // 24ÏãúÍ∞Ñ ÏµúÍ≥†Í∞Ä Ï†ÄÏû•
        let dailyLowPrices = {}; // 24ÏãúÍ∞Ñ ÏµúÏ†ÄÍ∞Ä Ï†ÄÏû•
        let dailyOpenPrices = {}; // 24ÏãúÍ∞Ñ ÏãúÍ∞Ä Ï†ÄÏû•
        let dailyVolumes = {}; // 24ÏãúÍ∞Ñ Í±∞ÎûòÎüâ Ï†ÄÏû•
        let baselineMode = 'current'; // Í∏∞Ï§ÄÏ†ê Î™®Îìú

        // Í∏∞Ï§ÄÏ†ê Î™®Îìú ÏÑ§Ï†ï
        function setBaselineMode(mode) {
            baselineMode = mode;
            
            // Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.baseline-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode + '-btn').classList.add('active');
            
            // ÏÑ§Î™Ö ÏóÖÎç∞Ïù¥Ìä∏
            const descriptions = {
                'current': 'ÌòÑÏû¨Í∞Ä: Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤©ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÍ∑úÌôî (Î≥ÄÎèôÏÑ± ÎÜíÏùå, Ïã§ÏãúÍ∞Ñ Î∞òÏòÅ)',
                '24h-avg': '24h ÌèâÍ∑†: (Í≥†Í∞Ä+Ï†ÄÍ∞Ä)/2 Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÍ∑úÌôî (ÏïàÏ†ïÏ†Å, Ï§ëÍ∞ÑÍ∞í Î∞òÏòÅ)',
                '24h-open': '24h ÏãúÍ∞Ä: Ïò§Îäò ÏãúÏûë Í∞ÄÍ≤© Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÍ∑úÌôî (ÏùºÏùº ÏãúÏûëÏ†ê Í∏∞Ï§Ä)',
                '24h-vwap': '24h VWAP: Í±∞ÎûòÎüâ Í∞ÄÏ§ë ÌèâÍ∑† Í∞ÄÍ≤© Í∏∞Ï§Ä (Ïã§Ï†ú Í±∞Îûò Î∞òÏòÅ)',
                'manual': 'ÏàòÎèô ÏÑ§Ï†ï: ÏÇ¨Ïö©ÏûêÍ∞Ä ÏßÅÏ†ë Í∏∞Ï§ÄÏ†ê ÏÑ§Ï†ï (Í≥†Ï†ïÎêú Í∏∞Ï§ÄÏ†ê)'
            };
            document.getElementById('baseline-desc').textContent = descriptions[mode];
            
            // ÏÉàÎ°úÏö¥ Í∏∞Ï§ÄÏúºÎ°ú Îã§Ïãú Í≥ÑÏÇ∞
            if (currentPrices.btc && currentPrices.eth && currentPrices.sol) {
                setBaseline();
            }
        }
        
        // Ï¥àÍ∏∞ Í∏∞Ï§ÄÏ†ê ÏÑ§Ï†ï
        function setBaseline() {
            if (!currentPrices.btc || !currentPrices.eth || !currentPrices.sol) return;
            
            let basePrices = {};
            
            switch(baselineMode) {
                case 'current':
                    basePrices = { ...currentPrices };
                    break;
                case '24h-avg':
                    basePrices = {
                        btc: (dailyHighPrices.btc + dailyLowPrices.btc) / 2,
                        eth: (dailyHighPrices.eth + dailyLowPrices.eth) / 2,
                        sol: (dailyHighPrices.sol + dailyLowPrices.sol) / 2
                    };
                    break;
                case '24h-open':
                    basePrices = { ...dailyOpenPrices };
                    break;
                case '24h-vwap':
                    // Í∞ÑÎã®Ìïú VWAP Í∑ºÏÇ¨Ïπò (Ïã§Ï†úÎ°úÎäî Îçî Î≥µÏû°Ìïú Í≥ÑÏÇ∞ ÌïÑÏöî)
                    basePrices = {
                        btc: (currentPrices.btc + dailyHighPrices.btc + dailyLowPrices.btc + dailyOpenPrices.btc) / 4,
                        eth: (currentPrices.eth + dailyHighPrices.eth + dailyLowPrices.eth + dailyOpenPrices.eth) / 4,
                        sol: (currentPrices.sol + dailyHighPrices.sol + dailyLowPrices.sol + dailyOpenPrices.sol) / 4
                    };
                    break;
                case 'manual':
                    // ÏàòÎèô ÏÑ§Ï†ïÏùò Í≤ΩÏö∞ Í∏∞Ï°¥ baselinePrices Ïú†ÏßÄ
                    if (!baselinePrices.btc) {
                        basePrices = { ...currentPrices };
                    } else {
                        basePrices = { ...baselinePrices };
                    }
                    break;
            }
            
            baselinePrices = basePrices;
            
            // BTC Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÍ∑úÌôî ÎπÑÏú® Í≥ÑÏÇ∞
            normalizationRatios.eth = baselinePrices.btc / baselinePrices.eth;
            normalizationRatios.sol = baselinePrices.btc / baselinePrices.sol;
            
            console.log(`Baseline set (${baselineMode}):`, baselinePrices);
            console.log('Normalization ratios:', normalizationRatios);
            
            updateRatioDisplay();
        }

        // ÎπÑÏú® ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateRatioDisplay() {
            if (baselinePrices.btc && baselinePrices.eth && baselinePrices.sol) {
                document.getElementById('eth-ratio').textContent = 
                    `1 ETH = ${(baselinePrices.eth / baselinePrices.btc).toFixed(4)} BTC`;
                document.getElementById('eth-multiplier').textContent = 
                    `√ó${normalizationRatios.eth.toFixed(2)}`;
                
                document.getElementById('sol-ratio').textContent = 
                    `1 SOL = ${(baselinePrices.sol / baselinePrices.btc).toFixed(6)} BTC`;
                document.getElementById('sol-multiplier').textContent = 
                    `√ó${normalizationRatios.sol.toFixed(2)}`;
                
                document.getElementById('eth-mult-display').textContent = 
                    normalizationRatios.eth.toFixed(1);
                document.getElementById('sol-mult-display').textContent = 
                    normalizationRatios.sol.toFixed(1);
            }
        }

        // Ï†ïÍ∑úÌôîÎêú Í∞ÄÍ≤© Í≥ÑÏÇ∞ Î∞è ÌëúÏãú
        function updateNormalizedPrices() {
            if (!normalizationRatios.eth || !normalizationRatios.sol) return;
            
            const normalizedETH = currentPrices.eth * normalizationRatios.eth;
            const normalizedSOL = currentPrices.sol * normalizationRatios.sol;
            
            // Ï†ïÍ∑úÌôîÎêú Í∞ÄÍ≤© ÌëúÏãú
            document.getElementById('normalized-btc').textContent = formatPrice(currentPrices.btc);
            document.getElementById('normalized-eth').textContent = formatPrice(normalizedETH);
            document.getElementById('normalized-sol').textContent = formatPrice(normalizedSOL);
            
            // Î≥ÄÌôîÏú® Í≥ÑÏÇ∞ (Í∏∞Ï§ÄÏ†ê ÎåÄÎπÑ)
            if (baselinePrices.btc) {
                const btcChange = ((currentPrices.btc - baselinePrices.btc) / baselinePrices.btc) * 100;
                const ethNormChange = ((normalizedETH - baselinePrices.btc) / baselinePrices.btc) * 100;
                const solNormChange = ((normalizedSOL - baselinePrices.btc) / baselinePrices.btc) * 100;
                
                updateChangeDisplay('btc-norm-change', btcChange);
                updateChangeDisplay('eth-norm-change', ethNormChange);
                updateChangeDisplay('sol-norm-change', solNormChange);
                
                // Ï∞®ÏùµÍ±∞Îûò Í∏∞Ìöå Î∂ÑÏÑù
                analyzeArbitrageOpportunity(btcChange, ethNormChange, solNormChange);
            }
        }

        // Î≥ÄÌôîÏú® ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateChangeDisplay(elementId, change) {
            const element = document.getElementById(elementId);
            const changeStr = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            element.textContent = changeStr;
            
            if (change > 0.5) {
                element.className = 'positive';
            } else if (change < -0.5) {
                element.className = 'negative';
            } else {
                element.className = 'neutral';
            }
        }

        // Ï∞®ÏùµÍ±∞Îûò Í∏∞Ìöå Î∂ÑÏÑù
        function analyzeArbitrageOpportunity(btcChange, ethChange, solChange) {
            const analysisDiv = document.getElementById('arbitrage-analysis');
            let analysis = '';
            
            const threshold = 1.0; // 1% Ïù¥ÏÉÅ Ï∞®Ïù¥
            
            // BTC vs ETH ÎπÑÍµê
            const btcEthDiff = Math.abs(btcChange - ethChange);
            if (btcEthDiff > threshold) {
                const stronger = btcChange > ethChange ? 'BTC' : 'ETH';
                const weaker = btcChange > ethChange ? 'ETH' : 'BTC';
                analysis += `üî• BTC-ETH Ï∞®ÏùµÍ∏∞Ìöå: ${stronger} ÏÉÅÏäπÏÑ∏ Í∞ïÌï® (Ï∞®Ïù¥: ${btcEthDiff.toFixed(2)}%)\n`;
            }
            
            // BTC vs SOL ÎπÑÍµê
            const btcSolDiff = Math.abs(btcChange - solChange);
            if (btcSolDiff > threshold) {
                const stronger = btcChange > solChange ? 'BTC' : 'SOL';
                const weaker = btcChange > solChange ? 'SOL' : 'BTC';
                analysis += `üî• BTC-SOL Ï∞®ÏùµÍ∏∞Ìöå: ${stronger} ÏÉÅÏäπÏÑ∏ Í∞ïÌï® (Ï∞®Ïù¥: ${btcSolDiff.toFixed(2)}%)\n`;
            }
            
            // ETH vs SOL ÎπÑÍµê
            const ethSolDiff = Math.abs(ethChange - solChange);
            if (ethSolDiff > threshold) {
                const stronger = ethChange > solChange ? 'ETH' : 'SOL';
                const weaker = ethChange > solChange ? 'SOL' : 'ETH';
                analysis += `üî• ETH-SOL Ï∞®ÏùµÍ∏∞Ìöå: ${stronger} ÏÉÅÏäπÏÑ∏ Í∞ïÌï® (Ï∞®Ïù¥: ${ethSolDiff.toFixed(2)}%)\n`;
            }
            
            if (analysis === '') {
                analysis = 'ÌòÑÏû¨ Ï∞®ÏùµÍ±∞Îûò Í∏∞Ìöå ÏóÜÏùå (Î™®Îì† ÏΩîÏù∏Ïù¥ Ïú†ÏÇ¨Ìïú ÏõÄÏßÅÏûÑ)';
            }
            
            analysisDiv.style.whiteSpace = 'pre-line';
            analysisDiv.textContent = analysis;
        }

        // 24ÏãúÍ∞Ñ ÏµúÍ≥†Í∞Ä ÎåÄÎπÑ ÌòÑÏû¨Í∞Ä ÎπÑÏú® ÏóÖÎç∞Ïù¥Ìä∏
        function updateHighRatio(coinType, currentPrice, highPrice) {
            if (!currentPrice || !highPrice || highPrice === 0) return;
            
            const ratio = (currentPrice / highPrice) * 100;
            const elementId = `${coinType}-high-ratio`;
            const element = document.getElementById(elementId);
            
            if (element) {
                element.textContent = `${ratio.toFixed(1)}%`;
                
                // ÏÉâÏÉÅ ÏßÄÏ†ï: 90% Ïù¥ÏÉÅ = ÎÖπÏÉâ, 80% Ïù¥ÏÉÅ = ÎÖ∏ÎûÄÏÉâ, Í∑∏ Ïô∏ = Îπ®Í∞ÑÏÉâ
                if (ratio >= 90) {
                    element.className = 'positive';
                } else if (ratio >= 80) {
                    element.className = 'neutral';
                    element.style.color = '#ffa726'; // Ïò§Î†åÏßÄÏÉâ
                } else {
                    element.className = 'negative';
                }
            }
        }

        // Í∞ÄÍ≤© Ìè¨Îß∑ÌåÖ
        function formatPrice(price) {
            if (price >= 1000) {
                return price.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            } else {
                return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }
        }

        // Binance WebSocket Ïó∞Í≤∞
        function connectWebSocket(symbol, priceId, changeId, coinType) {
            const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol.toLowerCase()}@ticker`);
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                const price = parseFloat(data.c);
                const change24h = parseFloat(data.P);
                const high24h = parseFloat(data.h); // 24ÏãúÍ∞Ñ ÏµúÍ≥†Í∞Ä
                const low24h = parseFloat(data.l); // 24ÏãúÍ∞Ñ ÏµúÏ†ÄÍ∞Ä
                const open24h = parseFloat(data.o); // 24ÏãúÍ∞Ñ ÏãúÍ∞Ä
                const volume24h = parseFloat(data.v); // 24ÏãúÍ∞Ñ Í±∞ÎûòÎüâ
                
                currentPrices[coinType] = price;
                dailyHighPrices[coinType] = high24h;
                dailyLowPrices[coinType] = low24h;
                dailyOpenPrices[coinType] = open24h;
                dailyVolumes[coinType] = volume24h;
                
                document.getElementById(priceId).textContent = formatPrice(price);
                document.getElementById(changeId).textContent = `${change24h >= 0 ? '+' : ''}${change24h.toFixed(2)}%`;
                document.getElementById(changeId).className = change24h >= 0 ? 'positive' : 'negative';
                
                // 24ÏãúÍ∞Ñ ÏµúÍ≥†Í∞Ä ÎåÄÎπÑ ÌòÑÏû¨Í∞Ä ÎπÑÏú® Í≥ÑÏÇ∞ Î∞è ÌëúÏãú
                updateHighRatio(coinType, price, high24h);
                
                // Í∏∞Ï§ÄÏ†êÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ ÏÑ§Ï†ï
                if (!baselinePrices.btc && currentPrices.btc && currentPrices.eth && currentPrices.sol) {
                    setBaseline();
                }
                
                // Ï†ïÍ∑úÌôîÎêú Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
                if (isCalculating && normalizationRatios.eth && normalizationRatios.sol) {
                    updateNormalizedPrices();
                    updateComparisonTable();
                }
            };
            
            return ws;
        }

        // Ïª®Ìä∏Î°§ Ìï®ÏàòÎì§
        function toggleCalculation() {
            isCalculating = !isCalculating;
            console.log('Calculation mode:', isCalculating ? 'ON' : 'OFF');
        }

        function resetBaseline() {
            if (currentPrices.btc && currentPrices.eth && currentPrices.sol) {
                setBaseline();
                console.log('Baseline reset');
            }
        }

        // ÎπÑÍµê ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
        function updateComparisonTable() {
            if (!normalizationRatios.eth || !normalizationRatios.sol) return;
            
            const normalizedETH = currentPrices.eth * normalizationRatios.eth;
            const normalizedSOL = currentPrices.sol * normalizationRatios.sol;
            
            // BTC (Í∏∞Ï§Ä)
            document.getElementById('table-btc-btc-price').textContent = '$' + formatPrice(currentPrices.btc);
            document.getElementById('table-btc-normalized').textContent = '$' + formatPrice(currentPrices.btc);
            document.getElementById('table-btc-diff-usd').textContent = 'Í∏∞Ï§Ä';
            document.getElementById('table-btc-diff-coin').textContent = 'Í∏∞Ï§Ä';
            
            // ETH Í≥ÑÏÇ∞
            const ethDiffUSD = currentPrices.btc - normalizedETH; // BTCÍ∞ÄÍ≤© - ETHÏ†ïÍ∑úÌôîÍ∞ÄÍ≤©
            const ethDiffCoin = ethDiffUSD / currentPrices.eth; // USD Ï∞®Ïï°ÏùÑ ETHÍ∞ÄÍ≤©ÏúºÎ°ú ÎÇòÎà†ÏÑú ETH ÏàòÎüâÏúºÎ°ú Î≥ÄÌôò
            
            document.getElementById('table-eth-btc-price').textContent = '$' + formatPrice(currentPrices.btc);
            document.getElementById('table-eth-normalized').textContent = '$' + formatPrice(normalizedETH);
            document.getElementById('table-eth-diff-usd').innerHTML = formatUSDDifference(ethDiffUSD);
            document.getElementById('table-eth-diff-coin').innerHTML = formatCoinDifference(ethDiffCoin, 'ETH');
            
            // SOL Í≥ÑÏÇ∞
            const solDiffUSD = currentPrices.btc - normalizedSOL; // BTCÍ∞ÄÍ≤© - SOLÏ†ïÍ∑úÌôîÍ∞ÄÍ≤©
            const solDiffCoin = solDiffUSD / currentPrices.sol; // USD Ï∞®Ïï°ÏùÑ SOLÍ∞ÄÍ≤©ÏúºÎ°ú ÎÇòÎà†ÏÑú SOL ÏàòÎüâÏúºÎ°ú Î≥ÄÌôò
            
            document.getElementById('table-sol-btc-price').textContent = '$' + formatPrice(currentPrices.btc);
            document.getElementById('table-sol-normalized').textContent = '$' + formatPrice(normalizedSOL);
            document.getElementById('table-sol-diff-usd').innerHTML = formatUSDDifference(solDiffUSD);
            document.getElementById('table-sol-diff-coin').innerHTML = formatCoinDifference(solDiffCoin, 'SOL');
        }
        
        // USD Ï∞®Ïï° Ìè¨Îß∑ÌåÖ
        function formatUSDDifference(diff) {
            const color = diff >= 0 ? '#4caf50' : '#f44336';
            const sign = diff >= 0 ? '+' : '';
            return `<span style="color: ${color}">${sign}$${Math.abs(diff).toFixed(2)}</span>`;
        }
        
        // ÏΩîÏù∏ ÏàòÎüâ Ï∞®Ïï° Ìè¨Îß∑ÌåÖ
        function formatCoinDifference(coinAmount, coinSymbol) {
            const color = coinAmount >= 0 ? '#4caf50' : '#f44336';
            const sign = coinAmount >= 0 ? '+' : '';
            const absAmount = Math.abs(coinAmount);
            
            // ÏΩîÏù∏ ÏàòÎüâÏóê Îî∞Î•∏ ÏÜåÏàòÏ†ê Ï°∞Ï†ï
            let decimals = 4;
            if (absAmount >= 1) decimals = 2;
            if (absAmount >= 100) decimals = 1;
            if (absAmount >= 1000) decimals = 0;
            
            return `<span style="color: ${color}">${sign}${absAmount.toFixed(decimals)} ${coinSymbol}</span>`;
        }
        
        // Ï¥àÍ∏∞Ìôî
        window.addEventListener('load', () => {
            // WebSocket Ïó∞Í≤∞
            connectWebSocket('BTCUSDT', 'btc-price', 'btc-change', 'btc');
            connectWebSocket('ETHUSDT', 'eth-price', 'eth-change', 'eth');
            connectWebSocket('SOLUSDT', 'sol-price', 'sol-change', 'sol');
            
            console.log('BW Calculator initialized');
        });
    </script>
</body>
</html>