<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>BW Mode 9 - BTC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000000;
            color: #ffffff;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* Navigation */
        .nav {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        .nav-btn {
            background: transparent;
            border: 1px solid #333;
            color: #666;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-btn:hover {
            border-color: #666;
            color: #fff;
        }
        
        /* Price display container */
        .price-display {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* Color bar for each digit */
        .color-bar {
            flex: 1;
            width: 100%;
            transition: background-color 0.3s ease;
            position: relative;
        }
        
        /* Decimal separator line */
        .decimal-separator {
            width: 100%;
            height: 2px;
            background-color: #666;
            position: relative;
            z-index: 10;
        }
        
        /* Backlight glow effect */
        .color-bar.glow {
            box-shadow: inset 0 0 50px rgba(255, 255, 255, 0.3);
        }
        
        /* Number to color mapping */
        .color-0 { background-color: #808080; } /* Gray */
        .color-1 { background-color: #FFFFFF; } /* White */
        .color-2 { background-color: #FF1744; } /* Crimson */
        .color-3 { background-color: #FF8C00; } /* Dark Orange */
        .color-4 { background-color: #FFFF00; } /* Yellow */
        .color-5 { background-color: #90EE90; } /* Green */
        .color-6 { background-color: #5DADE2; } /* Sky Blue */
        .color-7 { background-color: #6A0DAD; } /* Medium Blue */
        .color-8 { background-color: #8B00FF; } /* Violet */
        .color-9 { background-color: #000000; } /* Black */
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 24px;
            height: 100vh;
        }
        
        /* Coin label */
        .coin-label {
            position: fixed;
            bottom: 10px;
            left: 10px;
            color: #666;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
            z-index: 100;
        }
        
        /* Mobile optimization */
        @media (max-width: 768px) {
            .nav {
                gap: 5px;
            }
            
            .nav-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .decimal-separator {
                height: 1px;
            }
        }
    </style>
</head>
<body>
    <div class="nav">
        <button class="nav-btn" onclick="location.href='bw-mode9-eth.html'" title="ETH">ETH</button>
        <button class="nav-btn" onclick="location.href='bw-mode9-sol.html'" title="SOL">SOL</button>
        <button class="nav-btn" onclick="location.href='bw-mode9.html'" title="All">â˜°</button>
    </div>
    
    <div class="coin-label">BTC</div>
    
    <div class="price-display" id="priceDisplay">
        <div class="loading">Loading BTC...</div>
    </div>
    
    <script>
        let btcWs;
        let previousPrice = '';
        
        function createColorBars(priceStr) {
            const [integerPart, decimalPart] = priceStr.split('.');
            const allDigits = integerPart + (decimalPart || '');
            const hasDecimal = decimalPart !== undefined;
            
            let barsHtml = '';
            const totalDigits = allDigits.length;
            const decimalPosition = integerPart.length;
            
            for (let i = 0; i < totalDigits; i++) {
                const digit = allDigits[i];
                const hasChanged = previousPrice && previousPrice[i] !== digit;
                const glowClass = hasChanged ? 'glow' : '';
                
                barsHtml += `<div class="color-bar color-${digit} ${glowClass}"></div>`;
                
                // Add decimal separator after integer part
                if (hasDecimal && i === decimalPosition - 1) {
                    barsHtml += '<div class="decimal-separator"></div>';
                }
            }
            
            previousPrice = allDigits;
            
            // Remove glow effect after animation
            setTimeout(() => {
                document.querySelectorAll('.glow').forEach(el => {
                    el.classList.remove('glow');
                });
            }, 500);
            
            return barsHtml;
        }
        
        function connectBinanceWebSocket() {
            btcWs = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
            
            btcWs.onopen = function() {
                console.log('Connected to BTC stream');
            };
            
            btcWs.onmessage = function(event) {
                const data = JSON.parse(event.data);
                const price = parseFloat(data.c);
                const priceStr = price.toFixed(2);
                
                document.getElementById('priceDisplay').innerHTML = createColorBars(priceStr);
            };
            
            btcWs.onerror = function(error) {
                console.error('WebSocket error:', error);
            };
            
            btcWs.onclose = function() {
                console.log('Disconnected from BTC stream. Reconnecting...');
                setTimeout(connectBinanceWebSocket, 5000);
            };
        }
        
        // Fallback API fetch
        async function fetchBTCPrice() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT');
                const data = await response.json();
                const price = parseFloat(data.lastPrice);
                const priceStr = price.toFixed(2);
                
                document.getElementById('priceDisplay').innerHTML = createColorBars(priceStr);
            } catch (error) {
                console.error('Error fetching BTC price:', error);
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            connectBinanceWebSocket();
            fetchBTCPrice(); // Initial fetch
            setInterval(fetchBTCPrice, 10000); // Fallback update
        });
        
        // Clean up
        window.addEventListener('beforeunload', () => {
            if (btcWs) btcWs.close();
        });
        
        // Keyboard shortcuts for navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') {
                location.href = 'bw-mode9-eth.html';
            } else if (e.key === 'ArrowLeft') {
                location.href = 'bw-mode9-sol.html';
            } else if (e.key === 'Escape') {
                location.href = 'bw-mode9.html';
            }
        });
    </script>
</body>
</html>