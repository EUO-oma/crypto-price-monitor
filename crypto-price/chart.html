<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Chart - 1ë¶„ë´‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
        }

        .header {
            background: #0a0a0a;
            padding: 15px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .symbol-selector {
            display: flex;
            gap: 15px;
        }

        .symbol-btn {
            padding: 8px 16px;
            background: #1a1a1a;
            color: #888;
            border: 1px solid #333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .symbol-btn:hover {
            background: #2a2a2a;
            color: #fff;
        }

        .symbol-btn.active {
            background: #333;
            color: #fff;
            border-color: #555;
        }
        
        /* ëª¨ë°”ì¼ìš© ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .mobile-selector {
            display: none;
            gap: 10px;
            align-items: center;
        }
        
        .coin-dropdown {
            padding: 8px 12px;
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            min-width: 120px;
        }
        
        .coin-dropdown:focus {
            outline: none;
            border-color: #555;
        }
        
        .home-btn {
            padding: 8px 16px;
            background: #1a1a1a;
            color: #aaa;
            border: 1px solid #333;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .home-btn:hover {
            background: #2a2a2a;
            color: #fff;
        }

        .back-btn {
            padding: 8px 16px;
            background: #1a1a1a;
            color: #aaa;
            border: 1px solid #333;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: #2a2a2a;
            color: #fff;
        }
        
        .compare-btn {
            padding: 8px 16px;
            background: #1a1a1a;
            color: #aaa;
            border: 1px solid #333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 10px;
        }
        
        .compare-btn:hover {
            background: #2a2a2a;
            color: #fff;
        }
        
        .compare-btn.active {
            background: #f7931a;
            color: #000;
            border-color: #f7931a;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œë§Œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ */
        @media (max-width: 768px) {
            .symbol-selector {
                display: none;
            }
            
            .mobile-selector {
                display: flex;
                flex: 1;
            }
            
            .back-btn {
                display: none;
            }
            
            .compare-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        .coin-title {
            display: none;  /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ (PCì—ì„œëŠ” í‘œì‹œ ì•ˆí•¨) */
            padding: 10px 20px;
            background: #0a0a0a;
            border-bottom: 1px solid #333;
            text-align: right;
            font-size: 1.2em;
            font-weight: 500;
        }
        
        .chart-container {
            flex: 1;
            padding: 0;  /* íŒ¨ë”© ì œê±° */
            display: flex;
            justify-content: center;
            align-items: stretch;  /* ì „ì²´ ë†’ì´ ì‚¬ìš© */
            width: 100%;
            margin: 0;
            min-height: 500px;  /* ìµœì†Œ ë†’ì´ ë³´ì¥ */
        }

        #tradingview-widget {
            width: 100%;  /* ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
            aspect-ratio: 1 / 1.2;  /* ê¸°ë³¸ ê°€ë¡œ:ì„¸ë¡œ = 1:1.2 ë¹„ìœ¨ */
            min-height: 500px;
            max-height: 900px;
            resize: vertical;  /* ì„¸ë¡œ í¬ê¸° ì¡°ì • ê°€ëŠ¥ */
            overflow: auto;
            position: relative;
        }
        
        /* í¬ê¸° ì¡°ì • í•¸ë“¤ ìŠ¤íƒ€ì¼ */
        #tradingview-widget::-webkit-resizer {
            background-color: #444;
            border-radius: 5px;
        }
        
        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;  /* í—¤ë” íŒ¨ë”© ì¶•ì†Œ */
            }
            
            .coin-title {
                display: block;  /* ëª¨ë°”ì¼ì—ì„œë§Œ í‘œì‹œ */
                padding: 8px 15px;
                font-size: 1em;
            }
            
            .chart-container {
                padding-top: 0;  /* ëª¨ë°”ì¼ì—ì„œë„ ìƒë‹¨ ì—¬ë°± ì œê±° */
                padding-left: 5px;
                padding-right: 5px;
            }
            
            #tradingview-widget {
                aspect-ratio: 1 / 1.2;  /* ëª¨ë°”ì¼ì—ì„œë„ 1:1.2 ë¹„ìœ¨ */
                min-height: 450px;
                max-height: 700px;
                margin-top: 5px;  /* ì°¨íŠ¸ ìƒë‹¨ ì—¬ë°± ìµœì†Œí™” */
                resize: vertical;  /* ì„¸ë¡œ í¬ê¸° ì¡°ì • ê°€ëŠ¥ */
                overflow: auto;
            }
            
        }

    </style>
</head>
<body>
    <div class="header">
        <!-- PCìš© ë²„íŠ¼ ì„ íƒ -->
        <div class="symbol-selector">
            <button class="symbol-btn active" onclick="changeSymbol('BTCUSDT')">BTC<span style="color: #666; font-size: 0.9em;">USDT</span></button>
            <button class="symbol-btn" onclick="changeSymbol('ETHUSDT')">ETH<span style="color: #666; font-size: 0.9em;">USDT</span></button>
            <button class="symbol-btn" onclick="changeSymbol('XRPUSDT')">XRP<span style="color: #666; font-size: 0.9em;">USDT</span></button>
            <button class="symbol-btn" onclick="changeSymbol('SOLUSDT')">SOL<span style="color: #666; font-size: 0.9em;">USDT</span></button>
            <button class="symbol-btn" onclick="changeSymbol('AVAXUSDT')">AVAX<span style="color: #666; font-size: 0.9em;">USDT</span></button>
            <button class="symbol-btn" onclick="changeSymbol('NASDAQ')">NASDAQ</button>
        </div>
        
        <!-- ëª¨ë°”ì¼ìš© ë“œë¡­ë‹¤ìš´ ì„ íƒ -->
        <div class="mobile-selector">
            <a href="index.html" class="home-btn">ğŸ  í™ˆ</a>
            <select class="coin-dropdown" id="mobile-coin-select" onchange="changeSymbol(this.value)">
                <option value="BTCUSDT">BTC/USDT</option>
                <option value="ETHUSDT">ETH/USDT</option>
                <option value="XRPUSDT">XRP/USDT</option>
                <option value="SOLUSDT">SOL/USDT</option>
                <option value="AVAXUSDT">AVAX/USDT</option>
                <option value="NASDAQ">NASDAQ 100</option>
            </select>
        </div>
        
        <div style="display: flex; align-items: center;">
            <button class="compare-btn" id="compare-btn" onclick="toggleBTCCompare()">
                â‚¿ BTC ë¹„êµ
            </button>
            <a href="index.html" class="back-btn">â† ëŒì•„ê°€ê¸°</a>
        </div>
    </div>

    <!-- ì½”ì¸ ì´ë¦„ í‘œì‹œ ì„¹ì…˜ -->
    <div class="coin-title">
        <span id="coin-name">Bitcoin / TetherUS</span>
        <span id="coin-symbol" style="color: #888; font-size: 0.9em;">BTCUSDT</span>
        <!-- ë†’ì´ ì¡°ì ˆ ë²„íŠ¼ (ëª¨ë°”ì¼ìš©) -->
        <div class="height-controls" style="float: left;">
            <button onclick="adjustChartHeight('increase')" style="padding: 5px 10px; background: #1a1a1a; color: #fff; border: 1px solid #333; border-radius: 3px; margin-right: 5px;">ğŸ“ˆ +</button>
            <button onclick="adjustChartHeight('decrease')" style="padding: 5px 10px; background: #1a1a1a; color: #fff; border: 1px solid #333; border-radius: 3px;">ğŸ“‰ -</button>
        </div>
    </div>
    
    <!-- ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div class="chart-container">
        <div id="tradingview-widget"></div>
    </div>
    
    <!-- ë³¼ë¥¨ ë§‰ëŒ€ëŠ” TradingView ìœ„ì ¯ ë‚´ë¶€ì— í¬í•¨ë¨ -->

    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
        let currentSymbol = 'BTCUSDT';
        let widget = null;
        let ws = null;
        let btcCompareEnabled = false;

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì‹¬ë³¼ ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const symbolParam = urlParams.get('symbol');
        if (symbolParam) {
            currentSymbol = symbolParam.toUpperCase();
            // ëª¨ë°”ì¼ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°ê°’ ì„¤ì •
            const mobileSelect = document.getElementById('mobile-coin-select');
            if (mobileSelect) {
                mobileSelect.value = currentSymbol;
            }
        }

        function initChart(symbol) {
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            document.getElementById('tradingview-widget').innerHTML = '';
            
            // NASDAQì¸ ê²½ìš° TradingView ì‹¬ë³¼ ë³€ê²½
            let tradingViewSymbol = symbol === 'NASDAQ' ? 'NASDAQ:NDX' : `BINANCE:${symbol}`;
            
            // ëª¨ë°”ì¼ ì—¬ë¶€ í™•ì¸
            const isMobile = window.innerWidth <= 768;
            
            // ë¹„êµ ì‹¬ë³¼ ì„¤ì •
            let compareSymbols = [];
            let studies = [];
            
            if (btcCompareEnabled && symbol !== 'BTCUSDT') {
                compareSymbols = [{
                    "symbol": "BINANCE:BTCUSDT",
                    "position": "SameScale"
                }];
                
                // ë¹„êµ ëª¨ë“œì¼ ë•ŒëŠ” ë‘ ê°œì˜ ë³¼ë¥¨ ì§€í‘œ ì¶”ê°€
                studies = [
                    "Volume@tv-basicstudies",  // í˜„ì¬ ì½”ì¸ ë³¼ë¥¨
                    {
                        "id": "Volume@tv-basicstudies",
                        "inputs": {},
                        "styles": {
                            "volume": {
                                "color_0": "#3f51b5",  // íŒŒë€ìƒ‰ (í•˜ë½)
                                "color_1": "#ff4081",  // ë¶„í™ìƒ‰ (ìƒìŠ¹)
                                "transparency": 40
                            }
                        }
                    }
                ];
            } else {
                // ì¼ë°˜ ëª¨ë“œì¼ ë•ŒëŠ” í•˜ë‚˜ì˜ ë³¼ë¥¨ ì§€í‘œ
                studies = ["Volume@tv-basicstudies"];
            }
            
            // ìƒˆ ì°¨íŠ¸ ìƒì„±
            widget = new TradingView.widget({
                "width": "100%",
                "height": "100%",
                "symbol": tradingViewSymbol,
                "interval": symbol === 'NASDAQ' ? "5" : "1",  // NASDAQì€ 5ë¶„ë´‰, í¬ë¦½í† ëŠ” 1ë¶„ë´‰
                "timezone": "Asia/Seoul",
                "theme": "dark",
                "style": "1",  // Candlestick
                "locale": "kr",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "allow_symbol_change": false,
                "container_id": "tradingview-widget",
                "hide_side_toolbar": isMobile ? true : false,  // ëª¨ë°”ì¼ì—ì„œëŠ” ì‚¬ì´ë“œë°” ìˆ¨ê¹€
                "hide_drawing_toolbar": isMobile ? true : false,  // ëª¨ë°”ì¼ì—ì„œëŠ” ê·¸ë¦¬ê¸° ë„êµ¬ ìˆ¨ê¹€
                "hide_top_toolbar": false,
                "hide_legend": isMobile ? true : false,  // ëª¨ë°”ì¼ì—ì„œë§Œ ë ˆì „ë“œ ìˆ¨ê¹€
                "withdateranges": !isMobile,  // ëª¨ë°”ì¼ì—ì„œëŠ” ë‚ ì§œ ë²”ìœ„ ì„ íƒ ìˆ¨ê¹€
                "details": false,  // ìƒì„¸ ì •ë³´ ìˆ¨ê¹€ (ê²¹ì¹¨ ë°©ì§€)
                "studies": studies,  // ë™ì ìœ¼ë¡œ ì„¤ì •ëœ ë³¼ë¥¨ ì§€í‘œ
                "studies_overrides": btcCompareEnabled && symbol !== 'BTCUSDT' ? {
                    // ë¹„êµ ëª¨ë“œì¼ ë•Œ - í˜„ì¬ ì½”ì¸ì€ ê¸°ë³¸ìƒ‰, BTCëŠ” íŒŒë€/ë¶„í™
                    "volume.volume.transparency": 30,
                    "volume.volume.color.0": "#ef5350",  // í•˜ë½ ë¹¨ê°„ìƒ‰
                    "volume.volume.color.1": "#26a69a",  // ìƒìŠ¹ ì²­ë¡ìƒ‰
                    "volume.volume ma.color": "#FFD700",
                    "volume.volume ma.transparency": 70,
                    "volume.volume ma.linewidth": 2,
                    "volume.options.priceScaleId": "volume",
                    "volume@tv-basicstudies.height": 30,  // ë³¼ë¥¨ ë†’ì´ 30%
                    "volume.palettes.volumePalette.colors.0.color": "#ef5350",
                    "volume.palettes.volumePalette.colors.1.color": "#26a69a",
                    "volume_1.volume.transparency": 40,
                    "volume_1.volume.color.0": "#3f51b5",  // BTC í•˜ë½ íŒŒë€ìƒ‰
                    "volume_1.volume.color.1": "#ff4081",  // BTC ìƒìŠ¹ ë¶„í™ìƒ‰
                    "volume_1.options.priceScaleId": "volume_btc"
                } : {
                    // ì¼ë°˜ ëª¨ë“œì¼ ë•Œ
                    "volume.volume.transparency": 30,
                    "volume.volume.color.0": "#ef5350",  // í•˜ë½ ë¹¨ê°„ìƒ‰
                    "volume.volume.color.1": "#26a69a",  // ìƒìŠ¹ ì²­ë¡ìƒ‰
                    "volume.volume ma.color": "#FFD700",
                    "volume.volume ma.transparency": 70,
                    "volume.volume ma.linewidth": 2,
                    "volume.options.priceScaleId": "volume",
                    "volume@tv-basicstudies.height": 30,  // ë³¼ë¥¨ ë†’ì´ 30%
                    "volume.palettes.volumePalette.colors.0.color": "#ef5350",
                    "volume.palettes.volumePalette.colors.1.color": "#26a69a"
                },
                "compare_symbols": compareSymbols,  // ë¹„êµ ì‹¬ë³¼ ì¶”ê°€
                "show_popup_button": !isMobile,  // ëª¨ë°”ì¼ì—ì„œëŠ” íŒì—… ë²„íŠ¼ ìˆ¨ê¹€
                "popup_width": "1000",
                "popup_height": "650"
            });

            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸ (PC)
            document.querySelectorAll('.symbol-btn').forEach(btn => {
                btn.classList.remove('active');
                let btnText = btn.textContent.replace('USDT', '');
                if (symbol === 'NASDAQ' && btnText === 'NASDAQ') {
                    btn.classList.add('active');
                } else if (btnText === symbol.replace('USDT', '')) {
                    btn.classList.add('active');
                }
            });
            
            // ë“œë¡­ë‹¤ìš´ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸ (ëª¨ë°”ì¼)
            const mobileSelect = document.getElementById('mobile-coin-select');
            if (mobileSelect) {
                mobileSelect.value = symbol;
            }
            
            // ì½”ì¸ ì´ë¦„ ì—…ë°ì´íŠ¸
            updateCoinTitle(symbol);

            // WebSocket ì—°ê²° ì—…ë°ì´íŠ¸ (NASDAQ ì œì™¸)
            if (symbol !== 'NASDAQ') {
                connectWebSocket(symbol.toLowerCase());
            } else {
                // NASDAQì¸ ê²½ìš° WebSocket ì¢…ë£Œë§Œ
                if (ws) {
                    ws.close();
                    ws = null;
                }
            }
        }

        function changeSymbol(symbol) {
            currentSymbol = symbol;
            // URL ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì—†ì´)
            window.history.pushState({}, '', `?symbol=${symbol}`);
            
            // BTC ë¹„êµ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
            const compareBtn = document.getElementById('compare-btn');
            if (compareBtn) {
                if (symbol === 'BTCUSDT') {
                    compareBtn.style.display = 'none';
                    btcCompareEnabled = false;
                } else {
                    compareBtn.style.display = 'inline-block';
                }
            }
            
            initChart(symbol);
        }

        function connectWebSocket(symbol) {
            // ê¸°ì¡´ WebSocket ì—°ê²° ì¢…ë£Œ
            if (ws) {
                ws.close();
            }

            // Binance WebSocket ì—°ê²°
            ws = new WebSocket(`wss://fstream.binance.com/ws/${symbol}@ticker`);
            
            ws.onmessage = function(event) {
                // WebSocket ë°ì´í„° ìˆ˜ì‹  (í˜„ì¬ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
                const data = JSON.parse(event.data);
            };

            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
            };
        }

        // ì°¨íŠ¸ ë†’ì´ ì¡°ì ˆ í•¨ìˆ˜
        function adjustChartHeight(action) {
            const chartWidget = document.getElementById('tradingview-widget');
            if (!chartWidget) return;
            
            const currentHeight = chartWidget.offsetHeight;
            let newHeight;
            
            if (action === 'increase') {
                newHeight = Math.min(currentHeight + 50, 900);  // 50pxì”© ì¦ê°€, ìµœëŒ€ 900px
            } else {
                newHeight = Math.max(currentHeight - 50, 400);  // 50pxì”© ê°ì†Œ, ìµœì†Œ 400px
            }
            
            chartWidget.style.height = newHeight + 'px';
            
            // localStorageì— ì €ì¥
            localStorage.setItem('chartHeight', newHeight);
        }
        
        // ì €ì¥ëœ ì°¨íŠ¸ ë†’ì´ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadChartHeight() {
            const savedHeight = localStorage.getItem('chartHeight');
            if (savedHeight) {
                const chartWidget = document.getElementById('tradingview-widget');
                if (chartWidget) {
                    chartWidget.style.height = savedHeight + 'px';
                }
            }
        }
        
        // ì½”ì¸ ì´ë¦„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCoinTitle(symbol) {
            const coinNameEl = document.getElementById('coin-name');
            const coinSymbolEl = document.getElementById('coin-symbol');
            
            const coinNames = {
                'BTCUSDT': 'Bitcoin / TetherUS',
                'ETHUSDT': 'Ethereum / TetherUS',
                'XRPUSDT': 'Ripple / TetherUS',
                'SOLUSDT': 'Solana / TetherUS',
                'AVAXUSDT': 'Avalanche / TetherUS',
                'NASDAQ': 'NASDAQ 100 Index'
            };
            
            if (coinNameEl) {
                coinNameEl.textContent = coinNames[symbol] || symbol;
            }
            if (coinSymbolEl) {
                coinSymbolEl.textContent = symbol;
            }
        }
        
        // BTC ë¹„êµ í† ê¸€ í•¨ìˆ˜
        function toggleBTCCompare() {
            btcCompareEnabled = !btcCompareEnabled;
            const compareBtn = document.getElementById('compare-btn');
            
            if (btcCompareEnabled) {
                compareBtn.classList.add('active');
                compareBtn.innerHTML = 'â‚¿ BTC ë¹„êµ ON';
            } else {
                compareBtn.classList.remove('active');
                compareBtn.innerHTML = 'â‚¿ BTC ë¹„êµ';
            }
            
            // í˜„ì¬ ì‹¬ë³¼ì´ BTCê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì°¨íŠ¸ ì¬ì´ˆê¸°í™”
            if (currentSymbol !== 'BTCUSDT') {
                initChart(currentSymbol);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì°¨íŠ¸ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function() {
            initChart(currentSymbol);
            
            // ì €ì¥ëœ ì°¨íŠ¸ ë†’ì´ ë¶ˆëŸ¬ì˜¤ê¸°
            setTimeout(loadChartHeight, 500);  // ì°¨íŠ¸ ë¡œë“œ í›„ ì ìš©
            
            // BTCì¸ ê²½ìš° ë¹„êµ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (currentSymbol === 'BTCUSDT') {
                const compareBtn = document.getElementById('compare-btn');
                if (compareBtn) {
                    compareBtn.style.display = 'none';
                }
            }
        });
        
        // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ì°¨íŠ¸ ì¬ì´ˆê¸°í™” (ëª¨ë°”ì¼/PC ì „í™˜ ëŒ€ì‘)
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                const currentIsMobile = window.innerWidth <= 768;
                const prevIsMobile = widget && widget._options && widget._options.hide_side_toolbar;
                
                // ëª¨ë°”ì¼/PC ëª¨ë“œê°€ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì°¨íŠ¸ ì¬ì´ˆê¸°í™”
                if (currentIsMobile !== prevIsMobile) {
                    initChart(currentSymbol);
                }
            }, 250);
        });
    </script>
</body>
</html>