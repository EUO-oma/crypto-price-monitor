<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index.html ì˜¤ë¥˜ ìˆ˜ì • ê°€ì´ë“œ</title>
    <style>
        body {
            font-family: 'Segoe UI', monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .issue {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .critical { border-color: #dc2626; }
        .warning { border-color: #f59e0b; }
        .fix { border-color: #10b981; }
        
        h2 { color: #4facfe; }
        h3 { color: #fbbf24; margin-top: 20px; }
        
        pre {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #333;
        }
        .error-code { background: #7f1d1d; color: #fecaca; }
        .fixed-code { background: #14532d; color: #bbf7d0; }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Index.html ì˜¤ë¥˜ ìˆ˜ì • ê°€ì´ë“œ</h1>
    
    <div class="issue critical">
        <h2>ğŸš¨ ë¬¸ì œ 1: saveToSupabase ë¬´í•œ ë£¨í”„ ìœ„í—˜</h2>
        <p>ì¬ì‹œë„ ì œí•œì´ ì—†ì–´ ë¬´í•œ ë£¨í”„ì— ë¹ ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        
        <h3>í˜„ì¬ ì½”ë“œ (ë¬¸ì œ):</h3>
        <pre class="error-code">async function saveToSupabase(symbol, date, high, low, close) {
    if (!window.supabaseClient) {
        console.error('Supabase clientê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
        setTimeout(() => saveToSupabase(symbol, date, high, low, close), 100);
        return;
    }
    // ...
}</pre>
        
        <h3>ìˆ˜ì •ëœ ì½”ë“œ:</h3>
        <pre class="fixed-code">// ì¬ì‹œë„ ì¹´ìš´í„°ë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜
const retryCounters = {};

async function saveToSupabase(symbol, date, high, low, close, retryCount = 0) {
    const MAX_RETRIES = 10;
    
    if (!window.supabaseClient) {
        if (retryCount >= MAX_RETRIES) {
            console.error(`Supabase ì´ˆê¸°í™” ì‹¤íŒ¨ (${MAX_RETRIES}íšŒ ì¬ì‹œë„ í›„)`);
            return;
        }
        console.log(`Supabase ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘... (${retryCount + 1}/${MAX_RETRIES})`);
        setTimeout(() => saveToSupabase(symbol, date, high, low, close, retryCount + 1), 500);
        return;
    }
    // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
}</pre>
    </div>
    
    <div class="issue warning">
        <h2>âš ï¸ ë¬¸ì œ 2: XSS ì·¨ì•½ì  (innerHTML ì‚¬ìš©)</h2>
        <p>ì‚¬ìš©ì ì…ë ¥ê°’ì„ ì´ìŠ¤ì¼€ì´í”„í•˜ì§€ ì•Šê³  innerHTMLì— ì§ì ‘ ì‚½ì…í•˜ë©´ XSS ê³µê²©ì— ì·¨ì•½í•©ë‹ˆë‹¤.</p>
        
        <h3>ì•ˆì „í•œ HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜ ì¶”ê°€:</h3>
        <pre class="fixed-code">function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

// ì‚¬ìš© ì˜ˆì‹œ
gptContainer.innerHTML = gptLinks.map(link => `
    <a href="${escapeHtml(link.url)}" target="_blank" style="...">
        <div>${escapeHtml(link.name)}</div>
    </a>
`).join('');</pre>
    </div>
    
    <div class="issue warning">
        <h2>âš ï¸ ë¬¸ì œ 3: ë³µì¡í•œ ì¤‘ì²© í…œí”Œë¦¿ ë¦¬í„°ëŸ´</h2>
        <p>ê°€ë…ì„±ì´ ë–¨ì–´ì§€ê³  ë””ë²„ê¹…ì´ ì–´ë µìŠµë‹ˆë‹¤.</p>
        
        <h3>í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•˜ì—¬ ê°œì„ :</h3>
        <pre class="fixed-code">function createVideoThumbnail(videoInfo, settings) {
    if (!settings.showThumbnails) return '';
    
    return `
        <div style="width: 100%; aspect-ratio: 16/9; background: #000; overflow: hidden; position: relative;">
            <img src="${escapeHtml(videoInfo.thumbnail)}" 
                 style="width: 100%; height: 100%; object-fit: cover;"
                 onerror="this.src='https://via.placeholder.com/320x180?text=No+Thumbnail'">
        </div>
    `;
}

function createVideoCard(videoInfo, settings) {
    return `
        ${createVideoThumbnail(videoInfo, settings)}
        <div style="padding: 12px;">
            <div style="font-size: ${settings.fontSize}px; font-weight: 600;">
                ${escapeHtml(videoInfo.title)}
            </div>
            ${settings.showAuthor ? createAuthorInfo(videoInfo, settings) : ''}
        </div>
    `;
}</pre>
    </div>
    
    <div class="issue fix">
        <h2>âœ… ë¬¸ì œ 4: ì¸ë¼ì¸ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬</h2>
        <p>addEventListenerë¥¼ ì‚¬ìš©í•˜ì—¬ ë” ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
        
        <h3>ê°œì„ ëœ ì½”ë“œ:</h3>
        <pre class="fixed-code">// HTML ìƒì„±
const linkElement = document.createElement('a');
linkElement.href = link.url;
linkElement.target = '_blank';
linkElement.className = 'link-card';
linkElement.textContent = link.name;

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
linkElement.addEventListener('mouseover', function() {
    this.style.transform = 'translateY(-3px)';
    this.style.borderColor = '#555';
});

linkElement.addEventListener('mouseout', function() {
    this.style.transform = 'translateY(0)';
    this.style.borderColor = '#333';
});

container.appendChild(linkElement);</pre>
    </div>
    
    <div class="issue fix">
        <h2>âœ… ë¹ ë¥¸ ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸</h2>
        <button onclick="generateFixedCode()">ìˆ˜ì •ëœ ì½”ë“œ ìƒì„±</button>
        <div id="fixed-code-output"></div>
    </div>
    
    <script>
        function generateFixedCode() {
            const output = document.getElementById('fixed-code-output');
            
            const fixedCode = `
// 1. HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜ ì¶”ê°€
function escapeHtml(unsafe) {
    if (!unsafe) return '';
    return String(unsafe)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

// 2. ì¬ì‹œë„ ì œí•œì´ ìˆëŠ” saveToSupabase
async function saveToSupabase(symbol, date, high, low, close, retryCount = 0) {
    const MAX_RETRIES = 10;
    
    if (!window.supabaseClient) {
        if (retryCount >= MAX_RETRIES) {
            console.error(\`Supabase ì´ˆê¸°í™” ì‹¤íŒ¨ (ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼)\`);
            return;
        }
        console.log(\`Supabase ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘... (\${retryCount + 1}/\${MAX_RETRIES})\`);
        setTimeout(() => saveToSupabase(symbol, date, high, low, close, retryCount + 1), 500);
        return;
    }
    
    try {
        const { data, error } = await window.supabaseClient
            .from('price_history')
            .insert([{
                symbol: symbol,
                date: date,
                high: high,
                low: low, 
                close: close
            }]);

        if (error) {
            console.error(\`ë°ì´í„° ì €ì¥ ì‹¤íŒ¨ (\${symbol}):\`, error);
        } else {
            console.log(\`ë°ì´í„° ì €ì¥ ì„±ê³µ (\${symbol}):\`, date);
        }
    } catch (error) {
        console.error(\`saveToSupabase ì˜¤ë¥˜ (\${symbol}):\`, error);
    }
}

// 3. ì•ˆì „í•œ ë§í¬ ìƒì„± í•¨ìˆ˜
function createSafeLinkElement(link, styles) {
    const element = document.createElement('a');
    element.href = link.url;
    element.target = '_blank';
    element.textContent = link.name;
    
    // ìŠ¤íƒ€ì¼ ì ìš©
    Object.assign(element.style, {
        background: styles.bgColor || '#1a1a1a',
        color: styles.textColor || '#fff',
        padding: '15px',
        borderRadius: '10px',
        textAlign: 'center',
        border: \`1px solid \${styles.borderColor || '#333'}\`,
        textDecoration: 'none',
        transition: 'transform 0.3s ease',
        display: 'block'
    });
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    element.addEventListener('mouseover', () => {
        element.style.transform = 'translateY(-3px)';
    });
    
    element.addEventListener('mouseout', () => {
        element.style.transform = 'translateY(0)';
    });
    
    return element;
}
`;
            
            output.innerHTML = `
                <h3>ìˆ˜ì •ëœ ì½”ë“œë¥¼ index.htmlì— ì¶”ê°€í•˜ì„¸ìš”:</h3>
                <pre class="fixed-code">${escapeHtml(fixedCode)}</pre>
                <p style="margin-top: 20px;">
                    <strong>ì ìš© ë°©ë²•:</strong><br>
                    1. ìœ„ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ index.htmlì˜ &lt;script&gt; íƒœê·¸ ì‹œì‘ ë¶€ë¶„ì— ì¶”ê°€<br>
                    2. ê¸°ì¡´ saveToSupabase í•¨ìˆ˜ë¥¼ ìƒˆ ë²„ì „ìœ¼ë¡œ êµì²´<br>
                    3. innerHTMLì„ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì—ì„œ escapeHtml() í•¨ìˆ˜ ì‚¬ìš©<br>
                    4. ê°€ëŠ¥í•œ ê²½ìš° createElementë¥¼ ì‚¬ìš©í•˜ì—¬ DOM ìš”ì†Œ ìƒì„±
                </p>
            `;
        }
        
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>