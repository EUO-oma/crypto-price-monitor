<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ì • í‘œì‹œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #121212;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #1e1e1e;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
        pre {
            background: #0d0d0d;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        /* index.htmlì—ì„œ ë³µì‚¬í•œ ìŠ¤íƒ€ì¼ */
        .schedule-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        }
        .schedule-card {
            background: #1e1e1e;
            border: 1px solid #333;
            border-left: 4px solid;
            border-radius: 12px;
            padding: 20px 25px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .schedule-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            background: #2a2a2a;
        }
        .schedule-date-box {
            flex-shrink: 0;
            width: 80px;
            text-align: center;
            padding: 15px 10px;
            background: #2a2a2a;
            border-radius: 8px;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <h1>ì¼ì • í‘œì‹œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>
    
    <div class="test-section">
        <h2>1. Supabase ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <div id="connectionResult"></div>
    </div>
    
    <div class="test-section">
        <h2>2. ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testLoadData()">ë°ì´í„° ë¡œë“œ</button>
        <div id="loadResult"></div>
    </div>
    
    <div class="test-section">
        <h2>3. ë Œë”ë§ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testRender()">í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ë Œë”ë§</button>
        <button onclick="renderLoadedData()">ë¡œë“œëœ ë°ì´í„°ë¡œ ë Œë”ë§</button>
        <div id="renderResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. DOM ìƒíƒœ í™•ì¸</h2>
        <button onclick="checkDOM()">DOM ìš”ì†Œ í™•ì¸</button>
        <div id="domResult"></div>
    </div>
    
    <div class="test-section">
        <h2>ë Œë”ë§ ê²°ê³¼</h2>
        <div id="testListView" class="schedule-grid"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://ddfnxbkiewolgweivomv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
        
        let supabase;
        let loadedData = [];
        
        window.addEventListener('load', () => {
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                log('Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì™„ë£Œ', 'success');
            } catch (error) {
                log('Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì‹¤íŒ¨: ' + error.message, 'error');
            }
        });
        
        function log(message, type = 'info') {
            console.log(message);
        }
        
        async function testConnection() {
            const resultDiv = document.getElementById('connectionResult');
            try {
                const { data, error } = await supabase.from('schedules').select('count').limit(1);
                if (error) {
                    resultDiv.innerHTML = `<p class="error">âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}</p>`;
                } else {
                    resultDiv.innerHTML = `<p class="success">âœ… ì—°ê²° ì„±ê³µ</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ ì˜ˆì™¸ ë°œìƒ: ${error.message}</p>`;
            }
        }
        
        async function testLoadData() {
            const resultDiv = document.getElementById('loadResult');
            try {
                const { data, error } = await supabase
                    .from('schedules')
                    .select('*')
                    .order('event_date', { ascending: true });
                
                if (error) {
                    resultDiv.innerHTML = `<p class="error">âŒ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</p>`;
                } else {
                    loadedData = data || [];
                    resultDiv.innerHTML = `
                        <p class="success">âœ… ë¡œë“œ ì„±ê³µ: ${loadedData.length}ê°œ ì¼ì •</p>
                        <pre>${JSON.stringify(loadedData.slice(0, 2), null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">âŒ ì˜ˆì™¸ ë°œìƒ: ${error.message}</p>`;
            }
        }
        
        function testRender() {
            const testData = [{
                id: 'test-1',
                title: 'í…ŒìŠ¤íŠ¸ ì¼ì • 1',
                description: 'í…ŒìŠ¤íŠ¸ ì„¤ëª…ì…ë‹ˆë‹¤',
                event_date: '2024-11-06',
                event_time: '14:00:00',
                location: 'ì„œìš¸',
                category: 'general',
                priority: 'normal',
                status: 'upcoming',
                color: '#2196f3'
            }];
            
            renderSchedules(testData);
            document.getElementById('renderResult').innerHTML = '<p class="success">âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ë Œë”ë§ ì™„ë£Œ</p>';
        }
        
        function renderLoadedData() {
            if (loadedData.length === 0) {
                document.getElementById('renderResult').innerHTML = '<p class="error">âŒ ë¡œë“œëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì„¸ìš”.</p>';
                return;
            }
            renderSchedules(loadedData);
            document.getElementById('renderResult').innerHTML = `<p class="success">âœ… ${loadedData.length}ê°œ ì¼ì • ë Œë”ë§ ì™„ë£Œ</p>`;
        }
        
        function renderSchedules(schedules) {
            const container = document.getElementById('testListView');
            container.innerHTML = schedules.map(schedule => createScheduleCard(schedule)).join('');
            console.log('ë Œë”ë§ëœ HTML ê¸¸ì´:', container.innerHTML.length);
        }
        
        function createScheduleCard(schedule) {
            try {
                const eventDate = new Date(schedule.event_date);
                const day = eventDate.getDate();
                const monthNames = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
                const month = monthNames[eventDate.getMonth()];
                
                return `
                    <div class="schedule-card" style="border-left-color: ${schedule.color};">
                        <div class="schedule-date-box" style="border-color: ${schedule.color};">
                            <div style="font-size: 24px; font-weight: bold; color: ${schedule.color};">${day}</div>
                            <div style="font-size: 14px; color: #b0b0b0;">${month}</div>
                        </div>
                        <div class="schedule-content">
                            <h3 style="margin: 0 0 10px 0; font-size: 18px;">${schedule.title}</h3>
                            <p style="margin: 0; color: #b0b0b0; font-size: 14px;">
                                ${schedule.description || 'ì„¤ëª… ì—†ìŒ'}
                            </p>
                            ${schedule.location ? `<p style="margin: 5px 0 0 0; font-size: 14px;">ğŸ“ ${schedule.location}</p>` : ''}
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Schedule card creation error:', error, schedule);
                return `<div class="error">ë Œë”ë§ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }
        
        function checkDOM() {
            const resultDiv = document.getElementById('domResult');
            const elements = {
                'listView (ë©”ì¸ í˜ì´ì§€)': document.getElementById('listView'),
                'loadingDiv': document.getElementById('loadingDiv'),
                'emptyState': document.getElementById('emptyState'),
                'testListView (ì´ í˜ì´ì§€)': document.getElementById('testListView')
            };
            
            let html = '<h4>DOM ìš”ì†Œ ìƒíƒœ:</h4><ul>';
            for (const [name, elem] of Object.entries(elements)) {
                if (elem) {
                    const display = window.getComputedStyle(elem).display;
                    const visibility = window.getComputedStyle(elem).visibility;
                    const childCount = elem.children.length;
                    html += `<li class="success">âœ… ${name}: display=${display}, visibility=${visibility}, children=${childCount}</li>`;
                } else {
                    html += `<li class="error">âŒ ${name}: ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ</li>`;
                }
            }
            html += '</ul>';
            
            // ë©”ì¸ í˜ì´ì§€ì˜ ì „ì—­ ë³€ìˆ˜ í™•ì¸
            if (typeof schedules !== 'undefined') {
                html += `<p class="info">ğŸ“Š schedules ë³€ìˆ˜: ${schedules.length}ê°œ</p>`;
            }
            if (typeof filteredSchedules !== 'undefined') {
                html += `<p class="info">ğŸ“Š filteredSchedules ë³€ìˆ˜: ${filteredSchedules.length}ê°œ</p>`;
            }
            if (typeof currentView !== 'undefined') {
                html += `<p class="info">ğŸ‘ï¸ currentView: ${currentView}</p>`;
            }
            
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>