<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance 24ì‹œê°„ ë°ì´í„° í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        pre {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            overflow: auto;
            border: 1px solid #333;
        }
        button {
            padding: 10px 20px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .info {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }
        .success {
            background: #1a3a1a;
            border-left-color: #4caf50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #333;
            padding: 10px;
            text-align: left;
        }
        th {
            background: #2a2a2a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Binance API 24ì‹œê°„ ë°ì´í„° ë¶„ì„</h1>
        
        <button onclick="test24hrTicker()">24hr Ticker ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
        <button onclick="testKlineData()">Kline(ì¼ë´‰) ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
        <button onclick="compareData()">ë‘ ë°ì´í„° ë¹„êµ</button>
        
        <div id="results"></div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        async function test24hrTicker() {
            resultsDiv.innerHTML = '<div class="info">24ì‹œê°„ í‹°ì»¤ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';
            
            try {
                const symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT'];
                let html = '<h2>24ì‹œê°„ í‹°ì»¤ ë°ì´í„° (ticker/24hr)</h2>';
                
                for (const symbol of symbols) {
                    const response = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
                    const data = await response.json();
                    
                    // ì‹œê°„ ë³€í™˜
                    const openTime = new Date(data.openTime);
                    const closeTime = new Date(data.closeTime);
                    
                    html += `
                    <div class="info">
                        <h3>${symbol}</h3>
                        <table>
                            <tr><th>í•„ë“œ</th><th>ê°’</th><th>ì„¤ëª…</th></tr>
                            <tr><td>openPrice</td><td>$${parseFloat(data.openPrice).toLocaleString()}</td><td>24ì‹œê°„ ì „ ì‹œê°€</td></tr>
                            <tr><td>highPrice</td><td>$${parseFloat(data.highPrice).toLocaleString()}</td><td>24ì‹œê°„ ìµœê³ ê°€</td></tr>
                            <tr><td>lowPrice</td><td>$${parseFloat(data.lowPrice).toLocaleString()}</td><td>24ì‹œê°„ ìµœì €ê°€</td></tr>
                            <tr><td>lastPrice</td><td>$${parseFloat(data.lastPrice).toLocaleString()}</td><td>í˜„ì¬ê°€ (ì¢…ê°€)</td></tr>
                            <tr><td>prevClosePrice</td><td>$${parseFloat(data.prevClosePrice).toLocaleString()}</td><td>ì´ì „ ì¢…ê°€</td></tr>
                            <tr><td>openTime</td><td>${openTime.toLocaleString('ko-KR')}</td><td>ì‹œì‘ ì‹œê°„</td></tr>
                            <tr><td>closeTime</td><td>${closeTime.toLocaleString('ko-KR')}</td><td>ì¢…ë£Œ ì‹œê°„</td></tr>
                        </table>
                        <details>
                            <summary>ì „ì²´ ì‘ë‹µ ë°ì´í„° ë³´ê¸°</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>`;
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="info" style="border-left-color: #f44336;">ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }
        
        async function testKlineData() {
            resultsDiv.innerHTML = '<div class="info">Kline(ì¼ë´‰) ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';
            
            try {
                const symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT'];
                let html = '<h2>Kline ì¼ë´‰ ë°ì´í„°</h2>';
                
                // ì–´ì œì™€ ì˜¤ëŠ˜ ë°ì´í„°ë§Œ ê°€ì ¸ì˜¤ê¸°
                const endTime = new Date().getTime();
                const startTime = endTime - (2 * 24 * 60 * 60 * 1000); // 2ì¼ ì „
                
                for (const symbol of symbols) {
                    const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${startTime}&endTime=${endTime}&limit=2`);
                    const klines = await response.json();
                    
                    html += `<div class="info"><h3>${symbol} - ìµœê·¼ 2ì¼</h3><table>`;
                    html += '<tr><th>ë‚ ì§œ</th><th>ì‹œê°€</th><th>ê³ ê°€</th><th>ì €ê°€</th><th>ì¢…ê°€</th></tr>';
                    
                    klines.forEach(kline => {
                        const date = new Date(kline[0]).toLocaleDateString('ko-KR');
                        html += `<tr>
                            <td>${date}</td>
                            <td>$${parseFloat(kline[1]).toLocaleString()}</td>
                            <td>$${parseFloat(kline[2]).toLocaleString()}</td>
                            <td>$${parseFloat(kline[3]).toLocaleString()}</td>
                            <td>$${parseFloat(kline[4]).toLocaleString()}</td>
                        </tr>`;
                    });
                    
                    html += '</table></div>';
                }
                
                resultsDiv.innerHTML = html;
                
                // ì¤‘ìš” ì •ë³´ ì¶”ê°€
                html += `
                <div class="info success">
                    <h3>ğŸ“Œ ì¤‘ìš” ë°œê²¬ì‚¬í•­</h3>
                    <p>1. <strong>ticker/24hr API</strong>: ì§€ë‚œ 24ì‹œê°„ ë™ì•ˆì˜ ë°ì´í„° (rolling window)</p>
                    <p>2. <strong>klines API</strong>: íŠ¹ì • ë‚ ì§œì˜ ì¼ë´‰ ë°ì´í„° (UTC 0ì‹œ ê¸°ì¤€)</p>
                    <p>3. ë§¤ì¼ ìì •(UTC)ì— klines APIë¡œ ì „ì¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì €ì¥í•˜ëŠ” ê²ƒì´ ì •í™•í•©ë‹ˆë‹¤!</p>
                    <p>4. í•œêµ­ ì‹œê°„ ì˜¤ì „ 9ì‹œ = UTC 0ì‹œ (ì „ì¼ ë§ˆê°)</p>
                </div>`;
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="info" style="border-left-color: #f44336;">ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }
        
        async function compareData() {
            resultsDiv.innerHTML = '<div class="info">ë°ì´í„° ë¹„êµ ì¤‘...</div>';
            
            try {
                const symbol = 'BTCUSDT';
                
                // 24hr í‹°ì»¤ ë°ì´í„°
                const tickerResp = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
                const ticker = await tickerResp.json();
                
                // ì–´ì œ ì¼ë´‰ ë°ì´í„°
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                yesterday.setHours(0, 0, 0, 0);
                const startTime = yesterday.getTime();
                const endTime = startTime + (24 * 60 * 60 * 1000);
                
                const klineResp = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${startTime}&endTime=${endTime}&limit=1`);
                const klines = await klineResp.json();
                
                let html = `
                <h2>ë°ì´í„° ë¹„êµ: ${symbol}</h2>
                <div class="info">
                    <h3>24hr Ticker vs ì–´ì œ ì¼ë´‰</h3>
                    <table>
                        <tr>
                            <th>í•­ëª©</th>
                            <th>24hr Ticker</th>
                            <th>ì–´ì œ ì¼ë´‰</th>
                            <th>ì„¤ëª…</th>
                        </tr>
                        <tr>
                            <td>ì‹œê°€</td>
                            <td>$${parseFloat(ticker.openPrice).toLocaleString()}</td>
                            <td>${klines[0] ? '$' + parseFloat(klines[0][1]).toLocaleString() : 'N/A'}</td>
                            <td>24hr tickerëŠ” 24ì‹œê°„ ì „ ê°€ê²©</td>
                        </tr>
                        <tr>
                            <td>ê³ ê°€</td>
                            <td>$${parseFloat(ticker.highPrice).toLocaleString()}</td>
                            <td>${klines[0] ? '$' + parseFloat(klines[0][2]).toLocaleString() : 'N/A'}</td>
                            <td>ê¸°ê°„ ë‚´ ìµœê³ ê°€</td>
                        </tr>
                        <tr>
                            <td>ì €ê°€</td>
                            <td>$${parseFloat(ticker.lowPrice).toLocaleString()}</td>
                            <td>${klines[0] ? '$' + parseFloat(klines[0][3]).toLocaleString() : 'N/A'}</td>
                            <td>ê¸°ê°„ ë‚´ ìµœì €ê°€</td>
                        </tr>
                        <tr>
                            <td>ì¢…ê°€</td>
                            <td>$${parseFloat(ticker.lastPrice).toLocaleString()} (í˜„ì¬ê°€)</td>
                            <td>${klines[0] ? '$' + parseFloat(klines[0][4]).toLocaleString() : 'N/A'}</td>
                            <td>tickerëŠ” í˜„ì¬ê°€, ì¼ë´‰ì€ í•´ë‹¹ì¼ ì¢…ê°€</td>
                        </tr>
                    </table>
                </div>
                
                <div class="info success">
                    <h3>âœ… ê²°ë¡  ë° êµ¬í˜„ ë°©ì•ˆ</h3>
                    <p><strong>ë§¤ì¼ ìì •(UTC 0ì‹œ, í•œêµ­ì‹œê°„ ì˜¤ì „ 9ì‹œ)ì— ì‹¤í–‰:</strong></p>
                    <ol>
                        <li>ì–´ì œ ë‚ ì§œ ê³„ì‚°</li>
                        <li>Kline APIë¡œ ì–´ì œ ì¼ë´‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</li>
                        <li>Firebase/Supabaseì— ì €ì¥:
                            <ul>
                                <li>date: ì–´ì œ ë‚ ì§œ (YYYY-MM-DD)</li>
                                <li>open: ì‹œê°€</li>
                                <li>high: ê³ ê°€</li>
                                <li>low: ì €ê°€</li>
                                <li>close: ì¢…ê°€</li>
                            </ul>
                        </li>
                    </ol>
                    <p>ì´ë ‡ê²Œ í•˜ë©´ ì •í™•í•œ ì¼ë³„ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
                </div>`;
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="info" style="border-left-color: #f44336;">ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>