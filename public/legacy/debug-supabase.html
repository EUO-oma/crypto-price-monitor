<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase ì—°ê²° ë””ë²„ê·¸</title>
    <style>
        body {
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #0f0;
            border-radius: 5px;
        }
        
        h1, h2 {
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }
        
        .error {
            color: #f00;
        }
        
        .success {
            color: #0f0;
        }
        
        .warning {
            color: #ff0;
        }
        
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
            font-family: monospace;
            font-weight: bold;
        }
        
        button:hover {
            background: #0a0;
        }
        
        pre {
            background: #111;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        #log {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Supabase ì—°ê²° ë””ë²„ê·¸</h1>
    
    <div class="section">
        <h2>1. í™˜ê²½ í™•ì¸</h2>
        <div id="env-check"></div>
    </div>
    
    <div class="section">
        <h2>2. Supabase SDK ìƒíƒœ</h2>
        <div id="sdk-status"></div>
    </div>
    
    <div class="section">
        <h2>3. ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testDirectConnection()">ì§ì ‘ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <button onclick="testWithConfig()">Config ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <button onclick="testQuery()">ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearLog()">ë¡œê·¸ í´ë¦¬ì–´</button>
    </div>
    
    <div class="section">
        <h2>4. ë¡œê·¸</h2>
        <pre id="log"></pre>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        const log = (message, type = 'info') => {
            const logEl = document.getElementById('log');
            const time = new Date().toTimeString().split(' ')[0];
            const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logEl.innerHTML += `<span class="${colorClass}">[${time}] ${message}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
        };
        
        const clearLog = () => {
            document.getElementById('log').innerHTML = '';
            log('ë¡œê·¸ í´ë¦¬ì–´ë¨', 'info');
        };
        
        // í™˜ê²½ í™•ì¸
        function checkEnvironment() {
            const envEl = document.getElementById('env-check');
            let html = '<ul>';
            
            html += `<li>í˜„ì¬ URL: ${window.location.href}</li>`;
            html += `<li>Netlify í™˜ê²½: ${window.location.hostname.includes('netlify') ? 'Yes' : 'No'}</li>`;
            html += `<li>window.supabase ì¡´ì¬: ${window.supabase ? '<span class="success">Yes</span>' : '<span class="error">No</span>'}</li>`;
            html += `<li>window.supabase.createClient ì¡´ì¬: ${window.supabase?.createClient ? '<span class="success">Yes</span>' : '<span class="error">No</span>'}</li>`;
            html += `<li>window.supabaseClient ì¡´ì¬: ${window.supabaseClient ? '<span class="success">Yes</span>' : '<span class="error">No</span>'}</li>`;
            html += `<li>window.APP_CONFIG ì¡´ì¬: ${window.APP_CONFIG ? '<span class="success">Yes</span>' : '<span class="error">No</span>'}</li>`;
            
            if (window.APP_CONFIG) {
                html += `<li>APP_CONFIG.SUPABASE.URL: ${window.APP_CONFIG.SUPABASE?.URL || 'undefined'}</li>`;
                html += `<li>APP_CONFIG.SUPABASE.ANON_KEY: ${window.APP_CONFIG.SUPABASE?.ANON_KEY ? '***' + window.APP_CONFIG.SUPABASE.ANON_KEY.slice(-10) : 'undefined'}</li>`;
            }
            
            html += '</ul>';
            envEl.innerHTML = html;
        }
        
        // SDK ìƒíƒœ í™•ì¸
        function checkSDKStatus() {
            const sdkEl = document.getElementById('sdk-status');
            
            if (!window.supabase) {
                sdkEl.innerHTML = '<span class="error">âŒ Supabase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</span>';
                return;
            }
            
            let html = '<ul>';
            html += `<li class="success">âœ… Supabase SDK ë¡œë“œë¨</li>`;
            html += `<li>createClient í•¨ìˆ˜: ${typeof window.supabase.createClient === 'function' ? '<span class="success">ì‚¬ìš© ê°€ëŠ¥</span>' : '<span class="error">ì‚¬ìš© ë¶ˆê°€</span>'}</li>`;
            html += '</ul>';
            
            sdkEl.innerHTML = html;
        }
        
        // ì§ì ‘ ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testDirectConnection() {
            log('ì§ì ‘ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            const url = 'https://ddfnxbkiewolgweivomv.supabase.co';
            const key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
            
            try {
                log(`URL: ${url}`, 'info');
                log(`Key: ***${key.slice(-10)}`, 'info');
                
                const client = window.supabase.createClient(url, key);
                log('âœ… í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì„±ê³µ', 'success');
                
                // ì—°ê²° í…ŒìŠ¤íŠ¸
                const { data, error } = await client.from('links').select('count').limit(1);
                
                if (error) {
                    log(`âŒ ì¿¼ë¦¬ ì‹¤íŒ¨: ${error.message}`, 'error');
                    log(`Error code: ${error.code}`, 'error');
                    log(`Error hint: ${error.hint}`, 'error');
                } else {
                    log('âœ… ì¿¼ë¦¬ ì„±ê³µ!', 'success');
                    log(`ê²°ê³¼: ${JSON.stringify(data)}`, 'success');
                }
                
            } catch (e) {
                log(`âŒ ì˜ˆì™¸ ë°œìƒ: ${e.message}`, 'error');
                console.error(e);
            }
        }
        
        // Configë¥¼ ì‚¬ìš©í•œ ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testWithConfig() {
            log('Config ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            // config.js ë¡œë“œ ì‹œë„
            if (!window.APP_CONFIG) {
                log('âš ï¸ APP_CONFIGê°€ ì—†ìŠµë‹ˆë‹¤. config.js ë¡œë“œ ì‹œë„...', 'warning');
                
                try {
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = 'config.js';
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                    
                    log('âœ… config.js ë¡œë“œ ì„±ê³µ', 'success');
                } catch (e) {
                    log('âŒ config.js ë¡œë“œ ì‹¤íŒ¨', 'error');
                    return;
                }
            }
            
            if (!window.APP_CONFIG?.SUPABASE) {
                log('âŒ APP_CONFIG.SUPABASEê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const url = window.APP_CONFIG.SUPABASE.URL;
            const key = window.APP_CONFIG.SUPABASE.ANON_KEY;
            
            log(`Config URL: ${url}`, 'info');
            log(`Config Key: ***${key.slice(-10)}`, 'info');
            
            try {
                const client = window.supabase.createClient(url, key);
                log('âœ… Config ê¸°ë°˜ í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì„±ê³µ', 'success');
                
                // ì—°ê²° í…ŒìŠ¤íŠ¸
                const { data, error } = await client.from('links').select('count').limit(1);
                
                if (error) {
                    log(`âŒ ì¿¼ë¦¬ ì‹¤íŒ¨: ${error.message}`, 'error');
                } else {
                    log('âœ… ì¿¼ë¦¬ ì„±ê³µ!', 'success');
                }
                
            } catch (e) {
                log(`âŒ ì˜ˆì™¸ ë°œìƒ: ${e.message}`, 'error');
            }
        }
        
        // ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
        async function testQuery() {
            log('ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            let client = window.supabaseClient;
            
            if (!client) {
                log('âš ï¸ supabaseClientê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±...', 'warning');
                
                const url = 'https://ddfnxbkiewolgweivomv.supabase.co';
                const key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
                
                try {
                    client = window.supabase.createClient(url, key);
                    window.supabaseClient = client;
                } catch (e) {
                    log(`âŒ í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì‹¤íŒ¨: ${e.message}`, 'error');
                    return;
                }
            }
            
            // ì—¬ëŸ¬ í…Œì´ë¸” í…ŒìŠ¤íŠ¸
            const tables = ['links', 'users', 'test'];
            
            for (const table of tables) {
                try {
                    log(`ğŸ“Š ${table} í…Œì´ë¸” í…ŒìŠ¤íŠ¸...`, 'info');
                    const { data, error } = await client.from(table).select('*').limit(1);
                    
                    if (error) {
                        log(`  âŒ ${table}: ${error.message}`, 'error');
                    } else {
                        log(`  âœ… ${table}: ì„±ê³µ (${data.length}ê°œ ë ˆì½”ë“œ)`, 'success');
                    }
                } catch (e) {
                    log(`  âŒ ${table}: ì˜ˆì™¸ - ${e.message}`, 'error');
                }
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('load', () => {
            checkEnvironment();
            checkSDKStatus();
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'info');
            
            // supabase-init.js ë¡œë“œ ì‹œë„
            const scripts = document.getElementsByTagName('script');
            let hasSupabaseInit = false;
            for (let script of scripts) {
                if (script.src.includes('supabase-init.js')) {
                    hasSupabaseInit = true;
                    break;
                }
            }
            
            if (!hasSupabaseInit) {
                log('âš ï¸ supabase-init.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'warning');
            }
        });
        
        // 5ì´ˆ í›„ ì¬í™•ì¸
        setTimeout(() => {
            log('5ì´ˆ í›„ ì¬í™•ì¸...', 'info');
            checkEnvironment();
            checkSDKStatus();
        }, 5000);
    </script>
</body>
</html>