<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage ìŠ¤íƒ€ì¼ ìˆ˜ì • ë„êµ¬</title>
    <style>
        body {
            font-family: monospace;
            background: #0a0a0a;
            color: #fff;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        h1 {
            color: #4facfe;
            text-align: center;
        }
        
        .section {
            background: #1a1a1a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #444;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        button.danger {
            background: #dc2626;
        }
        
        button.danger:hover {
            background: #b91c1c;
        }
        
        button.success {
            background: #10b981;
        }
        
        button.success:hover {
            background: #059669;
        }
        
        pre {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .error { color: #f87171; }
        .success { color: #4ade80; }
        .warning { color: #fbbf24; }
        .info { color: #60a5fa; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background: #2a2a2a;
        }
        
        .problem {
            background: #7f1d1d;
            color: #fecaca;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ LocalStorage ìŠ¤íƒ€ì¼ ìˆ˜ì • ë„êµ¬</h1>
    
    <div class="section">
        <h2>1. í˜„ì¬ ì €ì¥ëœ ìŠ¤íƒ€ì¼ ê²€ì‚¬</h2>
        <button onclick="checkCurrentStyles()">í˜„ì¬ ìŠ¤íƒ€ì¼ í™•ì¸</button>
        <button onclick="findProblems()">ë¬¸ì œ ì°¾ê¸°</button>
        <div id="current-styles"></div>
    </div>
    
    <div class="section">
        <h2>2. ë¬¸ì œ ìë™ ìˆ˜ì •</h2>
        <button onclick="autoFix()" class="success">ìë™ ìˆ˜ì •</button>
        <button onclick="resetToDefaults()" class="danger">ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”</button>
        <div id="fix-result"></div>
    </div>
    
    <div class="section">
        <h2>3. ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ê²€ì‚¬</h2>
        <button onclick="checkCustomCategories()">ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ í™•ì¸</button>
        <div id="custom-categories"></div>
    </div>
    
    <div class="section">
        <h2>4. ì „ì²´ LocalStorage ë‚´ìš©</h2>
        <button onclick="showAllStorage()">ì „ì²´ ë³´ê¸°</button>
        <button onclick="clearAll()" class="danger">ì „ì²´ ì‚­ì œ (ì£¼ì˜!)</button>
        <div id="all-storage"></div>
    </div>

    <script>
        // í˜„ì¬ ìŠ¤íƒ€ì¼ í™•ì¸
        function checkCurrentStyles() {
            const result = document.getElementById('current-styles');
            
            try {
                const styles = localStorage.getItem('linkCardStyles');
                
                if (!styles) {
                    result.innerHTML = '<p class="warning">âš ï¸ ì €ì¥ëœ ìŠ¤íƒ€ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                
                const parsed = JSON.parse(styles);
                result.innerHTML = `
                    <p class="success">âœ… ìŠ¤íƒ€ì¼ ë°ì´í„° ë°œê²¬</p>
                    <pre>${JSON.stringify(parsed, null, 2)}</pre>
                `;
                
            } catch (error) {
                result.innerHTML = `
                    <p class="error">âŒ íŒŒì‹± ì˜¤ë¥˜: ${error.message}</p>
                    <p>ì›ë³¸ ë°ì´í„°:</p>
                    <pre>${localStorage.getItem('linkCardStyles')}</pre>
                `;
            }
        }
        
        // ë¬¸ì œ ì°¾ê¸°
        function findProblems() {
            const result = document.getElementById('current-styles');
            
            try {
                const styles = localStorage.getItem('linkCardStyles');
                if (!styles) {
                    result.innerHTML = '<p class="info">ì €ì¥ëœ ìŠ¤íƒ€ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                
                const parsed = JSON.parse(styles);
                let problems = [];
                
                // ê° ì¹´í…Œê³ ë¦¬ ê²€ì‚¬
                ['gpt', 'youtube', 'favorite'].forEach(category => {
                    if (parsed[category]) {
                        const cat = parsed[category];
                        
                        // NaN ì²´í¬
                        if (isNaN(cat.fontSize)) problems.push(`${category}.fontSizeê°€ NaN`);
                        if (isNaN(cat.borderWidth)) problems.push(`${category}.borderWidthê°€ NaN`);
                        if (isNaN(cat.borderRadius)) problems.push(`${category}.borderRadiusê°€ NaN`);
                        if (isNaN(cat.padding)) problems.push(`${category}.paddingì´ NaN`);
                        
                        // undefined/null ì²´í¬
                        if (cat.bgColor === undefined || cat.bgColor === null) 
                            problems.push(`${category}.bgColorê°€ undefined/null`);
                        if (cat.textColor === undefined || cat.textColor === null) 
                            problems.push(`${category}.textColorê°€ undefined/null`);
                        
                        // ë¹ˆ ë¬¸ìì—´ ì²´í¬
                        if (cat.bgColor === '') problems.push(`${category}.bgColorê°€ ë¹ˆ ë¬¸ìì—´`);
                        if (cat.textColor === '') problems.push(`${category}.textColorê°€ ë¹ˆ ë¬¸ìì—´`);
                    }
                });
                
                if (problems.length === 0) {
                    result.innerHTML += '<p class="success">âœ… ë¬¸ì œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
                } else {
                    let html = '<p class="error">âŒ ë°œê²¬ëœ ë¬¸ì œ:</p><table>';
                    problems.forEach(problem => {
                        html += `<tr class="problem"><td>${problem}</td></tr>`;
                    });
                    html += '</table>';
                    result.innerHTML += html;
                }
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ ê²€ì‚¬ ì‹¤íŒ¨: ${error.message}</p>`;
            }
        }
        
        // ìë™ ìˆ˜ì •
        function autoFix() {
            const result = document.getElementById('fix-result');
            
            try {
                const styles = localStorage.getItem('linkCardStyles');
                let fixed;
                
                if (!styles) {
                    // ìŠ¤íƒ€ì¼ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ìƒì„±
                    fixed = getDefaultStyles();
                } else {
                    fixed = JSON.parse(styles);
                    
                    // ê° ì¹´í…Œê³ ë¦¬ ìˆ˜ì •
                    ['gpt', 'youtube', 'favorite'].forEach(category => {
                        if (!fixed[category]) {
                            fixed[category] = getDefaultStyles()[category];
                        } else {
                            const cat = fixed[category];
                            
                            // NaNì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´
                            if (isNaN(cat.fontSize)) cat.fontSize = 16;
                            if (isNaN(cat.borderWidth)) cat.borderWidth = 1;
                            if (isNaN(cat.borderRadius)) cat.borderRadius = 10;
                            if (isNaN(cat.padding)) cat.padding = 15;
                            if (isNaN(cat.gap)) cat.gap = 10;
                            
                            // undefined/null/ë¹ˆ ë¬¸ìì—´ ìˆ˜ì •
                            if (!cat.bgColor) cat.bgColor = '#1a1a1a';
                            if (!cat.textColor) cat.textColor = '#ffffff';
                            if (!cat.borderColor) cat.borderColor = '#333333';
                            if (!cat.fontWeight) cat.fontWeight = '500';
                            
                            // í˜¸ë²„ ê´€ë ¨
                            if (!cat.hoverBg) cat.hoverBg = '#2a2a2a';
                            if (!cat.hoverScale) cat.hoverScale = 102;
                        }
                    });
                }
                
                // ì €ì¥
                localStorage.setItem('linkCardStyles', JSON.stringify(fixed));
                
                result.innerHTML = `
                    <p class="success">âœ… ìŠ¤íƒ€ì¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                    <p>ìˆ˜ì •ëœ ë°ì´í„°:</p>
                    <pre>${JSON.stringify(fixed, null, 2)}</pre>
                    <p class="info">â„¹ï¸ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì ìš©ë©ë‹ˆë‹¤.</p>
                `;
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ ìˆ˜ì • ì‹¤íŒ¨: ${error.message}</p>`;
            }
        }
        
        // ê¸°ë³¸ê°’
        function getDefaultStyles() {
            return {
                gpt: {
                    fontSize: 16, fontWeight: '500', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102
                },
                youtube: {
                    fontSize: 17, fontWeight: '600', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102,
                    showLiveIndicator: true
                },
                favorite: {
                    fontSize: 16, fontWeight: '500', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102
                }
            };
        }
        
        // ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
        function resetToDefaults() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ìŠ¤íƒ€ì¼ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.setItem('linkCardStyles', JSON.stringify(getDefaultStyles()));
                document.getElementById('fix-result').innerHTML = 
                    '<p class="success">âœ… ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ í™•ì¸
        function checkCustomCategories() {
            const result = document.getElementById('custom-categories');
            
            try {
                const custom = localStorage.getItem('customCategories');
                
                if (!custom) {
                    result.innerHTML = '<p class="info">ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    // ê¸°ë³¸ ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ìƒì„± ì œì•ˆ
                    result.innerHTML += `
                        <button onclick="createDefaultCustomCategories()" class="success" style="margin-top: 10px;">
                            ê¸°ë³¸ ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ìƒì„±
                        </button>
                    `;
                    return;
                }
                
                const parsed = JSON.parse(custom);
                result.innerHTML = `
                    <p class="success">âœ… ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ë°œê²¬</p>
                    <pre>${JSON.stringify(parsed, null, 2)}</pre>
                `;
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ íŒŒì‹± ì˜¤ë¥˜: ${error.message}</p>`;
            }
        }
        
        // ê¸°ë³¸ ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ìƒì„±
        function createDefaultCustomCategories() {
            const defaultCustom = [
                { id: 'tools', name: 'ğŸ› ï¸ ë„êµ¬', order: 4 },
                { id: 'news', name: 'ğŸ“° ë‰´ìŠ¤', order: 5 },
                { id: 'research', name: 'ğŸ”¬ ì—°êµ¬', order: 6 },
                { id: 'education', name: 'ğŸ“š êµìœ¡', order: 7 }
            ];
            
            localStorage.setItem('customCategories', JSON.stringify(defaultCustom));
            
            // ìŠ¤íƒ€ì¼ë„ í•¨ê»˜ ìƒì„±
            const currentStyles = JSON.parse(localStorage.getItem('linkCardStyles') || '{}');
            
            defaultCustom.forEach(cat => {
                if (!currentStyles[cat.id]) {
                    currentStyles[cat.id] = {
                        fontSize: 16, 
                        fontWeight: '500', 
                        bgColor: '#1a1a1a', 
                        textColor: '#ffffff',
                        borderColor: '#333333', 
                        borderWidth: 1, 
                        borderRadius: 10, 
                        padding: 15, 
                        gap: 10,
                        shadow: true, 
                        hoverEffect: true, 
                        hoverBg: '#2a2a2a', 
                        hoverScale: 102
                    };
                }
            });
            
            localStorage.setItem('linkCardStyles', JSON.stringify(currentStyles));
            
            document.getElementById('custom-categories').innerHTML = 
                '<p class="success">âœ… ê¸°ë³¸ ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</p>' +
                '<p class="info">â„¹ï¸ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì ìš©ë©ë‹ˆë‹¤.</p>';
            
            // ë‹¤ì‹œ í™•ì¸
            setTimeout(() => checkCustomCategories(), 1000);
        }
        
        // ì „ì²´ LocalStorage ë³´ê¸°
        function showAllStorage() {
            const result = document.getElementById('all-storage');
            let html = '<h3>ì „ì²´ LocalStorage ë‚´ìš©:</h3><table>';
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                html += `
                    <tr>
                        <th>${key}</th>
                        <td><pre>${value}</pre></td>
                    </tr>
                `;
            }
            
            html += '</table>';
            result.innerHTML = html;
        }
        
        // ì „ì²´ ì‚­ì œ
        function clearAll() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  LocalStorage ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                localStorage.clear();
                document.getElementById('all-storage').innerHTML = 
                    '<p class="success">âœ… ëª¨ë“  LocalStorage ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ê²€ì‚¬
        window.addEventListener('DOMContentLoaded', () => {
            checkCurrentStyles();
            findProblems();
        });
    </script>
</body>
</html>