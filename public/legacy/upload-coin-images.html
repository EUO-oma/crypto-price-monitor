<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ì¸ ì´ë¯¸ì§€ DB ì—…ë¡œë“œ</title>
    <style>
        body {
            font-family: 'SF Pro Display', sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .container {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #333;
        }
        
        .button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            background: #45a049;
        }
        
        .button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .log {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #333;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸª™ ì½”ì¸ ì´ë¯¸ì§€ ë°ì´í„°ë² ì´ìŠ¤ ì—…ë¡œë“œ</h1>
        <p>Firebaseì— ì½”ì¸ ì´ë¯¸ì§€ ì •ë³´ë¥¼ ì—…ë¡œë“œí•©ë‹ˆë‹¤.</p>
        
        <button class="button" onclick="uploadToFirebase()" id="uploadBtn">
            ğŸ“¤ Firebaseì— ì—…ë¡œë“œ
        </button>
        
        <button class="button" onclick="testCoinImages()" id="testBtn">
            ğŸ§ª ì´ë¯¸ì§€ ë§í¬ í…ŒìŠ¤íŠ¸
        </button>
        
        <button class="button" onclick="clearLog()">
            ğŸ§¹ ë¡œê·¸ ì§€ìš°ê¸°
        </button>
        
        <div class="log" id="log"></div>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="coin-images-db.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA6zB_snzOh_e5tG6_-uK64g6dwL5pzU4c",
            authDomain: "crypto-monitor-84bdb.firebaseapp.com",
            databaseURL: "https://crypto-monitor-84bdb-default-rtdb.firebaseio.com",
            projectId: "crypto-monitor-84bdb",
            storageBucket: "crypto-monitor-84bdb.firebasestorage.app",
            messagingSenderId: "146592267275",
            appId: "1:146592267275:web:916c54658889be5dab9b0e",
            measurementId: "G-TTGCF3YWWJ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        async function uploadToFirebase() {
            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'ì—…ë¡œë“œ ì¤‘...';
            
            try {
                log('Firebaseì— ì½”ì¸ ì´ë¯¸ì§€ ë°ì´í„° ì—…ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
                
                if (typeof getCoinImageDataForFirebase !== 'function') {
                    throw new Error('ì½”ì¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const coinData = getCoinImageDataForFirebase();
                log(`ì´ ${Object.keys(coinData.coins).length}ê°œì˜ ì½”ì¸ ì •ë³´ë¥¼ ì—…ë¡œë“œí•©ë‹ˆë‹¤.`, 'info');
                
                // Firebaseì— ì—…ë¡œë“œ
                await database.ref('coin-images').set(coinData);
                
                log('âœ… Firebase ì—…ë¡œë“œ ì™„ë£Œ!', 'success');
                log(`ì—…ë¡œë“œëœ ì½”ì¸ ìˆ˜: ${Object.keys(coinData.coins).length}`, 'success');
                log(`ë²„ì „: ${coinData.version}`, 'info');
                log(`ì—…ë°ì´íŠ¸ ì‹œê°„: ${coinData.lastUpdated}`, 'info');
                
                // ì—…ë¡œë“œëœ ë°ì´í„° ê²€ì¦
                const verification = await database.ref('coin-images').once('value');
                const uploadedData = verification.val();
                
                if (uploadedData && uploadedData.coins) {
                    log(`âœ… ê²€ì¦ ì™„ë£Œ: ${Object.keys(uploadedData.coins).length}ê°œ ì½”ì¸ í™•ì¸ë¨`, 'success');
                } else {
                    log('âš ï¸ ê²€ì¦ ì‹¤íŒ¨: ì—…ë¡œë“œëœ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                }
                
            } catch (error) {
                log(`âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
                console.error('Upload error:', error);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'ğŸ“¤ Firebaseì— ì—…ë¡œë“œ';
            }
        }
        
        async function testCoinImages() {
            const testBtn = document.getElementById('testBtn');
            testBtn.disabled = true;
            testBtn.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                log('ì½”ì¸ ì´ë¯¸ì§€ ë§í¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
                
                if (typeof COIN_IMAGES_ARRAY === 'undefined') {
                    throw new Error('ì½”ì¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                let successCount = 0;
                let failCount = 0;
                
                for (const coin of COIN_IMAGES_ARRAY.slice(0, 10)) { // ì²˜ìŒ 10ê°œë§Œ í…ŒìŠ¤íŠ¸
                    try {
                        const response = await fetch(coin.image, { method: 'HEAD' });
                        if (response.ok) {
                            log(`âœ… ${coin.symbol} (${coin.name}): ì´ë¯¸ì§€ OK`, 'success');
                            successCount++;
                        } else {
                            log(`âŒ ${coin.symbol} (${coin.name}): HTTP ${response.status}`, 'error');
                            failCount++;
                        }
                    } catch (error) {
                        log(`âŒ ${coin.symbol} (${coin.name}): ${error.message}`, 'error');
                        failCount++;
                    }
                    
                    // ë”œë ˆì´ ì¶”ê°€ (ë„ˆë¬´ ë¹ ë¥¸ ìš”ì²­ ë°©ì§€)
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                log(`\nğŸ“Š í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ì„±ê³µ ${successCount}ê°œ, ì‹¤íŒ¨ ${failCount}ê°œ`, 'info');
                
            } catch (error) {
                log(`âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                console.error('Test error:', error);
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'ğŸ§ª ì´ë¯¸ì§€ ë§í¬ í…ŒìŠ¤íŠ¸';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            log('ì½”ì¸ ì´ë¯¸ì§€ DB ì—…ë¡œë“œ ë„êµ¬ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            
            if (typeof COIN_IMAGES_DB !== 'undefined') {
                const coinCount = Object.keys(COIN_IMAGES_DB).length;
                log(`ë¡œë“œëœ ì½”ì¸ ë°ì´í„°: ${coinCount}ê°œ`, 'success');
                
                // ëª‡ ê°œ ì˜ˆì‹œ í‘œì‹œ
                const examples = Object.keys(COIN_IMAGES_DB).slice(0, 3);
                log(`ì˜ˆì‹œ: ${examples.join(', ')}`, 'info');
            } else {
                log('âš ï¸ ì½”ì¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. coin-images-db.js íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            }
            
            // Firebase ì—°ê²° ìƒíƒœ í™•ì¸
            database.ref('.info/connected').on('value', (snapshot) => {
                const connected = snapshot.val();
                if (connected) {
                    log('ğŸ”¥ Firebase ì—°ê²°ë¨', 'success');
                } else {
                    log('ğŸ”¥ Firebase ì—°ê²° ëŠì–´ì§', 'error');
                }
            });
        });
    </script>
</body>
</html>