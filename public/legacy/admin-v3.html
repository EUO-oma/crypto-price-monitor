<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§í¬ í¸ì§‘ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #0a0a0a;
            border-radius: 20px;
            padding: 30px;
            border: 1px solid #333;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }

        .config-section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #333;
        }

        .config-section h3 {
            color: #aaa;
            margin-bottom: 15px;
        }

        input, select, button {
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #444;
            background: #222;
            color: #fff;
        }

        input {
            width: 300px;
        }

        button {
            cursor: pointer;
            background: #333;
            transition: background 0.3s;
        }

        button:hover {
            background: #444;
        }

        .add-form {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 10px;
        }

        .links-table {
            width: 100%;
            border-collapse: collapse;
        }

        .links-table th {
            background: #1a1a1a;
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #333;
        }

        .links-table tbody {
            background: #0a0a0a;
        }

        .links-table td {
            padding: 12px;
            border-bottom: 1px solid #333;
        }

        .links-table tr:hover {
            background: #1a1a1a;
        }

        .sortable-ghost {
            opacity: 0.4;
            background: #444 !important;
        }

        .drag-handle {
            cursor: move;
            color: #666;
            padding: 0 10px;
            font-size: 1.2em;
        }

        .drag-handle:hover {
            color: #fff;
        }

        .position-btn {
            background: #444;
            color: white;
            border: none;
            padding: 3px 8px;
            margin: 0 2px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .position-btn:hover {
            background: #666;
        }

        .edit-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 5px 15px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        .edit-btn:hover {
            background: #1976d2;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #d32f2f;
        }

        .save-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 5px 15px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        .save-btn:hover {
            background: #45a049;
        }

        .cancel-btn {
            background: #666;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .cancel-btn:hover {
            background: #555;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }

        .success {
            background: #4caf50;
        }

        .error {
            background: #f44336;
        }

        .info {
            background: #2196f3;
            color: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        a {
            color: #4ecdc4;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .edit-input {
            padding: 5px;
            margin: 2px;
            border-radius: 3px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
            width: 200px;
        }

        .edit-mode {
            background: #2a2a2a !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— ë§í¬ í¸ì§‘ê¸°</h1>
        
        <!-- ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ í‘œì‹œ -->
        <div class="config-section" style="margin-bottom: 20px;">
            <h3>ğŸ‘¤ ì‚¬ìš©ì ì •ë³´</h3>
            <div id="user-info">
                <div id="user-email" style="color: #4caf50; font-weight: 500;">ì •ë³´ í™•ì¸ ì¤‘...</div>
                <div id="user-session" style="font-size: 0.9em; color: #888; margin-top: 5px;"></div>
            </div>
        </div>
        
        <div class="info" style="position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleGuide()">
                <span>ğŸ’¡ ê¸°ëŠ¥ ì•ˆë‚´ <span id="guide-arrow" style="font-size: 0.8em;">â–¼</span></span>
                <span style="font-size: 0.9em; opacity: 0.7;">í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°/ì ‘ê¸°</span>
            </div>
            <div id="guide-content" style="display: none; margin-top: 15px;">
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>âœï¸ <strong>ìˆ˜ì •</strong>: ë§í¬ ì´ë¦„ê³¼ URL ì§ì ‘ ìˆ˜ì •</li>
                    <li>ğŸ”„ <strong>ë“œë˜ê·¸ ì•¤ ë“œë¡­</strong>: â‰¡ ì•„ì´ì½˜ìœ¼ë¡œ ìˆœì„œ ë³€ê²½</li>
                    <li>â¬†ï¸â¬‡ï¸ <strong>ë²„íŠ¼ ì´ë™</strong>: ìœ„/ì•„ë˜ ì´ë™</li>
                    <li>â• <strong>ì¶”ê°€</strong>: ìƒˆ ë§í¬ ì¶”ê°€</li>
                    <li>ğŸ—‘ï¸ <strong>ì‚­ì œ</strong>: ë§í¬ ì œê±°</li>
                    <li>ğŸ¨ <strong>ìŠ¤íƒ€ì¼ ì„¤ì •</strong>: ê° ì„¹ì…˜ë³„ ê¸€ì í¬ê¸°, ìƒ‰ìƒ, íš¨ê³¼ ë“± ì»¤ìŠ¤í„°ë§ˆì´ì§•</li>
                    <li>ğŸ·ï¸ <strong>ì¹´í…Œê³ ë¦¬</strong>: ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</li>
                </ul>
            </div>
        </div>

        <div class="config-section">
            <h3>âš™ï¸ Supabase ì—°ê²° ìƒíƒœ</h3>
            <div id="connection-status">í™•ì¸ ì¤‘...</div>
            <div id="connection-help" style="display:none; margin-top: 10px; font-size: 0.9em; color: #ff9800;">
                ğŸ’¡ ì—°ê²° ë¬¸ì œ í•´ê²° ë°©ë²•:
                <ol style="margin: 5px 0; padding-left: 20px;">
                    <li>Supabase ëŒ€ì‹œë³´ë“œì—ì„œ SQL Editor ì—´ê¸°</li>
                    <li>ë‹¤ìŒ ëª…ë ¹ ì‹¤í–‰: <code>ALTER TABLE links DISABLE ROW LEVEL SECURITY;</code></li>
                    <li>ì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</li>
                </ol>
                <a href="/fix-supabase.html" target="_blank" style="color: #4caf50;">â†’ ìë™ ì§„ë‹¨ ë„êµ¬ ì—´ê¸°</a>
            </div>
        </div>

        <div class="add-form" style="margin-bottom: 20px;">
            <h3 style="width: 100%; margin-bottom: 10px;">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ ì„¤ì •</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="text" id="new-category-id" placeholder="ì¹´í…Œê³ ë¦¬ ID (ì˜ˆ: voucher)" style="flex: 1;">
                <input type="text" id="new-category-name" placeholder="í‘œì‹œ ì´ë¦„ (ì˜ˆ: Voucher)" style="flex: 1;">
                <button onclick="addCustomCategory()" style="background: #007bff;">ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
            </div>
            <div id="custom-categories" style="font-size: 0.9em; color: #888;">
                ê¸°ë³¸ ì¹´í…Œê³ ë¦¬: youtube, favorite, gpt, fun-youtube
            </div>
        </div>

        <!-- ë””ìì¸ ì„¤ì • í˜ì´ì§€ ì´ë™ ë²„íŠ¼ -->
        <div style="background: #1a1a1a; padding: 20px; margin-bottom: 20px; border-radius: 10px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="margin: 0; margin-bottom: 5px;">ğŸ¨ ë””ìì¸ ì„¤ì •</h3>
                    <p style="margin: 0; font-size: 0.9em; color: #888;">ë§í¬ ì¹´ë“œì˜ ìŠ¤íƒ€ì¼ì„ ì„¸ë¶€ì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                </div>
                <button onclick="location.href='design-settings.html'"
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                               color: white;
                               border: none;
                               padding: 12px 24px;
                               border-radius: 8px;
                               cursor: pointer;
                               font-size: 1em;
                               font-weight: 600;
                               transition: all 0.3s;
                               box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.5)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(102, 126, 234, 0.3)'">
                    ë””ìì¸ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™ â†’
                </button>
            </div>
        </div>


        <!-- Fun YouTube í‘œì‹œ ì„¤ì • í† ê¸€ ë²„íŠ¼ -->
        <div style="background: #1a1a1a; padding: 15px; margin-bottom: 20px; border-radius: 10px; cursor: pointer;" onclick="toggleFunYoutubeSettings()">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">ğŸ¬ Fun YouTube í‘œì‹œ ì„¤ì • <span id="fun-youtube-arrow" style="font-size: 0.8em;">â–¼</span></h3>
                <span style="font-size: 0.9em; opacity: 0.7;">í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°/ì ‘ê¸°</span>
            </div>
        </div>

        <!-- Fun YouTube í‘œì‹œ ì„¤ì • ì»¨í…ì¸  -->
        <div id="fun-youtube-settings-content" class="add-form" style="display: none; margin-bottom: 20px; background: #1a1a1a;">
            <h3 style="width: 100%; margin-bottom: 15px;">ğŸ¬ Fun YouTube í‘œì‹œ ì„¤ì •</h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <!-- í‘œì‹œ ì˜µì…˜ -->
                <div style="border: 1px solid #333; padding: 20px; border-radius: 8px;">
                    <h4 style="color: #ff6b6b; margin-bottom: 15px;">ğŸ“º í‘œì‹œ ì˜µì…˜</h4>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ê¸°ë³¸ ë³´ê¸° ëª¨ë“œ:</strong>
                        <select id="fun-youtube-default-view" style="width: 100%; margin-top: 5px; padding: 8px; background: #333; border: 1px solid #444; border-radius: 5px; color: #fff;">
                            <option value="list">ë¦¬ìŠ¤íŠ¸ ë·° (ê°€ë¡œí˜•)</option>
                            <option value="grid">ê·¸ë¦¬ë“œ ë·° (ì¹´ë“œí˜•)</option>
                            <option value="compact">ì»´íŒ©íŠ¸ ë·° (í…ìŠ¤íŠ¸ë§Œ)</option>
                        </select>
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ê·¸ë¦¬ë“œ ì—´ ê°œìˆ˜:</strong>
                        <select id="fun-youtube-grid-cols" style="width: 100%; margin-top: 5px; padding: 8px; background: #333; border: 1px solid #444; border-radius: 5px; color: #fff;">
                            <option value="2">2ì—´</option>
                            <option value="3" selected>3ì—´</option>
                            <option value="4">4ì—´</option>
                        </select>
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ì¸ë„¤ì¼ í‘œì‹œ:</strong>
                        <input type="checkbox" id="fun-youtube-show-thumbnail" checked style="margin-left: 10px;">
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ì±„ë„ëª… í‘œì‹œ:</strong>
                        <input type="checkbox" id="fun-youtube-show-author" checked style="margin-left: 10px;">
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ë·° ì „í™˜ ë²„íŠ¼ í‘œì‹œ:</strong>
                        <input type="checkbox" id="fun-youtube-show-toggle" checked style="margin-left: 10px;">
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ìë™ìœ¼ë¡œ ì œëª© ê°€ì ¸ì˜¤ê¸°:</strong>
                        <input type="checkbox" id="fun-youtube-auto-fetch" checked style="margin-left: 10px;">
                    </label>
                </div>

                <!-- ìŠ¤íƒ€ì¼ ì„¤ì • -->
                <div style="border: 1px solid #333; padding: 20px; border-radius: 8px;">
                    <h4 style="color: #ff6b6b; margin-bottom: 15px;">ğŸ¨ ìŠ¤íƒ€ì¼ ì„¤ì •</h4>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ì œëª© ê¸€ì í¬ê¸°:</strong>
                        <input type="range" id="fun-youtube-title-size" min="12" max="20" value="15" style="width: 150px; margin-left: 10px;">
                        <span id="fun-youtube-title-size-display">15px</span>
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ì¹´ë“œ ë°°ê²½ìƒ‰:</strong>
                        <input type="color" id="fun-youtube-card-bg" value="#1a1a1a" style="margin-left: 10px;">
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>í…Œë‘ë¦¬ ìƒ‰ìƒ:</strong>
                        <input type="color" id="fun-youtube-border-color" value="#333333" style="margin-left: 10px;">
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>í˜¸ë²„ íš¨ê³¼:</strong>
                        <select id="fun-youtube-hover-effect" style="width: 100%; margin-top: 5px; padding: 8px; background: #333; border: 1px solid #444; border-radius: 5px; color: #fff;">
                            <option value="lift" selected>ë“¤ì–´ì˜¬ë¦¬ê¸°</option>
                            <option value="glow">ë¹›ë‚˜ê¸°</option>
                            <option value="scale">í™•ëŒ€</option>
                            <option value="none">íš¨ê³¼ ì—†ìŒ</option>
                        </select>
                    </label>

                    <label style="display: block; margin-bottom: 15px;">
                        <strong>ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸°:</strong>
                        <input type="range" id="fun-youtube-border-radius" min="0" max="20" value="10" style="width: 150px; margin-left: 10px;">
                        <span id="fun-youtube-radius-display">10px</span>
                    </label>
                </div>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="saveFunYoutubeSettings()" style="background: #ff6b6b;">ğŸ’¾ Fun YouTube ì„¤ì • ì €ì¥</button>
                <button onclick="resetFunYoutubeSettings()" style="background: #666;">ğŸ”„ ê¸°ë³¸ê°’ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div class="add-form">
            <h3 style="width: 100%; margin-bottom: 10px;">â• ìƒˆ ë§í¬ ì¶”ê°€</h3>
            <input type="text" id="link-name" placeholder="ì´ë¦„ (ì˜ˆ: ì‚¬ë˜)">
            <input type="text" id="link-url" placeholder="URL (ì˜ˆ: https://...)">
            <select id="link-category">
                <option value="youtube">YouTube</option>
                <option value="favorite">Favorite</option>
                <option value="gpt">GPT Tools</option>
                <option value="fun-youtube">Fun YouTube</option>
            </select>
            <input type="number" id="link-position" placeholder="ìˆœì„œ (1, 2, 3...)" value="999">
            <button onclick="addNewLink()">ì¶”ê°€</button>
        </div>

        <div id="status-message"></div>

        <h2 style="margin-bottom: 20px;">ğŸ“‹ í˜„ì¬ ë§í¬ ëª©ë¡</h2>
        
        <div id="links-container">
            <p>ë¡œë”© ì¤‘...</p>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="index.html" style="margin-right: 20px;">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
            <button onclick="signOut()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                <span id="logout-user-email">ë¡œê·¸ì•„ì›ƒ</span>
            </button>
        </div>
    </div>

    <!-- Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¨¼ì € ë¡œë“œí•˜ê³  ì´ˆê¸°í™” -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <!-- ì§ì ‘ Supabase ì´ˆê¸°í™” -->
    <script>
        // ì¦‰ì‹œ Supabase ì´ˆê¸°í™”
        (function() {
            const SUPABASE_URL = 'https://ddfnxbkiewolgweivomv.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
            
            // Supabase SDK ë¡œë“œ ëŒ€ê¸°
            function waitForSupabase() {
                if (window.supabase && window.supabase.createClient) {
                    try {
                        window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                        console.log('âœ… Supabase client initialized directly');
                    } catch (e) {
                        console.error('âŒ Failed to create Supabase client:', e);
                    }
                } else {
                    setTimeout(waitForSupabase, 100);
                }
            }
            
            waitForSupabase();
        })();
    </script>
    
    <!-- Supabase ì´ˆê¸°í™” -->
    <script>
        // ì „ì—­ supabase í´ë¼ì´ì–¸íŠ¸
        let supabase = null;

        // í˜ì´ì§€ ë¡œë“œ í›„ ë°”ë¡œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function() {
            let retryCount = 0;
            const maxRetries = 10;
            
            // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹œë„
            function tryInitialize() {
                try {
                    console.log(`[app] Initialization attempt ${retryCount + 1}/${maxRetries}`);
                    
                    // supabaseClient í™•ì¸
                    if (window.supabaseClient) {
                        supabase = window.supabaseClient;
                        console.log('[app] Supabase client ready');
                        initializeApp();
                    } else {
                        retryCount++;
                        if (retryCount < maxRetries) {
                            console.log('[app] Supabase client not ready, retrying in 500ms...');
                            setTimeout(tryInitialize, 500);
                        } else {
                            console.error('[app] Supabase client not found after ' + maxRetries + ' attempts');
                            document.getElementById('connection-status').innerHTML = 
                                '<span style="color: #f44336;">âŒ Supabaseì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>';
                            
                            // ìˆ˜ë™ìœ¼ë¡œ ì´ˆê¸°í™” ì‹œë„ - í•˜ë“œì½”ë”©ëœ ê°’ ì‚¬ìš©
                            if (window.supabase && window.supabase.createClient) {
                                console.log('[app] Attempting manual initialization with hardcoded values...');
                                try {
                                    const url = 'https://ddfnxbkiewolgweivomv.supabase.co';
                                    const key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
                                    
                                    supabase = window.supabase.createClient(url, key);
                                    window.supabaseClient = supabase;
                                    console.log('[app] Manual initialization successful with hardcoded values');
                                    initializeApp();
                                } catch (e) {
                                    console.error('[app] Manual initialization failed:', e);
                                    document.getElementById('connection-status').innerHTML = 
                                        `<span style="color: #f44336;">âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ${e.message}</span>`;
                                }
                            } else {
                                document.getElementById('connection-status').innerHTML = 
                                    '<span style="color: #f44336;">âŒ Supabase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</span>';
                            }
                        }
                    }
                } catch (error) {
                    console.error('[app] ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                    document.getElementById('connection-status').innerHTML = 
                        '<span style="color: #f44336;">âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message + '</span>';
                }
            }
            
            // ì²« ì‹œë„ëŠ” ì¦‰ì‹œ ì‹¤í–‰
            tryInitialize();
        });

        // ë§í¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì§ì ‘ ì •ì˜
        async function fetchLinks() {
            if (!supabase) {
                console.error('[app] Supabase client not available in fetchLinks');
                return { youtube: [], favorites: [], gpt: [] };
            }

            try {
                // YouTube ì±„ë„ ê°€ì ¸ì˜¤ê¸°
                const { data: youtubeLinks, error: ytError } = await supabase.from('links')
                    .select('*')
                    .eq('category', 'youtube')
                    .order('position');

                if (ytError) throw ytError;

                // Favorite ì‚¬ì´íŠ¸ ê°€ì ¸ì˜¤ê¸°
                const { data: favoriteLinks, error: favError } = await supabase.from('links')
                    .select('*')
                    .eq('category', 'favorite')
                    .order('position');

                if (favError) throw favError;

                // GPT ë„êµ¬ ë§í¬ ê°€ì ¸ì˜¤ê¸°
                const { data: gptLinks, error: gptError } = await supabase.from('links')
                    .select('*')
                    .eq('category', 'gpt')
                    .order('position');

                if (gptError) throw gptError;

                return {
                    youtube: youtubeLinks || [],
                    favorites: favoriteLinks || [],
                    gpt: gptLinks || []
                };
            } catch (error) {
                console.error('Error fetching links:', error);
                return { youtube: [], favorites: [], gpt: [] };
            }
        }

        async function addLink(name, url, category, position = 999) {
            if (!supabase) {
                console.error('[app] Supabase client not available');
                return null;
            }

            try {
                // ë§í¬ ë°ì´í„°ì— ì¶”ê°€ì ì •ë³´ í¬í•¨
                const linkData = { 
                    name, 
                    url, 
                    category, 
                    position,
                    created_by: window.currentUser?.email || 'unknown',
                    created_at: new Date().toISOString()
                };
                
                console.log('ğŸ“ ë§í¬ ì¶”ê°€:', {
                    name: name,
                    category: category,
                    addedBy: linkData.created_by
                });

                const { data, error } = await supabase.from('links')
                    .insert([linkData])
                    .select();

                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error adding link:', error);
                return null;
            }
        }

        async function deleteLink(id) {
            if (!supabase) {
                console.error('[app] Supabase client not available');
                return false;
            }

            try {
                // ì‚­ì œ ì „ ë§í¬ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë¡œê·¸ìš©)
                const { data: linkInfo } = await supabase.from('links')
                    .select('name, category')
                    .eq('id', id)
                    .single();

                const { error } = await supabase.from('links')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                
                console.log('ğŸ—‘ï¸ ë§í¬ ì‚­ì œ:', {
                    id: id,
                    name: linkInfo?.name || 'unknown',
                    category: linkInfo?.category || 'unknown',
                    deletedBy: window.currentUser?.email || 'unknown',
                    deletedAt: new Date().toISOString()
                });
                
                return true;
            } catch (error) {
                console.error('Error deleting link:', error);
                return false;
            }
        }

        async function updateLink(id, updates) {
            if (!supabase) {
                console.error('[app] Supabase client not available');
                return null;
            }

            try {
                // ìˆ˜ì •ì ì •ë³´ ì¶”ê°€
                const updateData = {
                    ...updates,
                    updated_by: window.currentUser?.email || 'unknown',
                    updated_at: new Date().toISOString()
                };
                
                console.log('âœï¸ ë§í¬ ìˆ˜ì •:', {
                    id: id,
                    changes: Object.keys(updates),
                    updatedBy: updateData.updated_by
                });

                const { data, error } = await supabase.from('links')
                    .update(updateData)
                    .eq('id', id)
                    .select();

                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error updating link:', error);
                return null;
            }
        }

        function subscribeToLinks(callback) {
            if (!supabase) {
                console.error('[app] Supabase client not available for subscription');
                return null;
            }

            const subscription = supabase.channel('links_changes')
                .on('postgres_changes',
                    { event: '*', schema: 'public', table: 'links' },
                    (payload) => {
                        console.log('Change received!', payload);
                        callback(payload);
                    }
                )
                .subscribe();

            return subscription;
        }
    </script>

    <!-- í—¬í¼ í•¨ìˆ˜ ë¡œë“œ -->
    <script src="auth-helper.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let editingId = null;
        let customCategories = [];
        let guideOpen = false;
        let funYoutubeSettingsOpen = false;

        // ê¸°ëŠ¥ ì•ˆë‚´ í† ê¸€
        function toggleGuide() {
            const guideContent = document.getElementById('guide-content');
            const guideArrow = document.getElementById('guide-arrow');

            guideOpen = !guideOpen;

            if (guideOpen) {
                guideContent.style.display = 'block';
                guideArrow.textContent = 'â–²';
            } else {
                guideContent.style.display = 'none';
                guideArrow.textContent = 'â–¼';
            }

            // ìƒíƒœ ì €ì¥
            localStorage.setItem('guideOpen', guideOpen);
        }

        // Fun YouTube ì„¤ì • í† ê¸€
        function toggleFunYoutubeSettings() {
            const settingsContent = document.getElementById('fun-youtube-settings-content');
            const settingsArrow = document.getElementById('fun-youtube-arrow');

            funYoutubeSettingsOpen = !funYoutubeSettingsOpen;

            if (funYoutubeSettingsOpen) {
                settingsContent.style.display = 'block';
                settingsArrow.textContent = 'â–²';
            } else {
                settingsContent.style.display = 'none';
                settingsArrow.textContent = 'â–¼';
            }

            // ìƒíƒœ ì €ì¥
            localStorage.setItem('funYoutubeSettingsOpen', funYoutubeSettingsOpen);
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ê°€ì´ë“œ ìƒíƒœ ë³µì›
        function restoreGuideState() {
            const savedState = localStorage.getItem('guideOpen');
            if (savedState === 'true') {
                guideOpen = false; // toggleGuideê°€ ë°˜ëŒ€ë¡œ í† ê¸€í•˜ë¯€ë¡œ
                toggleGuide();
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ Fun YouTube ì„¤ì • ìƒíƒœ ë³µì›
        function restoreFunYoutubeSettingsState() {
            const savedState = localStorage.getItem('funYoutubeSettingsOpen');
            if (savedState === 'true') {
                funYoutubeSettingsOpen = false; // toggleì´ ë°˜ëŒ€ë¡œ í† ê¸€í•˜ë¯€ë¡œ
                toggleFunYoutubeSettings();
            }
            
            // Fun YouTube ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const titleSizeSlider = document.getElementById('fun-youtube-title-size');
            const titleSizeDisplay = document.getElementById('fun-youtube-title-size-display');
            if (titleSizeSlider && titleSizeDisplay) {
                titleSizeSlider.addEventListener('input', (e) => {
                    titleSizeDisplay.textContent = e.target.value + 'px';
                });
            }
            
            const radiusSlider = document.getElementById('fun-youtube-border-radius');
            const radiusDisplay = document.getElementById('fun-youtube-radius-display');
            if (radiusSlider && radiusDisplay) {
                radiusSlider.addEventListener('input', (e) => {
                    radiusDisplay.textContent = e.target.value + 'px';
                });
            }
        }

        // localStorageì—ì„œ ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadCustomCategories() {
            const saved = localStorage.getItem('customCategories');
            if (saved) {
                customCategories = JSON.parse(saved);
                updateCategoryDropdown();
                updateCategoryDisplay();
            }
        }

        // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateCategoryDropdown() {
            const select = document.getElementById('link-category');

            // select ìš”ì†Œê°€ ì—†ìœ¼ë©´ ë¦¬í„´
            if (!select) {
                console.warn('link-category select element not found');
                return;
            }

            // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì¶”ê°€
            customCategories.forEach(cat => {
                if (!document.querySelector(`option[value="${cat.id}"]`)) {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name;
                    select.appendChild(option);
                }
            });
        }

        // ì¹´í…Œê³ ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateCategoryDisplay() {
            const display = document.getElementById('custom-categories');
            const allCategories = [
                'youtube', 'favorite', 'gpt', 'fun-youtube',
                ...customCategories.map(c => c.id)
            ];
            display.innerHTML = `
                <div>ê¸°ë³¸ ì¹´í…Œê³ ë¦¬: youtube, favorite, gpt, fun-youtube</div>
                ${customCategories.length > 0 ? 
                    `<div>ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬: ${customCategories.map(c => `${c.id} (${c.name})`).join(', ')}</div>` : 
                    ''}
            `;
        }

        // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
        function addCustomCategory() {
            const idInput = document.getElementById('new-category-id');
            const nameInput = document.getElementById('new-category-name');
            
            const categoryId = idInput.value.trim().toLowerCase();
            const categoryName = nameInput.value.trim();
            
            if (!categoryId || !categoryName) {
                alert('ì¹´í…Œê³ ë¦¬ IDì™€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì¤‘ë³µ ì²´í¬
            const existing = ['youtube', 'favorite', 'gpt', 'fun-youtube', ...customCategories.map(c => c.id)];
            if (existing.includes(categoryId)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¹´í…Œê³ ë¦¬ IDì…ë‹ˆë‹¤.');
                return;
            }
            
            // ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            customCategories.push({ id: categoryId, name: categoryName });
            localStorage.setItem('customCategories', JSON.stringify(customCategories));
            
            // UI ì—…ë°ì´íŠ¸
            updateCategoryDropdown();
            updateCategoryDisplay();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            idInput.value = '';
            nameInput.value = '';
            
            showStatus(`ì¹´í…Œê³ ë¦¬ '${categoryName}' (${categoryId})ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // ìŠ¤íƒ€ì¼ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadSavedStyles() {
            const savedStyles = JSON.parse(localStorage.getItem('linkCardStyles') || '{}');

            // ê¸°ë³¸ê°’ ì„¤ì •
            const defaultStyles = {
                gpt: {
                    fontSize: 16, fontWeight: '500', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102
                },
                youtube: {
                    fontSize: 17, fontWeight: '600', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102,
                    showLiveIndicator: true
                },
                favorite: {
                    fontSize: 16, fontWeight: '500', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102
                }
            };

            // ì €ì¥ëœ ìŠ¤íƒ€ì¼ ë˜ëŠ” ê¸°ë³¸ê°’ ì ìš©
            ['gpt', 'youtube', 'favorite'].forEach(category => {
                const styles = { ...defaultStyles[category], ...(savedStyles[category] || {}) };

                // ê¸°ë³¸ ìŠ¤íƒ€ì¼
                document.getElementById(`${category}-font-size`).value = styles.fontSize;
                document.getElementById(`${category}-font-size-display`).textContent = `${styles.fontSize}px`;
                document.getElementById(`${category}-font-weight`).value = styles.fontWeight;
                document.getElementById(`${category}-bg-color`).value = styles.bgColor;
                document.getElementById(`${category}-text-color`).value = styles.textColor;
                document.getElementById(`${category}-border-color`).value = styles.borderColor;

                // í™•ì¥ ìŠ¤íƒ€ì¼
                document.getElementById(`${category}-border-width`).value = styles.borderWidth;
                document.getElementById(`${category}-border-width-display`).textContent = `${styles.borderWidth}px`;
                document.getElementById(`${category}-border-radius`).value = styles.borderRadius;
                document.getElementById(`${category}-border-radius-display`).textContent = `${styles.borderRadius}px`;
                document.getElementById(`${category}-padding`).value = styles.padding;
                document.getElementById(`${category}-padding-display`).textContent = `${styles.padding}px`;
                document.getElementById(`${category}-gap`).value = styles.gap;
                document.getElementById(`${category}-gap-display`).textContent = `${styles.gap}px`;

                // íš¨ê³¼ ì„¤ì •
                document.getElementById(`${category}-shadow`).checked = styles.shadow;
                document.getElementById(`${category}-hover-effect`).checked = styles.hoverEffect;
                document.getElementById(`${category}-hover-bg`).value = styles.hoverBg;
                document.getElementById(`${category}-hover-scale`).value = styles.hoverScale;
                document.getElementById(`${category}-hover-scale-display`).textContent = `${styles.hoverScale}%`;
            });

            // YouTube Live ì „ìš© ì„¤ì •
            const youtubeStyles = savedStyles.youtube || defaultStyles.youtube;
            document.getElementById('youtube-show-live-indicator').checked = youtubeStyles.showLiveIndicator;
        }

        function initStyleControls() {
            // ê° ì¹´í…Œê³ ë¦¬ë³„ ì»¨íŠ¸ë¡¤ ì´ˆê¸°í™”
            ['gpt', 'youtube', 'favorite'].forEach(category => {
                // í°íŠ¸ ì‚¬ì´ì¦ˆ ìŠ¬ë¼ì´ë”
                const fontSlider = document.getElementById(`${category}-font-size`);
                const fontDisplay = document.getElementById(`${category}-font-size-display`);
                if (fontSlider) {
                    fontSlider.addEventListener('input', (e) => {
                        fontDisplay.textContent = `${e.target.value}px`;
                        previewStyles();
                    });
                }

                // í…Œë‘ë¦¬ ë‘ê»˜ ìŠ¬ë¼ì´ë”
                const borderSlider = document.getElementById(`${category}-border-width`);
                const borderDisplay = document.getElementById(`${category}-border-width-display`);
                if (borderSlider) {
                    borderSlider.addEventListener('input', (e) => {
                        borderDisplay.textContent = `${e.target.value}px`;
                        previewStyles();
                    });
                }

                // ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸° ìŠ¬ë¼ì´ë”
                const radiusSlider = document.getElementById(`${category}-border-radius`);
                const radiusDisplay = document.getElementById(`${category}-border-radius-display`);
                if (radiusSlider) {
                    radiusSlider.addEventListener('input', (e) => {
                        radiusDisplay.textContent = `${e.target.value}px`;
                        previewStyles();
                    });
                }

                // íŒ¨ë”© ìŠ¬ë¼ì´ë”
                const paddingSlider = document.getElementById(`${category}-padding`);
                const paddingDisplay = document.getElementById(`${category}-padding-display`);
                if (paddingSlider) {
                    paddingSlider.addEventListener('input', (e) => {
                        paddingDisplay.textContent = `${e.target.value}px`;
                        previewStyles();
                    });
                }

                // ê°„ê²© ìŠ¬ë¼ì´ë”
                const gapSlider = document.getElementById(`${category}-gap`);
                const gapDisplay = document.getElementById(`${category}-gap-display`);
                if (gapSlider) {
                    gapSlider.addEventListener('input', (e) => {
                        gapDisplay.textContent = `${e.target.value}px`;
                        previewStyles();
                    });
                }

                // í˜¸ë²„ ìŠ¤ì¼€ì¼ ìŠ¬ë¼ì´ë”
                const scaleSlider = document.getElementById(`${category}-hover-scale`);
                const scaleDisplay = document.getElementById(`${category}-hover-scale-display`);
                if (scaleSlider) {
                    scaleSlider.addEventListener('input', (e) => {
                        scaleDisplay.textContent = `${e.target.value}%`;
                        previewStyles();
                    });
                }

                // ìƒ‰ìƒ ì„ íƒê¸° ì´ë²¤íŠ¸
                ['bg-color', 'text-color', 'border-color', 'hover-bg'].forEach(type => {
                    const colorInput = document.getElementById(`${category}-${type}`);
                    if (colorInput) {
                        colorInput.addEventListener('change', () => previewStyles());
                    }
                });

                // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
                ['shadow', 'hover-effect'].forEach(type => {
                    const checkbox = document.getElementById(`${category}-${type}`);
                    if (checkbox) {
                        checkbox.addEventListener('change', () => previewStyles());
                    }
                });

                // ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì´ë²¤íŠ¸ (font-weight)
                const fontWeight = document.getElementById(`${category}-font-weight`);
                if (fontWeight) {
                    fontWeight.addEventListener('change', () => previewStyles());
                }
            });

            // YouTube Live ì „ìš© - ë¼ì´ë¸Œ ì¸ë””ì¼€ì´í„°
            const liveIndicator = document.getElementById('youtube-show-live-indicator');
            if (liveIndicator) {
                liveIndicator.addEventListener('change', () => previewStyles());
            }
        }

        function saveStyles() {
            const styles = {};
            
            // ê¸°ë³¸ê°’ ì •ì˜
            const defaultValues = {
                fontSize: 16,
                fontWeight: '500',
                bgColor: '#1a1a1a',
                textColor: '#ffffff',
                borderColor: '#333333',
                borderWidth: 1,
                borderRadius: 10,
                padding: 15,
                gap: 10,
                hoverBg: '#2a2a2a',
                hoverScale: 102
            };

            ['gpt', 'youtube', 'favorite'].forEach(category => {
                // ê°’ ê°€ì ¸ì˜¤ê¸° ë° ê¸°ë³¸ê°’ ì²˜ë¦¬
                const fontSize = parseInt(document.getElementById(`${category}-font-size`).value);
                const borderWidth = parseInt(document.getElementById(`${category}-border-width`).value);
                const borderRadius = parseInt(document.getElementById(`${category}-border-radius`).value);
                const padding = parseInt(document.getElementById(`${category}-padding`).value);
                const gap = parseInt(document.getElementById(`${category}-gap`).value);
                const hoverScale = parseInt(document.getElementById(`${category}-hover-scale`).value);
                
                styles[category] = {
                    fontSize: isNaN(fontSize) ? defaultValues.fontSize : fontSize,
                    fontWeight: document.getElementById(`${category}-font-weight`).value || defaultValues.fontWeight,
                    bgColor: document.getElementById(`${category}-bg-color`).value || defaultValues.bgColor,
                    textColor: document.getElementById(`${category}-text-color`).value || defaultValues.textColor,
                    borderColor: document.getElementById(`${category}-border-color`).value || defaultValues.borderColor,
                    borderWidth: isNaN(borderWidth) ? defaultValues.borderWidth : borderWidth,
                    borderRadius: isNaN(borderRadius) ? defaultValues.borderRadius : borderRadius,
                    padding: isNaN(padding) ? defaultValues.padding : padding,
                    gap: isNaN(gap) ? defaultValues.gap : gap,
                    shadow: document.getElementById(`${category}-shadow`).checked,
                    hoverEffect: document.getElementById(`${category}-hover-effect`).checked,
                    hoverBg: document.getElementById(`${category}-hover-bg`).value || defaultValues.hoverBg,
                    hoverScale: isNaN(hoverScale) ? defaultValues.hoverScale : hoverScale
                };
            });

            // YouTube Live ì „ìš© ì„¤ì •
            styles.youtube.showLiveIndicator = document.getElementById('youtube-show-live-indicator').checked;

            localStorage.setItem('linkCardStyles', JSON.stringify(styles));
            showStatus('ìŠ¤íƒ€ì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ì¸ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì ìš©ë©ë‹ˆë‹¤.', 'success');
        }

        function resetStyles() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ìŠ¤íƒ€ì¼ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('linkCardStyles');
                loadSavedStyles();
                previewStyles();
                showStatus('ìŠ¤íƒ€ì¼ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        // Fun YouTube ì„¤ì • ì €ì¥
        function saveFunYoutubeSettings() {
            // ê¸°ë³¸ê°’ ì •ì˜
            const funDefaults = {
                viewMode: 'list',
                gridColumns: 3,
                fontSize: 16,
                bgColor: '#1a1a1a',
                textColor: '#ffffff',
                hoverBgColor: '#2a2a2a',
                borderRadius: 8
            };
            
            // ê°’ ê°€ì ¸ì˜¤ê¸° ë° ê²€ì¦ - ì˜¬ë°”ë¥¸ ID ì‚¬ìš©
            const gridColumns = parseInt(document.getElementById('fun-youtube-grid-cols').value);
            const fontSize = parseInt(document.getElementById('fun-youtube-title-size').value);
            const borderRadius = parseInt(document.getElementById('fun-youtube-border-radius').value);
            
            const settings = {
                viewMode: document.getElementById('fun-youtube-default-view').value || funDefaults.viewMode,
                gridColumns: isNaN(gridColumns) ? funDefaults.gridColumns : gridColumns,
                showThumbnails: document.getElementById('fun-youtube-show-thumbnail').checked,
                showAuthor: document.getElementById('fun-youtube-show-author').checked,
                showViewButton: document.getElementById('fun-youtube-show-toggle').checked,
                autoFetch: document.getElementById('fun-youtube-auto-fetch').checked,
                fontSize: isNaN(fontSize) ? funDefaults.fontSize : fontSize,
                bgColor: document.getElementById('fun-youtube-card-bg').value || funDefaults.bgColor,
                borderColor: document.getElementById('fun-youtube-border-color').value || funDefaults.borderColor,
                hoverEffect: document.getElementById('fun-youtube-hover-effect').value || 'lift',
                borderRadius: isNaN(borderRadius) ? funDefaults.borderRadius : borderRadius
            };

            localStorage.setItem('funYoutubeSettings', JSON.stringify(settings));
            showStatus('Fun YouTube ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // Fun YouTube ì„¤ì • ì´ˆê¸°í™”
        function resetFunYoutubeSettings() {
            const defaultSettings = {
                viewMode: 'list',
                gridColumns: 3,
                showThumbnails: true,
                showAuthor: false,
                showViewButton: false,
                fontSize: 16,
                bgColor: '#1a1a1a',
                textColor: '#ffffff',
                hoverBgColor: '#2a2a2a',
                borderRadius: 8,
                hoverScale: true
            };

            // í¼ì— ê¸°ë³¸ê°’ ì„¤ì • - ì˜¬ë°”ë¥¸ ID ì‚¬ìš©
            const viewModeEl = document.getElementById('fun-youtube-default-view');
            const gridColsEl = document.getElementById('fun-youtube-grid-cols');
            const thumbnailEl = document.getElementById('fun-youtube-show-thumbnail');
            const authorEl = document.getElementById('fun-youtube-show-author');
            const toggleEl = document.getElementById('fun-youtube-show-toggle');
            const autoFetchEl = document.getElementById('fun-youtube-auto-fetch');
            const fontSizeEl = document.getElementById('fun-youtube-title-size');
            const cardBgEl = document.getElementById('fun-youtube-card-bg');
            const borderColorEl = document.getElementById('fun-youtube-border-color');
            const hoverEffectEl = document.getElementById('fun-youtube-hover-effect');
            const borderRadiusEl = document.getElementById('fun-youtube-border-radius');
            
            if (viewModeEl) viewModeEl.value = defaultSettings.viewMode;
            if (gridColsEl) gridColsEl.value = defaultSettings.gridColumns;
            if (thumbnailEl) thumbnailEl.checked = defaultSettings.showThumbnails;
            if (authorEl) authorEl.checked = defaultSettings.showAuthor;
            if (toggleEl) toggleEl.checked = defaultSettings.showViewButton;
            if (autoFetchEl) autoFetchEl.checked = true;
            if (fontSizeEl) {
                fontSizeEl.value = defaultSettings.fontSize;
                const fontSizeDisplay = document.getElementById('fun-youtube-title-size-display');
                if (fontSizeDisplay) fontSizeDisplay.textContent = defaultSettings.fontSize + 'px';
            }
            if (cardBgEl) cardBgEl.value = defaultSettings.bgColor;
            if (borderColorEl) borderColorEl.value = '#333333';
            if (hoverEffectEl) hoverEffectEl.value = 'lift';
            if (borderRadiusEl) {
                borderRadiusEl.value = defaultSettings.borderRadius;
                const radiusDisplay = document.getElementById('fun-youtube-radius-display');
                if (radiusDisplay) radiusDisplay.textContent = defaultSettings.borderRadius + 'px';
            }

            localStorage.setItem('funYoutubeSettings', JSON.stringify(defaultSettings));
            showStatus('Fun YouTube ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // Fun YouTube ì„¤ì • ë¡œë“œ
        function loadFunYoutubeSettings() {
            const defaultSettings = {
                viewMode: 'list',
                gridColumns: 3,
                showThumbnails: true,
                showAuthor: false,
                showViewButton: false,
                fontSize: 16,
                bgColor: '#1a1a1a',
                textColor: '#ffffff',
                hoverBgColor: '#2a2a2a',
                borderRadius: 8,
                hoverScale: true
            };

            const savedSettings = JSON.parse(localStorage.getItem('funYoutubeSettings') || '{}');
            const settings = { ...defaultSettings, ...savedSettings };

            // í¼ì— ì €ì¥ëœ ê°’ ì„¤ì • - ì˜¬ë°”ë¥¸ ID ì‚¬ìš©
            const viewModeEl = document.getElementById('fun-youtube-default-view');
            const gridColsEl = document.getElementById('fun-youtube-grid-cols');
            const thumbnailEl = document.getElementById('fun-youtube-show-thumbnail');
            const authorEl = document.getElementById('fun-youtube-show-author');
            const toggleEl = document.getElementById('fun-youtube-show-toggle');
            const autoFetchEl = document.getElementById('fun-youtube-auto-fetch');
            const fontSizeEl = document.getElementById('fun-youtube-title-size');
            const cardBgEl = document.getElementById('fun-youtube-card-bg');
            const borderColorEl = document.getElementById('fun-youtube-border-color');
            const hoverEffectEl = document.getElementById('fun-youtube-hover-effect');
            const borderRadiusEl = document.getElementById('fun-youtube-border-radius');
            
            // Elementsê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ ì„¤ì •
            if (viewModeEl) viewModeEl.value = settings.viewMode;
            if (gridColsEl) gridColsEl.value = settings.gridColumns;
            if (thumbnailEl) thumbnailEl.checked = settings.showThumbnails;
            if (authorEl) authorEl.checked = settings.showAuthor;
            if (toggleEl) toggleEl.checked = settings.showViewButton;
            if (autoFetchEl) autoFetchEl.checked = settings.autoFetch !== false;
            if (fontSizeEl) {
                fontSizeEl.value = settings.fontSize;
                const fontSizeDisplay = document.getElementById('fun-youtube-title-size-display');
                if (fontSizeDisplay) fontSizeDisplay.textContent = settings.fontSize + 'px';
            }
            if (cardBgEl) cardBgEl.value = settings.bgColor;
            if (borderColorEl) borderColorEl.value = settings.borderColor || '#333333';
            if (hoverEffectEl) hoverEffectEl.value = settings.hoverEffect || 'lift';
            if (borderRadiusEl) {
                borderRadiusEl.value = settings.borderRadius;
                const radiusDisplay = document.getElementById('fun-youtube-radius-display');
                if (radiusDisplay) radiusDisplay.textContent = settings.borderRadius + 'px';
            }
        }

        function previewStyles() {
            const previewDiv = document.getElementById('style-preview');
            previewDiv.style.display = 'block';

            ['gpt', 'youtube', 'favorite'].forEach(category => {
                const preview = document.getElementById(`${category}-preview`);
                const fontSize = document.getElementById(`${category}-font-size`).value;
                const fontWeight = document.getElementById(`${category}-font-weight`).value;
                const bgColor = document.getElementById(`${category}-bg-color`).value;
                const textColor = document.getElementById(`${category}-text-color`).value;
                const borderColor = document.getElementById(`${category}-border-color`).value;
                const borderWidth = document.getElementById(`${category}-border-width`).value;
                const borderRadius = document.getElementById(`${category}-border-radius`).value;
                const padding = document.getElementById(`${category}-padding`).value;
                const shadow = document.getElementById(`${category}-shadow`).checked;
                const hoverEffect = document.getElementById(`${category}-hover-effect`).checked;
                const hoverBg = document.getElementById(`${category}-hover-bg`).value;
                const hoverScale = document.getElementById(`${category}-hover-scale`).value;

                preview.style.fontSize = `${fontSize}px`;
                preview.style.fontWeight = fontWeight;
                preview.style.backgroundColor = bgColor;
                preview.style.color = textColor;
                preview.style.border = `${borderWidth}px solid ${borderColor}`;
                preview.style.borderRadius = `${borderRadius}px`;
                preview.style.padding = `${padding}px`;
                preview.style.boxShadow = shadow ? '0 2px 8px rgba(0,0,0,0.2)' : 'none';
                preview.style.transition = hoverEffect ? 'all 0.3s ease' : 'none';
                preview.style.cursor = 'pointer';

                // í˜¸ë²„ íš¨ê³¼ ì ìš©
                if (hoverEffect) {
                    preview.onmouseover = function() {
                        this.style.backgroundColor = hoverBg;
                        this.style.transform = `scale(${hoverScale / 100})`;
                        if (shadow) {
                            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                        }
                    };
                    preview.onmouseout = function() {
                        this.style.backgroundColor = bgColor;
                        this.style.transform = 'scale(1)';
                        if (shadow) {
                            this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
                        }
                    };
                }
            });
        }

        // ë¡œê·¸ì¸ í•¨ìˆ˜
        async function loginWithGoogle() {
            try {
                sessionStorage.setItem('redirectTo', 'admin-v3.html');
                const { error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/auth-callback.html'
                    }
                });
                if (error) {
                    console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
        window.loginWithGoogle = loginWithGoogle;

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ í•¨ìˆ˜
        function displayUserInfo(session) {
            const userEmailEl = document.getElementById('user-email');
            const userSessionEl = document.getElementById('user-session');
            
            if (!userEmailEl || !userSessionEl) {
                console.warn('User info elements not found');
                return;
            }
            
            if (session && session.user) {
                const user = session.user;
                const email = user.email;
                const provider = user.app_metadata?.provider || 'ì•Œ ìˆ˜ ì—†ìŒ';
                const loginTime = new Date(session.expires_at * 1000 - (session.expires_in || 3600) * 1000);
                
                userEmailEl.innerHTML = `âœ… <strong>${email}</strong>`;
                userSessionEl.innerHTML = `
                    <div>ì œê³µì: ${provider} | ë¡œê·¸ì¸ ì‹œê°„: ${loginTime.toLocaleString('ko-KR')}</div>
                    <div>ì„¸ì…˜ ë§Œë£Œ: ${new Date(session.expires_at * 1000).toLocaleString('ko-KR')}</div>
                `;
                
                // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì— ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                const logoutBtn = document.getElementById('logout-user-email');
                if (logoutBtn) {
                    logoutBtn.textContent = `${email} ë¡œê·¸ì•„ì›ƒ`;
                }
                
                // ì „ì—­ ë³€ìˆ˜ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥ (ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì‚¬ìš©)
                window.currentUser = {
                    email: email,
                    id: user.id,
                    provider: provider
                };
                
                console.log('ğŸ‘¤ ì‚¬ìš©ì ì •ë³´:', {
                    email: email,
                    provider: provider,
                    userId: user.id
                });
            } else {
                userEmailEl.innerHTML = 'âŒ ì •ë³´ ì—†ìŒ';
                userSessionEl.innerHTML = '';
                
                // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
                const logoutBtn = document.getElementById('logout-user-email');
                if (logoutBtn) {
                    logoutBtn.textContent = 'ë¡œê·¸ì•„ì›ƒ';
                }
                
                window.currentUser = null;
            }
        }

        // initializeAppì€ ì´ë¯¸ ìœ„ì˜ DOMContentLoadedì—ì„œ í˜¸ì¶œë¨

        async function initializeApp() {
            // ìµœì¢… í™•ì¸
            if (!supabase) {
                console.error('[app] Failed to initialize Supabase client');
                document.getElementById('connection-status').innerHTML = '<span style="color: #f44336;">âŒ Supabase ì´ˆê¸°í™” ì‹¤íŒ¨</span>';
                return;
            }

            console.log('[app] Supabase client ready:', supabase);

            // ë””ë²„ê¹…: í™˜ê²½ë³€ìˆ˜ í™•ì¸
            console.log('=== App Auth Debug ===');
            console.log('1. APP_CONFIG:', window.APP_CONFIG || 'Not loaded');
            console.log('2. ENV_CONFIG:', window.ENV_CONFIG || 'Not loaded');
            console.log('3. getConfig function:', typeof window.getConfig);
            console.log('4. ALLOWED_EMAILS:', window.getConfig ? 'configured' : 'getConfig not available');
            
            // checkAuth í•¨ìˆ˜ í™•ì¸
            if (typeof checkAuth !== 'function') {
                console.error('[app] checkAuth function not found');
                document.getElementById('connection-status').innerHTML = '<span style="color: #f44336;">âŒ í•¨ìˆ˜ ì—†ìŒ</span>';
                return;
            }
            
            const userSession = await checkAuth();
            console.log('5. User session:', userSession ? 'authenticated' : 'not authenticated');
            
            // ë¡œê·¸ì¸ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ í‘œì‹œ
            if (!userSession) {
                console.log('ë¡œê·¸ì¸ í•„ìš”');
                // ë¡œê·¸ì¸ UI í‘œì‹œ
                document.getElementById('connection-status').innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <p style="color: #ff9800; margin-bottom: 20px;">ë§í¬ í¸ì§‘ í˜ì´ì§€</p>
                        <button onclick="loginWithGoogle()" style="background: #4285F4; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px;">
                            <svg style="width: 20px; height: 20px; vertical-align: middle; margin-right: 10px;" viewBox="0 0 24 24">
                                <path fill="#ffffff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#ffffff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#ffffff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#ffffff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Googleë¡œ ë¡œê·¸ì¸
                        </button>
                    </div>
                `;
                return; // ë” ì´ìƒ ì§„í–‰í•˜ì§€ ì•ŠìŒ
            }
            
            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            displayUserInfo(userSession);
            
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì™„ë£Œ

            restoreGuideState(); // ê°€ì´ë“œ ìƒíƒœ ë³µì›
            // restoreDesignSettingsState(); // ë””ìì¸ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™ë¨
            restoreFunYoutubeSettingsState(); // Fun YouTube ì„¤ì • ìƒíƒœ ë³µì›
            loadCustomCategories(); // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ë¡œë“œ
            updateCategoryDropdown(); // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            // loadSavedStyles(); // ë””ìì¸ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™ë¨
            // initStyleControls(); // ë””ìì¸ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™ë¨
            loadFunYoutubeSettings(); // Fun YouTube ì„¤ì • ë¡œë“œ

            await checkConnection();
            await loadLinks();

            // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í™œì„±í™”
            enableRealtimeUpdates();
            
            // í™˜ì˜ ë©”ì‹œì§€ í‘œì‹œ
            if (window.currentUser?.email) {
                setTimeout(() => {
                    showStatus(`${window.currentUser.email}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`, 'success');
                }, 1000);
            }
        }

        // Supabase ì—°ê²° í™•ì¸
        async function checkConnection() {
            const statusElement = document.getElementById('connection-status');

            if (!statusElement) {
                console.error('connection-status element not found');
                return;
            }

            if (!supabase) {
                console.error('Supabase client not initialized');
                statusElement.innerHTML = '<span style="color: #f44336;">âŒ Supabase ì´ˆê¸°í™” ì‹¤íŒ¨</span>';
                
                // ì¬ì‹œë„ - í•˜ë“œì½”ë”©ëœ ê°’ ì‚¬ìš©
                if (window.supabase && window.supabase.createClient) {
                    try {
                        const url = 'https://ddfnxbkiewolgweivomv.supabase.co';
                        const key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
                        
                        supabase = window.supabase.createClient(url, key);
                        window.supabaseClient = supabase;
                        console.log('Supabase client created in checkConnection with hardcoded values');
                    } catch (e) {
                        console.error('Failed to create Supabase client:', e);
                        statusElement.innerHTML = `<span style="color: #f44336;">âŒ í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì‹¤íŒ¨: ${e.message}</span>`;
                        return;
                    }
                } else {
                    statusElement.innerHTML = '<span style="color: #f44336;">âŒ Supabase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</span>';
                    return;
                }
            }

            try {
                console.log('Checking Supabase connection...');
                statusElement.innerHTML = '<span style="color: #ff9800;">ğŸ”„ ì—°ê²° í™•ì¸ ì¤‘...</span>';
                
                const { data, error } = await supabase.from('links').select('count').limit(1);
                if (error) throw error;
                
                console.log('Supabase connection successful');
                statusElement.innerHTML = '<span style="color: #4caf50;">âœ… ì—°ê²°ë¨</span>';
            } catch (error) {
                console.error('Supabase connection error:', error);
                
                // ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
                let errorMessage = 'ì—°ê²° ì‹¤íŒ¨';
                
                if (error.message && error.message.includes('Failed to fetch')) {
                    errorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜';
                } else if (error.message && error.message.includes('JWSError')) {
                    errorMessage = 'API í‚¤ ì˜¤ë¥˜';
                } else if (error.message && error.message.includes('permission')) {
                    errorMessage = 'ê¶Œí•œ ì˜¤ë¥˜';
                } else if (error.message) {
                    // "Config File" ê°™ì€ ë©”ì‹œì§€ë¥¼ ë” ì¹œí™”ì ìœ¼ë¡œ
                    errorMessage = 'ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜';
                }
                
                statusElement.innerHTML = `<span style="color: #f44336;">âŒ ${errorMessage}</span>`;
                
                // ë„ì›€ë§ í‘œì‹œ
                const helpElement = document.getElementById('connection-help');
                if (helpElement) {
                    helpElement.style.display = 'block';
                }
                
                // ë””ë²„ê¹… ì •ë³´ (ê°œë°œì ì½˜ì†”ì—ë§Œ)
                console.log('Debug info:', {
                    originalError: error.message,
                    errorCode: error.code,
                    errorHint: error.hint,
                    url: supabase?._supabaseUrl
                });
            }
        }

        // ë§í¬ ëª©ë¡ ë¡œë“œ
        async function loadLinks() {
            const container = document.getElementById('links-container');

            if (!container) {
                console.error('links-container element not found');
                return;
            }
            
            // Supabase ì—°ê²°ì´ ì—†ìœ¼ë©´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©
            if (!supabase) {
                console.warn('Supabase not available, using local storage');
                loadLinksFromLocalStorage();
                return;
            }

            console.log('Loading links...');
            container.innerHTML = '<p>ë¡œë”© ì¤‘...</p>';

            try {
                // ëª¨ë“  ë§í¬ë¥¼ ê°€ì ¸ì˜¤ê¸°
                const { data: allLinks, error } = await supabase.from('links')
                    .select('*')
                    .order('category', { ascending: true })
                    .order('position', { ascending: true });

                if (error) {
                    console.error('Supabase error:', error);
                    throw error;
                }

                console.log('Loaded links:', allLinks);

                // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”
                const linksByCategory = {};
                allLinks.forEach(link => {
                    if (!linksByCategory[link.category]) {
                        linksByCategory[link.category] = [];
                    }
                    linksByCategory[link.category].push(link);
                });

                let html = '';

                // ì¹´í…Œê³ ë¦¬ ìˆœì„œ ì •ì˜ (ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ë¨¼ì €)
                const categoryOrder = ['youtube', 'favorite', 'gpt', 'fun-youtube'];
                const customCats = Object.keys(linksByCategory).filter(cat => !categoryOrder.includes(cat));
                const allCategories = [...categoryOrder, ...customCats];

                // ì¹´í…Œê³ ë¦¬ ì´ë¦„ ë§¤í•‘
                const categoryNames = {
                    'youtube': 'ğŸ¬ YouTube',
                    'favorite': 'â­ Favorites',
                    'gpt': 'ğŸ¤– GPT Tools',
                    'fun-youtube': 'ğŸ® Fun YouTube'
                };

                // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì´ë¦„ ì¶”ê°€
                customCategories.forEach(cat => {
                    categoryNames[cat.id] = `ğŸ“Œ ${cat.name}`;
                });

                // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ë Œë”ë§
                allCategories.forEach(category => {
                    if (linksByCategory[category] && linksByCategory[category].length > 0) {
                        const displayName = categoryNames[category] || `ğŸ“ ${category}`;
                        html += `<h3 style="margin: 20px 0 10px;">${displayName}</h3>`;
                        html += createTable(linksByCategory[category], category);
                    }
                });

                container.innerHTML = html || '<p>ë“±ë¡ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';

                console.log('Links rendered successfully');

                // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ˆê¸°í™”
                initSortable();
            } catch (error) {
                console.error('Error loading links:', error);
                container.innerHTML = `<p style="color: #f44336;">ì˜¤ë¥˜: ${error.message}</p>`;
            }
        }

        // í…Œì´ë¸” ìƒì„±
        function createTable(links, category) {
            let html = `<table class="links-table" data-category="${category}">`;
            html += '<thead><tr><th width="30">â‡…</th><th width="60">ìˆœì„œ</th><th>ì´ë¦„</th><th>URL</th><th width="120">ì¹´í…Œê³ ë¦¬</th><th width="150">ì •ë³´</th><th width="250">ì‘ì—…</th></tr></thead>';
            html += `<tbody id="sortable-${category}">`;
            
            links.forEach(link => {
                html += `
                    <tr data-id="${link.id}" data-position="${link.position}" data-category="${link.category}" id="row-${link.id}">
                        <td class="drag-handle">â‰¡</td>
                        <td>${link.position || '-'}</td>
                        <td class="name-cell" id="name-${link.id}">${link.name}</td>
                        <td class="url-cell" id="url-${link.id}">
                            <a href="${link.url}" target="_blank">${link.url.substring(0, 50)}${link.url.length > 50 ? '...' : ''}</a>
                        </td>
                        <td class="category-cell" id="category-${link.id}" style="text-align: center; color: #888; font-size: 0.9em;">${link.category}</td>
                        <td class="info-cell" style="font-size: 0.8em; color: #666;">
                            ${link.created_by ? `<div>ì¶”ê°€: ${link.created_by.split('@')[0]}</div>` : ''}
                            ${link.updated_by ? `<div>ìˆ˜ì •: ${link.updated_by.split('@')[0]}</div>` : ''}
                            ${link.created_at ? `<div style="font-size: 0.75em; margin-top: 2px;">${new Date(link.created_at).toLocaleDateString('ko-KR')}</div>` : ''}
                        </td>
                        <td class="action-cell" id="actions-${link.id}">
                            <button class="position-btn" onclick="moveUp(${link.id}, ${link.position}, '${category}')">â†‘</button>
                            <button class="position-btn" onclick="moveDown(${link.id}, ${link.position}, '${category}')">â†“</button>
                            <button class="edit-btn" onclick="editLink(${link.id}, '${link.name.replace(/'/g, "\\'").replace(/"/g, '&quot;')}', '${link.url.replace(/'/g, "\\'").replace(/"/g, '&quot;')}', '${link.category}')">ìˆ˜ì •</button>
                            <button class="delete-btn" onclick="removeLink(${link.id})">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        function getCategories() {
            const defaultCategories = [
                { id: 'youtube', name: 'YouTube' },
                { id: 'favorite', name: 'Favorite' },
                { id: 'gpt', name: 'GPT Tools' },
                { id: 'fun-youtube', name: 'Fun YouTube' }
            ];

            // ì „ì—­ ë³€ìˆ˜ customCategories ì‚¬ìš©
            return [...defaultCategories, ...customCategories];
        }

        // ë§í¬ ìˆ˜ì • ëª¨ë“œ
        function editLink(id, name, url, currentCategory) {
            // ì´ë¯¸ ë‹¤ë¥¸ í•­ëª©ì„ ìˆ˜ì • ì¤‘ì´ë©´ ì·¨ì†Œ
            if (editingId && editingId !== id) {
                cancelEdit(editingId);
            }

            editingId = id;
            const row = document.getElementById(`row-${id}`);
            row.classList.add('edit-mode');

            // ì´ë¦„ ì…€ì„ ì…ë ¥ í•„ë“œë¡œ ë³€ê²½
            document.getElementById(`name-${id}`).innerHTML = 
                `<input type="text" class="edit-input" id="edit-name-${id}" value="${name}">`;

            // URL ì…€ì„ ì…ë ¥ í•„ë“œë¡œ ë³€ê²½
            document.getElementById(`url-${id}`).innerHTML = 
                `<input type="text" class="edit-input" id="edit-url-${id}" value="${url}" style="width: 90%;">`;

            // ì¹´í…Œê³ ë¦¬ ì…€ì„ ì„ íƒ ë°•ìŠ¤ë¡œ ë³€ê²½
            const categories = getCategories();
            let categoryOptions = '';
            categories.forEach(cat => {
                categoryOptions += `<option value="${cat.id}" ${cat.id === currentCategory ? 'selected' : ''}>${cat.name}</option>`;
            });
            
            document.getElementById(`category-${id}`).innerHTML = 
                `<select class="edit-input" id="edit-category-${id}" style="width: 100px; background: #333; color: #fff; border: 1px solid #444;">
                    ${categoryOptions}
                </select>`;

            // ì‘ì—… ë²„íŠ¼ ë³€ê²½
            document.getElementById(`actions-${id}`).innerHTML = 
                `<button class="save-btn" onclick="saveEdit(${id})">ì €ì¥</button>
                 <button class="cancel-btn" onclick="cancelEdit(${id})">ì·¨ì†Œ</button>`;
        }

        // ìˆ˜ì • ì €ì¥
        async function saveEdit(id) {
            const newName = document.getElementById(`edit-name-${id}`).value;
            const newUrl = document.getElementById(`edit-url-${id}`).value;
            const newCategory = document.getElementById(`edit-category-${id}`).value;

            if (!newName || !newUrl || !newCategory) {
                showStatus('ì´ë¦„, URL, ì¹´í…Œê³ ë¦¬ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }

            const result = await updateLink(id, { 
                name: newName, 
                url: newUrl, 
                category: newCategory 
            });
            
            if (result) {
                showStatus('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                editingId = null;
                await loadLinks();
            } else {
                showStatus('ìˆ˜ì • ì‹¤íŒ¨', 'error');
            }
        }

        // ìˆ˜ì • ì·¨ì†Œ
        function cancelEdit(id) {
            editingId = null;
            loadLinks();
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ˆê¸°í™”
        function initSortable() {
            // ëª¨ë“  sortable tbody ìš”ì†Œë¥¼ ì°¾ì•„ì„œ ì´ˆê¸°í™”
            const allSortables = document.querySelectorAll('[id^="sortable-"]');
            allSortables.forEach(element => {
                const category = element.id.replace('sortable-', '');
                if (element) {
                    new Sortable(element, {
                        handle: '.drag-handle',
                        animation: 150,
                        ghostClass: 'sortable-ghost',
                        onEnd: async function(evt) {
                            await updatePositions(category);
                        }
                    });
                }
            });
        }

        // ìˆœì„œ ì—…ë°ì´íŠ¸
        async function updatePositions(category) {
            const tbody = document.getElementById(`sortable-${category}`);
            if (!tbody) return;
            
            const rows = tbody.querySelectorAll('tr');
            const updates = [];
            
            rows.forEach((row, index) => {
                const id = row.dataset.id;
                const newPosition = index + 1;
                updates.push(updateLink(id, { position: newPosition }));
            });
            
            await Promise.all(updates);
            showStatus('ìˆœì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            await loadLinks();
        }

        // ìœ„ë¡œ ì´ë™
        async function moveUp(id, currentPos, category) {
            if (currentPos <= 1) return;
            
            const { data: links } = await supabase.from('links')
                .select('*')
                .eq('category', category)
                .order('position');
            
            const currentIndex = links.findIndex(l => l.id === id);
            if (currentIndex > 0) {
                const prevLink = links[currentIndex - 1];
                
                await updateLink(id, { position: prevLink.position });
                await updateLink(prevLink.id, { position: currentPos });
                
                await loadLinks();
            }
        }

        // ì•„ë˜ë¡œ ì´ë™
        async function moveDown(id, currentPos, category) {
            const { data: links } = await supabase.from('links')
                .select('*')
                .eq('category', category)
                .order('position');
            
            const currentIndex = links.findIndex(l => l.id === id);
            if (currentIndex < links.length - 1) {
                const nextLink = links[currentIndex + 1];
                
                await updateLink(id, { position: nextLink.position });
                await updateLink(nextLink.id, { position: currentPos });
                
                await loadLinks();
            }
        }

        // ìƒˆ ë§í¬ ì¶”ê°€
        async function addNewLink() {
            const name = document.getElementById('link-name').value;
            const url = document.getElementById('link-url').value;
            const category = document.getElementById('link-category').value;
            const position = parseInt(document.getElementById('link-position').value) || 999;
            
            if (!name || !url) {
                showStatus('ì´ë¦„ê³¼ URLì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }
            
            const result = await addLink(name, url, category, position);
            
            if (result) {
                showStatus('ë§í¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                document.getElementById('link-name').value = '';
                document.getElementById('link-url').value = '';
                document.getElementById('link-position').value = '999';
                await loadLinks();
            } else {
                showStatus('ì¶”ê°€ ì‹¤íŒ¨', 'error');
            }
        }

        // ë§í¬ ì‚­ì œ
        async function removeLink(id) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const result = await deleteLink(id);
            
            if (result) {
                showStatus('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                await loadLinks();
            } else {
                showStatus('ì‚­ì œ ì‹¤íŒ¨', 'error');
            }
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatus(message, type) {
            const statusElement = document.getElementById('status-message');
            statusElement.className = `status ${type}`;
            statusElement.textContent = message;
            
            setTimeout(() => {
                statusElement.textContent = '';
                statusElement.className = '';
            }, 3000);
        }

        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ëŠ” í˜ì´ì§€ ë¡œë“œ í›„ì— í™œì„±í™”
        function enableRealtimeUpdates() {
            if (typeof subscribeToLinks === 'function') {
                subscribeToLinks(async (payload) => {
                    console.log('ë°ì´í„° ë³€ê²½ ê°ì§€:', payload);
                    if (!editingId) {  // ìˆ˜ì • ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ìë™ ìƒˆë¡œê³ ì¹¨
                        await loadLinks();
                    }
                });
            } else {
                console.warn('subscribeToLinks function not available');
            }
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°±ì—… í•¨ìˆ˜ë“¤
        function loadLinksFromLocalStorage() {
            const container = document.getElementById('links-container');
            const localLinks = localStorage.getItem('admin_links');
            
            if (localLinks) {
                const links = JSON.parse(localLinks);
                displayLinks(links);
            } else {
                container.innerHTML = '<p style="color: #ff9800;">âš ï¸ ë¡œì»¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. Supabase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';
            }
        }
        
        function saveLinksToLocalStorage(links) {
            localStorage.setItem('admin_links', JSON.stringify(links));
        }
        
        // ë§í¬ í‘œì‹œ í•¨ìˆ˜ (ê³µí†µ)
        function displayLinks(allLinks) {
            const container = document.getElementById('links-container');
            const youtubeLinks = allLinks.filter(link => link.category === 'youtube');
            const favoriteLinks = allLinks.filter(link => link.category === 'favorite');
            const gptLinks = allLinks.filter(link => link.category === 'gpt');
            
            container.innerHTML = '';
            
            // YouTube ì„¹ì…˜
            if (youtubeLinks.length > 0) {
                container.innerHTML += createLinkSection('youtube', 'YouTube ì±„ë„', youtubeLinks);
            }
            
            // Favorites ì„¹ì…˜
            if (favoriteLinks.length > 0) {
                container.innerHTML += createLinkSection('favorite', 'Favorite Sites', favoriteLinks);
            }
            
            // GPT Tools ì„¹ì…˜
            if (gptLinks.length > 0) {
                container.innerHTML += createLinkSection('gpt', 'GPT Tools', gptLinks);
            }
            
            if (allLinks.length === 0) {
                container.innerHTML = '<p>ë“±ë¡ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        function createLinkSection(category, title, links) {
            let html = `<div class="link-category"><h3>${title}</h3><div class="links-grid">`;
            
            links.forEach(link => {
                html += `
                    <div class="link-item" data-id="${link.id}">
                        <div class="link-header">
                            <span class="link-name">${link.name}</span>
                            <div class="link-actions">
                                <button onclick="editLink('${link.id}')" class="edit-btn">âœï¸</button>
                                <button onclick="deleteLink('${link.id}')" class="delete-btn">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                        <a href="${link.url}" target="_blank" class="link-url">${link.url}</a>
                    </div>
                `;
            });
            
            html += '</div></div>';
            return html;
        }
    </script>
</body>
</html>