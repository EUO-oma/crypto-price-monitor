<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>LINKS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: #0a0a0a;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            max-width: 900px;
            width: 100%;
            border: 1px solid #1a1a1a;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 40px;
            font-size: 2.5em;
        }

        h2 {
            color: #aaa;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #333;
        }

        .links {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }

        .links a {
            color: #888;
            text-decoration: none;
            margin: 0 15px;
            font-size: 0.9em;
            transition: color 0.3s ease;
        }

        .links a:hover {
            color: #aaa;
            text-decoration: underline;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }
        
        /* YouTube ë¼ì´ë¸Œ ì¸ë””ì¼€ì´í„° ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes livePulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 0 5px rgba(255, 0, 0, 0);
                transform: scale(1.2);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
                transform: scale(1);
            }
        }
        
        /* ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ (í™”ë©´ ë„ˆë¹„ 768px ì´í•˜) */
        @media (max-width: 768px) {
            /* ëª¨ë°”ì¼ì—ì„œ ì „ì²´ í™”ë©´ í™œìš© */
            body {
                padding: 0;
                margin: 0;
            }
            
            .container {
                border-radius: 0;
                padding: 0;
                max-width: 100%;
                border: none;
                box-shadow: none;
            }
            
            /* ì¹´ë“œ ì„¹ì…˜ë“¤ ì—¬ë°± ì œê±° */
            .cards {
                padding: 10px 5px;
                gap: 8px;
            }
            
            .card {
                margin: 0;
                padding: 12px;
            }
            
            /* í—¤ë” ì¹´ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            .header-card {
                border-radius: 0 !important;
                margin: 0 !important;
                padding: 15px !important;
            }
            
            /* í…Œì´ë¸” ì„¹ì…˜ íŒ¨ë”© ì¤„ì´ê¸° */
            table {
                margin: 0 5px;
            }
            
            /* ë§í¬ ì„¹ì…˜ íŒ¨ë”© ì¤„ì´ê¸° */
            div[style*="margin-top: 30px"] {
                margin-top: 15px !important;
                padding: 10px 5px !important;
            }
            
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” ì¹´ë“œ -->
        <div class="header-card" style="
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
            width: 100%;
            box-sizing: border-box;
        ">
            <div style="text-align: center;">
                <div style="margin-bottom: 15px;">
                    <span style="
                        background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #dda0dd);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                        font-size: clamp(1.5em, 4vw, 2.5em);
                        font-weight: 900;
                        font-family: 'Courier New', monospace;
                        letter-spacing: 2px;
                        text-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
                        display: inline-block;
                        animation: glow 3s ease-in-out infinite;
                    ">EUO.NETLIFY.APP</span>
                </div>
                <style>
                    @keyframes glow {
                        0%, 100% { filter: brightness(1) contrast(1); }
                        50% { filter: brightness(1.2) contrast(1.1); }
                    }
                </style>
                
                
                <div style="margin-top: 10px;">
                    <a href="https://www.weather.go.kr/w/weather/warning/status.do" target="_blank" style="
                        color: #888; 
                        text-decoration: none; 
                        font-size: 0.85em;
                        transition: color 0.3s;
                    " onmouseover="this.style.color='#aaa'" onmouseout="this.style.color='#888'">
                        ğŸŒ¦ï¸ ë‚ ì”¨ëˆ„ë¦¬ íŠ¹ë³´í˜„í™©
                    </a>
                </div>
            </div>
        </div>
        
        <!-- ì±„íŒ… ë²„íŠ¼ ì„¹ì…˜ -->
        <div style="margin-top: 30px; margin-bottom: 30px; text-align: center;">
            <button onclick="openChatPopup()" style="
                padding: 12px 24px;
                background: linear-gradient(135deg, #4facfe 0%, #00e5ff 100%);
                color: #fff;
                border: none;
                border-radius: 30px;
                font-weight: 600;
                font-size: 16px;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(79, 172, 254, 0.4)'" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(79, 172, 254, 0.3)'">
                ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…
            </button>
        </div>
        
        <div class="gpt-section" style="margin-top: 20px; padding-bottom: 20px;">
            <h2 style="color: #aaa; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #333;">
                ğŸ¤– GPT Links
            </h2>
            <div id="gpt-links" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <!-- GPT ë§í¬ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <div class="youtube-section" style="margin-top: 20px; padding-bottom: 20px;">
            <h2 style="color: #aaa; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #333;">
                ğŸ“º YouTube Live
            </h2>
            <div id="youtube-links" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <!-- YouTube ë§í¬ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <div class="favorite-section" style="margin-top: 20px; padding-bottom: 20px;">
            <h2 style="color: #aaa; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #333;">
                â­ Favorite Sites
            </h2>
            <div id="favorite-links" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <!-- Favorite ë§í¬ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <!-- Fun YouTube ì„¹ì…˜ -->
        <div class="fun-youtube-section" style="margin-top: 20px; padding-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #333;">
                <h2 style="color: #aaa; margin: 0; font-weight: 400; font-size: 1.5rem;">
                    ğŸ® Fun YouTube
                </h2>
                <div style="display: flex; gap: 10px;">
                    <button onclick="toggleFunYoutubeView('list')" class="fun-youtube-view-btn" data-view="list" style="
                        padding: 6px 12px;
                        background: #fff;
                        color: #000;
                        border: 1px solid #444;
                        cursor: pointer;
                        font-size: 12px;
                        transition: all 0.2s ease;
                        border-radius: 4px;
                    ">List</button>
                    <button onclick="toggleFunYoutubeView('grid')" class="fun-youtube-view-btn" data-view="grid" style="
                        padding: 6px 12px;
                        background: transparent;
                        color: #999;
                        border: 1px solid #444;
                        cursor: pointer;
                        font-size: 12px;
                        transition: all 0.2s ease;
                        border-radius: 4px;
                    ">Grid</button>
                </div>
            </div>
            <div id="fun-youtube-links-list" style="display: flex; flex-direction: column; gap: 1px; background: transparent;">
                <!-- List view -->
            </div>
            <div id="fun-youtube-links-grid" style="display: none; grid-template-columns: repeat(3, 1fr); gap: 20px; background: transparent;">
                <!-- Grid view -->
            </div>
        </div>
        
        <!-- ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        <div id="custom-category-sections"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="links-module.js"></script>
    <script src="config-env.js"></script>
    <script src="config-loader.js"></script>
    <script>

        // Fun YouTube view toggle function
        function toggleFunYoutubeView(view) {
            window.funYoutubeViewMode = view;
            const buttons = document.querySelectorAll('.fun-youtube-view-btn');
            buttons.forEach(btn => {
                btn.style.background = btn.getAttribute('data-view') === view ? '#fff' : 'transparent';
                btn.style.color = btn.getAttribute('data-view') === view ? '#000' : '#999';
            });

            // Save the view mode preference
            const funSettings = JSON.parse(localStorage.getItem('funYoutubeSettings') || '{}');
            funSettings.viewMode = view;
            localStorage.setItem('funYoutubeSettings', JSON.stringify(funSettings));

            loadLinksFromSupabase(); // Reload to apply new view
        }

        // Extract video ID from YouTube URL
        function getVideoIdFromUrl(url) {
            if (!url) return null;
            const regex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        // YouTube ë¹„ë””ì˜¤ ì •ë³´ ìºì‹œ
        const youtubeVideoCache = {};

        // YouTube ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (noembed ì„œë¹„ìŠ¤ ì‚¬ìš©)
        async function getYouTubeVideoInfo(url) {
            // ìºì‹œ í™•ì¸
            if (youtubeVideoCache[url]) {
                return youtubeVideoCache[url];
            }

            try {
                const response = await fetch(`https://noembed.com/embed?url=${encodeURIComponent(url)}`);
                const data = await response.json();

                if (data && data.title) {
                    const videoInfo = {
                        title: data.title,
                        author: data.author_name || 'Unknown',
                        thumbnail: data.thumbnail_url || `https://img.youtube.com/vi/${getVideoIdFromUrl(url)}/maxresdefault.jpg`
                    };

                    // ìºì‹œì— ì €ì¥
                    youtubeVideoCache[url] = videoInfo;
                    return videoInfo;
                }
            } catch (error) {
                console.error('YouTube ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
            }

            // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
            const videoId = getVideoIdFromUrl(url);
            return {
                title: 'ë™ì˜ìƒ',
                author: '',
                thumbnail: videoId ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : ''
            };
        }

        // ì €ì¥ëœ ì¹´ë“œ ìŠ¤íƒ€ì¼ ê°€ì ¸ì˜¤ê¸°
        function getCardStyles(category) {
            const savedStyles = JSON.parse(localStorage.getItem('linkCardStyles') || '{}');
            const defaultStyles = {
                gpt: {
                    fontSize: 16, fontWeight: '500', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102
                },
                youtube: {
                    fontSize: 17, fontWeight: '600', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102,
                    showLiveIndicator: true
                },
                favorite: {
                    fontSize: 16, fontWeight: '500', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15, gap: 10,
                    shadow: true, hoverEffect: true, hoverBg: '#2a2a2a', hoverScale: 102
                }
            };
            return { ...defaultStyles[category], ...(savedStyles[category] || {}) };
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜ (XSS ë°©ì§€)
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // ì±„íŒ… íŒì—… ì—´ê¸° í•¨ìˆ˜
        function openChatPopup() {
            // íŒì—… ì°½ ì„¤ì •
            const width = 400;
            const height = 600;
            const left = window.screen.width - width - 50;
            const top = 100;
            
            const features = `
                width=${width},
                height=${height},
                left=${left},
                top=${top},
                toolbar=no,
                menubar=no,
                scrollbars=no,
                resizable=yes,
                status=no
            `.replace(/\s+/g, '');
            
            // íŒì—… ì—´ê¸°
            const chatWindow = window.open('chat-popup.html', 'ChatWindow', features);
            
            // í¬ì»¤ìŠ¤ ì£¼ê¸°
            if (chatWindow) {
                chatWindow.focus();
            }
        }

        // Supabaseì—ì„œ ë§í¬ ë°ì´í„° ë¡œë“œ
        async function loadLinksFromSupabase() {
            console.log('Loading links from Supabase...');
            
            // Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            let attempts = 0;
            while (!window.supabase && attempts < 20) {
                console.log(`Waiting for Supabase library... attempt ${attempts + 1}/20`);
                await new Promise(resolve => setTimeout(resolve, 200));
                attempts++;
            }
            
            if (!window.supabase) {
                console.error('Supabase library failed to load after 4 seconds');
                return;
            }

            // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
            if (!window.supabaseClient) {
                try {
                    const SUPABASE_URL = 'https://ddfnxbkiewolgweivomv.supabase.co';
                    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
                    window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log('âœ“ Supabase client initialized successfully');
                } catch (error) {
                    console.error('Failed to initialize Supabase:', error);
                    return;
                }
            }
            
            const supabase = window.supabaseClient;

            try {
                const { data: links, error } = await window.supabaseClient.from('links')
                    .select('*')
                    .order('position', { ascending: true });
                
                if (error) {
                    console.error('Supabase error:', error);
                    console.error('Error details:', error.message, error.code);
                    throw error;
                }
                
                console.log('Links loaded:', links);
                console.log('Total links count:', links ? links.length : 0);
                
                // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë§í¬ ë¶„ë¥˜
                const gptLinks = links ? links.filter(link => link.category === 'gpt') : [];
                const youtubeLinks = links ? links.filter(link => link.category === 'youtube') : [];
                const favoriteLinks = links ? links.filter(link => link.category === 'favorite') : [];
                const funYoutubeLinks = links ? links.filter(link => link.category === 'fun-youtube') : [];
                
                // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬
                const customCategories = JSON.parse(localStorage.getItem('customCategories') || '[]');
                const customCategoryLinks = {};
                customCategories.forEach(cat => {
                    customCategoryLinks[cat.id] = links ? links.filter(link => link.category === cat.id) : [];
                });
                
                console.log('GPT links:', gptLinks.length);
                console.log('YouTube links:', youtubeLinks.length);
                console.log('Favorite links:', favoriteLinks.length);
                console.log('Fun YouTube links:', funYoutubeLinks.length);
                console.log('Custom categories:', customCategories);
                
                // GPT ë§í¬ ë Œë”ë§
                const gptContainer = document.getElementById('gpt-links');
                if (gptContainer) {
                    if (gptLinks.length > 0) {
                        const gptStyles = getCardStyles('gpt');
                        gptContainer.innerHTML = gptLinks.map(link => `
                            <a href="${escapeHtml(link.url)}" target="_blank" style="
                                background: ${gptStyles.bgColor};
                                color: ${gptStyles.textColor};
                                padding: 15px;
                                border-radius: 10px;
                                text-align: center;
                                border: 1px solid ${gptStyles.borderColor};
                                text-decoration: none;
                                transition: transform 0.3s ease;
                                display: block;
                            ">
                                <div style="font-size: ${gptStyles.fontSize}px;">${escapeHtml(link.name)}</div>
                            </a>
                        `).join('');
                    } else {
                        gptContainer.innerHTML = '<div style="color: #666; text-align: center;">ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.</div>';
                    }
                }
                
                // YouTube ë§í¬ ë Œë”ë§ (original card style)
                const youtubeContainer = document.getElementById('youtube-links');
                if (youtubeContainer) {
                    if (youtubeLinks.length > 0) {
                        const youtubeStyles = getCardStyles('youtube');
                        youtubeContainer.innerHTML = youtubeLinks.map(link => `
                        <a href="${link.url}" target="_blank" style="
                            background: ${youtubeStyles.bgColor};
                            color: ${youtubeStyles.textColor};
                            padding: 15px;
                            border-radius: 10px;
                            text-align: center;
                            border: 1px solid ${youtubeStyles.borderColor};
                            text-decoration: none;
                            transition: transform 0.3s ease;
                            display: block;
                            position: relative;
                        ">
                            <div style="font-size: ${youtubeStyles.fontSize}px; font-weight: bold;">${escapeHtml(link.name)}</div>
                            <span class="live-indicator" data-channel-url="${escapeHtml(link.url)}" style="
                                position: absolute;
                                top: 5px;
                                right: 5px;
                                width: 10px;
                                height: 10px;
                                border-radius: 50%;
                                background: #666;
                                animation: none;
                            "></span>
                        </a>
                        `).join('');

                        // YouTube ë¼ì´ë¸Œ ìƒíƒœ ì²´í¬
                        checkYouTubeLiveStatus();
                    } else {
                        youtubeContainer.innerHTML = '<div style="color: #666; text-align: center;">ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.</div>';
                    }
                }
                
                // Favorite ë§í¬ ë Œë”ë§
                const favoriteContainer = document.getElementById('favorite-links');
                if (favoriteContainer) {
                    if (favoriteLinks.length > 0) {
                        const favoriteStyles = getCardStyles('favorite');
                        favoriteContainer.innerHTML = favoriteLinks.map(link => `
                        <a href="${link.url}" target="_blank" style="
                            background: ${favoriteStyles.bgColor};
                            color: ${favoriteStyles.textColor};
                            padding: 15px;
                            border-radius: 10px;
                            text-align: center;
                            border: 1px solid ${favoriteStyles.borderColor};
                            text-decoration: none;
                            transition: transform 0.3s ease;
                            display: block;
                        ">
                            <div style="font-size: ${favoriteStyles.fontSize}px;">${escapeHtml(link.name)}</div>
                        </a>
                        `).join('');
                    } else {
                        favoriteContainer.innerHTML = '<div style="color: #666; text-align: center;">ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.</div>';
                    }
                }
                
                // Fun YouTube ë§í¬ ë Œë”ë§ (ì¸ë„¤ì¼ê³¼ ì‹¤ì œ ì œëª© í¬í•¨)
                const funYoutubeListContainer = document.getElementById('fun-youtube-links-list');
                const funYoutubeGridContainer = document.getElementById('fun-youtube-links-grid');

                // Fun YouTube ì„¤ì • ë¡œë“œ
                const funYoutubeSettings = JSON.parse(localStorage.getItem('funYoutubeSettings') || '{}');
                const defaultSettings = {
                    viewMode: 'list',
                    gridColumns: 3,
                    showThumbnails: true,
                    showAuthor: false,
                    showViewButton: false,
                    fontSize: 16,
                    bgColor: '#1a1a1a',
                    textColor: '#ffffff',
                    hoverBgColor: '#2a2a2a',
                    borderRadius: 8,
                    hoverScale: true
                };
                const funSettings = { ...defaultSettings, ...funYoutubeSettings };

                // ì´ˆê¸° ë·° ëª¨ë“œ ì„¤ì •
                window.funYoutubeViewMode = funSettings.viewMode;

                if (funYoutubeListContainer && funYoutubeGridContainer) {
                    // ê·¸ë¦¬ë“œ ì»¬ëŸ¼ ì„¤ì •
                    if (funYoutubeGridContainer) {
                        funYoutubeGridContainer.style.gridTemplateColumns = `repeat(${funSettings.gridColumns}, 1fr)`;
                    }

                    if (funYoutubeLinks.length > 0) {
                        // Update view buttons to reflect current mode
                        const buttons = document.querySelectorAll('.fun-youtube-view-btn');
                        buttons.forEach(btn => {
                            btn.style.background = btn.getAttribute('data-view') === window.funYoutubeViewMode ? '#fff' : 'transparent';
                            btn.style.color = btn.getAttribute('data-view') === window.funYoutubeViewMode ? '#000' : '#999';
                        });

                        // ê° ë§í¬ì— ëŒ€í•´ YouTube ì •ë³´ ê°€ì ¸ì™€ì„œ ë Œë”ë§
                        const renderFunYoutubeLinks = async () => {
                            if (window.funYoutubeViewMode === 'grid') {
                                // ê·¸ë¦¬ë“œ ë·°
                                funYoutubeListContainer.style.display = 'none';
                                funYoutubeGridContainer.style.display = 'grid';
                                funYoutubeGridContainer.innerHTML = '';

                                for (const link of funYoutubeLinks) {
                                    const videoInfo = await getYouTubeVideoInfo(link.url);
                                    const gridItem = document.createElement('a');
                                    gridItem.href = link.url;
                                    gridItem.target = '_blank';
                                    gridItem.style.cssText = `
                                        background: ${funSettings.bgColor};
                                        color: ${funSettings.textColor};
                                        border-radius: ${funSettings.borderRadius}px;
                                        border: 1px solid #333;
                                        text-decoration: none;
                                        transition: all 0.3s ease;
                                        display: block;
                                        overflow: hidden;
                                        cursor: pointer;
                                    `;
                                    gridItem.innerHTML = `
                                        ${funSettings.showThumbnails ? `
                                        <div style="width: 100%; aspect-ratio: 16/9; background: #000; overflow: hidden; position: relative;">
                                            <img src="${videoInfo.thumbnail}" style="width: 100%; height: 100%; object-fit: cover;"
                                                onerror="this.src='https://via.placeholder.com/320x180?text=No+Thumbnail'">
                                        </div>
                                        ` : ''}
                                        <div style="padding: 12px;">
                                            <div style="font-size: ${funSettings.fontSize}px; font-weight: 600; margin-bottom: 4px;
                                                    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
                                                    overflow: hidden; line-height: 1.3;">${videoInfo.title}</div>
                                            ${funSettings.showAuthor ? `<div style="font-size: ${funSettings.fontSize - 2}px; color: #999; margin-top: 4px;">${videoInfo.author}</div>` : ''}
                                        </div>
                                    `;
                                    gridItem.onmouseover = function() {
                                        this.style.background = funSettings.hoverBgColor;
                                        if (funSettings.hoverScale) {
                                            this.style.transform = 'translateY(-2px)';
                                            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                                        }
                                    };
                                    gridItem.onmouseout = function() {
                                        this.style.background = funSettings.bgColor;
                                        if (funSettings.hoverScale) {
                                            this.style.transform = 'translateY(0)';
                                            this.style.boxShadow = 'none';
                                        }
                                    };
                                    funYoutubeGridContainer.appendChild(gridItem);
                                }
                            } else {
                                // ë¦¬ìŠ¤íŠ¸ ë·°
                                funYoutubeListContainer.style.display = 'flex';
                                funYoutubeGridContainer.style.display = 'none';
                                funYoutubeListContainer.innerHTML = '';

                                for (const link of funYoutubeLinks) {
                                    const videoInfo = await getYouTubeVideoInfo(link.url);
                                    const listItem = document.createElement('a');
                                    listItem.href = link.url;
                                    listItem.target = '_blank';
                                    listItem.style.cssText = `
                                        background: ${funSettings.bgColor};
                                        color: ${funSettings.textColor};
                                        padding: 12px;
                                        border: 1px solid #333;
                                        border-radius: ${funSettings.borderRadius}px;
                                        text-decoration: none;
                                        transition: all 0.2s ease;
                                        display: flex;
                                        gap: 15px;
                                        align-items: center;
                                        cursor: pointer;
                                        margin-bottom: 1px;
                                    `;
                                    listItem.innerHTML = `
                                        ${funSettings.showThumbnails ? `
                                        <div style="width: 160px; height: 90px; flex-shrink: 0; background: #000; overflow: hidden; border-radius: ${funSettings.borderRadius/2}px;">
                                            <img src="${videoInfo.thumbnail}" style="width: 100%; height: 100%; object-fit: cover;"
                                                onerror="this.src='https://via.placeholder.com/160x90?text=No+Thumbnail'">
                                        </div>
                                        ` : ''}
                                        <div style="flex: 1; min-width: 0;">
                                            <div style="font-size: ${funSettings.fontSize}px; font-weight: 500; margin-bottom: 4px;
                                                    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${videoInfo.title}</div>
                                            ${funSettings.showAuthor ? `<div style="font-size: ${funSettings.fontSize - 2}px; color: #999;">${videoInfo.author}</div>` : ''}
                                        </div>
                                    `;
                                    listItem.onmouseover = function() {
                                        this.style.background = funSettings.hoverBgColor;
                                        this.style.borderColor = '#444';
                                        if (funSettings.hoverScale) {
                                            this.style.transform = 'scale(1.01)';
                                        }
                                    };
                                    listItem.onmouseout = function() {
                                        this.style.background = funSettings.bgColor;
                                        this.style.borderColor = '#333';
                                        if (funSettings.hoverScale) {
                                            this.style.transform = 'scale(1)';
                                        }
                                    };
                                    funYoutubeListContainer.appendChild(listItem);
                                }
                            }
                        };

                        // ë¹„ë™ê¸°ë¡œ ë Œë”ë§ ì‹¤í–‰
                        renderFunYoutubeLinks();
                    } else {
                        funYoutubeListContainer.innerHTML = '<div style="color: #666; text-align: center;">ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.</div>';
                        funYoutubeGridContainer.innerHTML = '';
                    }
                }
                
                // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ ë Œë”ë§
                const customSectionsContainer = document.getElementById('custom-category-sections');
                if (customSectionsContainer && customCategories.length > 0) {
                    customSectionsContainer.innerHTML = '';
                    
                    customCategories.forEach(category => {
                        const categoryLinks = customCategoryLinks[category.id] || [];
                        
                        if (categoryLinks.length > 0) {
                            const section = document.createElement('div');
                            section.className = 'custom-category-section';
                            section.style.cssText = 'margin-top: 20px; padding-bottom: 20px;';
                            
                            section.innerHTML = `
                                <h2 style="color: #aaa; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #333;">
                                    ğŸ“Œ ${category.name}
                                </h2>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                    ${categoryLinks.map(link => `
                                        <a href="${link.url}" target="_blank" style="
                                            background: #1a1a1a;
                                            color: white;
                                            padding: 15px;
                                            border-radius: 10px;
                                            text-align: center;
                                            border: 1px solid #333;
                                            text-decoration: none;
                                            transition: transform 0.3s ease;
                                            display: block;
                                        ">
                                            <div style="font-size: 1em;">${link.name}</div>
                                        </a>
                                    `).join('')}
                                </div>
                            `;
                            
                            customSectionsContainer.appendChild(section);
                        }
                    });
                }
                
            } catch (error) {
                console.error('ë§í¬ ë¡œë“œ ì‹¤íŒ¨:', error);
                console.error('Error stack:', error.stack);
                
                // ì—ëŸ¬ ë°œìƒì‹œ ë¹ˆ ì»¨í…Œì´ë„ˆì— ë©”ì‹œì§€ í‘œì‹œ
                const gptContainer = document.getElementById('gpt-links');
                if (gptContainer && gptContainer.innerHTML === '') {
                    gptContainer.innerHTML = '<div style="color: #666;">ë§í¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.</div>';
                }
            }
        }
        
        // YouTube ë¼ì´ë¸Œ ìƒíƒœ ì²´í¬ í•¨ìˆ˜
        async function checkYouTubeLiveStatus() {
            const indicators = document.querySelectorAll('.live-indicator');
            
            indicators.forEach(async (indicator) => {
                const channelUrl = indicator.getAttribute('data-channel-url');
                
                // URLì—ì„œ ì±„ë„ ì •ë³´ ì¶”ì¶œ
                try {
                    // CORS ì œí•œìœ¼ë¡œ ì¸í•´ ì§ì ‘ ì²´í¬ê°€ ì–´ë ¤ìš°ë¯€ë¡œ,
                    // í”„ë¡ì‹œ ì„œë²„ë‚˜ YouTube APIë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
                    // ì¼ë‹¨ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ êµ¬í˜„
                    
                    // ì‹¤ì œ êµ¬í˜„ì‹œ YouTube Data API v3 ì‚¬ìš© í•„ìš”
                    // ì—¬ê¸°ì„œëŠ” URLì— '/live'ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ë¼ì´ë¸Œë¡œ ê°€ì •
                    const isLive = channelUrl.includes('/live');
                    
                    if (isLive) {
                        // ë¼ì´ë¸Œ ì¤‘ - ë¹¨ê°„ìƒ‰ ì› + ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜
                        indicator.style.background = '#ff0000';
                        indicator.style.animation = 'livePulse 1.5s infinite';
                        indicator.title = 'ğŸ”´ LIVE';
                    } else {
                        // ì˜¤í”„ë¼ì¸ - íšŒìƒ‰ ì›
                        indicator.style.background = '#666';
                        indicator.style.animation = 'none';
                        indicator.title = 'âš« Offline';
                    }
                } catch (error) {
                    console.error('ë¼ì´ë¸Œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                }
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ë§í¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', () => {

            // ëª¨ë“ˆí™”ëœ ë§í¬ ë¡œë”© ì‚¬ìš©
            async function loadLinksUsingModule() {
                console.log('LinksModuleì„ ì‚¬ìš©í•˜ì—¬ ë§í¬ ë¡œë”© ì‹œì‘...');

                // ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”
                LinksModule.setDebug(true);

                // ëª¨ë“ˆ ì´ˆê¸°í™” ë° ë§í¬ ë¡œë“œ
                const result = await LinksModule.loadAndRender();

                if (result.success) {
                    console.log(`âœ… ëª¨ë“ˆ ë§í¬ ë¡œë”© ì„±ê³µ: ${result.total}ê°œ ë§í¬`);
                } else {
                    console.error(`âŒ ëª¨ë“ˆ ë§í¬ ë¡œë”© ì‹¤íŒ¨: ${result.error}`);

                    // ì‹¤íŒ¨ì‹œ ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ í´ë°±
                    console.log('ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ í´ë°±...');
                    loadLinksFromSupabase();
                }
            }

            // ëª¨ë“ˆì´ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            function waitForLinksModule() {
                if (window.LinksModule) {
                    console.log('âœ… LinksModule ì¤€ë¹„ë¨');
                    loadLinksUsingModule();
                } else {
                    console.log('â³ LinksModule ëŒ€ê¸° ì¤‘...');
                    setTimeout(waitForLinksModule, 200);
                }
            }

            // ì§ì ‘ ë§í¬ ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ (LinksModule ëŒ€ì‹ )
            console.log('ğŸš€ ë§í¬ ë¡œë”© ì‹œì‘ (ì§ì ‘ í˜¸ì¶œ)');
            setTimeout(() => {
                loadLinksFromSupabase();
            }, 1000);
            
            // Supabase ì‹¤ì‹œê°„ êµ¬ë…ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì´ˆê¸°í™”ëœ í›„ì— ì„¤ì •
            setTimeout(() => {
                if (window.supabaseClient) {
                    // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ êµ¬ë… (ì„ íƒì‚¬í•­)
                    const subscription = window.supabaseClient
                        .channel('links-channel')
                        .on('postgres_changes', 
                            { event: '*', schema: 'public', table: 'links' }, 
                            () => {
                                loadLinksFromSupabase(); // ë³€ê²½ì‚¬í•­ ë°œìƒì‹œ ìë™ ìƒˆë¡œê³ ì¹¨
                            }
                        )
                        .subscribe();
                    
                    console.log('âœ“ Supabase ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì™„ë£Œ');
                } else {
                    console.log('âš ï¸ Supabase ì‹¤ì‹œê°„ êµ¬ë… ê±´ë„ˆëœ€ (í´ë¼ì´ì–¸íŠ¸ ì—†ìŒ)');
                }
            }, 2000);
        });
        
        // 5ë¶„ë§ˆë‹¤ YouTube ë¼ì´ë¸Œ ìƒíƒœ ì¬í™•ì¸
        setInterval(() => {
            checkYouTubeLiveStatus();
        }, 300000);

    </script>
    
    <!-- ê´€ë¦¬ì ì„¤ì • ë²„íŠ¼ -->
    <a href="login.html" class="settings-btn" title="ê´€ë¦¬ì ì„¤ì •">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m4.22-13.22l4.24 4.24M1.54 1.54l4.24 4.24M20.46 20.46l-4.24-4.24M1.54 20.46l4.24-4.24M22 12h-6m-6 0H1"></path>
        </svg>
    </a>
    
    <style>
        .settings-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
            transform: rotate(90deg);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }
        
        .settings-btn svg {
            width: 24px;
            height: 24px;
        }
        
        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            .settings-btn {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
            }
            
            .settings-btn svg {
                width: 20px;
                height: 20px;
            }
        }
    </style>
    <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 30px; border: 1px solid #333; z-index: 9999;">
        <a href="index.html" style="text-decoration: none; color: #fff; font-weight: bold; border-bottom: 2px solid #f7931a;">Main</a>
        <a href="index2-test.html" style="text-decoration: none; color: #fff; font-weight: bold;">2</a>
        <a href="index3-test.html" style="text-decoration: none; color: #fff; font-weight: bold;">3</a>
        <a href="index4-test.html" style="text-decoration: none; color: #fff; font-weight: bold;">4</a>
        <a href="index5-test.html" style="text-decoration: none; color: #fff; font-weight: bold;">5</a>
        <a href="index6-test.html" style="text-decoration: none; color: #fff; font-weight: bold;">6</a>
    </div>
</body>
</html>