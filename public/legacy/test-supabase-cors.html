<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase CORS ë° ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #000;
            color: #fff;
        }
        .test-section {
            background: #1a1a1a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #333;
        }
        .log {
            background: #0a0a0a;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
    </style>
</head>
<body>
    <h1>ğŸ” Supabase CORS ë° ì—°ê²° ì§„ë‹¨</h1>
    
    <div class="test-section">
        <h2>1. ê¸°ë³¸ Fetch í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testBasicFetch()">Fetch í…ŒìŠ¤íŠ¸</button>
        <div id="fetch-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Supabase Health Check</h2>
        <button onclick="testHealthCheck()">Health Check</button>
        <div id="health-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>3. ë‹¤ì–‘í•œ CDN í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testCDNs()">CDN í…ŒìŠ¤íŠ¸</button>
        <div id="cdn-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>4. ë¡œì»¬ íŒŒì¼ë¡œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testLocalFile()">ë¡œì»¬ íŒŒì¼ í…ŒìŠ¤íŠ¸</button>
        <div id="local-log" class="log"></div>
    </div>

    <script>
        function log(targetId, message, type = 'info') {
            const logDiv = document.getElementById(targetId);
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${type}">[${time}] ${message}</div>`;
        }

        // 1. ê¸°ë³¸ Fetch í…ŒìŠ¤íŠ¸
        async function testBasicFetch() {
            const logId = 'fetch-log';
            log(logId, 'ê¸°ë³¸ fetch í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            // Google í…ŒìŠ¤íŠ¸ (CORS í™•ì¸)
            try {
                const response = await fetch('https://www.google.com/favicon.ico', { mode: 'no-cors' });
                log(logId, 'Google favicon ìš”ì²­ ì„±ê³µ (no-cors mode)', 'success');
            } catch (error) {
                log(logId, `Google ìš”ì²­ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
            
            // Supabase REST API ì§ì ‘ í…ŒìŠ¤íŠ¸
            try {
                const response = await fetch('https://intyabzhvtkxgldmvpvr.supabase.co/rest/v1/', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImludHlhYnpodnRreGdsZG12cHZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkxODQwMTEsImV4cCI6MjA0NDc2MDAxMX0.mUgaLB6kQKvpsJ0L3n4cEBE_3S94BmdqYJoF-0K_vK0'
                    }
                });
                log(logId, `Supabase REST API ì‘ë‹µ: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
            } catch (error) {
                log(logId, `Supabase REST API ì‹¤íŒ¨: ${error.message}`, 'error');
                log(logId, `ì—ëŸ¬ íƒ€ì…: ${error.name}`, 'error');
                log(logId, `Stack: ${error.stack}`, 'error');
            }
        }

        // 2. Supabase Health Check
        async function testHealthCheck() {
            const logId = 'health-log';
            log(logId, 'Supabase health check ì‹œì‘...', 'info');
            
            const endpoints = [
                'https://intyabzhvtkxgldmvpvr.supabase.co',
                'https://intyabzhvtkxgldmvpvr.supabase.co/rest/v1',
                'https://intyabzhvtkxgldmvpvr.supabase.co/auth/v1',
                'https://intyabzhvtkxgldmvpvr.supabase.co/storage/v1'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint + '/health', { 
                        method: 'HEAD',
                        mode: 'cors'
                    });
                    log(logId, `${endpoint} - Status: ${response.status}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    log(logId, `${endpoint} - ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }
        }

        // 3. ë‹¤ì–‘í•œ CDN í…ŒìŠ¤íŠ¸
        async function testCDNs() {
            const logId = 'cdn-log';
            log(logId, 'CDN ë¡œë”© í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            const cdns = [
                {
                    name: 'jsDelivr ESM',
                    url: 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'
                },
                {
                    name: 'jsDelivr Regular',
                    url: 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2'
                },
                {
                    name: 'unpkg',
                    url: 'https://unpkg.com/@supabase/supabase-js@2'
                },
                {
                    name: 'cdnjs',
                    url: 'https://cdnjs.cloudflare.com/ajax/libs/supabase/2.39.0/supabase.min.js'
                }
            ];
            
            for (const cdn of cdns) {
                try {
                    const response = await fetch(cdn.url, { method: 'HEAD' });
                    log(logId, `${cdn.name}: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    log(logId, `${cdn.name} ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }
        }

        // 4. ë¡œì»¬ íŒŒì¼ë¡œ í…ŒìŠ¤íŠ¸
        async function testLocalFile() {
            const logId = 'local-log';
            log(logId, 'ë¡œì»¬ íŒŒì¼ í…ŒìŠ¤íŠ¸...', 'info');
            
            try {
                // í˜„ì¬ íŒŒì¼ì´ file:// í”„ë¡œí† ì½œì¸ì§€ í™•ì¸
                log(logId, `í˜„ì¬ í”„ë¡œí† ì½œ: ${window.location.protocol}`, 'info');
                log(logId, `í˜„ì¬ í˜¸ìŠ¤íŠ¸: ${window.location.host || 'localhost'}`, 'info');
                
                if (window.location.protocol === 'file:') {
                    log(logId, 'âš ï¸ file:// í”„ë¡œí† ì½œì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ë¡œì»¬ ì„œë²„ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.', 'error');
                    log(logId, 'ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ë¡œì»¬ ì„œë²„ ì‹¤í–‰: python3 -m http.server 8000', 'info');
                } else {
                    log(logId, 'âœ… HTTP(S) í”„ë¡œí† ì½œì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.', 'success');
                }
                
                // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
                log(logId, `ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ${navigator.onLine ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}`, navigator.onLine ? 'success' : 'error');
                
            } catch (error) {
                log(logId, `ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            log('fetch-log', 'í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'info');
        });
    </script>
</body>
</html>