<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance API ì œí•œì‚¬í•­ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-card {
            background: #111;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #0f0;
            border-radius: 10px;
        }
        button {
            background: #0f0;
            color: #000;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background: #0a0;
        }
        .info { color: #2196f3; }
        .success { color: #4caf50; }
        .warning { color: #ff9800; }
        .error { color: #f44336; }
        pre {
            background: #0a0a0a;
            padding: 10px;
            overflow: auto;
            border-radius: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Binance API ì œí•œì‚¬í•­ ë° ë°ì´í„° ê°€ìš©ì„± í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-card">
        <h2>API ì œí•œì‚¬í•­</h2>
        <p class="info">Binance Kline API ì œí•œ:</p>
        <ul>
            <li>ìµœëŒ€ 1000ê°œì˜ ìº”ë“¤ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ</li>
            <li>ì¼ë´‰(1d) ê¸°ì¤€ìœ¼ë¡œ ì•½ 2.7ë…„ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ</li>
            <li>API ìš”ì²­ ì œí•œ: 1200 ìš”ì²­/ë¶„ (ê°€ì¤‘ì¹˜ ê¸°ì¤€)</li>
            <li>Kline ìš”ì²­ ê°€ì¤‘ì¹˜: 1</li>
        </ul>
    </div>
    
    <div class="test-card">
        <h2>ë°ì´í„° ê°€ìš©ì„± í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testDataAvailability('BTCUSDT')">BTC ë°ì´í„° ë²”ìœ„ í™•ì¸</button>
        <button onclick="testDataAvailability('ETHUSDT')">ETH ë°ì´í„° ë²”ìœ„ í™•ì¸</button>
        <button onclick="testDataAvailability('SOLUSDT')">SOL ë°ì´í„° ë²”ìœ„ í™•ì¸</button>
        <button onclick="testHistoricalLimit()">ì—­ì‚¬ì  ë°ì´í„° í•œê³„ í…ŒìŠ¤íŠ¸</button>
        
        <div id="results"></div>
    </div>
    
    <div class="test-card">
        <h2>ì¥ê¸° ë°ì´í„° ìˆ˜ì§‘ ì „ëµ</h2>
        <div id="strategy"></div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        const strategyDiv = document.getElementById('strategy');
        
        // ì½”ì¸ë³„ ìƒì¥ ë‚ ì§œ
        const listingDates = {
            'BTCUSDT': '2017-08-17', // Binance BTC/USDT ê±°ë˜ ì‹œì‘
            'ETHUSDT': '2017-08-17', // Binance ETH/USDT ê±°ë˜ ì‹œì‘
            'SOLUSDT': '2020-08-11'  // SOL/USDT ê±°ë˜ ì‹œì‘ (ëŒ€ëµ)
        };
        
        async function testDataAvailability(symbol) {
            resultsDiv.innerHTML = `<p class="info">ğŸ”„ ${symbol} ë°ì´í„° ë²”ìœ„ í™•ì¸ ì¤‘...</p>`;
            
            try {
                // í˜„ì¬ ì‹œê°„
                const now = new Date();
                
                // ê³¼ê±° ë°ì´í„° í™•ì¸ (10ë…„ ì „ë¶€í„° ì‹œë„)
                const testYears = [10, 7, 5, 3, 2, 1];
                let oldestAvailable = null;
                
                for (const years of testYears) {
                    const testDate = new Date(now);
                    testDate.setFullYear(testDate.getFullYear() - years);
                    
                    const startTime = testDate.getTime();
                    const endTime = startTime + (24 * 60 * 60 * 1000);
                    
                    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${startTime}&endTime=${endTime}&limit=1`;
                    
                    try {
                        const response = await fetch(url);
                        const data = await response.json();
                        
                        if (data && data.length > 0) {
                            oldestAvailable = new Date(data[0][0]);
                            resultsDiv.innerHTML += `<p class="success">âœ… ${years}ë…„ ì „ ë°ì´í„° ì¡´ì¬</p>`;
                        } else {
                            resultsDiv.innerHTML += `<p class="warning">âŒ ${years}ë…„ ì „ ë°ì´í„° ì—†ìŒ</p>`;
                        }
                    } catch (error) {
                        resultsDiv.innerHTML += `<p class="error">ì˜¤ë¥˜: ${error.message}</p>`;
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                // ì •í™•í•œ ì‹œì‘ì  ì°¾ê¸°
                if (oldestAvailable) {
                    resultsDiv.innerHTML += await findExactStartDate(symbol, oldestAvailable);
                }
                
                // ì „ì²´ ë°ì´í„° ê°œìˆ˜ ì¶”ì •
                const listing = new Date(listingDates[symbol]);
                const totalDays = Math.floor((now - listing) / (1000 * 60 * 60 * 24));
                
                resultsDiv.innerHTML += `
                    <div style="margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 5px;">
                        <h3>${symbol} ë°ì´í„° ìš”ì•½</h3>
                        <p>ğŸ“… ì˜ˆìƒ ìƒì¥ì¼: ${listingDates[symbol]}</p>
                        <p>ğŸ“Š ì˜ˆìƒ ì´ ë°ì´í„°: ì•½ ${totalDays.toLocaleString()}ì¼ (${(totalDays/365).toFixed(1)}ë…„)</p>
                        <p>ğŸ’¾ í•„ìš”í•œ ì €ì¥ ê³µê°„: ì•½ ${(totalDays * 0.5).toFixed(0)}KB</p>
                        <p>â±ï¸ ì „ì²´ ìˆ˜ì§‘ ì˜ˆìƒ ì‹œê°„: ì•½ ${Math.ceil(totalDays / 500)}ë¶„ (API ì œí•œ ê³ ë ¤)</p>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML += `<p class="error">í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</p>`;
            }
        }
        
        async function findExactStartDate(symbol, approximateDate) {
            let result = '<h4>ì •í™•í•œ ì‹œì‘ ë‚ ì§œ ì°¾ê¸°</h4>';
            
            // ì´ì§„ íƒìƒ‰ìœ¼ë¡œ ì •í™•í•œ ì‹œì‘ì¼ ì°¾ê¸°
            let left = new Date(listingDates[symbol]);
            let right = approximateDate;
            let oldestFound = null;
            
            while (left <= right) {
                const mid = new Date((left.getTime() + right.getTime()) / 2);
                const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${mid.getTime()}&limit=1`;
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data && data.length > 0) {
                        oldestFound = new Date(data[0][0]);
                        right = new Date(mid.getTime() - 24*60*60*1000);
                    } else {
                        left = new Date(mid.getTime() + 24*60*60*1000);
                    }
                } catch (error) {
                    break;
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            if (oldestFound) {
                result += `<p class="success">ğŸ¯ ê°€ì¥ ì˜¤ë˜ëœ ë°ì´í„°: ${oldestFound.toISOString().split('T')[0]}</p>`;
            }
            
            return result;
        }
        
        async function testHistoricalLimit() {
            resultsDiv.innerHTML = '<h3>ì—­ì‚¬ì  ë°ì´í„° í•œê³„ í…ŒìŠ¤íŠ¸</h3>';
            
            const tests = [
                { period: '1ì¼', startOffset: 1, interval: '1h', limit: 24 },
                { period: '1ì£¼ì¼', startOffset: 7, interval: '1h', limit: 168 },
                { period: '1ê°œì›”', startOffset: 30, interval: '4h', limit: 180 },
                { period: '1ë…„', startOffset: 365, interval: '1d', limit: 365 },
                { period: '3ë…„', startOffset: 1095, interval: '1d', limit: 1000 },
                { period: '5ë…„', startOffset: 1825, interval: '1d', limit: 1000 },
            ];
            
            const table = document.createElement('table');
            table.innerHTML = `
                <tr>
                    <th>ê¸°ê°„</th>
                    <th>ê°„ê²©</th>
                    <th>ìš”ì²­ ìˆ˜</th>
                    <th>ì†Œìš” ì‹œê°„</th>
                    <th>ë°ì´í„° í¬ê¸°</th>
                </tr>
            `;
            
            for (const test of tests) {
                const requests = Math.ceil(test.startOffset * 24 / (test.interval === '1d' ? 24 : parseInt(test.interval)) / test.limit);
                const time = requests * 0.2; // 200ms per request
                const dataSize = test.startOffset * 0.5; // ~0.5KB per day
                
                table.innerHTML += `
                    <tr>
                        <td>${test.period}</td>
                        <td>${test.interval}</td>
                        <td>${requests}</td>
                        <td>${time.toFixed(1)}ì´ˆ</td>
                        <td>${dataSize.toFixed(1)}KB</td>
                    </tr>
                `;
            }
            
            resultsDiv.appendChild(table);
            
            // ìˆ˜ì§‘ ì „ëµ í‘œì‹œ
            showCollectionStrategy();
        }
        
        function showCollectionStrategy() {
            strategyDiv.innerHTML = `
                <h3>ğŸ¯ íš¨ìœ¨ì ì¸ ì¥ê¸° ë°ì´í„° ìˆ˜ì§‘ ì „ëµ</h3>
                
                <h4>1. ë‹¨ê³„ë³„ ìˆ˜ì§‘ ì ‘ê·¼ë²•</h4>
                <ul>
                    <li><strong>1ë‹¨ê³„ (ìµœê·¼ 90ì¼)</strong>: ì¼ì¼ ë°ì´í„° - ë§¤ì¼ ìë™ ì—…ë°ì´íŠ¸</li>
                    <li><strong>2ë‹¨ê³„ (90ì¼~1ë…„)</strong>: ì¼ì¼ ë°ì´í„° - ì£¼ 1íšŒ í™•ì¸</li>
                    <li><strong>3ë‹¨ê³„ (1~3ë…„)</strong>: ì¼ì¼ ë°ì´í„° - ì›” 1íšŒ í™•ì¸</li>
                    <li><strong>4ë‹¨ê³„ (3ë…„ ì´ìƒ)</strong>: ì£¼ê°„ ë°ì´í„°ë¡œ ì••ì¶• ì €ì¥</li>
                </ul>
                
                <h4>2. ìµœì í™” ë°©ë²•</h4>
                <ul>
                    <li>í•œ ë²ˆì— 1000ê°œì”© ë°°ì¹˜ ìš”ì²­ (ìµœëŒ€ 2.7ë…„ ë°ì´í„°)</li>
                    <li>ê° ìš”ì²­ ê°„ 200ms ì§€ì—° (API ì œí•œ ì¤€ìˆ˜)</li>
                    <li>ë³‘ë ¬ ì²˜ë¦¬ ëŒ€ì‹  ìˆœì°¨ ì²˜ë¦¬ (ì•ˆì •ì„± ìš°ì„ )</li>
                    <li>ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)</li>
                </ul>
                
                <h4>3. ì €ì¥ êµ¬ì¡° ì œì•ˆ</h4>
                <pre>
prices/
  daily/
    2025/
      01/
        2025-01-01.json
        2025-01-02.json
        ...
  weekly/
    2022/
      week-01.json
      ...
  monthly/
    2020/
      2020-01.json
      ...
                </pre>
                
                <h4>4. ì˜ˆìƒ ë¦¬ì†ŒìŠ¤</h4>
                <ul>
                    <li><strong>BTC (2017~í˜„ì¬)</strong>: ~${Math.floor((new Date() - new Date('2017-08-17')) / (1000*60*60*24*365))}ë…„, ~3MB</li>
                    <li><strong>ETH (2017~í˜„ì¬)</strong>: ~${Math.floor((new Date() - new Date('2017-08-17')) / (1000*60*60*24*365))}ë…„, ~3MB</li>
                    <li><strong>SOL (2020~í˜„ì¬)</strong>: ~${Math.floor((new Date() - new Date('2020-08-11')) / (1000*60*60*24*365))}ë…„, ~2MB</li>
                    <li><strong>ì´ ì˜ˆìƒ í¬ê¸°</strong>: ~8-10MB</li>
                </ul>
                
                <div style="margin-top: 20px; padding: 15px; background: #1a3a1a; border: 1px solid #4caf50; border-radius: 5px;">
                    <h4>âœ… ê¶Œì¥ êµ¬í˜„ ìˆœì„œ</h4>
                    <ol>
                        <li>ìµœê·¼ 1ë…„ ë°ì´í„° ì™„ì „ ìˆ˜ì§‘</li>
                        <li>ì¼ì¼ ìë™ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ êµ¬ì¶•</li>
                        <li>ê³¼ê±° ë°ì´í„° ì ì§„ì  ìˆ˜ì§‘ (1ë…„ì”© í™•ì¥)</li>
                        <li>ë°ì´í„° ì••ì¶• ë° ì•„ì¹´ì´ë¹™ ì‹œìŠ¤í…œ</li>
                        <li>ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦ ë„êµ¬</li>
                    </ol>
                </div>
            `;
        }
    </script>
</body>
</html>