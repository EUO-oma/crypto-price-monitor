<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§í¬ ê´€ë¦¬ - Simple v2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #111;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #333;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .status-box {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #333;
        }

        .form-section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.9em;
        }

        input, select {
            width: 100%;
            padding: 10px;
            background: #222;
            border: 1px solid #444;
            border-radius: 5px;
            color: #fff;
            font-size: 1em;
        }

        button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-right: 10px;
        }

        button:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #666;
        }

        .btn-secondary:hover {
            background: #777;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #da190b;
        }
        
        .login-section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 1px solid #333;
            max-width: 400px;
            margin: 20px auto;
        }
        
        .login-section h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #4caf50;
        }

        .links-container {
            margin-top: 30px;
        }

        .category-section {
            margin-bottom: 30px;
        }

        .category-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #4caf50;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .link-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .link-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.2s;
        }

        .link-card:hover {
            border-color: #4caf50;
            background: #222;
        }

        .link-title {
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }

        .link-url {
            color: #888;
            font-size: 0.85em;
            word-break: break-all;
            margin-bottom: 10px;
        }

        .link-actions {
            display: flex;
            gap: 10px;
        }

        .link-actions button {
            padding: 5px 10px;
            font-size: 0.85em;
        }

        .success { color: #4caf50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .link-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— ë§í¬ ê´€ë¦¬</h1>
        
        <!-- ë²„ì „ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div style="text-align: center; margin-bottom: 20px;">
            <a href="admin-simple.html" style="text-decoration: none;">
                <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px; margin: 0 5px;">v1</button>
            </a>
            <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px; margin: 0 5px;" disabled>v2 (í˜„ì¬)</button>
            <!-- v3 ì¤€ë¹„ ì¤‘
            <a href="admin-simple-v3.html" style="text-decoration: none;">
                <button class="btn-secondary" style="padding: 6px 12px; font-size: 12px; margin: 0 5px;">v3</button>
            </a>
            -->
        </div>
        
        <div class="status-box" id="status">
            <span>ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
        </div>
        
        <div class="login-section" id="login-section" style="display: none;">
            <h3>ë¡œê·¸ì¸</h3>
            <div class="form-group">
                <label for="email">ì´ë©”ì¼</label>
                <input type="email" id="email" placeholder="admin@example.com">
            </div>
            <div class="form-group">
                <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
            </div>
            <button onclick="login()">ë¡œê·¸ì¸</button>
            <button onclick="loginWithGoogle()" style="background: #4285f4; margin-top: 10px; width: 100%;">
                <span style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Googleë¡œ ë¡œê·¸ì¸
                </span>
            </button>
            <button onclick="loginWithMagicLink()" style="background: #333; margin-top: 10px; width: 100%;">
                âœ‰ï¸ ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸ (Magic Link)
            </button>
            <button class="btn-secondary" onclick="skipLogin()" style="margin-top: 10px;">ì½ê¸° ì „ìš©ìœ¼ë¡œ ê³„ì†</button>
        </div>

        <div class="form-section" style="display: none;">
            <h2>ìƒˆ ë§í¬ ì¶”ê°€</h2>
            <div class="form-group">
                <label for="name">ë§í¬ ì´ë¦„</label>
                <input type="text" id="name" placeholder="ì˜ˆ: ë„¤ì´ë²„">
            </div>
            <div class="form-group">
                <label for="url">URL</label>
                <input type="text" id="url" placeholder="ì˜ˆ: https://www.naver.com">
            </div>
            <div class="form-group">
                <label for="category">ì¹´í…Œê³ ë¦¬ (ììœ ë¡­ê²Œ ì…ë ¥ ê°€ëŠ¥)</label>
                <input type="text" id="category" list="category-list" placeholder="ì˜ˆ: youtube, favorite, gpt, ë˜ëŠ” ìƒˆ ì¹´í…Œê³ ë¦¬">
                <datalist id="category-list">
                    <option value="youtube">YouTube ì±„ë„</option>
                    <option value="favorite">ì¦ê²¨ì°¾ê¸°</option>
                    <option value="gpt">GPT ë„êµ¬</option>
                    <option value="fun-youtube">Fun YouTube</option>
                    <option value="youtube-playlist">YouTube ì¬ìƒëª©ë¡</option>
                    <option value="news">ë‰´ìŠ¤</option>
                    <option value="tech">ê¸°ìˆ </option>
                    <option value="shopping">ì‡¼í•‘</option>
                </datalist>
            </div>
            <button onclick="addLink()">ì¶”ê°€í•˜ê¸°</button>
            <button class="btn-secondary" onclick="clearForm()">ì´ˆê¸°í™”</button>
        </div>

        <div class="links-container" id="links-container">
            <p style="text-align: center; color: #666;">ë§í¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let supabase = null;
        let allLinks = [];
        let allCategories = new Set(); // Setìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì¤‘ë³µ ì œê±°
        let currentUser = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', async function() {
            // Supabase ì´ˆê¸°í™” ë¨¼ì €
            await initializeSupabase();
        });

        // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateAuthUI() {
            const statusEl = document.getElementById('status');
            const loginSection = document.getElementById('login-section');
            const formSection = document.querySelector('.form-section');
            
            if (currentUser) {
                statusEl.innerHTML = `<span class="success">âœ… ë¡œê·¸ì¸ë¨ (${currentUser.email}) <button class="btn-secondary" onclick="logout()" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8em;">ë¡œê·¸ì•„ì›ƒ</button></span>`;
                loginSection.style.display = 'none';
                formSection.style.display = 'block';
                loadLinks();
            } else {
                statusEl.innerHTML = '<span class="warning">âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (ì½ê¸° ì „ìš© ëª¨ë“œ)</span>';
                loginSection.style.display = 'block';
                formSection.style.display = 'none';
                loadLinks(); // ì½ê¸° ì „ìš©ìœ¼ë¡œë„ ë§í¬ í‘œì‹œ
            }
        }
        
        // Supabase ì´ˆê¸°í™”
        async function initializeSupabase() {
            const statusEl = document.getElementById('status');
            
            try {
                // í•˜ë“œì½”ë”©ëœ ì¸ì¦ ì •ë³´ ì‚¬ìš©
                const SUPABASE_URL = 'https://ddfnxbkiewolgweivomv.supabase.co';
                const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
                
                // Service Role Key (RLS ìš°íšŒìš© - ì£¼ì˜: í”„ë¡œë•ì…˜ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”!)
                // const SERVICE_KEY = 'YOUR_SERVICE_ROLE_KEY';
                
                // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
                    auth: {
                        persistSession: true,
                        autoRefreshToken: true,
                        detectSessionInUrl: true,
                        storage: window.localStorage, // ëª…ì‹œì ìœ¼ë¡œ localStorage ì§€ì •
                        storageKey: 'supabase.auth.token', // ì‚¬íŒŒë¦¬ë¥¼ ìœ„í•œ ëª…ì‹œì  í‚¤
                        flowType: 'pkce' // ì‚¬íŒŒë¦¬ë¥¼ ìœ„í•œ PKCE flow
                    }
                });
                
                // ë¨¼ì € ê¸°ì¡´ ì„¸ì…˜ í™•ì¸
                console.log('ì„¸ì…˜ í™•ì¸ ì¤‘...');
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (session) {
                    console.log('ê¸°ì¡´ ì„¸ì…˜ ë°œê²¬:', session.user.email);
                    currentUser = session.user;
                    statusEl.innerHTML = `<span class="success">âœ… ë¡œê·¸ì¸ë¨ (${session.user.email})</span>`;
                    
                    // ë°”ë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸
                    await testConnection();
                } else {
                    console.log('ì„¸ì…˜ ì—†ìŒ, OAuth ì½œë°± í™•ì¸...');
                    
                    // URLì—ì„œ OAuth í† í° í™•ì¸
                    if (window.location.hash && window.location.hash.includes('access_token')) {
                        console.log('OAuth ì½œë°± ì²˜ë¦¬ ì¤‘...');
                        // Supabaseê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ë„ë¡ ëŒ€ê¸°
                        setTimeout(async () => {
                            const { data: { session: newSession } } = await supabase.auth.getSession();
                            if (newSession) {
                                console.log('OAuth ë¡œê·¸ì¸ ì„±ê³µ');
                                location.reload();
                            }
                        }, 1000);
                    } else {
                        // ë¡œê·¸ì¸ ì•ˆ ë¨
                        await testConnection();
                    }
                }
                
                // Auth ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ
                supabase.auth.onAuthStateChange((event, session) => {
                    console.log('Auth ìƒíƒœ ë³€ê²½:', event);
                    if (event === 'SIGNED_IN') {
                        console.log('ë¡œê·¸ì¸ë¨:', session.user.email);
                        currentUser = session.user;
                        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ëŒ€ì‹  UI ì—…ë°ì´íŠ¸
                        updateAuthUI();
                    } else if (event === 'SIGNED_OUT') {
                        console.log('ë¡œê·¸ì•„ì›ƒë¨');
                        currentUser = null;
                        updateAuthUI();
                    }
                });
                
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                statusEl.innerHTML = '<span class="error">âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message + '</span>';
            }
        }

        // ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testConnection() {
            const statusEl = document.getElementById('status');
            
            try {
                // ì´ë¯¸ currentUserê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ì‚¬ìš©
                if (currentUser) {
                    console.log('ì´ë¯¸ ë¡œê·¸ì¸ë¨:', currentUser.email);
                } else {
                    // ì„¸ì…˜ í™•ì¸
                    const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                    
                    if (sessionError || !session) {
                        console.log('ì„¸ì…˜ ì—†ìŒ');
                        
                        // ë¡œê·¸ì¸ í¼ í‘œì‹œ
                        statusEl.innerHTML = '<span class="warning">âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤ (ì½ê¸° ì „ìš© ëª¨ë“œ)</span>';
                        document.getElementById('login-section').style.display = 'block';
                        document.querySelector('.form-section').style.display = 'none';
                        
                        // ì½ê¸° ì „ìš©ìœ¼ë¡œë„ ë§í¬ ë¶ˆëŸ¬ì˜¤ê¸°
                        currentUser = null;
                        loadLinks();
                        return;
                    }
                    
                    currentUser = session.user;
                }
                
                // ì—°ê²° í…ŒìŠ¤íŠ¸
                const { data, error } = await supabase.from('links').select('count').limit(1);
                
                if (error) throw error;
                
                statusEl.innerHTML = `<span class="success">âœ… ì—°ê²° ì„±ê³µ (${currentUser.email}) <button class="btn-secondary" onclick="logout()" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8em;">ë¡œê·¸ì•„ì›ƒ</button></span>`;
                // ë¡œê·¸ì¸ í¼ ìˆ¨ê¸°ê¸°, ì…ë ¥ í¼ í‘œì‹œ
                document.getElementById('login-section').style.display = 'none';
                document.querySelector('.form-section').style.display = 'block';
                
                // ë§í¬ ë¶ˆëŸ¬ì˜¤ê¸°
                loadLinks();
                
            } catch (error) {
                console.error('ì—°ê²° ì˜¤ë¥˜:', error);
                
                // RLS ì˜¤ë¥˜ì¼ ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë¯€ë¡œ ì½ê¸° ì „ìš© ëª¨ë“œë¡œ ì „í™˜
                if (error.message.includes('RLS') || error.message.includes('policy')) {
                    statusEl.innerHTML = '<span class="warning">âš ï¸ ì½ê¸° ì „ìš© ëª¨ë“œ (RLS ì •ì±…)</span>';
                    currentUser = null;
                    loadLinks();
                } else {
                    statusEl.innerHTML = '<span class="error">âŒ ì—°ê²° ì‹¤íŒ¨: ' + error.message + '</span>';
                    // ì…ë ¥ í¼ ìˆ¨ê¸°ê¸°
                    document.querySelector('.form-section').style.display = 'none';
                    
                    // ì˜¤ë¥˜ ì‹œì—ë„ ë§í¬ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œë„
                    loadLinks();
                }
            }
        }

        // ë§í¬ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadLinks() {
            try {
                const { data, error } = await supabase
                    .from('links')
                    .select('*')
                    .order('position', { ascending: true });
                
                if (error) throw error;
                
                allLinks = data || [];
                
                // ëª¨ë“  ê³ ìœ  ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ ë° Setì— ì¶”ê°€
                allLinks.forEach(link => {
                    if (link.category) {
                        allCategories.add(link.category);
                    }
                });
                
                // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateCategoryDatalist();
                
                // ë§í¬ í‘œì‹œ
                displayLinks(allLinks);
                
            } catch (error) {
                console.error('ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                document.getElementById('status').innerHTML = 
                    '<span class="error">âŒ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message + '</span>';
            }
        }

        // ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateCategoryDatalist() {
            const datalist = document.getElementById('category-list');
            datalist.innerHTML = '';
            
            // ê¸°ë³¸ ì¹´í…Œê³ ë¦¬
            const defaultCategories = [
                { value: 'youtube', label: 'YouTube ì±„ë„' },
                { value: 'favorite', label: 'ì¦ê²¨ì°¾ê¸°' },
                { value: 'gpt', label: 'GPT ë„êµ¬' },
                { value: 'fun-youtube', label: 'Fun YouTube' },
                { value: 'youtube-playlist', label: 'YouTube ì¬ìƒëª©ë¡' },
                { value: 'news', label: 'ë‰´ìŠ¤' },
                { value: 'tech', label: 'ê¸°ìˆ ' },
                { value: 'shopping', label: 'ì‡¼í•‘' },
                { value: 'crypto', label: 'ì•”í˜¸í™”í' },
                { value: 'dev', label: 'ê°œë°œ ë„êµ¬' },
                { value: 'education', label: 'êµìœ¡' },
                { value: 'entertainment', label: 'ì—”í„°í…Œì¸ë¨¼íŠ¸' },
                { value: 'social', label: 'ì†Œì…œ' }
            ];
            
            // ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            defaultCategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.value;
                option.textContent = cat.label;
                datalist.appendChild(option);
            });
            
            // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ê³ ìœ  ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            allCategories.forEach(category => {
                // ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ì™€ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ê²½ìš°ë§Œ ì¶”ê°€
                if (!defaultCategories.some(cat => cat.value === category)) {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    datalist.appendChild(option);
                }
            });
        }
        
        // ë§í¬ í‘œì‹œ
        function displayLinks(links) {
            const container = document.getElementById('links-container');
            container.innerHTML = '';
            
            if (links.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”
            const categories = {};
            
            // ì¹´í…Œê³ ë¦¬ íƒ€ì´í‹€ ë§¤í•‘
            const categoryTitles = {
                youtube: 'ğŸ“º YouTube ì±„ë„',
                favorite: 'â­ ì¦ê²¨ì°¾ê¸°',
                gpt: 'ğŸ¤– GPT ë„êµ¬',
                'fun-youtube': 'ğŸ¬ Fun YouTube',
                'youtube-playlist': 'ğŸ“‹ YouTube ì¬ìƒëª©ë¡',
                news: 'ğŸ“° ë‰´ìŠ¤',
                tech: 'ğŸ’» ê¸°ìˆ ',
                shopping: 'ğŸ›’ ì‡¼í•‘',
                crypto: 'ğŸ’° ì•”í˜¸í™”í',
                dev: 'ğŸ› ï¸ ê°œë°œ ë„êµ¬',
                education: 'ğŸ“š êµìœ¡',
                entertainment: 'ğŸ® ì—”í„°í…Œì¸ë¨¼íŠ¸',
                social: 'ğŸ’¬ ì†Œì…œ'
            };
            
            // ëª¨ë“  ë§í¬ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”
            links.forEach(link => {
                if (!categories[link.category]) {
                    categories[link.category] = {
                        title: categoryTitles[link.category] || `ğŸ“Œ ${link.category}`,
                        links: []
                    };
                }
                categories[link.category].links.push(link);
            });
            
            // ê° ì¹´í…Œê³ ë¦¬ í‘œì‹œ
            Object.keys(categories).sort().forEach(key => {
                if (categories[key].links.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'category-section';
                    
                    section.innerHTML = `
                        <h3 class="category-title">${categories[key].title}</h3>
                        <div class="link-grid">
                            ${categories[key].links.map(link => `
                                <div class="link-card">
                                    <div class="link-title">${link.name}</div>
                                    <div class="link-url">
                                        <a href="${link.url}" target="_blank" style="color: #888;">${link.url}</a>
                                    </div>
                                    <div class="link-actions">
                                        ${currentUser ? `
                                            <button class="btn-secondary" onclick="editLink('${link.id}', '${link.name.replace(/'/g, "\\'")}', '${link.url.replace(/'/g, "\\'")}', '${link.category}')">ìˆ˜ì •</button>
                                            <button class="btn-danger" onclick="deleteLink('${link.id}')">ì‚­ì œ</button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    container.appendChild(section);
                }
            });
        }

        // ë§í¬ ì¶”ê°€
        async function addLink() {
            // ë¡œê·¸ì¸ í™•ì¸
            if (!currentUser) {
                alert('ë§í¬ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            const name = document.getElementById('name').value.trim();
            const url = document.getElementById('url').value.trim();
            const category = document.getElementById('category').value;
            
            if (!name || !url) {
                alert('ì´ë¦„ê³¼ URLì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('links')
                    .insert([{
                        name: name,
                        url: url,
                        category: category,
                        position: 0
                    }])
                    .select();
                
                if (error) throw error;
                
                document.getElementById('status').innerHTML = 
                    '<span class="success">âœ… ë§í¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
                
                clearForm();
                loadLinks();
                
            } catch (error) {
                console.error('ì¶”ê°€ ì˜¤ë¥˜:', error);
                document.getElementById('status').innerHTML = 
                    '<span class="error">âŒ ì¶”ê°€ ì‹¤íŒ¨: ' + error.message + '</span>';
            }
        }

        // ë§í¬ ìˆ˜ì •
        function editLink(id, name, url, category) {
            document.getElementById('name').value = name;
            document.getElementById('url').value = url;
            document.getElementById('category').value = category;
            
            // ì¶”ê°€ ë²„íŠ¼ì„ ìˆ˜ì • ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
            const addBtn = document.querySelector('button[onclick="addLink()"]');
            addBtn.textContent = 'ìˆ˜ì •í•˜ê¸°';
            addBtn.onclick = function() { updateLink(id); };
            
            // ì·¨ì†Œ ë²„íŠ¼ ì¶”ê°€
            if (!document.querySelector('.btn-cancel')) {
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'btn-secondary btn-cancel';
                cancelBtn.textContent = 'ì·¨ì†Œ';
                cancelBtn.onclick = cancelEdit;
                addBtn.parentNode.insertBefore(cancelBtn, addBtn.nextSibling);
            }
            
            // ìŠ¤í¬ë¡¤ ì´ë™
            document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
        }

        // ë§í¬ ì—…ë°ì´íŠ¸
        async function updateLink(id) {
            // ë¡œê·¸ì¸ í™•ì¸
            if (!currentUser) {
                alert('ë§í¬ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            const name = document.getElementById('name').value.trim();
            const url = document.getElementById('url').value.trim();
            const category = document.getElementById('category').value;
            
            if (!name || !url) {
                alert('ì´ë¦„ê³¼ URLì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('links')
                    .update({
                        name: name,
                        url: url,
                        category: category
                    })
                    .eq('id', id)
                    .select();
                
                if (error) throw error;
                
                document.getElementById('status').innerHTML = 
                    '<span class="success">âœ… ë§í¬ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
                
                cancelEdit();
                loadLinks();
                
            } catch (error) {
                console.error('ìˆ˜ì • ì˜¤ë¥˜:', error);
                document.getElementById('status').innerHTML = 
                    '<span class="error">âŒ ìˆ˜ì • ì‹¤íŒ¨: ' + error.message + '</span>';
            }
        }

        // ìˆ˜ì • ì·¨ì†Œ
        function cancelEdit() {
            clearForm();
            
            const addBtn = document.querySelector('button[onclick^="updateLink"]');
            if (addBtn) {
                addBtn.textContent = 'ì¶”ê°€í•˜ê¸°';
                addBtn.onclick = addLink;
            }
            
            const cancelBtn = document.querySelector('.btn-cancel');
            if (cancelBtn) {
                cancelBtn.remove();
            }
        }

        // ë§í¬ ì‚­ì œ
        async function deleteLink(id) {
            // ë¡œê·¸ì¸ í™•ì¸
            if (!currentUser) {
                alert('ë§í¬ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm('ì •ë§ë¡œ ì´ ë§í¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('links')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                document.getElementById('status').innerHTML = 
                    '<span class="success">âœ… ë§í¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
                
                loadLinks();
                
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                document.getElementById('status').innerHTML = 
                    '<span class="error">âŒ ì‚­ì œ ì‹¤íŒ¨: ' + error.message + '</span>';
            }
        }

        // í¼ ì´ˆê¸°í™”
        function clearForm() {
            document.getElementById('name').value = '';
            document.getElementById('url').value = '';
            document.getElementById('category').value = '';
        }
        
        
        // ë¡œê·¸ì¸ í•¨ìˆ˜
        async function login() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const statusEl = document.getElementById('status');
            
            if (!email || !password) {
                alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                statusEl.innerHTML = '<span class="warning">ë¡œê·¸ì¸ ì¤‘...</span>';
                
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                // ë¡œê·¸ì¸ ì„±ê³µ - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                location.reload();
                
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                statusEl.innerHTML = '<span class="error">âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message + '</span>';
            }
        }
        
        // ì½ê¸° ì „ìš©ìœ¼ë¡œ ê³„ì†
        function skipLogin() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('status').innerHTML = '<span class="warning">âš ï¸ ì½ê¸° ì „ìš© ëª¨ë“œ</span>';
        }
        
        // Googleë¡œ ë¡œê·¸ì¸
        async function loginWithGoogle() {
            const statusEl = document.getElementById('status');
            
            try {
                statusEl.innerHTML = '<span class="warning">Google ë¡œê·¸ì¸ ì¤‘...</span>';
                
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + window.location.pathname,
                        queryParams: {
                            access_type: 'offline',
                            prompt: 'consent'
                        },
                        skipBrowserRedirect: false
                    }
                });
                
                if (error) throw error;
                
                // OAuthëŠ” ìë™ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¨
                
            } catch (error) {
                console.error('Google ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                statusEl.innerHTML = '<span class="error">âŒ Google ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message + '</span>';
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        async function logout() {
            const { error } = await supabase.auth.signOut();
            if (!error) {
                location.reload();
            }
        }
        
        // Magic Link ë¡œê·¸ì¸
        async function loginWithMagicLink() {
            const email = document.getElementById('email').value.trim();
            const statusEl = document.getElementById('status');
            
            if (!email) {
                alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                statusEl.innerHTML = '<span class="warning">Magic Link ì „ì†¡ ì¤‘...</span>';
                
                const { data, error } = await supabase.auth.signInWithOtp({
                    email: email,
                    options: {
                        emailRedirectTo: window.location.href
                    }
                });
                
                if (error) throw error;
                
                statusEl.innerHTML = '<span class="success">âœ… ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”! ë¡œê·¸ì¸ ë§í¬ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
                
            } catch (error) {
                console.error('Magic Link ì˜¤ë¥˜:', error);
                statusEl.innerHTML = '<span class="error">âŒ Magic Link ì „ì†¡ ì‹¤íŒ¨: ' + error.message + '</span>';
            }
        }
        
        // Enter í‚¤ë¡œ ë¡œê·¸ì¸
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }
        });
    </script>
</body>
</html>