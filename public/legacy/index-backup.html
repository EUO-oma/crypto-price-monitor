<!DOCTYPE html>
<!--
    CRYPTO Ã— LIVE MONITOR
    
    Branch Update Notice (2025-09-18):
    - ì´ í”„ë¡œì íŠ¸ëŠ” ì´ì œ 'main' ë¸Œëœì¹˜ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤
    - ê¸°ì¡´ 'master' ë¸Œëœì¹˜ì—ì„œ 'main' ë¸Œëœì¹˜ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤
    - Netlify ë° ëª¨ë“  ì—°ê²°ëœ ì„œë¹„ìŠ¤ëŠ” 'main' ë¸Œëœì¹˜ë¥¼ ì°¸ì¡°í•´ì•¼ í•©ë‹ˆë‹¤
    - This project now uses 'main' branch as default (previously 'master')
-->
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>CRYPTO Ã— LIVE ğŸ’¹</title>
    
    <!-- ê¸°ë³¸ ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="ì‹¤ì‹œê°„ ì•”í˜¸í™”í ê°€ê²© ëª¨ë‹ˆí„°ë§ - BTC, ETH, SOL ë¼ì´ë¸Œ ì°¨íŠ¸ ë° ê°€ê²© ì¶”ì ">
    <meta name="keywords" content="crypto, bitcoin, ethereum, solana, ì•”í˜¸í™”í, ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€, ì†”ë¼ë‚˜">
    <meta name="author" content="CRYPTO Ã— LIVE">
    
    <!-- Open Graph ë©”íƒ€ íƒœê·¸ (Facebook, LinkedIn ë“±) -->
    <meta property="og:title" content="CRYPTO Ã— LIVE ğŸ’¹">
    <meta property="og:description" content="ì‹¤ì‹œê°„ ì•”í˜¸í™”í ê°€ê²© ëª¨ë‹ˆí„°ë§ - BTC, ETH, SOL">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:image" content="/icons/og-image.png">
    
    <!-- Twitter ì¹´ë“œ ë©”íƒ€ íƒœê·¸ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CRYPTO Ã— LIVE ğŸ’¹">
    <meta name="twitter:description" content="ì‹¤ì‹œê°„ ì•”í˜¸í™”í ê°€ê²© ëª¨ë‹ˆí„°ë§">
    <meta name="twitter:image" content="/icons/twitter-card.png">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <!-- Apple Touch ì•„ì´ì½˜ (iOS í™ˆ í™”ë©´) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-touch-icon-57x57.png">
    
    <!-- Android Chrome -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#000000">
    
    <!-- Windows Metro íƒ€ì¼ -->
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-TileImage" content="/icons/mstile-144x144.png">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 60px 20px 20px 20px;
            font-weight: 400;
        }
        
        .mono {
            font-family: 'JetBrains Mono', 'Menlo', 'Monaco', 'Courier New', monospace;
        }

        .container {
            background: #0a0a0a;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            max-width: 900px;
            width: 100%;
            border: 1px solid #000;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 40px;
            font-size: 2.5em;
        }

        .exchange-section {
            margin-bottom: 40px;
        }

        h2 {
            color: #aaa;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #333;
        }

        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .price-card {
            background: #1a1a1a;
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
            border: 1px solid #000;
            cursor: pointer;
            text-decoration: none;
            display: block;
        }

        .price-card:hover {
            transform: translateY(-5px);
            border-color: #555;
        }

        .symbol {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .price {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .timestamp {
            font-size: 0.85em;
            opacity: 0.8;
        }

        .status {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #333;
            color: #888;
        }

        .links {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }

        .links a {
            color: #888;
            text-decoration: none;
            margin: 0 15px;
            font-size: 0.9em;
            transition: color 0.3s ease;
        }

        .links a:hover {
            color: #aaa;
            text-decoration: underline;
        }

        #status-message {
            display: inline-block;
            margin-right: 20px;
            font-weight: bold;
        }

        .connected {
            color: #4caf50;
        }

        .error {
            color: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }
        
        /* ì½”ì¸ ì‹¬ë³¼ ë””ë° ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes dimToBlack {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0.3;
                color: #000;
            }
        }
        
        /* í¼ì„¼íŠ¸ ë³€í™” ìˆ¨ê¹€ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeOut {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
        
        .coin-symbol {
            transition: all 2s ease;
        }
        
        .coin-symbol.dimmed {
            animation: dimToBlack 2s ease forwards;
        }
        
        .percentage-change {
            transition: all 2s ease;
        }
        
        .percentage-change.hidden {
            animation: fadeOut 2s ease forwards;
        }
        
        /* YouTube ë¼ì´ë¸Œ ì¸ë””ì¼€ì´í„° ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes livePulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 0 5px rgba(255, 0, 0, 0);
                transform: scale(1.2);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
                transform: scale(1);
            }
        }
        
        
        /* ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ (í™”ë©´ ë„ˆë¹„ 768px ì´í•˜) */
        @media (max-width: 768px) {
            /* ëª¨ë°”ì¼ì—ì„œ ì „ì²´ í™”ë©´ í™œìš© */
            body {
                padding: 0;
                margin: 0;
            }
            
            .container {
                border-radius: 0;
                padding: 0;
                max-width: 100%;
                border: none;
                box-shadow: none;
            }
            
            /* ì¹´ë“œ ì„¹ì…˜ë“¤ ì—¬ë°± ì œê±° */
            .cards {
                padding: 10px 5px;
                gap: 8px;
            }
            
            .card {
                margin: 0;
                padding: 12px;
            }
            
            
            /* í—¤ë” ì¹´ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            .header-card {
                border-radius: 0 !important;
                margin: 0 !important;
                padding: 15px !important;
            }
            
            /* í…Œì´ë¸” ì„¹ì…˜ íŒ¨ë”© ì¤„ì´ê¸° */
            table {
                margin: 0 5px;
            }
            
            /* ë§í¬ ì„¹ì…˜ íŒ¨ë”© ì¤„ì´ê¸° */
            div[style*="margin-top: 30px"] {
                margin-top: 15px !important;
                padding: 10px 5px !important;
            }
            
        }
        
        /* ì±„íŒ… ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ (ì›¹í‚· ë¸Œë¼ìš°ì €) */
        #chat-container::-webkit-scrollbar {
            width: 8px;
        }
        
        #chat-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            margin: 5px;
        }
        
        #chat-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #444 0%, #222 100%);
            border-radius: 10px;
            border: 1px solid #000;
            transition: all 0.3s ease;
        }
        
        #chat-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #555 0%, #333 100%);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        #chat-container::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, #666 0%, #444 100%);
        }
        
        /* Firefox ìŠ¤í¬ë¡¤ë°” */
        #chat-container {
            scrollbar-width: thin;
            scrollbar-color: #444 rgba(0, 0, 0, 0.4);
        }
        
        /* ì±„íŒ… ì»¨í…Œì´ë„ˆ í˜¸ë²„ ì‹œ ìŠ¤í¬ë¡¤ë°” ë” ì„ ëª…í•˜ê²Œ */
        #chat-container:hover::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #555 0%, #333 100%);
            box-shadow: 0 0 3px rgba(255, 255, 255, 0.1);
        }
        
        /* ì±„íŒ… ë©”ì‹œì§€ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        .message-content-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 5px;
        }
        
        .my-message-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 5px;
        }
        
        .message-time {
            margin-bottom: 5px;
            white-space: nowrap;
        }
        
        /* ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ (í™”ë©´ ë„ˆë¹„ 768px ì´í•˜) */
        @media (max-width: 768px) {
            /* ì±„íŒ… ì„¹ì…˜ ëª¨ë°”ì¼ ìµœì í™” */
            .chat-section {
                padding: 10px !important;
                margin-top: 15px !important;
                border-radius: 0 !important;
            }
            
            #chat-container {
                border-radius: 10px !important;
                height: 350px !important;
                padding: 10px !important;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
            #chat-container::-webkit-scrollbar {
                width: 4px;
                opacity: 0.5;
            }
            
            #chat-container::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.2);
            }
            
            .message-content-wrapper {
                flex-direction: column;
                align-items: flex-start;
                gap: 2px;
            }
            
            .my-message-wrapper {
                flex-direction: column-reverse;
                align-items: flex-end;
                gap: 2px;
            }
            
            .message-time {
                margin-bottom: 2px;
                margin-left: 5px;
                font-size: 10px !important;
                opacity: 0.8;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ============================================ -->
        <!-- ğŸ’° SECTION 2: ì½”ì¸ ê°€ê²© ì¹´ë“œ ì„¹ì…˜ -->
        <!-- TradingView Widgetì„ í†µí•œ ì‹¤ì‹œê°„ ê°€ê²© í‘œì‹œ -->
        <!-- BTC, ETH, SOL, XRP ë“± ì£¼ìš” ì½”ì¸ ê°€ê²© -->
        <!-- ============================================ -->
        <div class="exchange-section">
            <!-- ì„¹ì…˜ í—¤ë” (ì°¨íŠ¸ í˜ì´ì§€ ë§í¬ í¬í•¨) -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div style="padding-left: 15px;">
                    <h2 style="margin: 0; font-weight: 600; font-size: 0.75em;"><a href="triple-chart.html" style="color: inherit; text-decoration: none; transition: all 0.3s;" onmouseover="this.style.color='#f7931a'" onmouseout="this.style.color='inherit'">ğŸ“ˆ Crypto Prices</a></h2>
                    <p style="margin: 5px 0 0 0; font-size: 12px; color: #666; font-weight: 300;">
                        <span id="market-date"></span>
                        <span id="market-status" style="margin-left: 10px;"></span>
                    </p>
                </div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button onclick="adjustPriceSize('decrease')" style="
                        background: #1a1a1a;
                        border: 1px solid #000;
                        border-radius: 6px;
                        padding: 6px 12px;
                        cursor: pointer;
                        font-size: 13px;
                        font-weight: 500;
                        color: #888;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#2a2a2a'; this.style.color='#fff'" onmouseout="this.style.background='#1a1a1a'; this.style.color='#888'">
                        A-
                    </button>
                    <button onclick="adjustPriceSize('increase')" style="
                        background: #1a1a1a;
                        border: 1px solid #000;
                        border-radius: 6px;
                        padding: 6px 12px;
                        cursor: pointer;
                        font-size: 13px;
                        font-weight: 500;
                        color: #888;
                        transition: all 0.2s;
                    " onmouseover="this.style.background='#2a2a2a'; this.style.color='#fff'" onmouseout="this.style.background='#1a1a1a'; this.style.color='#888'">
                        A+
                    </button>
                </div>
            </div>
            
            
            <!-- Custom Crypto Price Display -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 0; margin-bottom: 20px;">
                <!-- BTC Price Card -->
                <a href="chart.html?symbol=BTCUSDT" style="text-decoration: none; display: block;">
                <div style="background: #0d0d0d; border-radius: 10px; padding: 8px; border: 1px solid #000; transition: all 0.3s ease; cursor: pointer;"
                     onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='#444';" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='#222';">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                        <span class="coin-symbol" style="color: #f7931a; font-size: 1.2em; font-weight: bold;">â‚¿ BTC</span>
                    </div>
                    <div id="btc-price-custom" class="crypto-price mono" style="font-size: 2.5em; font-weight: 600; color: #f7931a; margin-bottom: 5px; text-align: right;">Loading...</div>
                    <div id="btc-change-custom" class="mono percentage-change" style="font-size: 0.9em; color: #4caf50; text-align: right; font-weight: 400;">-</div>
                </div>
                </a>
                
                <!-- ETH Price Card -->
                <a href="chart.html?symbol=ETHUSDT" style="text-decoration: none; display: block;">
                <div class="crypto-card" style="background: #0d0d0d; border-radius: 10px; padding: 8px; border: 1px solid #000; transition: all 0.3s ease; cursor: pointer;"
                     onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='#444';" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='#222';">
                    <div class="coin-info-section">
                        <span class="coin-symbol" style="color: #9a8ff8; font-size: 1.2em; font-weight: bold;">Î ETH</span>
                    </div>
                    <div class="price-section">
                        <div id="eth-price-custom" class="crypto-price mono" style="font-size: 2.5em; font-weight: 600; color: #9a8ff8; margin-bottom: 5px; text-align: right;">Loading...</div>
                        <div id="eth-change-custom" class="mono percentage-change" style="font-size: 0.9em; color: #4caf50; text-align: right; font-weight: 400; white-space: nowrap;">-</div>
                    </div>
                </div>
                </a>
                
                <!-- SOL Price Card -->
                <a href="chart.html?symbol=SOLUSDT" style="text-decoration: none; display: block;">
                <div class="crypto-card" style="background: #0d0d0d; border-radius: 10px; padding: 8px; border: 1px solid #000; transition: all 0.3s ease; cursor: pointer;"
                     onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='#444';" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='#222';">
                    <div class="coin-info-section">
                        <span class="coin-symbol" style="color: #00FFA3; font-size: 1.2em; font-weight: bold;">â— SOL</span>
                    </div>
                    <div class="price-section">
                        <div id="sol-price-custom" class="crypto-price mono" style="font-size: 2.5em; font-weight: 600; color: #00FFA3; margin-bottom: 5px; text-align: right;">Loading...</div>
                        <div id="sol-change-custom" class="mono percentage-change" style="font-size: 0.9em; color: #4caf50; text-align: right; font-weight: 400; white-space: nowrap;">-</div>
                    </div>
                </div>
                </a>
                
                <!-- NASDAQ (NDX) Price Card -->
                <div style="background: #0d0d0d; border-radius: 10px; padding: 8px; border: 1px solid #000;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                        <span class="coin-symbol" style="color: #4facfe; font-size: 1.2em; font-weight: bold;">NDX</span>
                        <span style="color: #666; font-size: 0.9em;">NASDAQ-100</span>
                    </div>
                    <div id="nasdaq-price" class="crypto-price mono" style="font-size: 2.5em; font-weight: 600; color: #4facfe; margin-bottom: 5px; text-align: right;">Loading...</div>
                    <div class="mono" style="font-size: 0.9em; text-align: right; font-weight: 400;">
                        <span id="nasdaq-change" style="color: #4caf50;">-</span>
                        <span style="color: #666; margin: 0 5px;">|</span>
                        <span id="nasdaq-percent" class="percentage-change" style="color: #4caf50;">-</span>
                    </div>
                </div>
            </div>
            
        </div>
        <!-- ============================================ -->
        <!-- ğŸ’° SECTION 2 END: ì½”ì¸ ê°€ê²© ì¹´ë“œ ì„¹ì…˜ -->
        <!-- ============================================ -->
        
        <!-- ============================================ -->
        <!-- ğŸ—„ï¸ SECTION 3: Supabase DB ì¶”ì¶œ ì„¹ì…˜ -->
        <!-- ë§í¬ë“¤ì€ ì´ì œ ë³„ë„ í˜ì´ì§€ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤ -->
        <!-- ============================================ -->
        
        <!-- ============================================ -->
        <!-- ğŸ—„ï¸ SECTION 3 END: Supabase DB ì¶”ì¶œ ì„¹ì…˜ -->
        <!-- ============================================ -->
        
        
    </div>

    <!-- Firebase SDK scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="links-module.js"></script>
    <script>
        // Firebase ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyA6zB_snzOh_e5tG6_-uK64g6dwL5pzU4c",
            authDomain: "crypto-monitor-84bdb.firebaseapp.com",
            databaseURL: "https://crypto-monitor-84bdb-default-rtdb.firebaseio.com",
            projectId: "crypto-monitor-84bdb",
            storageBucket: "crypto-monitor-84bdb.firebasestorage.app",
            messagingSenderId: "146592267275",
            appId: "1:146592267275:web:916c54658889be5dab9b0e",
            measurementId: "G-TTGCF3YWWJ"
        };

        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();


        // Price size adjustment
        let priceScale = 1;
        let bwMode = false;
        let pageLoadTime = Date.now();
        
        function adjustPriceSize(action) {
            const priceElements = document.querySelectorAll('.crypto-price');
            
            if (action === 'increase') {
                priceScale = Math.min(priceScale + 0.2, 2);
            } else if (action === 'decrease') {
                priceScale = Math.max(priceScale - 0.2, 0.6);
            } else if (action === 'reset') {
                priceScale = 1;
            }
            
            priceElements.forEach(el => {
                el.style.transform = `scale(${priceScale})`;
                el.style.transformOrigin = 'right center';
            });
            
            // Save preference
            localStorage.setItem('priceScale', priceScale);
        }
        
        // Update market date and status
        function updateMarketStatus() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            const dateStr = now.toLocaleDateString('en-US', options);
            
            const dateElement = document.getElementById('market-date');
            const statusElement = document.getElementById('market-status');
            
            if (dateElement) {
                dateElement.textContent = dateStr;
            }
            
            // Check if market is open (crypto is 24/7, but we can show trading hours)
            const hours = now.getUTCHours();
            const day = now.getUTCDay();
            
            // NYSE hours: 9:30 AM - 4:00 PM EST (14:30 - 21:00 UTC)
            const isNYSEOpen = day >= 1 && day <= 5 && hours >= 14 && hours < 21;
            
            if (statusElement) {
                if (isNYSEOpen) {
                    statusElement.innerHTML = 'ğŸŸ¢ Markets Open';
                    statusElement.style.color = '#4caf50';
                } else {
                    statusElement.innerHTML = 'ğŸ”´ Markets Closed';
                    statusElement.style.color = '#888';
                }
            }
        }
        
        // Initialize on load
        // Store page load time
        window.pageLoadTime = Date.now();
        
        document.addEventListener('DOMContentLoaded', function() {
            // Restore price scale
            const savedScale = localStorage.getItem('priceScale');
            if (savedScale) {
                priceScale = parseFloat(savedScale);
                setTimeout(() => adjustPriceSize(''), 100);
            }
            
            // Update market status
            updateMarketStatus();
            setInterval(updateMarketStatus, 60000); // Update every minute
            
            // Hide percentage changes after 10 seconds
            setTimeout(() => {
                hidePercentageChanges();
            }, 10000);
        });
        
        // BW Mode Toggle Function
        function toggleBWMode() {
            bwMode = !bwMode;
            const priceElements = document.querySelectorAll('.crypto-price');
            const symbolElements = document.querySelectorAll('.coin-symbol');
            const percentageElements = [
                document.getElementById('btc-change-custom'),
                document.getElementById('eth-change-custom'),
                document.getElementById('sol-change-custom'),
                document.getElementById('nasdaq-percent')
            ];
            
            if (bwMode) {
                // Make all prices white
                priceElements.forEach(el => {
                    el.style.color = '#ffffff';
                });
                symbolElements.forEach(el => {
                    el.style.color = '#ffffff';
                    el.classList.remove('dimmed'); // Remove dimming in BW mode
                    el.style.animation = 'none';
                });
                // Hide percentage changes by making them black
                percentageElements.forEach(el => {
                    if (el) {
                        el.style.color = '#000000';
                        el.classList.remove('hidden'); // Remove hidden animation in BW mode
                        el.style.animation = 'none';
                    }
                });
            } else {
                // Restore original colors
                document.getElementById('btc-price-custom').style.color = '#f7931a';
                document.getElementById('eth-price-custom').style.color = '#627eea';
                document.getElementById('sol-price-custom').style.color = '#00ffa3';
                
                // Restore symbol colors
                const btcSymbol = document.querySelector('[style*="#f7931a"].coin-symbol');
                const ethSymbol = document.querySelector('[style*="#627eea"].coin-symbol');
                const solSymbol = document.querySelector('[style*="#00ffa3"].coin-symbol');
                
                if (btcSymbol) btcSymbol.style.color = '#f7931a';
                if (ethSymbol) ethSymbol.style.color = '#627eea';
                if (solSymbol) solSymbol.style.color = '#00ffa3';
                
                // Restore percentage colors based on value
                percentageElements.forEach(el => {
                    if (el && el.textContent) {
                        const value = parseFloat(el.textContent);
                        if (!isNaN(value)) {
                            el.style.color = value >= 0 ? '#4caf50' : '#f44336';
                        }
                        // Re-apply animations if more than 5 seconds have passed
                        if (Date.now() - pageLoadTime > 5000) {
                            el.classList.add('hidden');
                        }
                    }
                });
                
                // Re-apply symbol dimming if more than 5 seconds have passed
                if (Date.now() - pageLoadTime > 5000) {
                    symbolElements.forEach(el => {
                        el.classList.add('dimmed');
                    });
                }
                
                // Re-enable dimming if it was previously active
                symbolElements.forEach(el => {
                    el.style.animation = '';
                });
            }
        }
        
        // Hide percentage changes function
        function hidePercentageChanges() {
            // Don't hide if in BW mode (already hidden)
            if (bwMode) return;
            
            const percentageElements = [
                document.getElementById('btc-change-custom'),
                document.getElementById('eth-change-custom'),
                document.getElementById('sol-change-custom'),
                document.getElementById('nasdaq-percent')
            ];
            
            percentageElements.forEach(el => {
                if (el) {
                    el.style.transition = 'color 0.5s ease';
                    el.style.color = '#000000';
                }
            });
        }

        let binanceBtcWs = null;
        let binanceEthWs = null;
        let binanceXrpWs = null;
        let binanceSolWs = null;
        let binanceAvaxWs = null;

        // í˜„ì¬ ê°€ê²© ì¶”ì 
        let currentPrices = {
            BTCUSDT: { high: 0, low: 999999999, current: 0 },
            ETHUSDT: { high: 0, low: 999999999, current: 0 },
            SOLUSDT: { high: 0, low: 999999999, current: 0 }
        };

        function formatPrice(price) {
            // null, undefined, ë¹ˆ ë¬¸ìì—´ ì²˜ë¦¬
            if (price === null || price === undefined || price === '') {
                return '-';
            }
            
            const num = parseFloat(price);
            
            // NaN ì²´í¬
            if (isNaN(num)) {
                return '-';
            }
            
            const parts = num.toFixed(2).split('.');
            const integerPart = parseInt(parts[0]).toLocaleString('en-US');
            return `<span style="color: #000;">$</span>${integerPart}<span style="color: #666; font-size: 0.7em;">.${parts[1]}</span>`;
        }


        function updateLastUpdate() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            
            const day = now.getDate();
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const month = monthNames[now.getMonth()];
            
            // Header update time - simplified version
            const headerTimeElement = document.getElementById('header-update-time');
            if (headerTimeElement) {
                headerTimeElement.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: 600; color: #fff; margin-bottom: 5px;">
                            ${displayHours}:${minutes}:${seconds} ${ampm}
                        </div>
                        <div style="font-size: 1em; color: #888;">
                            ${month} ${day}
                        </div>
                    </div>
                `;
            }
            
            // Mini clock update (24ì‹œê°„ í˜•ì‹)
            const miniClockElement = document.getElementById('mini-clock-time');
            if (miniClockElement) {
                miniClockElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes}:${seconds}`;
            }
        }







        // Binance WebSocket for custom price cards
        function connectBinance() {
            console.log('ğŸš€ connectBinance í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ë¡œ ë‹¨ì¼ ì—°ê²° ì‹œë„
            console.log('ğŸ“¡ BTC WebSocket ì—°ê²° ì‹œë„...');
            const btcWs = new WebSocket('wss://stream.binance.com/ws/btcusdt@ticker');
            
            btcWs.onopen = function() {
                console.log('âœ… BTC WebSocket ì—°ê²° ì„±ê³µ!');
                document.getElementById('btc-price-custom').textContent = 'Connected...';
            };
            
            btcWs.onmessage = function(event) {
                console.log('ğŸ“Š BTC ë°ì´í„° ìˆ˜ì‹ :', event.data);
                try {
                    const data = JSON.parse(event.data);
                    if (data && data.c) {
                        const price = parseFloat(data.c);
                        const change = parseFloat(data.P || 0);
                        
                        // ê°€ê²© ì—…ë°ì´íŠ¸
                        const priceElement = document.getElementById('btc-price-custom');
                        if (priceElement) {
                            const parts = price.toFixed(2).split('.');
                            const integerPart = parseInt(parts[0]).toLocaleString('en-US');
                            priceElement.innerHTML = `<span style="color: #000;">$</span>${integerPart}<span style="font-size: 0.7em;">.${parts[1]}</span>`;
                            console.log('âœ… BTC ê°€ê²© ì—…ë°ì´íŠ¸ ì™„ë£Œ:', price);
                        } else {
                            console.error('âŒ btc-price-custom ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                        }
                        
                        // ë³€í™”ìœ¨ ì—…ë°ì´íŠ¸
                        const changeElement = document.getElementById('btc-change-custom');
                        if (changeElement) {
                            changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                            changeElement.style.color = change >= 0 ? '#4caf50' : '#f44336';
                        }
                    }
                } catch (error) {
                    console.error('âŒ ë°ì´í„° íŒŒì‹± ì—ëŸ¬:', error);
                }
            };
            
            btcWs.onerror = function(error) {
                console.error('âŒ BTC WebSocket ì—ëŸ¬:', error);
                document.getElementById('btc-price-custom').textContent = 'Connection Error';
            };
            
            btcWs.onclose = function(event) {
                console.log('ğŸ”Œ BTC WebSocket ì¢…ë£Œ:', event.code, event.reason);
                document.getElementById('btc-price-custom').textContent = 'Reconnecting...';
                
                // 5ì´ˆ í›„ ì¬ì—°ê²°
                setTimeout(() => {
                    console.log('ğŸ”„ ì¬ì—°ê²° ì‹œë„...');
                    connectBinance();
                }, 5000);
            };
            
            // ETH WebSocket ì—°ê²°
            console.log('ğŸ“¡ ETH WebSocket ì—°ê²° ì‹œë„...');
            const ethWs = new WebSocket('wss://stream.binance.com/ws/ethusdt@ticker');
            
            ethWs.onopen = function() {
                console.log('âœ… ETH WebSocket ì—°ê²° ì„±ê³µ!');
                document.getElementById('eth-price-custom').textContent = 'Connected...';
            };
            
            ethWs.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    if (data && data.c) {
                        const price = parseFloat(data.c);
                        const change = parseFloat(data.P || 0);
                        
                        const priceElement = document.getElementById('eth-price-custom');
                        if (priceElement) {
                            const parts = price.toFixed(2).split('.');
                            const integerPart = parseInt(parts[0]).toLocaleString('en-US');
                            priceElement.innerHTML = `<span style="color: #000;">$</span>${integerPart}<span style="font-size: 0.7em;">.${parts[1]}</span>`;
                        }
                        
                        const changeElement = document.getElementById('eth-change-custom');
                        if (changeElement) {
                            changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                            changeElement.style.color = change >= 0 ? '#4caf50' : '#f44336';
                        }
                    }
                } catch (error) {
                    console.error('âŒ ETH ë°ì´í„° íŒŒì‹± ì—ëŸ¬:', error);
                }
            };
            
            // SOL WebSocket ì—°ê²°
            console.log('ğŸ“¡ SOL WebSocket ì—°ê²° ì‹œë„...');
            const solWs = new WebSocket('wss://stream.binance.com/ws/solusdt@ticker');
            
            solWs.onopen = function() {
                console.log('âœ… SOL WebSocket ì—°ê²° ì„±ê³µ!');
                document.getElementById('sol-price-custom').textContent = 'Connected...';
            };
            
            solWs.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    if (data && data.c) {
                        const price = parseFloat(data.c);
                        const change = parseFloat(data.P || 0);
                        
                        const priceElement = document.getElementById('sol-price-custom');
                        if (priceElement) {
                            const parts = price.toFixed(2).split('.');
                            const integerPart = parseInt(parts[0]).toLocaleString('en-US');
                            priceElement.innerHTML = `<span style="color: #000;">$</span>${integerPart}<span style="font-size: 0.7em;">.${parts[1]}</span>`;
                        }
                        
                        const changeElement = document.getElementById('sol-change-custom');
                        if (changeElement) {
                            changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                            changeElement.style.color = change >= 0 ? '#4caf50' : '#f44336';
                        }
                    }
                } catch (error) {
                    console.error('âŒ SOL ë°ì´í„° íŒŒì‹± ì—ëŸ¬:', error);
                }
            };
            
            return; // ë‚˜ë¨¸ì§€ ì½”ë“œ ë¬´ì‹œ
            
            const symbols = ['btcusdt', 'ethusdt', 'solusdt'];
            
            symbols.forEach(symbol => {
                console.log(`WebSocket ì—°ê²° ì‹œë„: ${symbol}`);
                const ws = new WebSocket(`wss://stream.binance.com/ws/${symbol}@ticker`);
                
                ws.onopen = function() {
                    console.log(`âœ… WebSocket ì—°ê²° ì„±ê³µ: ${symbol}`);
                };

                ws.onmessage = function(event) {
                    console.log(`ğŸ“Š WebSocket ë°ì´í„° ìˆ˜ì‹ : ${symbol}`, event.data);
                    const data = JSON.parse(event.data);
                    if (data.c) {
                        const price = data.c;
                        const high = data.h;  // 24ì‹œê°„ ìµœê³ ê°€
                        const low = data.l;   // 24ì‹œê°„ ìµœì €ê°€
                        
                        // ì‹¬ë³¼ ì´ë¦„ ì¶”ì¶œ (btc, eth, xrp ë“±)
                        const coinName = symbol.replace('usdt', '');
                        const fullSymbol = symbol.toUpperCase() + 'USDT';
                        
                        
                        // ê°€ê²© ê¸°ë¡ ì—…ë°ì´íŠ¸ (BTC, ETH, SOLë§Œ)
                        if (fullSymbol === 'BTCUSDT' || fullSymbol === 'ETHUSDT' || fullSymbol === 'SOLUSDT') {
                            if (currentPrices[fullSymbol]) {
                                currentPrices[fullSymbol].current = parseFloat(price);
                                currentPrices[fullSymbol].high = Math.max(currentPrices[fullSymbol].high || 0, parseFloat(high));
                                currentPrices[fullSymbol].low = Math.min(currentPrices[fullSymbol].low || 999999999, parseFloat(low));
                            }
                        }
                        
                        // ê°€ê²© ì—…ë°ì´íŠ¸
                        const priceElement = document.getElementById(`binance-${coinName}`);
                        if (priceElement) {
                            priceElement.innerHTML = formatPrice(price);
                            priceElement.classList.remove('loading');
                        }
                        
                        // Custom price cards ì—…ë°ì´íŠ¸
                        const customPriceElement = document.getElementById(`${coinName}-price-custom`);
                        const customChangeElement = document.getElementById(`${coinName}-change-custom`);
                        
                        if (customPriceElement) {
                            const priceNum = parseFloat(price);
                            const change = parseFloat(data.P || 0); // 24h ë³€í™”ìœ¨ %
                            const changeAmount = parseFloat(data.p || 0); // 24h ë³€í™”ëŸ‰
                            
                            // ë‹¬ëŸ¬ ê¸°í˜¸ë¥¼ ê²€ì •ìƒ‰ìœ¼ë¡œ, ê°€ê²©ì€ ë¸Œëœë“œ ìƒ‰ìƒìœ¼ë¡œ
                            const parts = priceNum.toFixed(2).split('.');
                            const integerPart = parseInt(parts[0]).toLocaleString('en-US');
                            customPriceElement.innerHTML = `<span style="color: #000;">$</span>${integerPart}<span style="font-size: 0.7em;">.${parts[1]}</span>`;
                            
                            // ê°€ê²© ìƒ‰ìƒì€ ë¸Œëœë“œ ì»¬ëŸ¬ ìœ ì§€ (ë³€ê²½í•˜ì§€ ì•ŠìŒ)
                            
                            // ë³€í™”ëŸ‰ í‘œì‹œ
                            if (customChangeElement) {
                                const sign = change >= 0 ? '+' : '';
                                customChangeElement.textContent = `${sign}${changeAmount.toFixed(2)} (${sign}${change.toFixed(2)}%)`;
                                customChangeElement.style.color = change >= 0 ? '#4caf50' : '#f44336';
                            }
                        }
                        
                        // ìµœê³ ê°€/ìµœì €ê°€ ì—…ë°ì´íŠ¸
                        const highElement = document.getElementById(`${coinName}-high`);
                        const lowElement = document.getElementById(`${coinName}-low`);
                        if (highElement && high) {
                            highElement.innerHTML = formatPrice(high);
                        }
                        if (lowElement && low) {
                            lowElement.innerHTML = formatPrice(low);
                        }
                        
                        // ê°€ê²© ë°ì´í„°ëŠ” savePriceHistory í•¨ìˆ˜ì—ì„œ 5ë¶„ë§ˆë‹¤ ìë™ ì €ì¥ë¨
                        
                        updateLastUpdate();
                    }
                };

                ws.onerror = function(error) {
                    console.error(`âŒ Binance WebSocket error for ${symbol}:`, error);
                };
                
                ws.onclose = function(event) {
                    console.log(`ğŸ”Œ Binance WebSocket closed for ${symbol}. Code: ${event.code}, Reason: ${event.reason}`);
                    // ì¬ì—°ê²° ì‹œë„
                    setTimeout(() => {
                        console.log(`ğŸ”„ ì¬ì—°ê²° ì‹œë„: ${symbol}`);
                        connectBinance();
                    }, 5000);
                };

                if (symbol === 'btcusdt') {
                    binanceBtcWs = ws;
                } else if (symbol === 'ethusdt') {
                    binanceEthWs = ws;
                } else if (symbol === 'xrpusdt') {
                    binanceXrpWs = ws;
                } else if (symbol === 'solusdt') {
                    binanceSolWs = ws;
                } else if (symbol === 'avaxusdt') {
                    binanceAvaxWs = ws;
                }
            });
        }

        // DOM ë¡œë“œ ì™„ë£Œ í›„ WebSocket ì—°ê²°
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ DOM ë¡œë“œ ì™„ë£Œ, WebSocket ì´ˆê¸°í™” ì‹œì‘');
            
            // ì´ˆê¸° ë¡œë”© í´ë˜ìŠ¤ ì¶”ê°€
            document.querySelectorAll('.crypto-price').forEach(el => {
                el.classList.add('loading');
            });

            // WebSocket ì—°ê²° ì‹œì‘
            console.log('ğŸ”Œ WebSocket ì—°ê²° ì‹œì‘');
            connectBinance();
            
            // ì‹œê³„ ì—…ë°ì´íŠ¸ ì‹œì‘
            updateLastUpdate();
            setInterval(updateLastUpdate, 1000);
            
            // í˜ì´ì§€ ë¡œë“œ 5ì´ˆ í›„ ì½”ì¸ ì‹¬ë³¼ê³¼ í¼ì„¼íŠ¸ ë³€í™” ìˆ¨ê¸°ê¸° (BW ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ)
            setTimeout(() => {
                if (!bwMode) {
                    // ì½”ì¸ ì‹¬ë³¼ ë””ë°
                    document.querySelectorAll('.coin-symbol').forEach(symbol => {
                        symbol.classList.add('dimmed');
                    });
                    
                    // í¼ì„¼íŠ¸ ë³€í™” ìˆ¨ê¸°ê¸°
                    document.querySelectorAll('.percentage-change').forEach(change => {
                        change.classList.add('hidden');
                    });
                }
            }, 5000);
        });

        // ì €ì¥ëœ ì¹´ë“œ ìŠ¤íƒ€ì¼ ê°€ì ¸ì˜¤ê¸° (ì•ˆì „í•œ ë²„ì „ - NaN ë°©ì§€)
        function getCardStyles(category) {
            // í•­ìƒ ê¸°ë³¸ ìŠ¤íƒ€ì¼ë§Œ ì‚¬ìš© (localStorage ë¬´ì‹œ)
            const defaultStyles = {
                gpt: {
                    fontSize: 16, fontWeight: '500', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15,
                    hoverBg: '#2a2a2a'
                },
                youtube: {
                    fontSize: 17, fontWeight: '600', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15,
                    hoverBg: '#2a2a2a'
                },
                favorite: {
                    fontSize: 16, fontWeight: '500', bgColor: '#1a1a1a', textColor: '#ffffff',
                    borderColor: '#333333', borderWidth: 1, borderRadius: 10, padding: 15,
                    hoverBg: '#2a2a2a'
                }
            };
            
            return defaultStyles[category] || defaultStyles.gpt;
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜ (XSS ë°©ì§€)
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // ì•ˆì „í•œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showSafeErrorMessage() {
            const containers = ['gpt-links', 'youtube-links', 'favorite-links'];
            
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container && container.innerHTML.trim() === '') {
                    const errorDiv = document.createElement('div');
                    errorDiv.style.cssText = `
                        color: #888;
                        text-align: center;
                        padding: 20px;
                        background: #1a1a1a;
                        border-radius: 10px;
                        border: 1px solid #000;
                    `;
                    errorDiv.textContent = 'ë§í¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...';
                    container.appendChild(errorDiv);
                }
            });
        }

        // ì±„íŒ… íŒì—… ì—´ê¸° í•¨ìˆ˜
        function openChatPopup() {
            // íŒì—… ì°½ ì„¤ì •
            const width = 400;
            const height = 600;
            const left = window.screen.width - width - 50;
            const top = 100;
            
            const features = `
                width=${width},
                height=${height},
                left=${left},
                top=${top},
                toolbar=no,
                menubar=no,
                scrollbars=no,
                resizable=yes,
                status=no
            `.replace(/\s+/g, '');
            
            // íŒì—… ì—´ê¸°
            const chatWindow = window.open('anonymous-chat.html', 'ChatWindow', features);
            
            // í¬ì»¤ìŠ¤ ì£¼ê¸°
            if (chatWindow) {
                chatWindow.focus();
            }
        }

        // Firebaseì—ì„œ ë§í¬ ë°ì´í„° ë¡œë“œ (ì•ˆì „í•œ ë²„ì „)
        async function loadLinksFromSupabase() {
            console.log('ğŸ—„ï¸ === SECTION 3: Firebase DB ì¶”ì¶œ ì‹œì‘ ===');
            
            try {
                // Firebase ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (!database) {
                    console.error('Firebase databaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    showSafeErrorMessage();
                    return;
                }
                
                console.log('âœ… Firebase ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸');

                // Firebaseì—ì„œ ë§í¬ ë°ì´í„° ë¡œë“œ
                const snapshot = await database.ref('links').orderByChild('position').once('value');
                const links = [];
                snapshot.forEach((childSnapshot) => {
                    links.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // position ìˆœìœ¼ë¡œ ì •ë ¬
                links.sort((a, b) => (a.position || 0) - (b.position || 0));
                
                console.log('Firebaseì—ì„œ ë¡œë“œëœ ë§í¬ ìˆ˜:', links.length);
                
                console.log('Links loaded from Firebase:', links);
                
                // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë§í¬ ë¶„ë¥˜
                const gptLinks = links ? links.filter(link => link.category === 'gpt') : [];
                const youtubeLinks = links ? links.filter(link => link.category === 'youtube') : [];
                const favoriteLinks = links ? links.filter(link => link.category === 'favorite') : [];
                
                // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬
                const customCategories = JSON.parse(localStorage.getItem('customCategories') || '[]');
                const customCategoryLinks = {};
                customCategories.forEach(cat => {
                    customCategoryLinks[cat.id] = links ? links.filter(link => link.category === cat.id) : [];
                });
                
                console.log('GPT links:', gptLinks.length);
                console.log('YouTube links:', youtubeLinks.length);
                console.log('Favorite links:', favoriteLinks.length);
                console.log('Custom categories:', customCategories);
                
                // ì´ˆê°„ë‹¨ GPT ë§í¬ ë Œë”ë§
                const gptContainer = document.getElementById('gpt-links');
                if (gptContainer) {
                    console.log('ğŸ¤– GPT ë§í¬ ë Œë”ë§ ì‹œì‘, ê°œìˆ˜:', gptLinks.length);
                    gptContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì œê±°
                    
                    if (gptLinks && gptLinks.length > 0) {
                        gptLinks.forEach((link, index) => {
                            console.log(`GPT ë§í¬ ${index + 1}:`, link);
                            
                            // ì´ˆê°„ë‹¨ ë§í¬ ìš”ì†Œ ìƒì„±
                            const linkEl = document.createElement('a');
                            linkEl.href = link.url || '#';
                            linkEl.target = '_blank';
                            linkEl.textContent = link.name || `GPT Link ${index + 1}`;
                            
                            // ì´ˆê°„ë‹¨ ìŠ¤íƒ€ì¼
                            linkEl.style.cssText = `
                                display: block;
                                background: #1a1a1a;
                                color: #ffffff;
                                padding: 15px;
                                margin: 5px 0;
                                border-radius: 8px;
                                text-decoration: none;
                                border: 1px solid #000;
                                text-align: center;
                                transition: all 0.3s ease;
                            `;
                            
                            // í˜¸ë²„ íš¨ê³¼
                            linkEl.onmouseover = () => {
                                linkEl.style.background = '#2a2a2a';
                                linkEl.style.borderColor = '#555';
                            };
                            linkEl.onmouseout = () => {
                                linkEl.style.background = '#1a1a1a';
                                linkEl.style.borderColor = '#333';
                            };
                            
                            gptContainer.appendChild(linkEl);
                        });
                        
                        console.log('âœ… GPT ë§í¬ ë Œë”ë§ ì™„ë£Œ');
                    } else {
                        gptContainer.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">GPT ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                        console.log('âš ï¸ GPT ë§í¬ ì—†ìŒ');
                    }
                }
                
                // YouTube ë§í¬ ë Œë”ë§ (original card style)
                const youtubeContainer = document.getElementById('youtube-links');
                if (youtubeContainer) {
                    youtubeContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì œê±°
                    
                    if (youtubeLinks.length > 0) {
                        const youtubeStyles = getCardStyles('youtube');
                        
                        youtubeLinks.forEach(link => {
                            const linkElement = document.createElement('a');
                            linkElement.href = link.url || '#';
                            linkElement.target = '_blank';
                            
                            // ìŠ¤íƒ€ì¼ ì ìš© (ê°œë³„ ì†ì„±ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ)
                            linkElement.style.background = youtubeStyles.bgColor || '#1a1a1a';
                            linkElement.style.color = youtubeStyles.textColor || '#ffffff';
                            linkElement.style.padding = (youtubeStyles.padding || 15) + 'px';
                            linkElement.style.borderRadius = (youtubeStyles.borderRadius || 10) + 'px';
                            linkElement.style.textAlign = 'center';
                            linkElement.style.border = `${youtubeStyles.borderWidth || 1}px solid ${youtubeStyles.borderColor || '#333333'}`;
                            linkElement.style.textDecoration = 'none';
                            linkElement.style.transition = 'transform 0.3s ease';
                            linkElement.style.display = 'block';
                            linkElement.style.position = 'relative';
                            linkElement.style.fontWeight = youtubeStyles.fontWeight || '600';
                            linkElement.style.cursor = 'pointer';
                            
                            const textDiv = document.createElement('div');
                            textDiv.style.fontSize = `${youtubeStyles.fontSize || 17}px`;
                            textDiv.style.fontWeight = 'bold';
                            textDiv.textContent = link.name || 'ì´ë¦„ ì—†ìŒ';
                            
                            const liveIndicator = document.createElement('span');
                            liveIndicator.className = 'live-indicator';
                            liveIndicator.setAttribute('data-channel-url', link.url || '');
                            liveIndicator.style.position = 'absolute';
                            liveIndicator.style.top = '5px';
                            liveIndicator.style.right = '5px';
                            liveIndicator.style.width = '10px';
                            liveIndicator.style.height = '10px';
                            liveIndicator.style.borderRadius = '50%';
                            liveIndicator.style.background = '#666';
                            liveIndicator.style.animation = 'none';
                            
                            linkElement.appendChild(textDiv);
                            linkElement.appendChild(liveIndicator);
                            
                            // í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
                            linkElement.addEventListener('mouseover', function() {
                                this.style.transform = 'translateY(-3px)';
                                this.style.borderColor = '#555';
                                if (youtubeStyles.hoverBg) {
                                    this.style.background = youtubeStyles.hoverBg;
                                }
                            });
                            
                            linkElement.addEventListener('mouseout', function() {
                                this.style.transform = 'translateY(0)';
                                this.style.borderColor = youtubeStyles.borderColor || '#333333';
                                this.style.background = youtubeStyles.bgColor || '#1a1a1a';
                            });
                            
                            youtubeContainer.appendChild(linkElement);
                        });

                        // YouTube ë¼ì´ë¸Œ ìƒíƒœ ì²´í¬
                        checkYouTubeLiveStatus();
                    } else {
                        const emptyMessage = document.createElement('div');
                        emptyMessage.style.color = '#666';
                        emptyMessage.style.textAlign = 'center';
                        emptyMessage.textContent = 'ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.';
                        youtubeContainer.appendChild(emptyMessage);
                    }
                }
                
                // Favorite ë§í¬ ë Œë”ë§
                const favoriteContainer = document.getElementById('favorite-links');
                if (favoriteContainer) {
                    favoriteContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì œê±°
                    
                    if (favoriteLinks.length > 0) {
                        const favoriteStyles = getCardStyles('favorite');
                        
                        favoriteLinks.forEach(link => {
                            const linkElement = document.createElement('a');
                            linkElement.href = link.url || '#';
                            linkElement.target = '_blank';
                            
                            // ìŠ¤íƒ€ì¼ ì ìš© (ê°œë³„ ì†ì„±ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ)
                            linkElement.style.background = favoriteStyles.bgColor || '#1a1a1a';
                            linkElement.style.color = favoriteStyles.textColor || '#ffffff';
                            linkElement.style.padding = (favoriteStyles.padding || 15) + 'px';
                            linkElement.style.borderRadius = (favoriteStyles.borderRadius || 10) + 'px';
                            linkElement.style.textAlign = 'center';
                            linkElement.style.border = `${favoriteStyles.borderWidth || 1}px solid ${favoriteStyles.borderColor || '#333333'}`;
                            linkElement.style.textDecoration = 'none';
                            linkElement.style.transition = 'transform 0.3s ease';
                            linkElement.style.display = 'block';
                            linkElement.style.fontWeight = favoriteStyles.fontWeight || '500';
                            linkElement.style.cursor = 'pointer';
                            
                            const textDiv = document.createElement('div');
                            textDiv.style.fontSize = `${favoriteStyles.fontSize || 16}px`;
                            textDiv.textContent = link.name || 'ì´ë¦„ ì—†ìŒ';
                            
                            // í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
                            linkElement.addEventListener('mouseover', function() {
                                this.style.transform = 'translateY(-3px)';
                                this.style.borderColor = '#555';
                                if (favoriteStyles.hoverBg) {
                                    this.style.background = favoriteStyles.hoverBg;
                                }
                            });
                            
                            linkElement.addEventListener('mouseout', function() {
                                this.style.transform = 'translateY(0)';
                                this.style.borderColor = favoriteStyles.borderColor || '#333333';
                                this.style.background = favoriteStyles.bgColor || '#1a1a1a';
                            });
                            
                            linkElement.appendChild(textDiv);
                            favoriteContainer.appendChild(linkElement);
                        });
                    } else {
                        const emptyMessage = document.createElement('div');
                        emptyMessage.style.color = '#666';
                        emptyMessage.style.textAlign = 'center';
                        emptyMessage.textContent = 'ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.';
                        favoriteContainer.appendChild(emptyMessage);
                    }
                }
                
                // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ ë Œë”ë§
                const customSectionsContainer = document.getElementById('custom-category-sections');
                if (customSectionsContainer && customCategories.length > 0) {
                    customSectionsContainer.innerHTML = '';
                    
                    customCategories.forEach(category => {
                        const categoryLinks = customCategoryLinks[category.id] || [];
                        
                        if (categoryLinks.length > 0) {
                            const section = document.createElement('div');
                            section.className = 'custom-category-section';
                            section.style.cssText = 'margin-top: 20px; padding-bottom: 20px;';
                            
                            // ì¹´í…Œê³ ë¦¬ í—¤ë” ìƒì„±
                            const header = document.createElement('h2');
                            header.style.color = '#aaa';
                            header.style.marginBottom = '20px';
                            header.style.paddingBottom = '10px';
                            header.style.borderBottom = '2px solid #333';
                            header.textContent = `ğŸ“Œ ${category.name || 'ì´ë¦„ ì—†ìŒ'}`;
                            section.appendChild(header);
                            
                            // ë§í¬ ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ ìƒì„±
                            const linksGrid = document.createElement('div');
                            linksGrid.style.display = 'grid';
                            linksGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(150px, 1fr))';
                            linksGrid.style.gap = '15px';
                            
                            // ê° ë§í¬ë¥¼ DOM ìš”ì†Œë¡œ ìƒì„±
                            categoryLinks.forEach(link => {
                                const linkElement = document.createElement('a');
                                linkElement.href = link.url || '#';
                                linkElement.target = '_blank';
                                
                                // ì¹´í…Œê³ ë¦¬ë³„ ìŠ¤íƒ€ì¼ ê°€ì ¸ì˜¤ê¸°
                                const categoryStyles = getCardStyles(category.id) || getCardStyles('gpt'); // ê¸°ë³¸ê°’ìœ¼ë¡œ gpt ìŠ¤íƒ€ì¼ ì‚¬ìš©
                                
                                linkElement.style.cssText = `
                                    background: ${categoryStyles.bgColor || '#1a1a1a'};
                                    color: ${categoryStyles.textColor || '#ffffff'};
                                    padding: ${categoryStyles.padding || 15}px;
                                    border-radius: ${categoryStyles.borderRadius || 10}px;
                                    text-align: center;
                                    border: ${categoryStyles.borderWidth || 1}px solid ${categoryStyles.borderColor || '#333333'};
                                    text-decoration: none;
                                    transition: transform 0.3s ease;
                                    display: block;
                                    font-weight: ${categoryStyles.fontWeight || '500'};
                                    cursor: pointer;
                                `;
                                
                                const textDiv = document.createElement('div');
                                textDiv.style.fontSize = `${categoryStyles.fontSize || 16}px`;
                                textDiv.textContent = link.name || 'ì´ë¦„ ì—†ìŒ';
                                
                                // í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
                                linkElement.addEventListener('mouseover', function() {
                                    this.style.transform = 'translateY(-3px)';
                                    this.style.borderColor = '#555';
                                    if (categoryStyles.hoverBg) {
                                        this.style.background = categoryStyles.hoverBg;
                                    }
                                });
                                
                                linkElement.addEventListener('mouseout', function() {
                                    this.style.transform = 'translateY(0)';
                                    this.style.borderColor = categoryStyles.borderColor || '#333333';
                                    this.style.background = categoryStyles.bgColor || '#1a1a1a';
                                });
                                
                                linkElement.appendChild(textDiv);
                                linksGrid.appendChild(linkElement);
                            });
                            
                            section.appendChild(linksGrid);
                            
                            customSectionsContainer.appendChild(section);
                        }
                    });
                }
                
            } catch (error) {
                console.error('ğŸ—„ï¸ === SECTION 3: ë§í¬ ë¡œë“œ ì‹¤íŒ¨ ===');
                console.error('Error:', error);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                
                // ëª¨ë“  ì»¨í…Œì´ë„ˆì— ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                const containers = [
                    { id: 'gpt-links', name: 'GPT ë§í¬' },
                    { id: 'youtube-links', name: 'YouTube ë§í¬' },
                    { id: 'favorite-links', name: 'Favorite ë§í¬' },
                ];
                
                containers.forEach(({ id, name }) => {
                    const container = document.getElementById(id);
                    if (container) {
                        const errorDiv = document.createElement('div');
                        errorDiv.style.cssText = `
                            color: #f87171;
                            text-align: center;
                            padding: 20px;
                            background: #1a1a1a;
                            border-radius: 10px;
                            border: 1px solid #000;
                        `;
                        errorDiv.innerHTML = `
                            <div>âŒ ${name} ë¡œë“œ ì‹¤íŒ¨</div>
                            <div style="font-size: 12px; margin-top: 5px; color: #888;">
                                ${error.message}
                            </div>
                            <button onclick="location.reload()" style="
                                margin-top: 10px;
                                padding: 5px 15px;
                                background: #333;
                                color: #fff;
                                border: 1px solid #000;
                                border-radius: 5px;
                                cursor: pointer;
                            ">ìƒˆë¡œê³ ì¹¨</button>
                        `;
                        container.innerHTML = '';
                        container.appendChild(errorDiv);
                    }
                });
                
                // ì¶”ê°€ ë””ë²„ê¹… ì •ë³´ í‘œì‹œ
                alert(`ì„¹ì…˜ 3 ë¡œë“œ ì‹¤íŒ¨: ${error.message}\n\në””ë²„ê·¸ í˜ì´ì§€ì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”:\n/debug-section3.html`);
            }
        }
        
        // YouTube ë¼ì´ë¸Œ ìƒíƒœ ì²´í¬ í•¨ìˆ˜
        async function checkYouTubeLiveStatus() {
            const indicators = document.querySelectorAll('.live-indicator');
            
            indicators.forEach(async (indicator) => {
                const channelUrl = indicator.getAttribute('data-channel-url');
                
                // URLì—ì„œ ì±„ë„ ì •ë³´ ì¶”ì¶œ
                try {
                    // CORS ì œí•œìœ¼ë¡œ ì¸í•´ ì§ì ‘ ì²´í¬ê°€ ì–´ë ¤ìš°ë¯€ë¡œ,
                    // í”„ë¡ì‹œ ì„œë²„ë‚˜ YouTube APIë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
                    // ì¼ë‹¨ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ êµ¬í˜„
                    
                    // ì‹¤ì œ êµ¬í˜„ì‹œ YouTube Data API v3 ì‚¬ìš© í•„ìš”
                    // ì—¬ê¸°ì„œëŠ” URLì— '/live'ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ë¼ì´ë¸Œë¡œ ê°€ì •
                    const isLive = channelUrl.includes('/live');
                    
                    if (isLive) {
                        // ë¼ì´ë¸Œ ì¤‘ - ë¹¨ê°„ìƒ‰ ì› + ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜
                        indicator.style.background = '#ff0000';
                        indicator.style.animation = 'livePulse 1.5s infinite';
                        indicator.title = 'ğŸ”´ LIVE';
                    } else {
                        // ì˜¤í”„ë¼ì¸ - íšŒìƒ‰ ì›
                        indicator.style.background = '#666';
                        indicator.style.animation = 'none';
                        indicator.title = 'âš« Offline';
                    }
                } catch (error) {
                    console.error('ë¼ì´ë¸Œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                }
            });
        }
        
        // ê³µí†µ Firebase ì €ì¥ í•¨ìˆ˜
        // ì¬ì‹œë„ ì¹´ìš´í„°ë¥¼ ìœ„í•œ ì „ì—­ ê°ì²´
        const retryCounters = {};
        
        async function saveToSupabase(symbol, date, high, low, close, retryCount = 0) {
            const MAX_RETRIES = 10;
            
            // Firebase ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
            if (!database) {
                if (retryCount >= MAX_RETRIES) {
                    console.error(`Firebase ì´ˆê¸°í™” ì‹¤íŒ¨ (${MAX_RETRIES}íšŒ ì¬ì‹œë„ í›„)`);
                    return;
                }
                console.log(`Firebase ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘... (${retryCount + 1}/${MAX_RETRIES})`);
                setTimeout(() => saveToSupabase(symbol, date, high, low, close, retryCount + 1), 500);
                return;
            }
            
            try {
                // Firebaseì— ë°ì´í„° ì €ì¥ (symbolê³¼ dateë¥¼ í‚¤ë¡œ ì‚¬ìš©)
                const key = `${symbol}_${date}`;
                await database.ref(`price_history/${key}`).set({
                    symbol: symbol,
                    date: date,
                    high_price: parseFloat(high),
                    low_price: parseFloat(low),
                    price: parseFloat(close),
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                });
                
                console.log(`âœ… ${symbol} ê°€ê²© ë°ì´í„° Firebaseì— ì €ì¥ ì™„ë£Œ`);
                
                // ë°ì´í„° ì €ì¥ í›„ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
                if (symbol === 'BTCUSDT') loadBTCHistory();
                else if (symbol === 'ETHUSDT') loadETHHistory();
                else if (symbol === 'SOLUSDT') loadSOLHistory();
                
            } catch (err) {
                console.error(`${symbol} Firebase ì €ì¥ ì‹¤íŒ¨:`, err);
            }
        }
        
        // BTC 10ì¼ ê°€ê²© ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadBTCHistory() {
            console.log('BTC ê¸°ë¡ ë¡œë“œ ì‹œì‘');
            
            // Firebase ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
            if (!database) {
                console.error('Firebaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                setTimeout(loadBTCHistory, 100);
                return;
            }
            
            try {
                // ì˜¤ëŠ˜ ë‚ ì§œ í¬í•¨í•´ì„œ 10ì¼ê°„ ë°ì´í„° ìƒì„±
                const today = new Date();
                const dates = [];
                for (let i = 0; i < 10; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    dates.push(date.toISOString().split('T')[0]);
                }
                
                // Firebaseì—ì„œ BTCUSDT ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const snapshot = await database.ref('price_history')
                    .orderByChild('symbol')
                    .equalTo('BTCUSDT')
                    .once('value');
                
                const allPriceData = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    if (dates.includes(data.date)) {
                        allPriceData.push(data);
                    }
                });
                
                // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  ìˆœ)
                const data = allPriceData.sort((a, b) => new Date(b.date) - new Date(a.date));
                console.log('BTC ë°ì´í„°:', data);
                
                const tbody = document.getElementById('btc-history-tbody');
                if (!tbody) {
                    console.error('btc-history-tbody ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                // ì˜¤ëŠ˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í˜„ì¬ ê°€ê²©ìœ¼ë¡œ ì¶”ê°€
                let allData = data || [];
                const todayStr = today.toISOString().split('T')[0];
                const todayData = allData.find(d => d.date === todayStr);
                
                if (!todayData && currentPrices.BTCUSDT && currentPrices.BTCUSDT.current > 0) {
                    allData.unshift({
                        date: todayStr,
                        high_price: currentPrices.BTCUSDT.high || currentPrices.BTCUSDT.current,
                        low_price: currentPrices.BTCUSDT.low || currentPrices.BTCUSDT.current,
                        price: currentPrices.BTCUSDT.current,
                        symbol: 'BTCUSDT'
                    });
                }
                
                if (allData.length > 0) {
                    tbody.innerHTML = allData.slice(0, 10).map((record, index) => {
                        // ê°€ê²© í¬ë§· í•¨ìˆ˜
                        const formatPriceSimple = (price) => {
                            if (price === null || price === undefined || price === '') return '-';
                            const num = parseFloat(price);
                            if (isNaN(num)) return '-';
                            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        };
                        
                        const dateObj = new Date(record.date + 'T00:00:00');
                        const month = dateObj.getMonth() + 1;
                        const day = dateObj.getDate();
                        const dateStr = `${month}.${day}`;
                        
                        // ì˜¤ëŠ˜ ë°ì´í„°ëŠ” ê°•ì¡°
                        const isToday = record.date === todayStr;
                        const rowStyle = isToday ? 'background: #1a1a1a;' : '';
                        
                        // ì „ì¼ ëŒ€ë¹„ ë³€í™”ìœ¨ ê³„ì‚°
                        let changePercent = '';
                        if (index < allData.length - 1) {
                            const prevPrice = allData[index + 1].price;
                            if (prevPrice && prevPrice > 0) {
                                const change = ((record.price - prevPrice) / prevPrice * 100);
                                const changeColor = change >= 0 ? '#4caf50' : '#f44336';
                                const changeSymbol = change >= 0 ? '+' : '';
                                changePercent = ` <span style="color: ${changeColor}; font-size: 0.8em;">${changeSymbol}${change.toFixed(2)}%</span>`;
                            }
                        }
                        
                        return `
                        <tr style="border-bottom: 1px solid #222; ${rowStyle}">
                            <td style="padding: 8px; color: ${isToday ? '#f7931a' : '#888'};">
                                ${isToday ? 'ì˜¤ëŠ˜' : dateStr}
                            </td>
                            <td style="padding: 8px; text-align: right; color: #fff;">$${formatPriceSimple(record.high_price)}</td>
                            <td style="padding: 8px; text-align: right; color: #fff;">$${formatPriceSimple(record.low_price)}</td>
                            <td style="padding: 8px; text-align: right; color: #fff;">
                                $${formatPriceSimple(record.price || record.close_price)}${changePercent}
                            </td>
                        </tr>`;
                    }).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #666;">ë°ì´í„°ë¥¼ ìˆ˜ì§‘ ì¤‘ì…ë‹ˆë‹¤...<br><small>ì ì‹œ í›„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</small></td></tr>';
                }
            } catch (error) {
                console.error('BTC ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                const tbody = document.getElementById('btc-history-tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #f44336;">ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜<br><small>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”</small></td></tr>';
                }
            }
        }
        
        // ETH 10ì¼ ê°€ê²© ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadETHHistory() {
            console.log('ETH ê¸°ë¡ ë¡œë“œ ì‹œì‘');
            
            // Firebase ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
            if (!database) {
                console.error('Firebaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                setTimeout(loadETHHistory, 100);
                return;
            }
            
            try {
                // ì˜¤ëŠ˜ ë‚ ì§œ í¬í•¨í•´ì„œ 10ì¼ê°„ ë°ì´í„° ìƒì„±
                const today = new Date();
                const dates = [];
                for (let i = 0; i < 10; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    dates.push(date.toISOString().split('T')[0]);
                }
                
                // Firebaseì—ì„œ ETHUSDT ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const snapshot = await database.ref('price_history')
                    .orderByChild('symbol')
                    .equalTo('ETHUSDT')
                    .once('value');
                
                const allPriceData = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    if (dates.includes(data.date)) {
                        allPriceData.push(data);
                    }
                });
                
                // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  ìˆœ)
                const data = allPriceData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const tbody = document.getElementById('eth-history-tbody');
                if (!tbody) return;
                
                // ì˜¤ëŠ˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í˜„ì¬ ê°€ê²©ìœ¼ë¡œ ì¶”ê°€
                let allData = data || [];
                const todayStr = today.toISOString().split('T')[0];
                const todayData = allData.find(d => d.date === todayStr);
                
                if (!todayData && currentPrices.ETHUSDT && currentPrices.ETHUSDT.current > 0) {
                    allData.unshift({
                        date: todayStr,
                        high_price: currentPrices.ETHUSDT.high || currentPrices.ETHUSDT.current,
                        low_price: currentPrices.ETHUSDT.low || currentPrices.ETHUSDT.current,
                        price: currentPrices.ETHUSDT.current,
                        symbol: 'ETHUSDT'
                    });
                }
                
                if (allData.length > 0) {
                    tbody.innerHTML = allData.slice(0, 10).map((record, index) => {
                        // ê°€ê²© í¬ë§· í•¨ìˆ˜
                        const formatPriceSimple = (price) => {
                            if (price === null || price === undefined || price === '') return '-';
                            const num = parseFloat(price);
                            if (isNaN(num)) return '-';
                            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        };
                        
                        const dateObj = new Date(record.date + 'T00:00:00');
                        const month = dateObj.getMonth() + 1;
                        const day = dateObj.getDate();
                        const dateStr = `${month}.${day}`;
                        
                        // ì˜¤ëŠ˜ ë°ì´í„°ëŠ” ê°•ì¡°
                        const isToday = record.date === todayStr;
                        const rowStyle = isToday ? 'background: #1a1a1a;' : '';
                        
                        // ì „ì¼ ëŒ€ë¹„ ë³€í™”ìœ¨ ê³„ì‚°
                        let changePercent = '';
                        if (index < allData.length - 1) {
                            const prevPrice = allData[index + 1].price;
                            if (prevPrice && prevPrice > 0) {
                                const change = ((record.price - prevPrice) / prevPrice * 100);
                                const changeColor = change >= 0 ? '#4caf50' : '#f44336';
                                const changeSymbol = change >= 0 ? '+' : '';
                                changePercent = ` <span style="color: ${changeColor}; font-size: 0.8em;">${changeSymbol}${change.toFixed(2)}%</span>`;
                            }
                        }
                        
                        return `
                        <tr style="border-bottom: 1px solid #222; ${rowStyle}">
                            <td style="padding: 8px; color: ${isToday ? '#9a8ff8' : '#888'};">
                                ${isToday ? 'ì˜¤ëŠ˜' : dateStr}
                            </td>
                            <td style="padding: 8px; text-align: right; color: #fff;">$${formatPriceSimple(record.high_price)}</td>
                            <td style="padding: 8px; text-align: right; color: #fff;">$${formatPriceSimple(record.low_price)}</td>
                            <td style="padding: 8px; text-align: right; color: #fff;">
                                $${formatPriceSimple(record.price || record.close_price)}${changePercent}
                            </td>
                        </tr>`;
                    }).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #666;">ë°ì´í„°ë¥¼ ìˆ˜ì§‘ ì¤‘ì…ë‹ˆë‹¤...<br><small>ì ì‹œ í›„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</small></td></tr>';
                }
            } catch (error) {
                console.error('ETH ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                const tbody = document.getElementById('eth-history-tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #f44336;">ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜<br><small>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”</small></td></tr>';
                }
            }
        }
        
        // SOL 10ì¼ ê°€ê²© ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadSOLHistory() {
            console.log('SOL ê¸°ë¡ ë¡œë“œ ì‹œì‘');
            
            // Firebase ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
            if (!database) {
                console.error('Firebaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                setTimeout(loadSOLHistory, 100);
                return;
            }
            
            try {
                // ì˜¤ëŠ˜ ë‚ ì§œ í¬í•¨í•´ì„œ 10ì¼ê°„ ë°ì´í„° ìƒì„±
                const today = new Date();
                const dates = [];
                for (let i = 0; i < 10; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    dates.push(date.toISOString().split('T')[0]);
                }
                
                // Firebaseì—ì„œ SOLUSDT ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const snapshot = await database.ref('price_history')
                    .orderByChild('symbol')
                    .equalTo('SOLUSDT')
                    .once('value');
                
                const allPriceData = [];
                snapshot.forEach((childSnapshot) => {
                    const data = childSnapshot.val();
                    if (dates.includes(data.date)) {
                        allPriceData.push(data);
                    }
                });
                
                // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  ìˆœ)
                const data = allPriceData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const tbody = document.getElementById('sol-history-tbody');
                if (!tbody) return;
                
                // ì˜¤ëŠ˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í˜„ì¬ ê°€ê²©ìœ¼ë¡œ ì¶”ê°€
                let allData = data || [];
                const todayStr = today.toISOString().split('T')[0];
                const todayData = allData.find(d => d.date === todayStr);
                
                if (!todayData && currentPrices.SOLUSDT && currentPrices.SOLUSDT.current > 0) {
                    allData.unshift({
                        date: todayStr,
                        high_price: currentPrices.SOLUSDT.high || currentPrices.SOLUSDT.current,
                        low_price: currentPrices.SOLUSDT.low || currentPrices.SOLUSDT.current,
                        price: currentPrices.SOLUSDT.current,
                        symbol: 'SOLUSDT'
                    });
                }
                
                if (allData.length > 0) {
                    tbody.innerHTML = allData.slice(0, 10).map((record, index) => {
                        // ê°€ê²© í¬ë§· í•¨ìˆ˜
                        const formatPriceSimple = (price) => {
                            if (price === null || price === undefined || price === '') return '-';
                            const num = parseFloat(price);
                            if (isNaN(num)) return '-';
                            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        };
                        
                        const dateObj = new Date(record.date + 'T00:00:00');
                        const month = dateObj.getMonth() + 1;
                        const day = dateObj.getDate();
                        const dateStr = `${month}.${day}`;
                        
                        // ì˜¤ëŠ˜ ë°ì´í„°ëŠ” ê°•ì¡°
                        const isToday = record.date === todayStr;
                        const rowStyle = isToday ? 'background: #1a1a1a;' : '';
                        
                        // ì „ì¼ ëŒ€ë¹„ ë³€í™”ìœ¨ ê³„ì‚°
                        let changePercent = '';
                        if (index < allData.length - 1) {
                            const prevPrice = allData[index + 1].price;
                            if (prevPrice && prevPrice > 0) {
                                const change = ((record.price - prevPrice) / prevPrice * 100);
                                const changeColor = change >= 0 ? '#4caf50' : '#f44336';
                                const changeSymbol = change >= 0 ? '+' : '';
                                changePercent = ` <span style="color: ${changeColor}; font-size: 0.8em;">${changeSymbol}${change.toFixed(2)}%</span>`;
                            }
                        }
                        
                        return `
                        <tr style="border-bottom: 1px solid #222; ${rowStyle}">
                            <td style="padding: 8px; color: ${isToday ? '#00FFA3' : '#888'};">
                                ${isToday ? 'ì˜¤ëŠ˜' : dateStr}
                            </td>
                            <td style="padding: 8px; text-align: right; color: #fff;">$${formatPriceSimple(record.high_price)}</td>
                            <td style="padding: 8px; text-align: right; color: #fff;">$${formatPriceSimple(record.low_price)}</td>
                            <td style="padding: 8px; text-align: right; color: #fff;">
                                $${formatPriceSimple(record.price || record.close_price)}${changePercent}
                            </td>
                        </tr>`;
                    }).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #666;">ë°ì´í„°ë¥¼ ìˆ˜ì§‘ ì¤‘ì…ë‹ˆë‹¤...<br><small>ì ì‹œ í›„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</small></td></tr>';
                }
            } catch (error) {
                console.error('SOL ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                const tbody = document.getElementById('sol-history-tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #f44336;">ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜<br><small>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”</small></td></tr>';
                }
            }
        }
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        // ë‚˜ìŠ¤ë‹¥ ì§€ìˆ˜ ê°€ì ¸ì˜¤ê¸° (Yahoo Finance API ëŒ€ì²´)
        async function fetchNasdaqData() {
            try {
                // Alpha Vantage ë¬´ë£Œ API ì‚¬ìš© (ì¼ì¼ ì œí•œ ìˆìŒ)
                // ë˜ëŠ” ë‹¤ë¥¸ ë°©ë²•: finnhub.io, twelvedata.com ë“±
                
                // ê°„ë‹¨í•œ ëŒ€ì²´ ë°©ë²•: ê³ ì •ê°’ í‘œì‹œ ë˜ëŠ” ì™¸ë¶€ API
                // ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œë¡œ ê³ ì •ê°’ í‘œì‹œ
                const nasdaqElement = document.getElementById('nasdaq-price');
                const changeElement = document.getElementById('nasdaq-change');
                const percentElement = document.getElementById('nasdaq-percent');
                
                // ì‹¤ì‹œê°„ APIê°€ í•„ìš”í•˜ë©´ ë‚˜ì¤‘ì— ì¶”ê°€ ê°€ëŠ¥
                // ì˜ˆì‹œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” APIë¥¼ í†µí•´ ê°€ì ¸ì™€ì•¼ í•¨)
                if (nasdaqElement) {
                    // ëœë¤ ë³€ë™ ì‹œë®¬ë ˆì´ì…˜ (ì„ì‹œ)
                    const basePrice = 20000;
                    const variation = Math.random() * 200 - 100;
                    const currentPrice = basePrice + variation;
                    const change = variation;
                    const changePercent = (variation / basePrice * 100);
                    
                    nasdaqElement.innerHTML = formatPrice(currentPrice.toFixed(2));
                    nasdaqElement.classList.remove('loading');
                    
                    if (changeElement && percentElement) {
                        changeElement.innerHTML = `${change >= 0 ? '+' : ''}${change.toFixed(2)}`;
                        changeElement.style.color = change >= 0 ? '#4caf50' : '#f44336';
                        
                        percentElement.innerHTML = `${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%`;
                        percentElement.style.color = changePercent >= 0 ? '#4caf50' : '#f44336';
                    }
                }
            } catch (error) {
                console.error('NASDAQ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                const nasdaqElement = document.getElementById('nasdaq-price');
                if (nasdaqElement) {
                    nasdaqElement.innerHTML = 'N/A';
                    nasdaqElement.classList.remove('loading');
                }
            }
        }
        
        // ì±„íŒ… ê¸°ëŠ¥
        let chatChannel = null;
        
        // ë¸Œë¼ìš°ì € fingerprint ìƒì„±
        function getBrowserFingerprint() {
            let storedId = localStorage.getItem('persistent_browser_id');
            
            if (storedId) {
                console.log('ê¸°ì¡´ Browser ID ì‚¬ìš©:', storedId);
                return storedId;
            }
            
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('fingerprint', 2, 2);
                
                const dataURL = canvas.toDataURL();
                const hash = btoa(dataURL).slice(0, 20);
                
                const newId = `browser_${Date.now()}_${hash}_${Math.random().toString(36).slice(2, 11)}`;
                localStorage.setItem('persistent_browser_id', newId);
                console.log('ìƒˆ Browser ID ìƒì„±:', newId);
                
                return newId;
            } catch (e) {
                const fallbackId = `fallback_${Date.now()}_${Math.random().toString(36).slice(2, 11)}`;
                localStorage.setItem('persistent_browser_id', fallbackId);
                console.log('Fallback Browser ID ìƒì„±:', fallbackId);
                return fallbackId;
            }
        }
        
        // ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ ì´ë™
        function scrollToBottom() {
            const container = document.getElementById('chat-container');
            if (container) {
                container.scrollTop = container.scrollHeight;
            }
        }
        
        // ì½”ì¸ ì•„ë°”íƒ€ ê´€ë ¨
        const coinAvatars = [
            { id: 'btc', name: 'Bitcoin', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/btc.png', color: '#f7931a' },
            { id: 'eth', name: 'Ethereum', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/eth.png', color: '#627eea' },
            { id: 'bnb', name: 'BNB', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/bnb.png', color: '#f3ba2f' },
            { id: 'xrp', name: 'XRP', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/xrp.png', color: '#23292f' },
            { id: 'ada', name: 'Cardano', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/ada.png', color: '#0033ad' },
            { id: 'sol', name: 'Solana', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/sol.png', color: '#00FFA3' },
            { id: 'dot', name: 'Polkadot', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/dot.png', color: '#e6007a' },
            { id: 'matic', name: 'Polygon', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/matic.png', color: '#8b5cf6' },
            { id: 'avax', name: 'Avalanche', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/avax.png', color: '#e84142' },
            { id: 'link', name: 'Chainlink', image: 'https://cdn.jsdelivr.net/gh/Pymmdrza/Cryptocurrency_Logos@mainx/PNG/link.png', color: '#375bd2' }
        ];
        
        const userAvatarMap = {};
        const usedAvatarIndices = new Set();
        
        function getCoinAvatar(userId) {
            if (!userId || userId === 'undefined' || userId === 'null') {
                return coinAvatars[0];
            }
            
            if (userAvatarMap[userId]) {
                return userAvatarMap[userId];
            }
            
            let avatarIndex;
            
            if (usedAvatarIndices.size < coinAvatars.length) {
                for (let i = 0; i < coinAvatars.length; i++) {
                    if (!usedAvatarIndices.has(i)) {
                        avatarIndex = i;
                        break;
                    }
                }
            } else {
                let hashNum = 0;
                for (let i = 0; i < Math.min(userId.length, 10); i++) {
                    hashNum += userId.charCodeAt(i) * (i + 1);
                }
                avatarIndex = hashNum % coinAvatars.length;
            }
            
            if (avatarIndex === undefined || avatarIndex < 0 || avatarIndex >= coinAvatars.length) {
                avatarIndex = 0;
            }
            
            const avatar = coinAvatars[avatarIndex];
            userAvatarMap[userId] = avatar;
            usedAvatarIndices.add(avatarIndex);
            
            try {
                const savedMappings = JSON.parse(localStorage.getItem('userCoinAvatars') || '{}');
                savedMappings[userId] = avatarIndex;
                localStorage.setItem('userCoinAvatars', JSON.stringify(savedMappings));
            } catch (e) {
                console.error('ì•„ë°”íƒ€ ë§µí•‘ ì €ì¥ ì‹¤íŒ¨:', e);
            }
            
            return avatar;
        }
        
        // ì•„ë°”íƒ€ ë§µí•‘ ì €ì¥
        function saveAvatarMappings() {
            try {
                const mappingData = {
                    userMap: {},
                    usedIndices: Array.from(usedAvatarIndices)
                };
                
                // userAvatarMapì—ì„œ ì•„ë°”íƒ€ ì¸ë±ìŠ¤ë§Œ ì €ì¥
                for (const [userId, avatar] of Object.entries(userAvatarMap)) {
                    const index = coinAvatars.findIndex(a => a.id === avatar.id);
                    if (index !== -1) {
                        mappingData.userMap[userId] = index;
                    }
                }
                
                localStorage.setItem('chatAvatarMappings', JSON.stringify(mappingData));
            } catch (e) {
                console.error('ì•„ë°”íƒ€ ë§µí•‘ ì €ì¥ ì‹¤íŒ¨:', e);
            }
        }
        
        function loadSavedAvatarMappings() {
            try {
                const saved = localStorage.getItem('chatAvatarMappings');
                if (saved) {
                    const data = JSON.parse(saved);
                    
                    // ì‚¬ìš©ìë³„ ì•„ë°”íƒ€ ë³µì›
                    for (const [userId, avatarIndex] of Object.entries(data.userMap)) {
                        if (avatarIndex < coinAvatars.length) {
                            userAvatarMap[userId] = coinAvatars[avatarIndex];
                            usedAvatarIndices.add(avatarIndex);
                        }
                    }
                }
                console.log('ì½”ì¸ ì•„ë°”íƒ€ ë§µí•‘ ë³µì›:', Object.keys(userAvatarMap).length, 'ëª…');
            } catch (e) {
                console.error('ì•„ë°”íƒ€ ë§µí•‘ ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }
        
        // ë©”ì‹œì§€ ìš”ì†Œ ìƒì„± (ì¹´ì¹´ì˜¤í†¡ ìŠ¤íƒ€ì¼)
        function createMessageElement(message) {
            const time = new Date(message.created_at).toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            // í˜„ì¬ ë¸Œë¼ìš°ì €ì˜ fingerprintì™€ ë¹„êµ
            const currentBrowserId = getBrowserFingerprint();
            const isMyMessage = message.browser_id === currentBrowserId || 
                               message.browser_id === localStorage.getItem('chat_browser_id');
            
            // ë¸Œë¼ìš°ì € ID ì €ì¥ (ì¼ê´€ì„± ìœ ì§€)
            if (isMyMessage && message.browser_id) {
                localStorage.setItem('chat_browser_id', message.browser_id);
            }
            
            // ë””ë°”ì´ìŠ¤ ì •ë³´ í‘œì‹œ
            let deviceInfo = '';
            if (message.device_info || message.location) {
                const parts = [];
                if (message.device_info) {
                    parts.push(message.device_info);
                }
                if (message.location && message.location !== 'Unknown') {
                    parts.push(message.location);
                }
                if (parts.length > 0) {
                    deviceInfo = parts.join(' Â· ');
                }
            }
            
            // ì‚¬ìš©ìì˜ ì½”ì¸ ì•„ë°”íƒ€ ê°€ì ¸ì˜¤ê¸° (browser_id ê¸°ë°˜)
            const userIdentifier = message.browser_id || message.ip_hash || `user_${message.id}`;
            const coinAvatar = getCoinAvatar(userIdentifier);
            
            if (isMyMessage) {
                // ë‚´ ë©”ì‹œì§€ (ì¢Œì¸¡ ì •ë ¬ë¡œ ë³€ê²½) - ì „ì²´ ë„ˆë¹„ ì‚¬ìš©
                return `
                    <div data-message-id="${message.id}" style="
                        display: flex;
                        margin-bottom: 10px;
                        width: 100%;
                    ">
                        <div style="
                            width: 36px;
                            height: 36px;
                            border-radius: 50%;
                            margin-right: 8px;
                            background: ${coinAvatar.color || '#fff'};
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            overflow: hidden;
                            position: relative;
                            flex-shrink: 0;
                        ">
                            <img src="${coinAvatar.image}"
                                style="
                                    width: 100%;
                                    height: 100%;
                                    object-fit: contain;
                                    padding: 4px;
                                "
                                alt="${coinAvatar.name}"
                                onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNDUiIGZpbGw9IiNmN2EwMGMiLz48dGV4dCB4PSI1MCIgeT0iNjUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI0MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7CpzwvdGV4dD48L3N2Zz4='">
                        </div>
                        <div style="
                            flex-grow: 1;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            min-width: 0;
                            width: calc(100% - 44px);
                        ">
                            <div class="message-bubble" style="
                                background: #1a1a1a;
                                color: #ffffff;
                                padding: 8px 12px;
                                border-radius: 15px;
                                border-top-left-radius: 4px;
                                font-size: 14px;
                                line-height: 1.4;
                                word-wrap: break-word;
                                border: 1px solid #000;
                                flex-grow: 1;
                                min-width: 0;
                            ">
                                ${escapeHtml(message.message)}
                            </div>
                            <span class="message-time" style="color: #666; font-size: 11px; flex-shrink: 0; width: 45px;">
                                ${time}
                            </span>
                        </div>
                    </div>
                `;
            } else {
                // ë‹¤ë¥¸ ì‚¬ëŒ ë©”ì‹œì§€ (ì™¼ìª½ ì •ë ¬)
                return `
                    <div data-message-id="${message.id}" style="
                        display: flex;
                        margin-bottom: 10px;
                        width: 100%;
                    ">
                        <div style="
                            width: 36px;
                            height: 36px;
                            border-radius: 50%;
                            margin-right: 8px;
                            background: ${coinAvatar.color || '#fff'};
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            overflow: hidden;
                            position: relative;
                            flex-shrink: 0;
                        ">
                            <img src="${coinAvatar.image}"
                                style="
                                    width: 100%;
                                    height: 100%;
                                    object-fit: contain;
                                    padding: 4px;
                                "
                                alt="${coinAvatar.name}"
                                onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNDUiIGZpbGw9IiNmN2EwMGMiLz48dGV4dCB4PSI1MCIgeT0iNjUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1saXplPSI0MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7CpzwvdGV4dD48L3N2Zz4='">
                        </div>
                        <div style="
                            flex-grow: 1;
                            display: flex;
                            flex-direction: column;
                            gap: 2px;
                            min-width: 0;
                            width: calc(100% - 44px);
                        ">
                            ${deviceInfo ? `<div style="color: #888; font-size: 11px; margin-left: 5px;">${deviceInfo}</div>` : ''}
                            <div style="display: flex; align-items: center; gap: 8px; width: 100%;">
                                <div class="message-bubble" style="
                                    background: #000;
                                    color: #ffffff;
                                    padding: 8px 12px;
                                    border-radius: 15px;
                                    border-top-left-radius: 4px;
                                    font-size: 14px;
                                    line-height: 1.4;
                                    word-wrap: break-word;
                                    border: 1px solid #000;
                                    flex-grow: 1;
                                    min-width: 0;
                                ">
                                    ${escapeHtml(message.message)}
                                </div>
                                <span class="message-time" style="color: #666; font-size: 11px; flex-shrink: 0; width: 45px;">
                                    ${time}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        
        // ì±„íŒ… ë©”ì‹œì§€ ë¡œë“œ
        async function loadChatMessages() {
            try {
                console.log('ì±„íŒ… ë©”ì‹œì§€ ë¡œë“œ ì‹œì‘...');
                
                if (!window.supabaseClient) {
                if (window.APP_CONFIG && window.APP_CONFIG.SUPABASE) {
                    window.supabaseClient = window.supabase.createClient(
                        window.APP_CONFIG.SUPABASE.URL,
                        window.APP_CONFIG.SUPABASE.ANON_KEY
                    );
                } else {
                    console.error('Configuration not loaded');
                    return;
                }
            }
                
                const { data, error } = await window.supabaseClient
                    .from('messages')
                    .select('*')
                    .order('created_at', { ascending: true })
                    .limit(100);
                
                if (error) {
                    console.error('ì±„íŒ… ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
                    const messagesContainer = document.getElementById('chat-messages');
                    if (messagesContainer) {
                        messagesContainer.innerHTML = `<div style="color: #f44; padding: 10px;">ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
                    }
                    return;
                }
                
                console.log('ë¡œë“œëœ ë©”ì‹œì§€:', data);
                const messagesContainer = document.getElementById('chat-messages');
                if (messagesContainer) {
                    if (data && data.length > 0) {
                        messagesContainer.innerHTML = data.map(msg => createMessageElement(msg)).join('');
                    } else {
                        messagesContainer.innerHTML = '<div style="color: #666; text-align: center; padding: 10px;">ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”!</div>';
                    }
                    scrollToBottom();
                }
            } catch (error) {
                console.error('ì±„íŒ… ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                const messagesContainer = document.getElementById('chat-messages');
                if (messagesContainer) {
                    messagesContainer.innerHTML = `<div style="color: #f44; padding: 10px;">ì˜¤ë¥˜ ë°œìƒ: ${error.message}</div>`;
                }
            }
        }
        
        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            console.log('sendMessage í•¨ìˆ˜ ì‹œì‘');
            
            const input = document.getElementById('chat-input');
            const sendButton = document.getElementById('chat-send');
            
            if (!input || !input.value.trim()) {
                console.log('ì…ë ¥ê°’ì´ ë¹„ì–´ìˆìŒ');
                return;
            }
            
            if (!window.supabaseClient) {
                console.error('Supabase client not initialized');
                alert('ì±„íŒ… ì„œë¹„ìŠ¤ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const message = input.value.trim();
            console.log('ì „ì†¡í•  ë©”ì‹œì§€:', message);
            
            if (sendButton) {
                sendButton.disabled = true;
                sendButton.style.opacity = '0.5';
            }
            
            try {
                const browserId = getBrowserFingerprint();
                console.log('ë©”ì‹œì§€ ì „ì†¡ì‹œ Browser ID:', browserId);
                
                const { data, error } = await window.supabaseClient
                    .from('messages')
                    .insert([{ 
                        message: message,
                        browser_id: browserId
                    }])
                    .select();
                
                console.log('Supabase ì‘ë‹µ:', { data, error });
                
                if (error) {
                    console.error('ì „ì†¡ ì—ëŸ¬ ìƒì„¸:', error);
                    
                    console.log('browser_id ì—†ì´ ì¬ì‹œë„');
                    const { data: retryData, error: retryError } = await window.supabaseClient
                        .from('messages')
                        .insert([{ message: message }])
                        .select();
                    
                    if (retryError) {
                        console.error('ì¬ì‹œë„ë„ ì‹¤íŒ¨:', retryError);
                        alert(`ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨\nì—ëŸ¬: ${retryError.message}\n\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.`);
                    } else {
                        console.log('ì¬ì‹œë„ ì„±ê³µ:', retryData);
                        input.value = '';
                        await loadChatMessages();
                    }
                } else {
                    console.log('ì „ì†¡ ì„±ê³µ:', data);
                    input.value = '';
                    await loadChatMessages();
                }
                
            } catch (error) {
                console.error('ì˜ˆì™¸ ë°œìƒ:', error);
                alert('ë©”ì‹œì§€ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                if (sendButton) {
                    sendButton.disabled = false;
                    sendButton.style.opacity = '1';
                }
            }
        }
        
        // ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì •
        function subscribeToChatUpdates() {
            console.log('ì±„íŒ… ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘');
            
            if (!window.supabaseClient) {
                if (window.APP_CONFIG && window.APP_CONFIG.SUPABASE) {
                    window.supabaseClient = window.supabase.createClient(
                        window.APP_CONFIG.SUPABASE.URL,
                        window.APP_CONFIG.SUPABASE.ANON_KEY
                    );
                } else {
                    console.error('Configuration not loaded');
                    return;
                }
            }
            
            if (chatChannel) {
                chatChannel.unsubscribe();
            }
            
            chatChannel = window.supabaseClient
                .channel('chat-channel-' + Date.now())
                .on('postgres_changes', 
                    { event: 'INSERT', schema: 'public', table: 'messages' },
                    (payload) => {
                        console.log('ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹ :', payload);
                        const messagesContainer = document.getElementById('chat-messages');
                        if (messagesContainer && payload.new) {
                            const existingMessage = document.querySelector(`[data-message-id="${payload.new.id}"]`);
                            if (!existingMessage) {
                                messagesContainer.innerHTML += createMessageElement(payload.new);
                                scrollToBottom();
                            }
                            
                            const messages = messagesContainer.children;
                            while (messages.length > 100) {
                                messages[0].remove();
                            }
                        }
                    }
                )
                .subscribe((status) => {
                    console.log('ì±„íŒ… êµ¬ë… ìƒíƒœ:', status);
                });
        
            setInterval(async () => {
                await loadChatMessages();
            }, 20000);
        }
        
        // ì±„íŒ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupChatListeners() {
            console.log('ì±„íŒ… ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘');
            
            const input = document.getElementById('chat-input');
            const button = document.getElementById('chat-send');
            
            if (input) {
                console.log('ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ì„¤ì •');
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.keyCode === 13) {
                        console.log('Enter í‚¤ ê°ì§€');
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
            
            if (button) {
                console.log('ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì •');
                
                button.onclick = null;
                
                button.addEventListener('click', (e) => {
                    console.log('ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸');
                    e.preventDefault();
                    e.stopPropagation();
                    sendMessage();
                });
                
                button.addEventListener('touchend', (e) => {
                    console.log('ë²„íŠ¼ í„°ì¹˜ ì´ë²¤íŠ¸');
                    e.preventDefault();
                    e.stopPropagation();
                    sendMessage();
                });
            }
        }
        
        // ìˆœì°¨ì  í˜ì´ì§€ ë¡œë”© ì‹œìŠ¤í…œ
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ === ìˆœì°¨ì  í˜ì´ì§€ ë¡œë”© ì‹œì‘ ===');
            
            try {
                // ì•„ë°”íƒ€ ë§µí•‘ ë³µì›
                loadSavedAvatarMappings();
                
                // 1ë‹¨ê³„: Supabase ë°ì´í„° ìš°ì„  ë¡œë“œ
                console.log('ğŸ“Š 1ë‹¨ê³„: Supabase ë°ì´í„° ë¡œë”©...');
                await loadSupabaseDataFirst();
                
                // 2ë‹¨ê³„: ì‹œê³„ ì‹œì‘
                console.log('ğŸ• 2ë‹¨ê³„: ì‹œê³„ ì‹œìŠ¤í…œ ì‹œì‘...');
                startClockSystem();
                
                // 3ë‹¨ê³„: ì½”ì¸ ë°ì´í„° ë¡œë“œ
                console.log('ğŸ’° 3ë‹¨ê³„: ì½”ì¸ ë°ì´í„° ë¡œë”©...');
                startCryptoSystem();
                
                // 4ë‹¨ê³„: ê°€ê²© ê¸°ë¡ ë¡œë“œ
                console.log('ğŸ“ˆ 4ë‹¨ê³„: ê°€ê²© ê¸°ë¡ ë¡œë”©...');
                loadHistoryData();
                
                // 5ë‹¨ê³„: ì±„íŒ… ì‹œìŠ¤í…œ ì´ˆê¸°í™” (ë¹„í™œì„±í™”ë¨ - chat-popup.htmlë¡œ ì´ë™)
                console.log('ğŸ’¬ 5ë‹¨ê³„: ì±„íŒ… ì‹œìŠ¤í…œ ìŠ¤í‚µ (íŒì—…ìœ¼ë¡œ ì´ë™ë¨)...');
                // loadChatMessages();
                // setupChatListeners();
                // subscribeToChatUpdates();
                
                console.log('âœ… === ëª¨ë“  ì‹œìŠ¤í…œ ë¡œë”© ì™„ë£Œ ===');
                
            } catch (error) {
                console.error('âŒ í˜ì´ì§€ ë¡œë”© ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒì‹œ ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ í´ë°±
                fallbackLoading();
            }
        });
        
        // 1ë‹¨ê³„: Supabase ë°ì´í„° ìš°ì„  ë¡œë“œ
        async function loadSupabaseDataFirst() {
            console.log('ğŸ—„ï¸ Supabase ë°ì´í„° ìš°ì„  ë¡œë”© ì‹œì‘...');
            
            // Section 3 ë§í¬ ë°ì´í„° ë¡œë“œ
            await loadLinksFromSupabase();
            
            // ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì •
            setupRealtimeSubscription();
            
            // ìë™ìœ¼ë¡œ GPT ë§í¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            setTimeout(() => {
                console.log('ğŸ” ìë™ GPT ë§í¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰...');
                testGptLinksAbove();
            }, 2000);
            
            console.log('âœ… Supabase ë°ì´í„° ë¡œë”© ì™„ë£Œ');
        }
        
        // 2ë‹¨ê³„: ì‹œê³„ ì‹œìŠ¤í…œ ì‹œì‘
        function startClockSystem() {
            console.log('ğŸ• ì‹œê³„ ì‹œìŠ¤í…œ ì‹œì‘...');
            
            // ì‹œê³„ ì—…ë°ì´íŠ¸ ì‹œì‘
            updateLastUpdate();
            
            // 1ì´ˆë§ˆë‹¤ ì‹œê³„ ì—…ë°ì´íŠ¸
            setInterval(updateLastUpdate, 1000);
            
            console.log('âœ… ì‹œê³„ ì‹œìŠ¤í…œ ì‹œì‘ ì™„ë£Œ');
        }
        
        // 3ë‹¨ê³„: ì½”ì¸ ë°ì´í„° ì‹œìŠ¤í…œ ì‹œì‘
        function startCryptoSystem() {
            console.log('ğŸ’° ì½”ì¸ ë°ì´í„° ì‹œìŠ¤í…œ ì‹œì‘...');
            
            // Binance WebSocket ì—°ê²°
            connectBinance();
            
            console.log('âœ… ì½”ì¸ ë°ì´í„° ì‹œìŠ¤í…œ ì‹œì‘ ì™„ë£Œ');
        }
        
        // 4ë‹¨ê³„: ê°€ê²© ê¸°ë¡ ë°ì´í„° ë¡œë“œ
        function loadHistoryData() {
            console.log('ğŸ“ˆ ê°€ê²© ê¸°ë¡ ë°ì´í„° ë¡œë”©...');
            
            // ê°€ê²© ê¸°ë¡ í‘œì‹œëŠ” ë³„ë„ í˜ì´ì§€ë¡œ ì´ë™ (price-history.html)
            // loadBTCHistory(); // BTC ê°€ê²© ê¸°ë¡ ë¡œë“œ
            // loadETHHistory(); // ETH ê°€ê²© ê¸°ë¡ ë¡œë“œ
            // loadSOLHistory(); // SOL ê°€ê²© ê¸°ë¡ ë¡œë“œ
            
            // ë‚˜ìŠ¤ë‹¥ ë°ì´í„° ë¡œë“œ
            fetchNasdaqData();
            
            // ì •ê¸° ì—…ë°ì´íŠ¸ ì„¤ì •
            setInterval(fetchNasdaqData, 60000); // 1ë¶„ë§ˆë‹¤ ë‚˜ìŠ¤ë‹¥ ì—…ë°ì´íŠ¸
            
            // í˜„ì¬ ê°€ê²© ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë°”ë¡œ ì €ì¥
            setTimeout(() => {
                savePriceHistory();
            }, 5000); // 5ì´ˆ í›„ ì²« ì €ì¥
            
            console.log('âœ… ê°€ê²© ê¸°ë¡ ë°ì´í„° ë¡œë”© ì™„ë£Œ');
            
            // ì±„íŒ… ê¸°ëŠ¥ ì´ˆê¸°í™” (ë¹„í™œì„±í™”ë¨ - chat-popup.htmlë¡œ ì´ë™)
            // loadChatMessages();
            // setupChatListeners();
            // subscribeToChatUpdates();
        }
        
        // ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì •
        function setupRealtimeSubscription() {
            setTimeout(() => {
                if (database) {
                    console.log('ğŸ”„ Firebase ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì¤‘...');
                    
                    // ë§í¬ ë°ì´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
                    database.ref('links').on('value', (snapshot) => {
                        console.log('ë§í¬ ë°ì´í„° ì—…ë°ì´íŠ¸ ê°ì§€');
                        loadLinksFromSupabase(); // ë³€ê²½ì‚¬í•­ ë°œìƒì‹œ ìë™ ìƒˆë¡œê³ ì¹¨
                    });
                    
                    // ê°€ê²© ê¸°ë¡ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
                    database.ref('price_history').on('child_added', (snapshot) => {
                        const data = snapshot.val();
                        console.log('ê°€ê²© ê¸°ë¡ ì—…ë°ì´íŠ¸ ê°ì§€:', data);
                        if (data.symbol === 'BTCUSDT') loadBTCHistory();
                        if (data.symbol === 'ETHUSDT') loadETHHistory();
                        if (data.symbol === 'SOLUSDT') loadSOLHistory();
                    });
                    
                    console.log('âœ… Firebase ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì™„ë£Œ');
                } else {
                    console.log('âš ï¸ Firebase ì‹¤ì‹œê°„ êµ¬ë… ê±´ë„ˆëœ€ (database ì—†ìŒ)');
                }
            }, 2000);
        }
        
        // GPT ë§í¬ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ (ì œëª© ìœ„ ì˜ì—­)
        async function testGptLinksAbove() {
            const testArea = document.getElementById('gpt-test-area');
            if (!testArea) {
                console.error('âŒ gpt-test-area ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            testArea.innerHTML = '<div style="color: #4facfe;">ğŸ” GPT ë§í¬ í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            // ìƒì„¸ ë””ë²„ê¹… ì •ë³´
            console.log('ğŸ” === GPT ë§í¬ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            console.log('Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬:', typeof window.supabase);
            console.log('Supabase í´ë¼ì´ì–¸íŠ¸:', typeof window.supabaseClient);
            console.log('í…ŒìŠ¤íŠ¸ ì˜ì—­ ìš”ì†Œ:', testArea);
            
            try {
                // Supabase í´ë¼ì´ì–¸íŠ¸ í™•ì¸
                if (!window.supabaseClient) {
                    const errorMsg = 'âŒ Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤';
                    testArea.innerHTML = `<div style="color: #f44336;">${errorMsg}</div>`;
                    console.error(errorMsg);
                    
                    // ì„¤ì •ì—ì„œ ì´ˆê¸°í™” ì‹œë„
                    try {
                        if (window.APP_CONFIG && window.APP_CONFIG.SUPABASE) {
                            const SUPABASE_URL = window.APP_CONFIG.SUPABASE.URL;
                            const SUPABASE_KEY = window.APP_CONFIG.SUPABASE.ANON_KEY;
                            
                            if (window.supabase && SUPABASE_URL && SUPABASE_KEY) {
                                window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                                testArea.innerHTML += '<div style="color: #fbbf24;">âš ï¸ ì„¤ì •ì—ì„œ ì´ˆê¸°í™” ì‹œë„ ì¤‘...</div>';
                                console.log('âœ… ì„¤ì •ì—ì„œ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±');
                            } else {
                                testArea.innerHTML += '<div style="color: #f44336;">âŒ Supabase ì„¤ì •ì´ ì—†ê±°ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                                return;
                            }
                        } else {
                            testArea.innerHTML += '<div style="color: #f44336;">âŒ APP_CONFIGê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>';
                            return;
                        }
                    } catch (initError) {
                        console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', initError);
                        testArea.innerHTML += `<div style="color: #f44336;">âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ${initError.message}</div>`;
                        return;
                    }
                }
                
                // Firebaseì—ì„œ GPT ë§í¬ ì¡°íšŒ
                try {
                    const snapshot = await database.ref('links')
                        .orderByChild('category')
                        .equalTo('gpt')
                        .once('value');
                    
                    const gptLinks = [];
                    snapshot.forEach((childSnapshot) => {
                        gptLinks.push(childSnapshot.val());
                    });
                    
                    // position ìˆœìœ¼ë¡œ ì •ë ¬
                    gptLinks.sort((a, b) => (a.position || 0) - (b.position || 0));
                
                    console.log('ğŸ” í…ŒìŠ¤íŠ¸ ì˜ì—­ GPT ë§í¬:', gptLinks);
                    
                    if (!gptLinks || gptLinks.length === 0) {
                        testArea.innerHTML = '<div style="color: #fbbf24;">âš ï¸ GPT ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                        return;
                    }
                } catch (error) {
                    testArea.innerHTML = `<div style="color: #f44336;">âŒ Firebase ì¡°íšŒ ì˜¤ë¥˜: ${error.message}</div>`;
                    return;
                }
                
                // ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì˜¨ ê²½ìš° ê°„ë‹¨íˆ í‘œì‹œ
                let html = `<div style="color: #4caf50; margin-bottom: 10px;">âœ… GPT ë§í¬ ${gptLinks.length}ê°œ ë°œê²¬!</div>`;
                
                gptLinks.forEach((link, index) => {
                    html += `
                        <div style="background: #2a2a2a; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #000;">
                            <a href="${link.url || '#'}" target="_blank" style="color: #4facfe; text-decoration: none; font-weight: bold;">
                                ${index + 1}. ${link.name || 'ì´ë¦„ ì—†ìŒ'}
                            </a>
                            <div style="color: #888; font-size: 11px; margin-top: 5px;">
                                ID: ${link.id}, Position: ${link.position}
                            </div>
                        </div>
                    `;
                });
                
                testArea.innerHTML = html;
                
            } catch (error) {
                testArea.innerHTML = `<div style="color: #f44336;">âŒ ì˜ˆì™¸ ë°œìƒ: ${error.message}</div>`;
                console.error('GPT ë§í¬ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        }
        
        // í´ë°± ë¡œë”© (ì˜¤ë¥˜ì‹œ ê¸°ì¡´ ë°©ì‹)
        function fallbackLoading() {
            console.log('ğŸ”„ í´ë°± ë¡œë”© ì‹œì‘...');
            
            // ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ëª¨ë“  ê²ƒì„ ë™ì‹œì— ë¡œë“œ
            setTimeout(() => {
                loadLinksFromSupabase();
            }, 1000);
            
            // ê°€ê²© ê¸°ë¡ì€ ë³„ë„ í˜ì´ì§€ë¡œ ì´ë™ (price-history.html)
            // loadBTCHistory();
            // loadETHHistory();
            // loadSOLHistory();
            
            fetchNasdaqData();
            
            // connectBinance(); // DISABLED - Using TradingView Widget
            updateCryptoPrices(); // Binance APIë¡œ ê°€ê²© ì—…ë°ì´íŠ¸
            
            setInterval(fetchNasdaqData, 60000);
            setInterval(updateCryptoPrices, 5000); // 5ì´ˆë§ˆë‹¤ ê°€ê²© ì—…ë°ì´íŠ¸
            
            setTimeout(() => {
                savePriceHistory();
            }, 5000);
            
            setupRealtimeSubscription();
        }
        
        // TradingView í…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¡œë¶€í„° ê°€ê²© ë°ì´í„° ìˆ˜ì‹ 
        window.addEventListener('message', function(event) {
            if (event.data.type === 'TRADINGVIEW_PRICE_UPDATE') {
                console.log('ğŸ“ˆ TradingViewì—ì„œ ê°€ê²© ë°ì´í„° ìˆ˜ì‹ :', event.data.data);
                
                // ë°›ì€ ê°€ê²© ë°ì´í„°ë¡œ ë©”ì¸ í˜ì´ì§€ ì—…ë°ì´íŠ¸
                updateMainPagePrices(event.data.data);
                
                // ì•Œë¦¼ í‘œì‹œ
                showPriceUpdateNotification();
            }
        });
        
        // ë©”ì¸ í˜ì´ì§€ ê°€ê²© ì—…ë°ì´íŠ¸
        function updateMainPagePrices(tradingViewData) {
            Object.keys(tradingViewData).forEach(symbol => {
                const data = tradingViewData[symbol];
                const price = data.price;
                
                // ì‹¬ë³¼ì— ë”°ë¼ í•´ë‹¹ ìš”ì†Œ ì—…ë°ì´íŠ¸
                if (symbol === 'BTCUSDT') {
                    const btcElement = document.getElementById('binance-btc');
                    if (btcElement) {
                        btcElement.innerHTML = formatPrice(price);
                        btcElement.style.color = data.change >= 0 ? '#4caf50' : '#f44336';
                    }
                } else if (symbol === 'ETHUSDT') {
                    const ethElement = document.getElementById('binance-eth');
                    if (ethElement) {
                        ethElement.innerHTML = formatPrice(price);
                        ethElement.style.color = data.change >= 0 ? '#4caf50' : '#f44336';
                    }
                } else if (symbol === 'SOLUSDT') {
                    const solElement = document.getElementById('binance-sol');
                    if (solElement) {
                        solElement.innerHTML = formatPrice(price);
                        solElement.style.color = data.change >= 0 ? '#4caf50' : '#f44336';
                    }
                } else if (symbol === 'XRPUSDT') {
                    const xrpElement = document.getElementById('binance-xrp');
                    if (xrpElement) {
                        xrpElement.innerHTML = formatPrice(price);
                        xrpElement.style.color = data.change >= 0 ? '#4caf50' : '#f44336';
                    }
                }
            });
        }
        
        // ê°€ê²© ì—…ë°ì´íŠ¸ ì•Œë¦¼ í‘œì‹œ
        function showPriceUpdateNotification() {
            // ì„ì‹œ ì•Œë¦¼ í‘œì‹œ
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4facfe;
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                font-weight: bold;
                z-index: 10000;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
            `;
            notification.textContent = 'ğŸ“ˆ TradingView ê°€ê²© ë°ì´í„° ì—…ë°ì´íŠ¸ë¨!';
            
            document.body.appendChild(notification);
            
            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // 5ë¶„ë§ˆë‹¤ YouTube ë¼ì´ë¸Œ ìƒíƒœ ì¬í™•ì¸
        setInterval(() => {
            checkYouTubeLiveStatus();
        }, 300000);

        // ì—°ê²° ìƒíƒœ ì²´í¬ (30ì´ˆë§ˆë‹¤)
        setInterval(() => {
            if (binanceBtcWs && binanceBtcWs.readyState !== WebSocket.OPEN) {
                // connectBinance(); // DISABLED - Using TradingView Widget
            }
        }, 30000);
        
        // Binance APIë¡œ ê°€ê²© ì—…ë°ì´íŠ¸
        async function updateCryptoPrices() {
            try {
                // BTC, ETH, SOL ê°€ê²© ê°€ì ¸ì˜¤ê¸°
                const symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT'];
                const promises = symbols.map(symbol => 
                    fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`)
                        .then(res => res.json())
                );
                
                const results = await Promise.all(promises);
                
                results.forEach((data, index) => {
                    const symbol = symbols[index];
                    const price = parseFloat(data.lastPrice);
                    const priceChange = parseFloat(data.priceChange);
                    const priceChangePercent = parseFloat(data.priceChangePercent);
                    const highPrice = parseFloat(data.highPrice);
                    const lowPrice = parseFloat(data.lowPrice);
                    
                    // ê°€ê²© í¬ë§· í•¨ìˆ˜
                    const formatPrice = (price, coinSymbol) => {
                        const parts = price.toFixed(2).split('.');
                        const integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                        let color = '#000';
                        if (!bwMode) {
                            if (coinSymbol === 'BTCUSDT') color = '#f7931a';
                            else if (coinSymbol === 'ETHUSDT') color = '#627eea';
                            else if (coinSymbol === 'SOLUSDT') color = '#00ffa3';
                        } else {
                            color = '#ffffff';
                        }
                        return `<span style="color: ${color};">$</span>${integerPart}<span style="color: ${color}; font-size: 0.7em;">.${parts[1]}</span>`;
                    };
                    
                    // DOM ì—…ë°ì´íŠ¸
                    let priceElementId, changeElementId;
                    if (symbol === 'BTCUSDT') {
                        priceElementId = 'btc-price-custom';
                        changeElementId = 'btc-change-custom';
                        // currentPrices ì—…ë°ì´íŠ¸
                        currentPrices.BTCUSDT = {
                            current: price,
                            high: highPrice,
                            low: lowPrice
                        };
                    } else if (symbol === 'ETHUSDT') {
                        priceElementId = 'eth-price-custom';
                        changeElementId = 'eth-change-custom';
                        currentPrices.ETHUSDT = {
                            current: price,
                            high: highPrice,
                            low: lowPrice
                        };
                    } else if (symbol === 'SOLUSDT') {
                        priceElementId = 'sol-price-custom';
                        changeElementId = 'sol-change-custom';
                        currentPrices.SOLUSDT = {
                            current: price,
                            high: highPrice,
                            low: lowPrice
                        };
                    }
                    
                    const priceElement = document.getElementById(priceElementId);
                    const changeElement = document.getElementById(changeElementId);
                    
                    if (priceElement) {
                        priceElement.innerHTML = formatPrice(price, symbol);
                    }
                    
                    if (changeElement) {
                        const changeSymbol = priceChange >= 0 ? '+' : '';
                        changeElement.innerHTML = `${changeSymbol}${priceChangePercent.toFixed(2)}%`;
                        
                        // Check BW mode first
                        if (bwMode) {
                            changeElement.style.color = '#000000';
                        } else {
                            const changeColor = priceChange >= 0 ? '#4caf50' : '#f44336';
                            changeElement.style.color = changeColor;
                            
                            // Apply black color if already past 10 seconds
                            const now = Date.now();
                            const pageLoadTime = window.pageLoadTime || now;
                            if (now - pageLoadTime > 10000) {
                                changeElement.style.color = '#000000';
                            }
                        }
                    }
                });
                
            } catch (error) {
                console.error('ê°€ê²© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        // ë§¤ì¼ ìì • ë°ì´í„° ìˆ˜ì§‘ ì²´í¬
        async function checkAndCollectDailyData() {
            const lastFetch = localStorage.getItem('lastDailyPriceFetch');
            const today = new Date().toISOString().split('T')[0];
            
            if (lastFetch !== today) {
                console.log('ì˜¤ëŠ˜ ì¼ì¼ ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘...');
                
                const symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT'];
                
                for (const symbol of symbols) {
                    try {
                        // 24ì‹œê°„ í†µê³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                        const response = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
                        const data = await response.json();
                        
                        // ì–´ì œ ë‚ ì§œë¡œ ì €ì¥ (24ì‹œê°„ ë°ì´í„°ì´ë¯€ë¡œ)
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        const yesterdayStr = yesterday.toISOString().split('T')[0];
                        
                        // Firebaseì— ì¼ì¼ ë°ì´í„° ì €ì¥
                        const key = `${symbol}_${yesterdayStr}`;
                        await database.ref(`price_history/${key}`).set({
                            symbol: symbol,
                            date: yesterdayStr,
                            high_price: parseFloat(data.highPrice),
                            low_price: parseFloat(data.lowPrice),
                            price: parseFloat(data.lastPrice),
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString(),
                            updatedAt: firebase.database.ServerValue.TIMESTAMP
                        });
                        
                        console.log(`${symbol} ì¼ì¼ ë°ì´í„° ì €ì¥ ì™„ë£Œ`);
                    } catch (error) {
                        console.error(`${symbol} ì¼ì¼ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:`, error);
                    }
                }
                
                localStorage.setItem('lastDailyPriceFetch', today);
                console.log('ì¼ì¼ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ');
            }
        }

        // ê°€ê²© ê¸°ë¡ ì €ì¥ í•¨ìˆ˜ (5ë¶„ë§ˆë‹¤ ìë™ ì‹¤í–‰)
        async function savePriceHistory() {
            const today = new Date().toISOString().split('T')[0];
            console.log('ê°€ê²© ê¸°ë¡ ìë™ ì €ì¥:', today, currentPrices);
            
            // BTC ì €ì¥
            if (currentPrices.BTCUSDT && currentPrices.BTCUSDT.current > 0) {
                console.log('BTC ê°€ê²© ì €ì¥:', currentPrices.BTCUSDT);
                await saveToSupabase('BTCUSDT', today,
                    currentPrices.BTCUSDT.high,
                    currentPrices.BTCUSDT.low,
                    currentPrices.BTCUSDT.current);
            }

            // ETH ì €ì¥
            if (currentPrices.ETHUSDT && currentPrices.ETHUSDT.current > 0) {
                console.log('ETH ê°€ê²© ì €ì¥:', currentPrices.ETHUSDT);
                await saveToSupabase('ETHUSDT', today,
                    currentPrices.ETHUSDT.high,
                    currentPrices.ETHUSDT.low,
                    currentPrices.ETHUSDT.current);
            }
            
            // SOL ì €ì¥
            if (currentPrices.SOLUSDT && currentPrices.SOLUSDT.current > 0) {
                console.log('SOL ê°€ê²© ì €ì¥:', currentPrices.SOLUSDT);
                await saveToSupabase('SOLUSDT', today,
                    currentPrices.SOLUSDT.high,
                    currentPrices.SOLUSDT.low,
                    currentPrices.SOLUSDT.current);
            }
            
            console.log('ê°€ê²© ê¸°ë¡ ìë™ ì €ì¥ ì™„ë£Œ:', today);
        }
        
        // 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
        setInterval(savePriceHistory, 300000);

        // ì´ˆê¸° ì‹¤í–‰ (20ì´ˆ í›„ - WebSocket ì—°ê²° í›„)
        setTimeout(savePriceHistory, 20000);
        
        // ê°€ê²© ê¸°ë¡ í…Œì´ë¸”ì€ ë³„ë„ í˜ì´ì§€ë¡œ ì´ë™ (price-history.html)
        // setInterval(() => {
        //     loadBTCHistory();
        //     loadETHHistory();
        //     loadSOLHistory();
        // }, 60000); // 1ë¶„ë§ˆë‹¤

        // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        async function refreshPriceHistory() {
            console.log('ê°€ê²© ê¸°ë¡ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');

            // í˜„ì¬ ê°€ê²© ì¦‰ì‹œ ì €ì¥
            await savePriceHistory();

            // ë³„ë„ í˜ì´ì§€ë¡œ ì´ë™í–ˆìœ¼ë¯€ë¡œ ì£¼ì„ ì²˜ë¦¬
            // setTimeout(() => {
            //     loadBTCHistory();
            //     loadETHHistory();
            //     loadSOLHistory();
            // }, 1000);
        }

        // ì „ì—­ ìŠ¤ì½”í”„ì— ë…¸ì¶œ
        window.refreshPriceHistory = refreshPriceHistory;
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ“Š í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘...');
            
            // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
            setTimeout(async () => {
                // ì¼ì¼ ë°ì´í„° ìˆ˜ì§‘ ì²´í¬
                if (database) {
                    await checkAndCollectDailyData();
                    
                    // ëˆ„ë½ëœ ë°ì´í„° ìë™ ì±„ìš°ê¸° (ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)
                    autoFillMissingData();
                }
            }, 2000);
        });
        
        // ëˆ„ë½ëœ ë°ì´í„° ìë™ ì±„ìš°ê¸°
        async function autoFillMissingData() {
            console.log('[ìë™ ì±„ìš°ê¸°] ëˆ„ë½ëœ ë°ì´í„° í™•ì¸ ì¤‘...');
            
            try {
                // Firebaseì—ì„œ ê¸°ì¡´ ë°ì´í„° í™•ì¸
                const snapshot = await database.ref('prices').once('value');
                const existingData = snapshot.val() || {};
                const existingDates = new Set(Object.keys(existingData));
                
                // ìµœê·¼ 30ì¼ í™•ì¸
                const today = new Date();
                const missingDates = [];
                
                for (let i = 1; i <= 30; i++) {
                    const date = new Date(Date.UTC(
                        today.getUTCFullYear(),
                        today.getUTCMonth(),
                        today.getUTCDate() - i
                    ));
                    const dateStr = date.toISOString().split('T')[0];
                    
                    if (!existingDates.has(dateStr)) {
                        missingDates.push({ dateStr, date });
                    }
                }
                
                if (missingDates.length > 0) {
                    console.log(`[ìë™ ì±„ìš°ê¸°] ${missingDates.length}ê°œì˜ ëˆ„ë½ëœ ë‚ ì§œ ë°œê²¬`);
                    
                    // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„° ìˆ˜ì§‘ (UIë¥¼ ì°¨ë‹¨í•˜ì§€ ì•ŠìŒ)
                    for (const dateInfo of missingDates) {
                        setTimeout(async () => {
                            await collectHistoricalDataForDate(dateInfo.date);
                        }, 1000);
                        
                        // API ì œí•œ ë°©ì§€ë¥¼ ìœ„í•œ ì§€ì—°
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    console.log('[ìë™ ì±„ìš°ê¸°] ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„° ìˆ˜ì§‘ ì§„í–‰ ì¤‘...');
                } else {
                    console.log('[ìë™ ì±„ìš°ê¸°] ëª¨ë“  ë°ì´í„°ê°€ ì™„ë²½í•©ë‹ˆë‹¤!');
                }
            } catch (error) {
                console.error('[ìë™ ì±„ìš°ê¸°] ì˜¤ë¥˜:', error);
            }
        }
        
        // íŠ¹ì • ë‚ ì§œì˜ ê³¼ê±° ë°ì´í„° ìˆ˜ì§‘
        async function collectHistoricalDataForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            const startTime = date.getTime();
            const endTime = startTime + (24 * 60 * 60 * 1000) - 1;
            
            try {
                const dayData = {
                    date: dateStr,
                    collected_at: new Date().toISOString()
                };
                
                const symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT'];
                
                for (const symbol of symbols) {
                    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${startTime}&endTime=${endTime}&limit=1`;
                    
                    try {
                        const response = await fetch(url);
                        
                        if (response.ok) {
                            const klines = await response.json();
                            if (klines.length > 0) {
                                const kline = klines[0];
                                const prefix = symbol.replace('USDT', '').toLowerCase();
                                
                                dayData[prefix] = parseFloat(kline[4]); // ì¢…ê°€
                                dayData[`${prefix}_high`] = parseFloat(kline[2]); // ê³ ê°€
                                dayData[`${prefix}_low`] = parseFloat(kline[3]); // ì €ê°€
                            }
                        }
                    } catch (fetchError) {
                        console.error(`[ìë™ ì±„ìš°ê¸°] ${symbol} ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:`, fetchError);
                    }
                    
                    // API ì œí•œ ë°©ì§€
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // Firebaseì— ì €ì¥
                if (dayData.btc || dayData.eth || dayData.sol) {
                    await database.ref(`prices/${dateStr}`).set(dayData);
                    console.log(`[ìë™ ì±„ìš°ê¸°] âœ… ${dateStr} ë°ì´í„° ì €ì¥ ì™„ë£Œ`);
                }
                
            } catch (error) {
                console.error(`[ìë™ ì±„ìš°ê¸°] ${dateStr} ìˆ˜ì§‘ ì‹¤íŒ¨:`, error);
            }
        }
        
        // ë§¤ì‹œê°„ë§ˆë‹¤ ì¼ì¼ ë°ì´í„° ì²´í¬ (ìì •ì„ ë†“ì¹  ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
        setInterval(() => {
            const now = new Date();
            if (now.getMinutes() === 0) { // ì •ê°ë§ˆë‹¤ ì²´í¬
                checkAndCollectDailyData();
            }
        }, 60000); // 1ë¶„ë§ˆë‹¤ ì²´í¬
    </script>
    
    
    
    <!-- Navigation Buttons Container -->
    <div class="nav-buttons-container" style="
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        flex-direction: row;
        gap: 10px;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.95);
        padding: 8px 16px;
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid #000;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    ">
        <!-- í™ˆ ë²„íŠ¼ -->
        <a href="index.html" class="nav-btn" title="í™ˆ">
            <span style="font-size: 20px;">ğŸ </span>
        </a>
        
        <!-- ì°¨íŠ¸ ë²„íŠ¼ -->
        <a href="triple-chart.html" class="nav-btn" title="ì°¨íŠ¸">
            <span style="font-size: 20px;">ğŸ“Š</span>
        </a>
        
        <!-- ë§í¬ ëª¨ìŒ ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©) -->
        <a href="links.html" class="nav-btn" title="ë§í¬">
            <span style="font-size: 20px;">ğŸ”—</span>
        </a>
        
        <!-- ì±„íŒ… ë²„íŠ¼ -->
        <button onclick="openChatPopup()" class="nav-btn" title="ì±„íŒ…">
            <span style="font-size: 20px;">ğŸ’¬</span>
        </button>
        
        <!-- ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©) -->
        <a href="supabase-links.html" class="nav-btn" title="ì¦ê²¨ì°¾ê¸°">
            <span style="font-size: 20px;">â­</span>
        </a>
        
        <!-- ì„¸ê³„ì‹œê³„ ë²„íŠ¼ -->
        <a href="world-clock.html" class="nav-btn" title="ì„¸ê³„ì‹œê³„">
            <span style="font-size: 20px;">ğŸ•</span>
        </a>
        
        <!-- ê°€ê²© ê¸°ë¡ ë²„íŠ¼ -->
        <a href="price-history.html" class="nav-btn" title="ê°€ê²© ê¸°ë¡">
            <span style="font-size: 20px;">ğŸ“ˆ</span>
        </a>
        
        <!-- ê´€ë¦¬ì ì„¤ì • ë²„íŠ¼ -->
        <a href="admin-v3.html" class="nav-btn" title="ì„¤ì •">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
            </svg>
        </a>
    </div>
    
    <style>
        /* Unified Navigation Buttons Style */
        .nav-btn {
            width: 45px;
            height: 45px;
            background: transparent;
            border: none;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            text-decoration: none;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: scale(1.1);
        }
        
        .nav-btn:active {
            transform: scale(0.95);
        }
        
        /* Current page indicator */
        .nav-btn.active {
            color: #f7931a;
            background: rgba(247, 147, 26, 0.1);
        }
        
        /* Tooltip for navigation buttons */
        .nav-btn::after {
            content: attr(title);
            position: absolute;
            bottom: 55px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 26, 26, 0.95);
            color: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            border: 1px solid #000;
        }
        
        .nav-btn:hover::after {
            opacity: 1;
        }
        
        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            .nav-buttons-container {
                bottom: 10px !important;
                padding: 6px 12px !important;
                gap: 5px !important;
            }
            
            .nav-btn {
                width: 40px;
                height: 40px;
            }
            
            .nav-btn span {
                font-size: 18px !important;
            }
            
            .nav-btn svg {
                width: 18px !important;
                height: 18px !important;
            }
        }
        
        .settings-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
            transform: rotate(90deg);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }
        
        .settings-btn svg {
            width: 24px;
            height: 24px;
        }
        
        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            .settings-btn {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
            }
            
            .settings-btn svg {
                width: 20px;
                height: 20px;
            }
        }
    </style>
    
    <!-- Firebase SDK (ê°€ê²© ê¸°ë¡ìš©) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
        // Firebase ì„¤ì • (ê°€ê²© ê¸°ë¡ ì „ìš©)
        const firebaseConfig = {
            apiKey: "AIzaSyA6zB_snzOh_e5tG6_-uK64g6dwL5pzU4c",
            authDomain: "crypto-monitor-84bdb.firebaseapp.com",
            databaseURL: "https://crypto-monitor-84bdb-default-rtdb.firebaseio.com",
            projectId: "crypto-monitor-84bdb",
            storageBucket: "crypto-monitor-84bdb.firebasestorage.app",
            messagingSenderId: "146592267275",
            appId: "1:146592267275:web:916c54658889be5dab9b0e",
            measurementId: "G-TTGCF3YWWJ"
        };
        
        // Firebase ì´ˆê¸°í™”
        let firebaseApp;
        let firebaseDatabase;
        try {
            if (!firebase.apps.length) {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                firebaseDatabase = firebase.database();
                console.log('ğŸ”¥ Firebase ê°€ê²© ê¸°ë¡ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
            }
        } catch (error) {
            console.error('Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        }
        
        // Firebaseì— ê°€ê²© ì €ì¥ í•¨ìˆ˜
        async function saveToFirebase(symbol, date, high, low, close) {
            if (!firebaseDatabase) {
                console.error('Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }
            
            try {
                const priceData = {
                    symbol: symbol,
                    date: date,
                    high_price: high,
                    low_price: low,
                    price: close,
                    updated_at: new Date().toISOString()
                };
                
                // Firebaseì— ì €ì¥ (ë‚ ì§œë¥¼ í‚¤ë¡œ ì‚¬ìš©)
                await firebaseDatabase.ref(`prices/${date}/${symbol}`).set(priceData);
                console.log(`âœ… Firebase ì €ì¥ ì™„ë£Œ: ${symbol} - ${date}`);
            } catch (error) {
                console.error(`Firebase ì €ì¥ ì‹¤íŒ¨ ${symbol}:`, error);
            }
        }
        
        // ê¸°ì¡´ savePriceHistory í•¨ìˆ˜ ìˆ˜ì •
        const originalSavePriceHistory = savePriceHistory;
        savePriceHistory = async function() {
            const today = new Date().toISOString().split('T')[0];
            console.log('ê°€ê²© ê¸°ë¡ ìë™ ì €ì¥ (Firebase):', today, currentPrices);
            
            // BTC ì €ì¥
            if (currentPrices.BTCUSDT && currentPrices.BTCUSDT.current > 0) {
                console.log('BTC ê°€ê²© ì €ì¥:', currentPrices.BTCUSDT);
                await saveToFirebase('BTCUSDT', today,
                    currentPrices.BTCUSDT.high || currentPrices.BTCUSDT.current,
                    currentPrices.BTCUSDT.low || currentPrices.BTCUSDT.current,
                    currentPrices.BTCUSDT.current);
            }
            
            // ETH ì €ì¥
            if (currentPrices.ETHUSDT && currentPrices.ETHUSDT.current > 0) {
                console.log('ETH ê°€ê²© ì €ì¥:', currentPrices.ETHUSDT);
                await saveToFirebase('ETHUSDT', today,
                    currentPrices.ETHUSDT.high || currentPrices.ETHUSDT.current,
                    currentPrices.ETHUSDT.low || currentPrices.ETHUSDT.current,
                    currentPrices.ETHUSDT.current);
            }
            
            // SOL ì €ì¥
            if (currentPrices.SOLUSDT && currentPrices.SOLUSDT.current > 0) {
                console.log('SOL ê°€ê²© ì €ì¥:', currentPrices.SOLUSDT);
                await saveToFirebase('SOLUSDT', today,
                    currentPrices.SOLUSDT.high || currentPrices.SOLUSDT.current,
                    currentPrices.SOLUSDT.low || currentPrices.SOLUSDT.current,
                    currentPrices.SOLUSDT.current);
            }
            
            console.log('ê°€ê²© ê¸°ë¡ Firebase ì €ì¥ ì™„ë£Œ:', today);
        }
    </script>
    
    <!-- Hidden footer -->
    <footer style="position: fixed; bottom: 10px; right: 10px; opacity: 0.3; font-size: 12px;">
        <a href="bw-mode.html" style="color: #333; text-decoration: none;">made by euo</a>
    </footer>
</body>
</html>