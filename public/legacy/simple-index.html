<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ ì¼ì • - ê°„ë‹¨í•œ ë²„ì „</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #121212;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .status {
            padding: 20px;
            background: #1e1e1e;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .error {
            border-color: #f44336;
            color: #f44336;
        }

        .success {
            border-color: #4caf50;
            color: #4caf50;
        }

        .info {
            border-color: #2196f3;
            color: #2196f3;
        }

        .schedule-item {
            background: #1e1e1e;
            border: 1px solid #333;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .schedule-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .schedule-meta {
            color: #999;
            font-size: 0.9rem;
        }

        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #1976d2;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #333;
            border-top-color: #2196f3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ë‚˜ì˜ ì¼ì •</h1>
            <p>ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ë²„ì „</p>
        </div>

        <div id="status" class="status info">
            í˜ì´ì§€ ì´ˆê¸°í™” ì¤‘...
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>ë°ì´í„° ë¡œë”© ì¤‘...</p>
        </div>

        <div id="schedules" style="display: none;">
            <!-- ì¼ì •ì´ ì—¬ê¸°ì— í‘œì‹œë¨ -->
        </div>

        <div style="margin-top: 20px;">
            <button onclick="location.href='/'">ì›ë˜ í˜ì´ì§€ë¡œ</button>
            <button onclick="testLoad()">ìˆ˜ë™ìœ¼ë¡œ ë¡œë“œ</button>
            <button onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        console.log('Script starting...');
        
        const SUPABASE_URL = 'https://ddfnxbkiewolgweivomv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
        
        let supabase = null;

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            console.log(`Status: ${type} - ${message}`);
        }

        async function initializeApp() {
            console.log('Initializing app...');
            
            try {
                // 1. Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                updateStatus('Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œë¨', 'success');
                
                // 2. Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                updateStatus('Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±ë¨', 'success');
                
                // 3. ë°ì´í„° ë¡œë“œ
                await loadSchedules();
                
            } catch (error) {
                console.error('Initialization error:', error);
                updateStatus(`ì˜¤ë¥˜: ${error.message}`, 'error');
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function loadSchedules() {
            console.log('Loading schedules...');
            updateStatus('ì¼ì • ë°ì´í„° ë¡œë“œ ì¤‘...', 'info');
            
            try {
                const { data, error } = await supabase
                    .from('schedules')
                    .select('*')
                    .order('event_date', { ascending: true });
                
                if (error) {
                    throw error;
                }
                
                console.log(`Loaded ${data.length} schedules`);
                displaySchedules(data);
                
            } catch (error) {
                console.error('Load error:', error);
                updateStatus(`ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displaySchedules(schedules) {
            console.log('Displaying schedules...');
            document.getElementById('loading').style.display = 'none';
            
            const container = document.getElementById('schedules');
            container.style.display = 'block';
            
            if (schedules.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                updateStatus('ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤', 'info');
                return;
            }
            
            updateStatus(`${schedules.length}ê°œ ì¼ì • í‘œì‹œ ì¤‘`, 'success');
            
            container.innerHTML = schedules.map(schedule => {
                const date = new Date(schedule.event_date).toLocaleDateString('ko-KR');
                return `
                    <div class="schedule-item">
                        <h3 class="schedule-title">${schedule.title}</h3>
                        <div class="schedule-meta">
                            <p>ğŸ“… ${date} ${schedule.event_time || ''}</p>
                            ${schedule.location ? `<p>ğŸ“ ${schedule.location}</p>` : ''}
                            ${schedule.description ? `<p>ğŸ“ ${schedule.description}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function testLoad() {
            console.log('Manual load triggered');
            initializeApp();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, starting initialization...');
            initializeApp();
        });

        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Global error:', msg, error);
            updateStatus(`JavaScript ì˜¤ë¥˜: ${msg}`, 'error');
            return false;
        };
    </script>
</body>
</html>