<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BW Calculator - ì •ê·œí™” ê°€ê²© ë¹„êµ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000000;
            color: #ffffff;
            font-family: 'Monaco', 'Consolas', 'Courier New', monospace;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-x: auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #4caf50;
        }
        
        .header p {
            font-size: 14px;
            color: #888;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .section {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
        }
        
        .section-title {
            font-size: 18px;
            color: #4caf50;
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        
        .price-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .coin-data {
            background: #151515;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        
        .coin-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .btc-color { color: #f7931a; }
        .eth-color { color: #9a8ff8; }
        .sol-color { color: #00FFA3; }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .price-value {
            font-family: 'Monaco', 'Consolas', monospace;
            font-weight: bold;
        }
        
        .calculation-section {
            background: #0f0f0f;
            border: 2px solid #4caf50;
        }
        
        .ratio-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .ratio-card {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .baseline-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #888;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .baseline-btn:hover {
            background: #2a2a2a;
            color: #fff;
            border-color: #555;
        }
        
        .baseline-btn.active {
            background: #4caf50;
            color: #000;
            border-color: #4caf50;
            font-weight: bold;
        }
        
        /* ë¹„êµ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: #0a0a0a;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #333;
        }
        
        .comparison-table th {
            background: #1a1a1a;
            color: #4caf50;
            font-weight: bold;
            font-size: 14px;
        }
        
        .comparison-table td {
            color: #e0e0e0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .coin-cell {
            font-weight: bold;
        }
        
        .btc-cell { color: #f7931a; }
        .eth-cell { color: #9a8ff8; }
        .sol-cell { color: #00FFA3; }
        
        .eth-ratio { border-left-color: #9a8ff8; }
        .sol-ratio { border-left-color: #00FFA3; }
        
        .normalized-prices {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #666;
        }
        
        .normalized-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            text-align: center;
        }
        
        .normalized-item {
            padding: 10px;
            background: #1a1a1a;
            border-radius: 6px;
        }
        
        .change-display {
            margin-top: 15px;
            padding: 15px;
            background: #0a0a0a;
            border-radius: 8px;
        }
        
        .change-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .positive { color: #4caf50; }
        .negative { color: #f44336; }
        .neutral { color: #888; }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .control-btn {
            background: transparent;
            border: 1px solid #333;
            color: #666;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .arbitrage-opportunity {
            background: #1a0a0a;
            border: 2px solid #ff9800;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
        }
        
        .opportunity-title {
            color: #ff9800;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button class="control-btn" onclick="toggleCalculation()">ğŸ”„</button>
        <button class="control-btn" onclick="resetBaseline()">âš¡</button>
    </div>

    <div class="header">
        <h1>BW Calculator - ì •ê·œí™” ê°€ê²© ë¹„êµ ì‹œìŠ¤í…œ</h1>
        <p>ë¹„íŠ¸ì½”ì¸ ê¸°ì¤€ ì •ê·œí™”ë¥¼ í†µí•œ ìƒëŒ€ì  ê°€ê²© ë¹„êµ ë° ì°¨ìµê±°ë˜ ê¸°íšŒ íƒì§€</p>
    </div>

    <div class="container">
        <!-- í˜„ì¬ ê°€ê²© í‘œì‹œ -->
        <div class="section">
            <div class="section-title">ğŸ“ˆ í˜„ì¬ ê°€ê²© ë°ì´í„°</div>
            <div class="price-display">
                <div class="coin-data">
                    <div class="coin-name btc-color">BTC (ê¸°ì¤€)</div>
                    <div class="price-row">
                        <span>í˜„ì¬ê°€:</span>
                        <span class="price-value" id="btc-price">------</span>
                    </div>
                    <div class="price-row">
                        <span>24h ë³€í™”:</span>
                        <span class="price-value" id="btc-change">------</span>
                    </div>
                </div>
                
                <div class="coin-data">
                    <div class="coin-name eth-color">ETH</div>
                    <div class="price-row">
                        <span>í˜„ì¬ê°€:</span>
                        <span class="price-value" id="eth-price">------</span>
                    </div>
                    <div class="price-row">
                        <span>24h ë³€í™”:</span>
                        <span class="price-value" id="eth-change">------</span>
                    </div>
                </div>
                
                <div class="coin-data">
                    <div class="coin-name sol-color">SOL</div>
                    <div class="price-row">
                        <span>í˜„ì¬ê°€:</span>
                        <span class="price-value" id="sol-price">------</span>
                    </div>
                    <div class="price-row">
                        <span>24h ë³€í™”:</span>
                        <span class="price-value" id="sol-change">------</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì •ê·œí™” ê³„ì‚° -->
        <div class="section calculation-section">
            <div class="section-title">ğŸ§® ì •ê·œí™” ë¹„ìœ¨ ê³„ì‚°</div>
            
            <!-- ê¸°ì¤€ì  ì„ íƒ -->
            <div style="margin-bottom: 20px; padding: 15px; background: #1a1a1a; border-radius: 8px;">
                <div style="margin-bottom: 10px; color: #888; font-size: 14px;">ì •ê·œí™” ê¸°ì¤€ì  ì„ íƒ:</div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="baseline-btn active" onclick="setBaselineMode('current')" id="current-btn">í˜„ì¬ê°€</button>
                    <button class="baseline-btn" onclick="setBaselineMode('24h-avg')" id="avg-btn">24h í‰ê· </button>
                    <button class="baseline-btn" onclick="setBaselineMode('24h-open')" id="open-btn">24h ì‹œê°€</button>
                    <button class="baseline-btn" onclick="setBaselineMode('24h-vwap')" id="vwap-btn">24h VWAP</button>
                    <button class="baseline-btn" onclick="setBaselineMode('manual')" id="manual-btn">ìˆ˜ë™ ì„¤ì •</button>
                </div>
                <div style="margin-top: 10px; color: #666; font-size: 12px;" id="baseline-desc">
                    í˜„ì¬ê°€: ì‹¤ì‹œê°„ ê°€ê²©ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ê·œí™” (ë³€ë™ì„± ë†’ìŒ, ì‹¤ì‹œê°„ ë°˜ì˜)
                </div>
            </div>
            
            <div class="ratio-display">
                <div class="ratio-card eth-ratio">
                    <div style="font-size: 14px; margin-bottom: 10px; color: #9a8ff8;">ETH â†’ BTC ì •ê·œí™”</div>
                    <div class="price-row">
                        <span>ê¸°ì¤€ ë¹„ìœ¨:</span>
                        <span id="eth-ratio">------</span>
                    </div>
                    <div class="price-row">
                        <span>ì •ê·œí™” ë°°ìˆ˜:</span>
                        <span id="eth-multiplier">------</span>
                    </div>
                </div>
                
                <div class="ratio-card sol-ratio">
                    <div style="font-size: 14px; margin-bottom: 10px; color: #00FFA3;">SOL â†’ BTC ì •ê·œí™”</div>
                    <div class="price-row">
                        <span>ê¸°ì¤€ ë¹„ìœ¨:</span>
                        <span id="sol-ratio">------</span>
                    </div>
                    <div class="price-row">
                        <span>ì •ê·œí™” ë°°ìˆ˜:</span>
                        <span id="sol-multiplier">------</span>
                    </div>
                </div>
            </div>

            <div class="normalized-prices">
                <div style="text-align: center; margin-bottom: 15px; font-size: 16px; color: #4caf50;">
                    ì •ê·œí™”ëœ ê°€ê²© (BTC ë²”ì£¼ë¡œ ì¡°ì •)
                </div>
                <div class="normalized-grid">
                    <div class="normalized-item">
                        <div style="color: #f7931a; margin-bottom: 5px;">BTC</div>
                        <div class="price-value" id="normalized-btc">------</div>
                    </div>
                    <div class="normalized-item">
                        <div style="color: #9a8ff8; margin-bottom: 5px;">ETH (Ã—<span id="eth-mult-display">--</span>)</div>
                        <div class="price-value" id="normalized-eth">------</div>
                    </div>
                    <div class="normalized-item">
                        <div style="color: #00FFA3; margin-bottom: 5px;">SOL (Ã—<span id="sol-mult-display">--</span>)</div>
                        <div class="price-value" id="normalized-sol">------</div>
                    </div>
                </div>
            </div>

            <div class="change-display">
                <div style="text-align: center; margin-bottom: 10px; font-size: 14px; color: #888;">
                    ì •ê·œí™”ëœ ê°€ê²© ë³€í™”ìœ¨ ë¹„êµ
                </div>
                <div class="change-row">
                    <span>BTC ë³€í™”:</span>
                    <span id="btc-norm-change" class="neutral">------</span>
                </div>
                <div class="change-row">
                    <span>ETH ë³€í™” (ì •ê·œí™”):</span>
                    <span id="eth-norm-change" class="neutral">------</span>
                </div>
                <div class="change-row">
                    <span>SOL ë³€í™” (ì •ê·œí™”):</span>
                    <span id="sol-norm-change" class="neutral">------</span>
                </div>
            </div>

            <!-- ì „ì¼ ìµœê³ ê°€ ëŒ€ë¹„ í˜„ì¬ê°€ ë¹„ìœ¨ -->
            <div class="change-display">
                <div style="text-align: center; margin-bottom: 10px; font-size: 14px; color: #888;">
                    24h ìµœê³ ê°€ ëŒ€ë¹„ í˜„ì¬ê°€ ë¹„ìœ¨ (ìµœê³ ê°€=100%)
                </div>
                <div class="change-row">
                    <span>BTC í˜„ì¬ ìœ„ì¹˜:</span>
                    <span id="btc-high-ratio" class="neutral">------</span>
                </div>
                <div class="change-row">
                    <span>ETH í˜„ì¬ ìœ„ì¹˜:</span>
                    <span id="eth-high-ratio" class="neutral">------</span>
                </div>
                <div class="change-row">
                    <span>SOL í˜„ì¬ ìœ„ì¹˜:</span>
                    <span id="sol-high-ratio" class="neutral">------</span>
                </div>
            </div>
            
            <!-- ë¹„êµ í…Œì´ë¸” -->
            <div style="margin-top: 20px;">
                <div style="text-align: center; margin-bottom: 15px; font-size: 16px; color: #4caf50;">
                    ì •ê·œí™”ëœ ê°€ê²© ë¹„êµ í…Œì´ë¸”
                </div>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ì½”ì¸ëª…</th>
                            <th>BTCê°€ê²© (A)</th>
                            <th>ì •ê·œí™”ê°€ê²© (B)</th>
                            <th>ì°¨ì•¡ (A-B)</th>
                            <th>ëŒ€ìƒì½”ì¸ìœ¼ë¡œ ë³€í™˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="coin-cell btc-cell">BTC</td>
                            <td id="table-btc-btc-price">------</td>
                            <td id="table-btc-normalized">------</td>
                            <td id="table-btc-diff-usd">ê¸°ì¤€</td>
                            <td id="table-btc-diff-coin">ê¸°ì¤€</td>
                        </tr>
                        <tr>
                            <td class="coin-cell eth-cell">ETH</td>
                            <td id="table-eth-btc-price">------</td>
                            <td id="table-eth-normalized">------</td>
                            <td id="table-eth-diff-usd">------</td>
                            <td id="table-eth-diff-coin">------</td>
                        </tr>
                        <tr>
                            <td class="coin-cell sol-cell">SOL</td>
                            <td id="table-sol-btc-price">------</td>
                            <td id="table-sol-normalized">------</td>
                            <td id="table-sol-diff-usd">------</td>
                            <td id="table-sol-diff-coin">------</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ì°¨ìµê±°ë˜ ê¸°íšŒ -->
        <div class="arbitrage-opportunity">
            <div class="opportunity-title">âš¡ ì°¨ìµê±°ë˜ ê¸°íšŒ ë¶„ì„</div>
            <div id="arbitrage-analysis">
                ì‹¤ì‹œê°„ ë°ì´í„° ë¶„ì„ ì¤‘...
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let baselinePrices = {};
        let currentPrices = {};
        let normalizationRatios = {};
        let isCalculating = true;
        let dailyHighPrices = {}; // 24ì‹œê°„ ìµœê³ ê°€ ì €ì¥
        let dailyLowPrices = {}; // 24ì‹œê°„ ìµœì €ê°€ ì €ì¥
        let dailyOpenPrices = {}; // 24ì‹œê°„ ì‹œê°€ ì €ì¥
        let dailyVolumes = {}; // 24ì‹œê°„ ê±°ë˜ëŸ‰ ì €ì¥
        let baselineMode = 'current'; // ê¸°ì¤€ì  ëª¨ë“œ

        // ê¸°ì¤€ì  ëª¨ë“œ ì„¤ì •
        function setBaselineMode(mode) {
            baselineMode = mode;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.baseline-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode + '-btn').classList.add('active');
            
            // ì„¤ëª… ì—…ë°ì´íŠ¸
            const descriptions = {
                'current': 'í˜„ì¬ê°€: ì‹¤ì‹œê°„ ê°€ê²©ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ê·œí™” (ë³€ë™ì„± ë†’ìŒ, ì‹¤ì‹œê°„ ë°˜ì˜)',
                '24h-avg': '24h í‰ê· : (ê³ ê°€+ì €ê°€)/2 ê¸°ì¤€ìœ¼ë¡œ ì •ê·œí™” (ì•ˆì •ì , ì¤‘ê°„ê°’ ë°˜ì˜)',
                '24h-open': '24h ì‹œê°€: ì˜¤ëŠ˜ ì‹œì‘ ê°€ê²© ê¸°ì¤€ìœ¼ë¡œ ì •ê·œí™” (ì¼ì¼ ì‹œì‘ì  ê¸°ì¤€)',
                '24h-vwap': '24h VWAP: ê±°ë˜ëŸ‰ ê°€ì¤‘ í‰ê·  ê°€ê²© ê¸°ì¤€ (ì‹¤ì œ ê±°ë˜ ë°˜ì˜)',
                'manual': 'ìˆ˜ë™ ì„¤ì •: ì‚¬ìš©ìê°€ ì§ì ‘ ê¸°ì¤€ì  ì„¤ì • (ê³ ì •ëœ ê¸°ì¤€ì )'
            };
            document.getElementById('baseline-desc').textContent = descriptions[mode];
            
            // ìƒˆë¡œìš´ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ ê³„ì‚°
            if (currentPrices.btc && currentPrices.eth && currentPrices.sol) {
                setBaseline();
            }
        }
        
        // ì´ˆê¸° ê¸°ì¤€ì  ì„¤ì •
        function setBaseline() {
            if (!currentPrices.btc || !currentPrices.eth || !currentPrices.sol) return;
            
            let basePrices = {};
            
            switch(baselineMode) {
                case 'current':
                    basePrices = { ...currentPrices };
                    break;
                case '24h-avg':
                    basePrices = {
                        btc: (dailyHighPrices.btc + dailyLowPrices.btc) / 2,
                        eth: (dailyHighPrices.eth + dailyLowPrices.eth) / 2,
                        sol: (dailyHighPrices.sol + dailyLowPrices.sol) / 2
                    };
                    break;
                case '24h-open':
                    basePrices = { ...dailyOpenPrices };
                    break;
                case '24h-vwap':
                    // ê°„ë‹¨í•œ VWAP ê·¼ì‚¬ì¹˜ (ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•œ ê³„ì‚° í•„ìš”)
                    basePrices = {
                        btc: (currentPrices.btc + dailyHighPrices.btc + dailyLowPrices.btc + dailyOpenPrices.btc) / 4,
                        eth: (currentPrices.eth + dailyHighPrices.eth + dailyLowPrices.eth + dailyOpenPrices.eth) / 4,
                        sol: (currentPrices.sol + dailyHighPrices.sol + dailyLowPrices.sol + dailyOpenPrices.sol) / 4
                    };
                    break;
                case 'manual':
                    // ìˆ˜ë™ ì„¤ì •ì˜ ê²½ìš° ê¸°ì¡´ baselinePrices ìœ ì§€
                    if (!baselinePrices.btc) {
                        basePrices = { ...currentPrices };
                    } else {
                        basePrices = { ...baselinePrices };
                    }
                    break;
            }
            
            baselinePrices = basePrices;
            
            // BTC ê¸°ì¤€ìœ¼ë¡œ ì •ê·œí™” ë¹„ìœ¨ ê³„ì‚°
            normalizationRatios.eth = baselinePrices.btc / baselinePrices.eth;
            normalizationRatios.sol = baselinePrices.btc / baselinePrices.sol;
            
            console.log(`Baseline set (${baselineMode}):`, baselinePrices);
            console.log('Normalization ratios:', normalizationRatios);
            
            updateRatioDisplay();
        }

        // ë¹„ìœ¨ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateRatioDisplay() {
            if (baselinePrices.btc && baselinePrices.eth && baselinePrices.sol) {
                document.getElementById('eth-ratio').textContent = 
                    `1 ETH = ${(baselinePrices.eth / baselinePrices.btc).toFixed(4)} BTC`;
                document.getElementById('eth-multiplier').textContent = 
                    `Ã—${normalizationRatios.eth.toFixed(2)}`;
                
                document.getElementById('sol-ratio').textContent = 
                    `1 SOL = ${(baselinePrices.sol / baselinePrices.btc).toFixed(6)} BTC`;
                document.getElementById('sol-multiplier').textContent = 
                    `Ã—${normalizationRatios.sol.toFixed(2)}`;
                
                document.getElementById('eth-mult-display').textContent = 
                    normalizationRatios.eth.toFixed(1);
                document.getElementById('sol-mult-display').textContent = 
                    normalizationRatios.sol.toFixed(1);
            }
        }

        // ì •ê·œí™”ëœ ê°€ê²© ê³„ì‚° ë° í‘œì‹œ
        function updateNormalizedPrices() {
            if (!normalizationRatios.eth || !normalizationRatios.sol) return;
            
            const normalizedETH = currentPrices.eth * normalizationRatios.eth;
            const normalizedSOL = currentPrices.sol * normalizationRatios.sol;
            
            // ì •ê·œí™”ëœ ê°€ê²© í‘œì‹œ
            document.getElementById('normalized-btc').textContent = formatPrice(currentPrices.btc);
            document.getElementById('normalized-eth').textContent = formatPrice(normalizedETH);
            document.getElementById('normalized-sol').textContent = formatPrice(normalizedSOL);
            
            // ë³€í™”ìœ¨ ê³„ì‚° (ê¸°ì¤€ì  ëŒ€ë¹„)
            if (baselinePrices.btc) {
                const btcChange = ((currentPrices.btc - baselinePrices.btc) / baselinePrices.btc) * 100;
                const ethNormChange = ((normalizedETH - baselinePrices.btc) / baselinePrices.btc) * 100;
                const solNormChange = ((normalizedSOL - baselinePrices.btc) / baselinePrices.btc) * 100;
                
                updateChangeDisplay('btc-norm-change', btcChange);
                updateChangeDisplay('eth-norm-change', ethNormChange);
                updateChangeDisplay('sol-norm-change', solNormChange);
                
                // ì°¨ìµê±°ë˜ ê¸°íšŒ ë¶„ì„
                analyzeArbitrageOpportunity(btcChange, ethNormChange, solNormChange);
            }
        }

        // ë³€í™”ìœ¨ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateChangeDisplay(elementId, change) {
            const element = document.getElementById(elementId);
            const changeStr = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
            element.textContent = changeStr;
            
            if (change > 0.5) {
                element.className = 'positive';
            } else if (change < -0.5) {
                element.className = 'negative';
            } else {
                element.className = 'neutral';
            }
        }

        // ì°¨ìµê±°ë˜ ê¸°íšŒ ë¶„ì„
        function analyzeArbitrageOpportunity(btcChange, ethChange, solChange) {
            const analysisDiv = document.getElementById('arbitrage-analysis');
            let analysis = '';
            
            const threshold = 1.0; // 1% ì´ìƒ ì°¨ì´
            
            // BTC vs ETH ë¹„êµ
            const btcEthDiff = Math.abs(btcChange - ethChange);
            if (btcEthDiff > threshold) {
                const stronger = btcChange > ethChange ? 'BTC' : 'ETH';
                const weaker = btcChange > ethChange ? 'ETH' : 'BTC';
                analysis += `ğŸ”¥ BTC-ETH ì°¨ìµê¸°íšŒ: ${stronger} ìƒìŠ¹ì„¸ ê°•í•¨ (ì°¨ì´: ${btcEthDiff.toFixed(2)}%)\n`;
            }
            
            // BTC vs SOL ë¹„êµ
            const btcSolDiff = Math.abs(btcChange - solChange);
            if (btcSolDiff > threshold) {
                const stronger = btcChange > solChange ? 'BTC' : 'SOL';
                const weaker = btcChange > solChange ? 'SOL' : 'BTC';
                analysis += `ğŸ”¥ BTC-SOL ì°¨ìµê¸°íšŒ: ${stronger} ìƒìŠ¹ì„¸ ê°•í•¨ (ì°¨ì´: ${btcSolDiff.toFixed(2)}%)\n`;
            }
            
            // ETH vs SOL ë¹„êµ
            const ethSolDiff = Math.abs(ethChange - solChange);
            if (ethSolDiff > threshold) {
                const stronger = ethChange > solChange ? 'ETH' : 'SOL';
                const weaker = ethChange > solChange ? 'SOL' : 'ETH';
                analysis += `ğŸ”¥ ETH-SOL ì°¨ìµê¸°íšŒ: ${stronger} ìƒìŠ¹ì„¸ ê°•í•¨ (ì°¨ì´: ${ethSolDiff.toFixed(2)}%)\n`;
            }
            
            if (analysis === '') {
                analysis = 'í˜„ì¬ ì°¨ìµê±°ë˜ ê¸°íšŒ ì—†ìŒ (ëª¨ë“  ì½”ì¸ì´ ìœ ì‚¬í•œ ì›€ì§ì„)';
            }
            
            analysisDiv.style.whiteSpace = 'pre-line';
            analysisDiv.textContent = analysis;
        }

        // 24ì‹œê°„ ìµœê³ ê°€ ëŒ€ë¹„ í˜„ì¬ê°€ ë¹„ìœ¨ ì—…ë°ì´íŠ¸
        function updateHighRatio(coinType, currentPrice, highPrice) {
            if (!currentPrice || !highPrice || highPrice === 0) return;
            
            const ratio = (currentPrice / highPrice) * 100;
            const elementId = `${coinType}-high-ratio`;
            const element = document.getElementById(elementId);
            
            if (element) {
                element.textContent = `${ratio.toFixed(1)}%`;
                
                // ìƒ‰ìƒ ì§€ì •: 90% ì´ìƒ = ë…¹ìƒ‰, 80% ì´ìƒ = ë…¸ë€ìƒ‰, ê·¸ ì™¸ = ë¹¨ê°„ìƒ‰
                if (ratio >= 90) {
                    element.className = 'positive';
                } else if (ratio >= 80) {
                    element.className = 'neutral';
                    element.style.color = '#ffa726'; // ì˜¤ë Œì§€ìƒ‰
                } else {
                    element.className = 'negative';
                }
            }
        }

        // ê°€ê²© í¬ë§·íŒ…
        function formatPrice(price) {
            if (price >= 1000) {
                return price.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            } else {
                return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }
        }

        // Binance WebSocket ì—°ê²°
        function connectWebSocket(symbol, priceId, changeId, coinType) {
            const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol.toLowerCase()}@ticker`);
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                const price = parseFloat(data.c);
                const change24h = parseFloat(data.P);
                const high24h = parseFloat(data.h); // 24ì‹œê°„ ìµœê³ ê°€
                const low24h = parseFloat(data.l); // 24ì‹œê°„ ìµœì €ê°€
                const open24h = parseFloat(data.o); // 24ì‹œê°„ ì‹œê°€
                const volume24h = parseFloat(data.v); // 24ì‹œê°„ ê±°ë˜ëŸ‰
                
                currentPrices[coinType] = price;
                dailyHighPrices[coinType] = high24h;
                dailyLowPrices[coinType] = low24h;
                dailyOpenPrices[coinType] = open24h;
                dailyVolumes[coinType] = volume24h;
                
                document.getElementById(priceId).textContent = formatPrice(price);
                document.getElementById(changeId).textContent = `${change24h >= 0 ? '+' : ''}${change24h.toFixed(2)}%`;
                document.getElementById(changeId).className = change24h >= 0 ? 'positive' : 'negative';
                
                // 24ì‹œê°„ ìµœê³ ê°€ ëŒ€ë¹„ í˜„ì¬ê°€ ë¹„ìœ¨ ê³„ì‚° ë° í‘œì‹œ
                updateHighRatio(coinType, price, high24h);
                
                // ê¸°ì¤€ì ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì„¤ì •
                if (!baselinePrices.btc && currentPrices.btc && currentPrices.eth && currentPrices.sol) {
                    setBaseline();
                }
                
                // ì •ê·œí™”ëœ ê°€ê²© ì—…ë°ì´íŠ¸
                if (isCalculating && normalizationRatios.eth && normalizationRatios.sol) {
                    updateNormalizedPrices();
                    updateComparisonTable();
                }
            };
            
            return ws;
        }

        // ì»¨íŠ¸ë¡¤ í•¨ìˆ˜ë“¤
        function toggleCalculation() {
            isCalculating = !isCalculating;
            console.log('Calculation mode:', isCalculating ? 'ON' : 'OFF');
        }

        function resetBaseline() {
            if (currentPrices.btc && currentPrices.eth && currentPrices.sol) {
                setBaseline();
                console.log('Baseline reset');
            }
        }

        // ë¹„êµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateComparisonTable() {
            if (!normalizationRatios.eth || !normalizationRatios.sol) return;
            
            const normalizedETH = currentPrices.eth * normalizationRatios.eth;
            const normalizedSOL = currentPrices.sol * normalizationRatios.sol;
            
            // BTC (ê¸°ì¤€)
            document.getElementById('table-btc-btc-price').textContent = '$' + formatPrice(currentPrices.btc);
            document.getElementById('table-btc-normalized').textContent = '$' + formatPrice(currentPrices.btc);
            document.getElementById('table-btc-diff-usd').textContent = 'ê¸°ì¤€';
            document.getElementById('table-btc-diff-coin').textContent = 'ê¸°ì¤€';
            
            // ETH ê³„ì‚°
            const ethDiffUSD = currentPrices.btc - normalizedETH; // BTCê°€ê²© - ETHì •ê·œí™”ê°€ê²©
            const ethDiffCoin = ethDiffUSD / currentPrices.eth; // USD ì°¨ì•¡ì„ ETHê°€ê²©ìœ¼ë¡œ ë‚˜ëˆ ì„œ ETH ìˆ˜ëŸ‰ìœ¼ë¡œ ë³€í™˜
            
            document.getElementById('table-eth-btc-price').textContent = '$' + formatPrice(currentPrices.btc);
            document.getElementById('table-eth-normalized').textContent = '$' + formatPrice(normalizedETH);
            document.getElementById('table-eth-diff-usd').innerHTML = formatUSDDifference(ethDiffUSD);
            document.getElementById('table-eth-diff-coin').innerHTML = formatCoinDifference(ethDiffCoin, 'ETH');
            
            // SOL ê³„ì‚°
            const solDiffUSD = currentPrices.btc - normalizedSOL; // BTCê°€ê²© - SOLì •ê·œí™”ê°€ê²©
            const solDiffCoin = solDiffUSD / currentPrices.sol; // USD ì°¨ì•¡ì„ SOLê°€ê²©ìœ¼ë¡œ ë‚˜ëˆ ì„œ SOL ìˆ˜ëŸ‰ìœ¼ë¡œ ë³€í™˜
            
            document.getElementById('table-sol-btc-price').textContent = '$' + formatPrice(currentPrices.btc);
            document.getElementById('table-sol-normalized').textContent = '$' + formatPrice(normalizedSOL);
            document.getElementById('table-sol-diff-usd').innerHTML = formatUSDDifference(solDiffUSD);
            document.getElementById('table-sol-diff-coin').innerHTML = formatCoinDifference(solDiffCoin, 'SOL');
        }
        
        // USD ì°¨ì•¡ í¬ë§·íŒ…
        function formatUSDDifference(diff) {
            const color = diff >= 0 ? '#4caf50' : '#f44336';
            const sign = diff >= 0 ? '+' : '';
            return `<span style="color: ${color}">${sign}$${Math.abs(diff).toFixed(2)}</span>`;
        }
        
        // ì½”ì¸ ìˆ˜ëŸ‰ ì°¨ì•¡ í¬ë§·íŒ…
        function formatCoinDifference(coinAmount, coinSymbol) {
            const color = coinAmount >= 0 ? '#4caf50' : '#f44336';
            const sign = coinAmount >= 0 ? '+' : '';
            const absAmount = Math.abs(coinAmount);
            
            // ì½”ì¸ ìˆ˜ëŸ‰ì— ë”°ë¥¸ ì†Œìˆ˜ì  ì¡°ì •
            let decimals = 4;
            if (absAmount >= 1) decimals = 2;
            if (absAmount >= 100) decimals = 1;
            if (absAmount >= 1000) decimals = 0;
            
            return `<span style="color: ${color}">${sign}${absAmount.toFixed(decimals)} ${coinSymbol}</span>`;
        }
        
        // ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            // WebSocket ì—°ê²°
            connectWebSocket('BTCUSDT', 'btc-price', 'btc-change', 'btc');
            connectWebSocket('ETHUSDT', 'eth-price', 'eth-change', 'eth');
            connectWebSocket('SOLUSDT', 'sol-price', 'sol-change', 'sol');
            
            console.log('BW Calculator initialized');
        });
    </script>
</body>
</html>