<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹ ë¥¸ ì¼ì • ì¶”ê°€</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #121212;
            color: #fff;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover { background: #1976d2; }
        button:disabled { background: #666; cursor: not-allowed; }
        .result {
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            background: #1e1e1e;
            border: 1px solid #333;
        }
        .success { border-color: #4caf50; }
        .error { border-color: #f44336; }
        pre {
            background: #0d0d0d;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ë¹ ë¥¸ ì¼ì • ì¶”ê°€ (ë¡œê·¸ì¸ ì—†ì´)</h1>
    
    <p>ì´ í˜ì´ì§€ëŠ” í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œ ë¡œê·¸ì¸ ì—†ì´ ê³µê°œ ì¼ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
    
    <button id="addBtn" onclick="addPublicSchedule()">ê³µê°œ í…ŒìŠ¤íŠ¸ ì¼ì • ì¶”ê°€</button>
    <button onclick="location.href='/'">ë©”ì¸ í˜ì´ì§€ë¡œ</button>
    
    <div id="result"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://ddfnxbkiewolgweivomv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkJXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
        
        async function addPublicSchedule() {
            const btn = document.getElementById('addBtn');
            btn.disabled = true;
            btn.textContent = 'ì¶”ê°€ ì¤‘...';
            
            try {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                // ë¨¼ì € í…Œì´ë¸”ì´ ìˆëŠ”ì§€ í™•ì¸
                const { data: checkData, error: checkError } = await supabase
                    .from('schedules')
                    .select('count')
                    .limit(1);
                
                if (checkError) {
                    throw new Error(`í…Œì´ë¸” í™•ì¸ ì‹¤íŒ¨: ${checkError.message}`);
                }
                
                // ê³µê°œ ì¼ì • ì¶”ê°€ (user_id ì—†ì´)
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                const schedule = {
                    title: 'ğŸ‰ ê³µê°œ í…ŒìŠ¤íŠ¸ ì¼ì •',
                    description: 'ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆëŠ” ê³µê°œ ì¼ì •ì…ë‹ˆë‹¤. ì´ ì¼ì •ì€ í…ŒìŠ¤íŠ¸ìš©ì…ë‹ˆë‹¤.',
                    event_date: tomorrow.toISOString().split('T')[0],
                    event_time: '15:00:00',
                    location: 'ì˜¨ë¼ì¸ ë¯¸íŒ…ë£¸',
                    category: 'general',
                    priority: 'normal',
                    status: 'upcoming',
                    color: '#4caf50',
                    user_id: null  // ê³µê°œ ì¼ì •
                };
                
                const { data, error } = await supabase
                    .from('schedules')
                    .insert([schedule])
                    .select();
                
                if (error) {
                    // RLS ì •ì±… ë•Œë¬¸ì— ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
                    if (error.message.includes('new row violates row-level security policy')) {
                        showError('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. RLS ì •ì±…ì— ì˜í•´ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì¼ì •ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        
                        // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì•ˆë‚´
                        setTimeout(() => {
                            if (confirm('ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                location.href = '/add-test-schedule.html';
                            }
                        }, 1000);
                    } else {
                        throw error;
                    }
                } else {
                    showSuccess('ì¼ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', data[0]);
                }
            } catch (error) {
                showError(error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ê³µê°œ í…ŒìŠ¤íŠ¸ ì¼ì • ì¶”ê°€';
            }
        }
        
        function showSuccess(message, data) {
            document.getElementById('result').innerHTML = `
                <div class="result success">
                    <h3>âœ… ${message}</h3>
                    ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
                    <p style="margin-top: 15px;">
                        <a href="/" style="color: #2196f3;">ë©”ì¸ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ê¸°</a>
                    </p>
                </div>
            `;
        }
        
        function showError(message) {
            document.getElementById('result').innerHTML = `
                <div class="result error">
                    <h3>âŒ ì˜¤ë¥˜</h3>
                    <p>${message}</p>
                </div>
            `;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì‹œë„
        window.addEventListener('load', () => {
            console.log('Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œë¨:', !!window.supabase);
        });
    </script>
</body>
</html>