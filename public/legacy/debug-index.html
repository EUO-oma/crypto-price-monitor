<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index.html ë””ë²„ê·¸</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #444;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        .info { color: #60a5fa; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        pre {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .code-error {
            background: #7f1d1d;
            color: #fecaca;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Index.html JavaScript ë””ë²„ê·¸</h1>
    
    <div class="section">
        <h2>1. ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬</h2>
        <button onclick="checkConsoleErrors()">ì½˜ì†” ì—ëŸ¬ í™•ì¸</button>
        <div id="console-errors"></div>
    </div>
    
    <div class="section">
        <h2>2. ì „ì—­ ë³€ìˆ˜ ìƒíƒœ</h2>
        <button onclick="checkGlobalVariables()">ì „ì—­ ë³€ìˆ˜ ê²€ì‚¬</button>
        <div id="global-vars"></div>
    </div>
    
    <div class="section">
        <h2>3. í•¨ìˆ˜ ì¡´ì¬ ì—¬ë¶€</h2>
        <button onclick="checkFunctions()">í•¨ìˆ˜ ê²€ì‚¬</button>
        <div id="functions"></div>
    </div>
    
    <div class="section">
        <h2>4. Supabase ìƒíƒœ</h2>
        <button onclick="checkSupabaseStatus()">Supabase ê²€ì‚¬</button>
        <div id="supabase-status"></div>
    </div>
    
    <div class="section">
        <h2>5. ë¬¸ë²• ì˜¤ë¥˜ ê²€ì‚¬</h2>
        <button onclick="testSyntax()">ë¬¸ë²• í…ŒìŠ¤íŠ¸</button>
        <div id="syntax-test"></div>
    </div>
    
    <div class="section">
        <h2>6. Index.html ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="loadIndexPage()">Index.html ë¡œë“œ</button>
        <button onclick="openIndexInNewTab()">ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</button>
        <iframe id="index-frame" src="" style="width: 100%; height: 400px; border: 1px solid #444; margin-top: 20px; display: none;"></iframe>
        <div id="load-result"></div>
    </div>

    <script>
        // ì½˜ì†” ì—ëŸ¬ ìˆ˜ì§‘
        let consoleErrors = [];
        window.addEventListener('error', (event) => {
            consoleErrors.push({
                message: event.message,
                source: event.filename,
                line: event.lineno,
                column: event.colno,
                error: event.error
            });
        });

        // 1. ì½˜ì†” ì—ëŸ¬ í™•ì¸
        function checkConsoleErrors() {
            const result = document.getElementById('console-errors');
            
            if (consoleErrors.length === 0) {
                result.innerHTML = '<p class="success">âœ… ì½˜ì†” ì—ëŸ¬ ì—†ìŒ</p>';
            } else {
                let html = '<p class="error">âŒ ì½˜ì†” ì—ëŸ¬ ë°œê²¬:</p>';
                consoleErrors.forEach((err, i) => {
                    html += `<div class="code-error">
                        <strong>ì—ëŸ¬ ${i + 1}:</strong> ${err.message}<br>
                        <small>íŒŒì¼: ${err.source}<br>
                        ìœ„ì¹˜: ë¼ì¸ ${err.line}, ì»¬ëŸ¼ ${err.column}</small>
                    </div>`;
                });
                result.innerHTML = html;
            }
        }
        
        // 2. ì „ì—­ ë³€ìˆ˜ í™•ì¸
        function checkGlobalVariables() {
            const result = document.getElementById('global-vars');
            
            const varsToCheck = [
                'supabase',
                'window.supabase',
                'window.supabaseClient',
                'LinksModule',
                'binanceBtcWs',
                'binanceEthWs',
                'binanceSolWs',
                'binanceXrpWs',
                'binanceAvaxWs'
            ];
            
            let html = '<h3>ì „ì—­ ë³€ìˆ˜ ìƒíƒœ:</h3><pre>';
            varsToCheck.forEach(varName => {
                try {
                    const value = eval(varName);
                    const type = typeof value;
                    const exists = value !== undefined;
                    html += `${varName}: ${exists ? 'âœ…' : 'âŒ'} (${type})\n`;
                } catch (e) {
                    html += `${varName}: âŒ (ì ‘ê·¼ ë¶ˆê°€)\n`;
                }
            });
            html += '</pre>';
            
            result.innerHTML = html;
        }
        
        // 3. í•¨ìˆ˜ í™•ì¸
        function checkFunctions() {
            const result = document.getElementById('functions');
            
            const functionsToCheck = [
                'loadLinksFromSupabase',
                'openChatPopup',
                'connectBinance',
                'updateTime',
                'savePriceHistory',
                'loadBTCHistory',
                'loadETHHistory',
                'loadSOLHistory'
            ];
            
            let html = '<h3>í•¨ìˆ˜ ì¡´ì¬ ì—¬ë¶€:</h3><pre>';
            functionsToCheck.forEach(funcName => {
                try {
                    const func = window[funcName];
                    const exists = typeof func === 'function';
                    html += `${funcName}: ${exists ? 'âœ…' : 'âŒ'}\n`;
                } catch (e) {
                    html += `${funcName}: âŒ (ì—ëŸ¬)\n`;
                }
            });
            html += '</pre>';
            
            result.innerHTML = html;
        }
        
        // 4. Supabase ìƒíƒœ í™•ì¸
        async function checkSupabaseStatus() {
            const result = document.getElementById('supabase-status');
            result.innerHTML = '<p class="info">ğŸ”„ Supabase í™•ì¸ ì¤‘...</p>';
            
            // Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸
            let html = '<h3>Supabase ìƒíƒœ:</h3>';
            
            if (!window.supabase) {
                html += '<p class="error">âŒ Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ</p>';
            } else {
                html += '<p class="success">âœ… Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œë¨</p>';
                
                try {
                    const SUPABASE_URL = 'https://ddfnxbkiewolgweivomv.supabase.co';
                    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
                    
                    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    html += '<p class="success">âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ê°€ëŠ¥</p>';
                    
                    // ì—°ê²° í…ŒìŠ¤íŠ¸
                    const { data, error } = await supabaseClient
                        .from('links')
                        .select('count', { count: 'exact', head: true });
                    
                    if (error) {
                        html += `<p class="error">âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨: ${error.message}</p>`;
                    } else {
                        html += '<p class="success">âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ</p>';
                    }
                } catch (e) {
                    html += `<p class="error">âŒ Supabase ì´ˆê¸°í™” ì‹¤íŒ¨: ${e.message}</p>`;
                }
            }
            
            result.innerHTML = html;
        }
        
        // 5. ë¬¸ë²• í…ŒìŠ¤íŠ¸
        function testSyntax() {
            const result = document.getElementById('syntax-test');
            
            // ì¼ë°˜ì ì¸ ë¬¸ë²• ì˜¤ë¥˜ íŒ¨í„´ í…ŒìŠ¤íŠ¸
            const tests = [
                {
                    name: 'ë”°ì˜´í‘œ ë§¤ì¹­ í…ŒìŠ¤íŠ¸',
                    code: `const test = 'hello world'; return true;`
                },
                {
                    name: 'ì¤‘ì²© ë”°ì˜´í‘œ í…ŒìŠ¤íŠ¸',
                    code: `const test = "hello 'world'"; return true;`
                },
                {
                    name: 'í…œí”Œë¦¿ ë¦¬í„°ëŸ´ í…ŒìŠ¤íŠ¸',
                    code: `const test = \`hello \${1 + 1} world\`; return test === 'hello 2 world';`
                },
                {
                    name: 'í•¨ìˆ˜ ì •ì˜ í…ŒìŠ¤íŠ¸',
                    code: `function test() { return true; } return test();`
                },
                {
                    name: 'ë¹„ë™ê¸° í•¨ìˆ˜ í…ŒìŠ¤íŠ¸',
                    code: `async function test() { return Promise.resolve(true); } return true;`
                }
            ];
            
            let html = '<h3>ë¬¸ë²• í…ŒìŠ¤íŠ¸ ê²°ê³¼:</h3>';
            tests.forEach(test => {
                try {
                    const func = new Function(test.code);
                    const result = func();
                    html += `<p class="success">âœ… ${test.name}: ${result ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}</p>`;
                } catch (e) {
                    html += `<p class="error">âŒ ${test.name}: ${e.message}</p>`;
                }
            });
            
            result.innerHTML = html;
        }
        
        // 6. Index.html ë¡œë“œ
        function loadIndexPage() {
            const iframe = document.getElementById('index-frame');
            const result = document.getElementById('load-result');
            
            iframe.style.display = 'block';
            iframe.src = 'index.html';
            
            result.innerHTML = '<p class="info">ğŸ”„ Index.html ë¡œë”© ì¤‘... (ê°œë°œì ë„êµ¬ ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”)</p>';
            
            // iframe ë¡œë“œ ì™„ë£Œ ê°ì§€
            iframe.onload = () => {
                result.innerHTML = '<p class="success">âœ… Index.html ë¡œë“œ ì™„ë£Œ</p>';
                
                // iframe ë‚´ë¶€ ì—ëŸ¬ í™•ì¸ ì‹œë„
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const errors = iframeDoc.querySelectorAll('.error');
                    if (errors.length > 0) {
                        result.innerHTML += `<p class="warning">âš ï¸ í˜ì´ì§€ ë‚´ ì—ëŸ¬ ìš”ì†Œ ${errors.length}ê°œ ë°œê²¬</p>`;
                    }
                } catch (e) {
                    console.log('iframe ì ‘ê·¼ ì œí•œ');
                }
            };
            
            iframe.onerror = (e) => {
                result.innerHTML = `<p class="error">âŒ Index.html ë¡œë“œ ì‹¤íŒ¨: ${e.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</p>`;
            };
        }
        
        function openIndexInNewTab() {
            window.open('index.html', '_blank');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ê²€ì‚¬
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ë””ë²„ê·¸ í˜ì´ì§€ ì¤€ë¹„ ì™„ë£Œ');
        });
    </script>
</body>
</html>