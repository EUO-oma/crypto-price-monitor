<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ê²½ ë³€ìˆ˜ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #61dafb; }
        h2 { color: #ffd700; margin-top: 30px; }
        .section {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        .good { color: #4caf50; }
        .bad { color: #f44336; }
        .warning { color: #ff9800; }
        .code {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>ğŸ”§ í™˜ê²½ ë³€ìˆ˜ ë° ì„¤ì • í…ŒìŠ¤íŠ¸</h1>
    
    <div class="section">
        <h2>1. ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ìƒíƒœ</h2>
        <div id="script-status"></div>
    </div>

    <div class="section">
        <h2>2. í™˜ê²½ ë³€ìˆ˜ í™•ì¸</h2>
        <div id="env-check"></div>
    </div>

    <div class="section">
        <h2>3. Supabase ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testSupabase()">Supabase í…ŒìŠ¤íŠ¸</button>
        <div id="supabase-test"></div>
    </div>

    <div class="section">
        <h2>4. ì „ì²´ ì„¤ì • ë¤í”„</h2>
        <button onclick="dumpConfig()">ì„¤ì • ë³´ê¸°</button>
        <div id="config-dump"></div>
    </div>

    <div class="section">
        <h2>5. ë„¤íŠ¸ì›Œí¬ ì •ë³´</h2>
        <div id="network-info"></div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì •ë³´ ìˆ˜ì§‘
        window.addEventListener('DOMContentLoaded', () => {
            checkScripts();
            checkEnvironment();
            checkNetwork();
        });

        function checkScripts() {
            const statusDiv = document.getElementById('script-status');
            let html = '';

            // config-env.js í™•ì¸
            html += checkScript('config-env.js', window.ENV_CONFIG);
            html += checkScript('config-loader.js', window.APP_CONFIG);
            html += checkScript('config.js (ë¡œì»¬)', window.APP_CONFIG && !window.ENV_CONFIG);
            html += checkScript('Supabase SDK', window.supabase);
            html += checkScript('auth-helper.js', window.getSupabaseClient);

            statusDiv.innerHTML = html;
        }

        function checkScript(name, exists) {
            return `<div class="${exists ? 'good' : 'bad'}">
                ${exists ? 'âœ…' : 'âŒ'} ${name}: ${exists ? 'ë¡œë“œë¨' : 'ë¡œë“œ ì‹¤íŒ¨'}
            </div>`;
        }

        function checkEnvironment() {
            const envDiv = document.getElementById('env-check');
            let html = '';

            // ENV_CONFIG í™•ì¸
            if (window.ENV_CONFIG) {
                html += '<h3>ENV_CONFIG (Netlify ë¹Œë“œ):</h3>';
                html += '<div class="code">' + JSON.stringify(window.ENV_CONFIG, null, 2) + '</div>';
            }

            // APP_CONFIG í™•ì¸
            if (window.APP_CONFIG) {
                html += '<h3>APP_CONFIG (ë³‘í•©ëœ ì„¤ì •):</h3>';
                const safeConfig = JSON.parse(JSON.stringify(window.APP_CONFIG));
                
                // ë¯¼ê°í•œ ì •ë³´ ë§ˆìŠ¤í‚¹
                if (safeConfig.SUPABASE?.ANON_KEY) {
                    safeConfig.SUPABASE.ANON_KEY = safeConfig.SUPABASE.ANON_KEY.substring(0, 20) + '...';
                }
                if (safeConfig.FIREBASE?.apiKey) {
                    safeConfig.FIREBASE.apiKey = safeConfig.FIREBASE.apiKey.substring(0, 10) + '...';
                }
                
                html += '<div class="code">' + JSON.stringify(safeConfig, null, 2) + '</div>';
            }

            // ì¤‘ìš” ë³€ìˆ˜ í™•ì¸
            html += '<h3>ì¤‘ìš” ë³€ìˆ˜ ìƒíƒœ:</h3>';
            const supabaseUrl = window.getConfig?.('SUPABASE.URL') || window.APP_CONFIG?.SUPABASE?.URL;
            const supabaseKey = window.getConfig?.('SUPABASE.ANON_KEY') || window.APP_CONFIG?.SUPABASE?.ANON_KEY;
            
            html += `<div class="${supabaseUrl ? 'good' : 'bad'}">
                ${supabaseUrl ? 'âœ…' : 'âŒ'} SUPABASE_URL: ${supabaseUrl ? supabaseUrl : 'ì„¤ì •ë˜ì§€ ì•ŠìŒ'}
            </div>`;
            html += `<div class="${supabaseKey ? 'good' : 'bad'}">
                ${supabaseKey ? 'âœ…' : 'âŒ'} SUPABASE_ANON_KEY: ${supabaseKey ? 'ì„¤ì •ë¨' : 'ì„¤ì •ë˜ì§€ ì•ŠìŒ'}
            </div>`;

            envDiv.innerHTML = html;
        }

        function checkNetwork() {
            const networkDiv = document.getElementById('network-info');
            let html = '<h3>í˜„ì¬ í™˜ê²½:</h3>';
            
            html += `<div>URL: ${window.location.href}</div>`;
            html += `<div>í˜¸ìŠ¤íŠ¸: ${window.location.hostname}</div>`;
            html += `<div>í”„ë¡œí† ì½œ: ${window.location.protocol}</div>`;
            html += `<div>Netlify í™˜ê²½: ${window.location.hostname.includes('netlify') ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</div>`;
            
            networkDiv.innerHTML = html;
        }

        async function testSupabase() {
            const testDiv = document.getElementById('supabase-test');
            testDiv.innerHTML = '<div class="warning">í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            try {
                // config-env.js ë¡œë“œ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Supabase í´ë¼ì´ì–¸íŠ¸ ê°€ì ¸ì˜¤ê¸°
                const supabase = window.getSupabaseClient ? window.getSupabaseClient() : null;
                
                if (!supabase) {
                    throw new Error('Supabase í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ê°„ë‹¨í•œ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
                const { data, error } = await supabase
                    .from('messages')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    throw error;
                }
                
                testDiv.innerHTML = '<div class="good">âœ… Supabase ì—°ê²° ì„±ê³µ!</div>';
            } catch (error) {
                testDiv.innerHTML = `<div class="bad">âŒ Supabase ì—°ê²° ì‹¤íŒ¨: ${error.message}</div>`;
                console.error('Supabase í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        function dumpConfig() {
            const dumpDiv = document.getElementById('config-dump');
            let html = '<h3>ì „ì²´ window ê°ì²´ì˜ ê´€ë ¨ ì†ì„±:</h3>';
            
            const relevantProps = [
                'ENV_CONFIG',
                'APP_CONFIG',
                'SUPABASE_URL',
                'SUPABASE_ANON_KEY',
                'supabase',
                'supabaseClient',
                'getSupabaseClient',
                'getConfig',
                'debugLog'
            ];
            
            relevantProps.forEach(prop => {
                if (window[prop] !== undefined) {
                    const value = typeof window[prop] === 'function' ? 'function' : 
                                 typeof window[prop] === 'object' ? JSON.stringify(window[prop], null, 2).substring(0, 100) + '...' :
                                 String(window[prop]).substring(0, 50);
                    html += `<div><strong>${prop}:</strong> ${value}</div>`;
                }
            });
            
            dumpDiv.innerHTML = '<div class="code">' + html + '</div>';
        }
    </script>
    
    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ (config-env.jsê°€ ë¨¼ì €) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config-env.js"></script>
    <script src="config-loader.js"></script>
    <script src="auth-helper.js"></script>
</body>
</html>