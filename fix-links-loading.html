<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Links Loading</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .code-block {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>🔧 Links Loading 수정 가이드</h1>
    
    <div class="code-block">
        <h2>문제 분석</h2>
        <p>index.html에서 링크가 로드되지 않는 이유:</p>
        <ol>
            <li>LinksModule이 로드되기 전에 실행됨</li>
            <li>Supabase 초기화 타이밍 문제</li>
            <li>비동기 로딩 순서 문제</li>
        </ol>
    </div>
    
    <div class="code-block">
        <h2>해결 방법</h2>
        <p>index.html의 스크립트 부분을 다음과 같이 수정하세요:</p>
        <pre><code>// 페이지 로드시 링크 데이터 가져오기
window.addEventListener('DOMContentLoaded', async () => {
    console.log('=== 링크 로딩 시작 ===');
    
    // 1. 직접 Supabase 초기화 및 로드 (간단한 방법)
    try {
        // Supabase가 로드될 때까지 대기
        let attempts = 0;
        while (!window.supabase && attempts < 10) {
            console.log('Supabase 대기 중...');
            await new Promise(resolve => setTimeout(resolve, 200));
            attempts++;
        }
        
        if (!window.supabase) {
            throw new Error('Supabase 라이브러리를 찾을 수 없습니다');
        }
        
        // Supabase 클라이언트 생성
        const SUPABASE_URL = 'https://ddfnxbkiewolgweivomv.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZm54YmtpZXdvbGd3ZWl2b212Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MzI3NzYsImV4cCI6MjA2NzIwODc3Nn0.YCS2UH6YWarPX3C2ryFUUQnFA-3er_ZQomf_mccjmD8';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        console.log('✅ Supabase 초기화 완료');
        
        // 링크 조회
        const { data: links, error } = await supabase
            .from('links')
            .select('*')
            .order('position', { ascending: true });
        
        if (error) throw error;
        
        console.log(`✅ ${links.length}개 링크 로드 완료`);
        
        // 카테고리별 분류
        const gptLinks = links.filter(link => link.category === 'gpt');
        const youtubeLinks = links.filter(link => link.category === 'youtube');
        const favoriteLinks = links.filter(link => link.category === 'favorite');
        
        // GPT 링크 렌더링
        const gptContainer = document.getElementById('gpt-links');
        if (gptContainer && gptLinks.length > 0) {
            gptContainer.innerHTML = gptLinks.map(link => `
                &lt;a href="${link.url}" target="_blank" class="link-card"&gt;
                    ${link.name}
                &lt;/a&gt;
            `).join('');
        }
        
        // YouTube 링크 렌더링
        const youtubeContainer = document.getElementById('youtube-links');
        if (youtubeContainer && youtubeLinks.length > 0) {
            youtubeContainer.innerHTML = youtubeLinks.map(link => `
                &lt;a href="${link.url}" target="_blank" class="link-card"&gt;
                    ${link.name}
                &lt;/a&gt;
            `).join('');
        }
        
        // Favorite 링크 렌더링
        const favoriteContainer = document.getElementById('favorite-links');
        if (favoriteContainer && favoriteLinks.length > 0) {
            favoriteContainer.innerHTML = favoriteLinks.map(link => `
                &lt;a href="${link.url}" target="_blank" class="link-card"&gt;
                    ${link.name}
                &lt;/a&gt;
            `).join('');
        }
        
    } catch (error) {
        console.error('❌ 링크 로딩 실패:', error);
    }
});</code></pre>
    </div>
    
    <div class="code-block">
        <h2>또는 기존 함수 수정</h2>
        <p>loadLinksFromSupabase 함수 시작 부분 수정:</p>
        <pre><code>async function loadLinksFromSupabase() {
    console.log('Loading links from Supabase...');
    
    // Supabase 라이브러리 대기
    let attempts = 0;
    while (!window.supabase && attempts < 10) {
        console.log('Waiting for Supabase library...');
        await new Promise(resolve => setTimeout(resolve, 200));
        attempts++;
    }
    
    // 나머지 코드는 그대로...
}</code></pre>
    </div>
    
    <button onclick="copyFix()">수정 코드 복사</button>
    <div id="copy-result"></div>

    <script>
        function copyFix() {
            const fixCode = `// Supabase 라이브러리 대기
let attempts = 0;
while (!window.supabase && attempts < 10) {
    console.log('Waiting for Supabase library...');
    await new Promise(resolve => setTimeout(resolve, 200));
    attempts++;
}`;
            
            navigator.clipboard.writeText(fixCode).then(() => {
                document.getElementById('copy-result').innerHTML = '<p class="success">✅ 복사되었습니다!</p>';
            });
        }
    </script>
</body>
</html>